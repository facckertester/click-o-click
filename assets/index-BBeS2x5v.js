var Pt=Object.defineProperty,xt=Object.defineProperties;var St=Object.getOwnPropertyDescriptors;var _e=Object.getOwnPropertySymbols;var kt=Object.prototype.hasOwnProperty,Ct=Object.prototype.propertyIsEnumerable;var Fe=(o,u,w)=>u in o?Pt(o,u,{enumerable:!0,configurable:!0,writable:!0,value:w}):o[u]=w,l=(o,u)=>{for(var w in u||(u={}))kt.call(u,w)&&Fe(o,w,u[w]);if(_e)for(var w of _e(u))Ct.call(u,w)&&Fe(o,w,u[w]);return o},i=(o,u)=>xt(o,St(u));var Lt=(o,u)=>()=>(u||o((u={exports:{}}).exports,u),u.exports);var se=(o,u,w)=>new Promise((I,x)=>{var S=E=>{try{D(w.next(E))}catch(G){x(G)}},j=E=>{try{D(w.throw(E))}catch(G){x(G)}},D=E=>E.done?I(E.value):Promise.resolve(E.value).then(S,j);D((w=w.apply(o,u)).next())});import{j as a,r as y,a as Tt,R as Et}from"./vendor-react-CUeQczFW.js";import{t as e,f as q,T as We,j as $e,B as J,P as jt,g as ze,p as me,A as Mt,k as Gt,l as ge,M as It,b as Dt,m as He,i as Bt,d as Ot,e as Nt,c as Ut,q as Rt,a as At}from"./core-B2DWBvsF.js";import{a as Je,T as _t,G as Ft}from"./components-ui-shO_GMmo.js";import{B as Ke,P as Xe}from"./components-store-e3GU96g1.js";import{M as Ve}from"./components-main-DoGkSMZK.js";import{s as Ye,a as ie,O as Wt,E as $t,T as zt,P as Ht,S as Jt,b as Kt,c as Xt,C as Vt,R as Yt,L as qt,d as Qt,u as Zt}from"./components-modals-DPFD1T_r.js";import{P as eo}from"./components-services-IDmCsBj4.js";import"./vendor-DdgGw12P.js";import"./components-achievements-Be1VGs35.js";import"./vendor-firebase-IMiYFFvY.js";var ro=Lt(ae=>{(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const x of document.querySelectorAll('link[rel="modulepreload"]'))I(x);new MutationObserver(x=>{for(const S of x)if(S.type==="childList")for(const j of S.addedNodes)j.tagName==="LINK"&&j.rel==="modulepreload"&&I(j)}).observe(document,{childList:!0,subtree:!0});function w(x){const S={};return x.integrity&&(S.integrity=x.integrity),x.referrerPolicy&&(S.referrerPolicy=x.referrerPolicy),x.crossOrigin==="use-credentials"?S.credentials="include":x.crossOrigin==="anonymous"?S.credentials="omit":S.credentials="same-origin",S}function I(x){if(x.ep)return;x.ep=!0;const S=w(x);fetch(x.href,S)}})();const to=({gameState:o})=>{const{weather:u,buildings:w,totalGold:I}=o,x=Q=>{var O;return((O=w[Q])==null?void 0:O.toNumber())||0};let S="wilderness";x("palace")>0?S="empire":x("castle")>0||x("market")>0?S="city":(x("peasant")>20||x("field")>10||I.gt(e(500)))&&(S="hamlet");let j="",D="";switch(S){case"wilderness":j="linear-gradient(to bottom, #87CEEB 0%, #87CEEB 60%, #556B2F 60%, #556B2F 100%)",D="ðŸŒ² ðŸŒ³ ðŸŒ² ðŸ¦Œ ðŸŒ² ðŸŒ¿";break;case"hamlet":j="linear-gradient(to bottom, #87CEEB 0%, #87CEEB 65%, #8B4513 65%, #228B22 80%)",D="ðŸ¡ ðŸŒ¾ ðŸ„ ðŸ¡ ðŸŒ¾ ðŸšœ";break;case"city":j="linear-gradient(to bottom, #B0C4DE 0%, #B0C4DE 60%, #696969 60%, #808080 100%)",D="ðŸ° ðŸ  âš’ï¸ ðŸ  âš–ï¸ ðŸ ";break;case"empire":j="linear-gradient(to bottom, #191970 0%, #4B0082 50%, #FFD700 100%)",D="ðŸ¯ ðŸ’‚ ðŸ›ï¸ ðŸ‰ ðŸ›ï¸ ðŸ’‚";break}const E=u.current;let G="none",U="",W=0;return E==="rainy"?(G="linear-gradient(to bottom, rgba(0,0,50,0.3), rgba(0,0,100,0.3))",U="ðŸŒ§ï¸ ðŸŒ§ï¸ ðŸŒ§ï¸ ðŸŒ§ï¸ ðŸŒ§ï¸",W=1):E==="stormy"?(G="linear-gradient(to bottom, rgba(0,0,0,0.6), rgba(50,50,50,0.6))",U="âš¡ â›ˆï¸ âš¡ â›ˆï¸ âš¡",W=1):E==="sunny"?(G="radial-gradient(circle at top right, rgba(255,255,0,0.3), transparent)",U="â˜€ï¸",W=.6):E==="windy"&&(U="ðŸƒ ðŸƒ ðŸƒ",W=.8),a.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:j,display:"flex",flexDirection:"column",justifyContent:"flex-end",alignItems:"center",paddingBottom:"20vh",zIndex:0,overflow:"hidden",transition:"background 2s ease"},children:[a.jsx("div",{style:{position:"absolute",top:"10%",width:"100%",textAlign:"center",fontSize:"5rem",opacity:W,animation:E==="windy"?"float 3s infinite ease-in-out":"none"},children:U}),G!=="none"&&a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:G,pointerEvents:"none"}}),a.jsx("div",{style:{fontSize:"4rem",textAlign:"center",zIndex:1,textShadow:"0 4px 4px rgba(0,0,0,0.3)",whiteSpace:"nowrap"},children:D}),a.jsx("div",{style:{marginTop:"20px",fontSize:"1.5rem",color:"#fff",textShadow:"2px 2px 4px #000",fontStyle:"italic",zIndex:2,background:"rgba(0,0,0,0.5)",padding:"5px 15px",borderRadius:"15px"},children:"The Kingdom sleeps..."}),a.jsx("style",{children:`
            @keyframes float {
                0% { transform: translateX(0px); }
                50% { transform: translateX(20px); }
                100% { transform: translateX(0px); }
            }
        `})]})},F={density:"normal",showFloatingText:!0,showWeatherWidget:!0,reduceMotion:!1,crownAnimations:!0,lastBuyAmount:e(1),layout:{left:e(1),center:e(1),right:e(1)},borderWidth:e(4),customColors:{enabled:!1,bg:"#e8dcc5",panel:"#fdf6e3",text:"#3e2723",secondaryText:"#5d4037",accent:"#8d6e63",accentHover:"#6d4c41",gold:"#bf9000",border:"#a1887f",success:"#2e7d32",danger:"#c62828"}},_={gold:e(0),totalGold:e(0),totalRenownEarned:e(0),startTime:e(Date.now()),lastSaveTime:e(Date.now()),buildings:{},achievements:[],renown:e(0),prestigeCount:0,darkMatterGold:e(0),infiniteTowerLevel:0,portalProgress:0,nationalProjects:{},clickUpgradeLevel:0,offlineUpgradeLevel:0,weather:{current:"clear",timeLeft:e(120)},event:null,theme:"default",numberFormat:"standard",idleModeEnabled:!1,interface:F,stats:{totalClicks:e(0),currentPrestigeClicks:e(0),dragonsKilled:e(0),tavernGamesPlayed:e(0),prestigeCount:0,infiniteTowerLevel:0,darkMatterGold:e(0),portalProgress:0,clickUpgradeLevel:0,offlineUpgradeLevel:0,totalBuildingsPurchased:e(0),totalGoldSpent:e(0)},playerProfile:null,isDeveloperWifeBlessingObtained:!1,globalIncomeMultiplier:1},K=o=>{if(o==null||typeof o=="string"||typeof o=="number"||typeof o=="boolean")return o;if(Array.isArray(o))return o.map(K);if(typeof o=="object"&&o.toString&&typeof o.toString=="function"&&(o.hasOwnProperty("mantissa")||o.hasOwnProperty("exponent")))return o.toString();if(typeof o=="object"){const u={};for(const w in o)o.hasOwnProperty(w)&&(u[w]=K(o[w]));return u}return o},oo=()=>{var Ee,je;const[o,u]=y.useState(()=>{var t,r,s,d,f,h,p,P,g,C,v,T,N,R,L,M,$,re,Me,Ge,Ie,De,Be,Oe,Ne,Ue,Re;const n=localStorage.getItem("kingdom_save");if(n)try{const c=JSON.parse(n);if((t=c.playerProfile)!=null&&t.id){const m=localStorage.getItem(`playerProfile_${c.playerProfile.id}`);m&&(c.playerProfile=JSON.parse(m))}const A=c.interface||{},Ae=i(l(l({},F),A),{lastBuyAmount:e((r=A.lastBuyAmount)!=null?r:1),crownAnimations:(s=A.crownAnimations)!=null?s:!0,layout:{left:e((f=(d=A.layout)==null?void 0:d.left)!=null?f:F.layout.left),center:e((p=(h=A.layout)==null?void 0:h.center)!=null?p:F.layout.center),right:e((g=(P=A.layout)==null?void 0:P.right)!=null?g:F.layout.right)},borderWidth:e((C=A.borderWidth)!=null?C:F.borderWidth),customColors:l(l({},F.customColors),A.customColors||{})});return i(l(l({},_),c),{renown:e(c.renown||0),totalRenownEarned:e(c.totalRenownEarned||0),prestigeCount:c.prestigeCount||0,gold:e(c.gold||0),totalGold:e(c.totalGold||0),startTime:e(c.startTime||Date.now()),lastSaveTime:e(c.lastSaveTime||Date.now()),darkMatterGold:e(c.darkMatterGold||0),infiniteTowerLevel:c.infiniteTowerLevel||0,portalProgress:c.portalProgress||0,buildings:Object.keys(c.buildings||{}).reduce((m,k)=>(m[k]=e(c.buildings[k]),m),{}),stats:i(l(l({},_.stats),c.stats||{}),{totalClicks:e(((v=c.stats)==null?void 0:v.totalClicks)||0),currentPrestigeClicks:e(((T=c.stats)==null?void 0:T.currentPrestigeClicks)||0),dragonsKilled:e(((N=c.stats)==null?void 0:N.dragonsKilled)||0),tavernGamesPlayed:e(((R=c.stats)==null?void 0:R.tavernGamesPlayed)||0),prestigeCount:((L=c.stats)==null?void 0:L.prestigeCount)||0,infiniteTowerLevel:((M=c.stats)==null?void 0:M.infiniteTowerLevel)||0,darkMatterGold:e((($=c.stats)==null?void 0:$.darkMatterGold)||0),portalProgress:((re=c.stats)==null?void 0:re.portalProgress)||0,clickUpgradeLevel:((Me=c.stats)==null?void 0:Me.clickUpgradeLevel)||0,offlineUpgradeLevel:((Ge=c.stats)==null?void 0:Ge.offlineUpgradeLevel)||0,totalBuildingsPurchased:e(((Ie=c.stats)==null?void 0:Ie.totalBuildingsPurchased)||0),totalGoldSpent:e(((De=c.stats)==null?void 0:De.totalGoldSpent)||0)}),nationalProjects:c.nationalProjects||{},clickUpgradeLevel:c.clickUpgradeLevel||0,offlineUpgradeLevel:c.offlineUpgradeLevel||0,interface:Ae,playerProfile:c.playerProfile?i(l({},c.playerProfile),{lastLeaderboardSubmit:c.playerProfile.lastLeaderboardSubmit||0}):null,globalIncomeMultiplier:c.globalIncomeMultiplier||1,isDeveloperWifeBlessingObtained:c.isDeveloperWifeBlessingObtained||!1})}catch(c){console.error("Save load failed",c)}return _}),w=y.useRef(o);y.useEffect(()=>{w.current=o},[o]);const I=y.useRef("");y.useEffect(()=>{const n=t=>{I.current=(I.current+t.key).slice(-20);const r=I.current.toLowerCase();r.endsWith("godon")?(u(s=>i(l({},s),{godMode:!0})),b("God Mode Enabled: +99999s per click","success"),I.current=""):r.endsWith("godoff")&&(u(s=>i(l({},s),{godMode:!1})),b("God Mode Disabled","info"),I.current="")};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[]);const x=()=>{Z(null);const n=localStorage.getItem("kingdom_last_save_time"),t=Date.now();if(n){const r=t-parseInt(n),s=e(r/1e3);if(s.gte(e(60))){const d=o.offlineUpgradeLevel||0,{efficiency:f,duration:h}=$e(d),p=e(h),P=s.lt(p)?s:p,C=X(o).times(e(f)).times(P).floor();C.gt(e(0))&&(Z({gained:C,effectiveTime:P,totalTime:s,efficiency:f,completedProjects:[],currentLevel:d,maxDuration:h}),u(v=>i(l({},v),{gold:v.gold.plus(C),totalGold:v.totalGold.plus(C)})))}}localStorage.setItem("kingdom_last_save_time",t.toString())},[S,j]=y.useState(!1);y.useEffect(()=>{let n;const t=()=>{j(!1),clearTimeout(n),o.idleModeEnabled&&(n=setTimeout(()=>{j(!0)},2e4))};t();const r=["mousemove","mousedown","keydown","touchstart","scroll"];return r.forEach(s=>window.addEventListener(s,t)),()=>{clearTimeout(n),r.forEach(s=>window.removeEventListener(s,t))}},[o.idleModeEnabled]),y.useEffect(()=>{o.event&&j(!1)},[o.event]),y.useEffect(()=>{const n=q(o.gold);document.title=`Gold: ${n} - Kingdom Clicker`},[o.gold]),y.useEffect(()=>{const n=document.documentElement,t=o.interface||F,r=o.theme||"default",s=We[r]||We.default;s&&Object.entries(s.colors).forEach(([h,p])=>{n.style.setProperty(h,p)});const d={compact:"8px",normal:"12px",spacious:"20px"},f={compact:"6px",normal:"12px",spacious:"16px"};n.style.setProperty("--panel-padding",d[t.density]),n.style.setProperty("--gap-size",f[t.density]),n.style.setProperty("--col-left",String(t.layout.left)),n.style.setProperty("--col-center",String(t.layout.center)),n.style.setProperty("--col-right",String(t.layout.right)),t.reduceMotion?document.body.classList.add("no-motion"):document.body.classList.remove("no-motion")},[o.theme,o.interface]);const[D,E]=y.useState(!1);y.useEffect(()=>{var n;o.gold.gte(e(1e7))&&!((n=o.playerProfile)!=null&&n.hasChosenName)&&!D&&ve(!0)},[o.gold,o.playerProfile,D]);const[G,U]=y.useState(null),[W,Q]=y.useState([]),[O,Z]=y.useState(null),[pe,Qe]=y.useState("buildings"),[he,Ze]=y.useState("army"),[ee,et]=y.useState(!1),[B,te]=y.useState("throne");y.useEffect(()=>{const n=()=>{et(window.innerWidth<768)};return n(),window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]);const[tt,ce]=y.useState(!1),[ot,oe]=y.useState(!1),[nt,z]=y.useState(!1),[rt,lt]=y.useState(!1),[st,de]=y.useState(!1),[it,ne]=y.useState(!1),[ye,ve]=y.useState(!1),[be,ue]=y.useState(!1),[at,fe]=y.useState(!1),[we,Pe]=y.useState(!1),b=(n,t="info")=>{const r=Date.now().toString()+Math.random();Q(s=>[...s,{id:r,message:n,type:t}]),setTimeout(()=>{Q(s=>s.filter(d=>d.id!==r))},3e3)};y.useEffect(()=>{const n=Date.now();if(o.lastSaveTime&&e(n).minus(o.lastSaveTime).gt(e(6e4))){const t=e(n).minus(o.lastSaveTime).dividedBy(e(1e3)),{efficiency:r,duration:s}=$e(o.offlineUpgradeLevel||0),d=e(s),f=t.lt(d)?t:d,p=X(o).times(e(r)).times(f).floor(),P=[];let g=l({},o.nationalProjects),C=!1;Object.keys(g).forEach(v=>{var N;const T=g[v];if(T.active&&T.endTime&&n>=T.endTime){g[v]=i(l({},T),{active:!1,level:T.level+1,startTime:0,endTime:0});const R=(N=J.find(L=>L.id===v))==null?void 0:N.name;R&&P.push(`${R} Infrastructure (Lvl ${T.level+1})`),C=!0}}),(p.gt(e(0))||P.length>0)&&(Z(v=>v||{gained:p,effectiveTime:f,totalTime:t,efficiency:r,completedProjects:P,currentLevel:o.offlineUpgradeLevel||0,maxDuration:s}),u(v=>i(l({},v),{gold:v.gold.plus(p),totalGold:v.totalGold.plus(p),nationalProjects:C?g:v.nationalProjects})))}},[]),y.useEffect(()=>{const n=setInterval(()=>{Date.now()%3e4<1e3&&u(t=>{const r=i(l({},t),{lastSaveTime:e(Date.now())}),s=K(r);return localStorage.setItem("kingdom_save",JSON.stringify(s)),r})},1e3);return()=>clearInterval(n)},[]),y.useEffect(()=>{const n=()=>{const r=w.current,s=K(r);localStorage.setItem("kingdom_save",JSON.stringify(s)),localStorage.setItem("kingdom_last_save_time",Date.now().toString())};window.addEventListener("beforeunload",n);const t=()=>{document.visibilityState==="hidden"?n():document.visibilityState==="visible"&&x()};return document.addEventListener("visibilitychange",t),()=>{window.removeEventListener("beforeunload",n),document.removeEventListener("visibilitychange",t)}},[]),y.useEffect(()=>{var r;if(!((r=o.playerProfile)!=null&&r.hasChosenName))return;(()=>{var h;const s=Date.now(),d=((h=o.playerProfile)==null?void 0:h.lastLeaderboardSubmit)||0,f=3600*1e3;if(s-d>=f){const p={rulerName:o.playerProfile.rulerName,rulerId:o.playerProfile.rulerId,gold:o.totalGold,renown:o.totalRenownEarned,achievements:o.achievements.length,totalClicks:o.stats.totalClicks};Promise.all([ie(i(l({},p),{period:"alltime"})),ie(i(l({},p),{period:"weekly"})),Ye(o,o.playerProfile.rulerId,o.playerProfile.rulerName)]).then(()=>{u(P=>i(l({},P),{playerProfile:i(l({},P.playerProfile),{lastLeaderboardSubmit:Date.now()})})),b("Leaderboard data synced on load!","success")}).catch(P=>{console.error("Initial leaderboard submission failed:",P)})}})();const t=setInterval(()=>{var p;const s=w.current,d=Date.now(),f=((p=s.playerProfile)==null?void 0:p.lastLeaderboardSubmit)||0,h=3600*1e3;if(d-f>=h){Ye(s,s.playerProfile.rulerId,s.playerProfile.rulerName).catch(g=>{console.error("Failed to save player stats:",g)});const P={rulerName:s.playerProfile.rulerName,rulerId:s.playerProfile.rulerId,gold:s.totalGold,renown:s.totalRenownEarned,achievements:s.achievements.length,totalClicks:s.stats.totalClicks};Promise.all([ie(i(l({},P),{period:"alltime"})),ie(i(l({},P),{period:"weekly"}))]).then(()=>{u(g=>i(l({},g),{playerProfile:i(l({},g.playerProfile),{lastLeaderboardSubmit:Date.now()})})),b("Leaderboard data submitted successfully!","success")}).catch(g=>{console.error("Auto leaderboard submission failed:",g)})}},6e4);return()=>clearInterval(t)},[(Ee=o.playerProfile)==null?void 0:Ee.hasChosenName]),y.useEffect(()=>{const n=setInterval(()=>{if(!o.event&&Math.random()<.05){const s=["dragon","merchant","jester"],d=s[Math.floor(Math.random()*s.length)],f=d==="dragon"?6e5:3e4,h={id:Date.now().toString(),type:d,expiresAt:e(Date.now()).plus(e(f)),hp:d==="dragon"?e(10):void 0,maxHp:d==="dragon"?e(10):void 0,reward:e(0),startTime:d==="dragon"?Date.now():void 0};u(p=>i(l({},p),{event:h}))}},1e4);return()=>clearInterval(n)},[o.event]);const X=n=>{var P;let t=e(0);const r=((P=n.weather)==null?void 0:P.current)||"clear";J.forEach(g=>{const C=n.buildings[g.id]||e(0);let v=g.baseProduction;t=t.plus(C.times(v))});const s=Je(n.totalRenownEarned);s.gt(e(1))&&(t=t.times(s));let d=0;n.nationalProjects&&Object.values(n.nationalProjects).forEach(g=>{d+=g.level||0});const f=e(1).plus(e(d*jt));t=t.times(f);const h=ze(n.infiniteTowerLevel||0);t=t.times(h),e(1),J.forEach(g=>{const C=n.buildings[g.id]||e(0);if(C.gt(0)){let v=e(1);r==="sunny"?(g.id==="peasant"||g.id==="field"||g.id==="stable"||g.id==="cathedral")&&(v=e(1.2)):r==="rainy"?(g.id==="silver_mine"||g.id==="alchemist"||g.id==="market"||g.id==="tavern")&&(v=e(1.2)):r==="stormy"?((g.id==="blacksmith"||g.id==="void_portal")&&(v=e(1.3)),(g.id==="field"||g.id==="stable")&&(v=e(.8))):r==="windy"&&(g.id==="market"||g.id==="castle"||g.id==="time_chamber")&&(v=e(1.15));const T=C.times(g.baseProduction);if(s.gt(e(1))){const N=T.times(s).times(f).times(v.minus(e(1)));t=t.plus(N)}else{const N=T.times(f).times(v.minus(e(1)));t=t.plus(N)}}});const p=e(1).plus(e(n.achievements.length*.02));if(t=t.times(p),n.globalIncomeMultiplier&&(t=t.times(e(n.globalIncomeMultiplier))),n.event&&n.event.type==="dragon"&&n.event.startTime){const g=Math.floor((Date.now()-n.event.startTime)/1e3),v=1-Math.min(99,g)/100;t=t.times(e(v))}return t},V=X(o),Y=y.useRef(V);Y.current=V,y.useEffect(()=>{const n=setInterval(()=>{u(t=>{const r=Date.now(),s=Y.current.times(e(me)).dividedBy(e(1e3));let d=t.totalGold.plus(s),f=t.gold.plus(s),h=l({},t.weather);const p=e(me/1e3);if(h.timeLeft=e(h.timeLeft||0).minus(p),h.timeLeft.lte(e(0))){const L=["clear","sunny","rainy","stormy","windy"],M=L[Math.floor(Math.random()*L.length)],$=e(Math.floor(Math.random()*120)+60);h={current:M,timeLeft:$}}let P=t.event;P&&P.expiresAt&&e(P.expiresAt).lt(e(r))&&(P=null);let g=l({},t.nationalProjects||{});Object.keys(g).forEach(L=>{var $;const M=g[L];M.active&&M.endTime&&r>=M.endTime&&(g[L]=i(l({},M),{active:!1,level:M.level+1,startTime:0,endTime:0}),b(`Project Completed: ${($=J.find(re=>re.id===L))==null?void 0:$.name} Infrastructure Level ${M.level+1}!`,"success"))});const C=[...t.achievements];let v=null;Mt.forEach(L=>{C.includes(L.id)||L.condition(i(l({},t),{totalGold:d,gold:f}),Y.current)&&(C.push(L.id),v=L)}),v&&(U(v),setTimeout(()=>U(null),3e3));const T=Gt(d),N=(t.infiniteTowerLevel||0)>0?Array.from({length:t.infiniteTowerLevel},(L,M)=>ge(M)).reduce((L,M)=>L.plus(M),e(0)):e(0),R=T.minus(N);return i(l({},t),{gold:f,totalGold:d,darkMatterGold:R,achievements:C,event:P,weather:h,nationalProjects:g,stats:i(l({},t.stats),{darkMatterGold:R})})})},me);return()=>clearInterval(n)},[]);const H=(n="light")=>{if("vibrate"in navigator&&ee)switch(n){case"light":navigator.vibrate(10);break;case"medium":navigator.vibrate(20);break;case"heavy":navigator.vibrate([30,10,30]);break}},xe=(n=!1)=>{if(n||H("light"),!n&&!o.isDeveloperWifeBlessingObtained&&o.totalGold.gte(e(1e12))&&Math.random()<1e-6){u(s=>i(l({},s),{globalIncomeMultiplier:(s.globalIncomeMultiplier||1)+1.073,isDeveloperWifeBlessingObtained:!0,achievements:[...new Set([...s.achievements,"developer_wife_blessing"])]})),b("ðŸ’ Developer Wife Blessing received! +107.3% global income!","success");return}const t=ct(w.current);u(r=>i(l({},r),{gold:r.gold.plus(t),totalGold:r.totalGold.plus(t),stats:i(l({},r.stats),{totalClicks:n?r.stats.totalClicks:r.stats.totalClicks.plus(e(1)),currentPrestigeClicks:n?r.stats.currentPrestigeClicks:r.stats.currentPrestigeClicks.plus(e(1))})}))},ct=n=>{const t=e(1),r=n.clickUpgradeLevel||0,s=Math.min(r,15),d=e(2).pow(s),f=t.times(d),h=Je(n.totalRenownEarned);let p=f;h.gt(e(1))&&(p=f.times(h));const P=ze(n.infiniteTowerLevel||0);p=p.times(P);const g=At(r);if(g>0){const T=X(n).times(g);p=p.plus(T)}const C=e(1).plus(e(n.achievements.length*.02));if(p=p.times(C),n.globalIncomeMultiplier&&(p=p.times(e(n.globalIncomeMultiplier))),n.godMode){const T=X(n).times(e(99999));p=p.plus(T)}return p},dt=()=>{const n=o.clickUpgradeLevel||0;if(n>=Nt){b("Maximum Royal Scepter level reached!","warning");return}const t=Ut(n+1);if(o.gold.lt(t)){b("Not enough gold!","error");return}u(r=>i(l({},r),{gold:r.gold.minus(t),clickUpgradeLevel:r.clickUpgradeLevel+1,stats:i(l({},r.stats),{clickUpgradeLevel:r.clickUpgradeLevel+1,totalGoldSpent:r.stats.totalGoldSpent.plus(t)})})),b(`Royal Scepter upgraded to level ${n+1}!`,"success")},ut=()=>{const n=o.offlineUpgradeLevel||0;if(n>=Bt){b("Maximum Passive Income level reached!","warning");return}const t=Ot(n+1);if(o.renown.lt(t)){b("Not enough Renown!","error");return}u(r=>i(l({},r),{renown:r.renown.minus(t),offlineUpgradeLevel:r.offlineUpgradeLevel+1,stats:i(l({},r.stats),{offlineUpgradeLevel:r.offlineUpgradeLevel+1})})),b(`Passive Income upgraded to level ${n+1}!`,"success")},Se=(n,t)=>{const r=J.find(f=>f.id===n);if(!r||t<=0)return;const s=o.buildings[n]||e(0),d=He(r.baseCost,s,e(t)).floor();o.gold.gte(d)&&(H("medium"),u(f=>i(l({},f),{gold:f.gold.minus(d),buildings:i(l({},f.buildings),{[n]:(f.buildings[n]||e(0)).plus(e(t))}),stats:i(l({},f.stats),{totalBuildingsPurchased:f.stats.totalBuildingsPurchased.plus(e(t)),totalGoldSpent:f.stats.totalGoldSpent.plus(d)})})))},ke=(n,t)=>{const r=J.find(h=>h.id===n);if(!r||t<=0)return;const s=o.buildings[n]||e(0),d=e(Math.min(t,s.toNumber()));if(d.lte(e(0)))return;const f=He(r.baseCost,s.minus(d),d).times(e(.25)).floor();u(h=>i(l({},h),{gold:h.gold.plus(f),buildings:i(l({},h.buildings),{[n]:s.minus(d)})}))},Ce=n=>{if(n.type==="merchant"){const t=Y.current.times(e(10));u(r=>i(l({},r),{gold:r.gold.plus(t),totalGold:r.totalGold.plus(t),event:null})),b(`The merchant gifted you ${q(t.floor(),o.numberFormat)} gold!`,"success")}else if(n.type==="jester"){const t=o.gold.times(e(.1)),r=Math.random()>.5;u(s=>i(l({},s),{gold:r?s.gold.plus(t):s.gold.minus(t),totalGold:r?s.totalGold.plus(t):s.totalGold,event:null})),r?b(`Jester pays out! +${q(t.floor(),o.numberFormat)}`,"success"):b(`Jester tricked you! -${q(t.floor(),o.numberFormat)}`,"warning")}else if(n.type==="dragon")try{let t=!1;u(r=>{if(!r.event||r.event.type!=="dragon")return r;const d=e(r.event.hp||10).minus(e(1));if(d.lte(0)){const f=Y.current.times(e(30));return t=!0,i(l({},r),{gold:r.gold.plus(f),totalGold:r.totalGold.plus(f),event:null,stats:i(l({},r.stats),{dragonsKilled:r.stats.dragonsKilled.plus(e(1))})})}return i(l({},r),{event:i(l({},r.event),{hp:d})})}),t&&b("Dragon Slain! +Treasury Boost","success")}catch(t){console.error("Error handling dragon interaction:",t),b("Error interacting with dragon","error")}},ft=()=>{const n=e(1),t=e(1e12),r=o.totalGold;if(r.lt(t))return;const s=r.dividedBy(t),f=e(Math.floor(Math.pow(s.toNumber(),.33))).times(n).minus(o.renown);if(f.lte(0))return;const h=l({},o.nationalProjects);Object.keys(h).forEach(p=>{h[p].active&&(h[p]=i(l({},h[p]),{active:!1,startTime:0,endTime:0}))}),u(i(l({},_),{renown:o.renown.plus(f),totalRenownEarned:o.totalRenownEarned.plus(f),prestigeCount:o.prestigeCount+1,totalGold:o.totalGold,achievements:o.achievements,nationalProjects:h,offlineUpgradeLevel:o.offlineUpgradeLevel,darkMatterGold:o.darkMatterGold,infiniteTowerLevel:o.infiniteTowerLevel,playerProfile:o.playerProfile,startTime:e(Date.now()),lastSaveTime:e(Date.now()),theme:o.theme,idleModeEnabled:o.idleModeEnabled,interface:o.interface,stats:i(l({},_.stats),{prestigeCount:o.prestigeCount+1,infiniteTowerLevel:o.infiniteTowerLevel,darkMatterGold:o.darkMatterGold,clickUpgradeLevel:o.clickUpgradeLevel,offlineUpgradeLevel:o.offlineUpgradeLevel})})),oe(!1),b("Abdication Successful. Long live the new King!","success")},mt=()=>{localStorage.removeItem("kingdom_save"),u(i(l({},_),{startTime:e(Date.now())})),z(!1),b("Game Reset","warning")},gt=()=>{const t=K(o);localStorage.setItem("kingdom_save",JSON.stringify(t)),b("Game Saved","info")},pt=()=>{u(n=>{const t=l({},n.nationalProjects);return Object.keys(t).forEach(r=>{t[r].active&&(t[r]=i(l({},t[r]),{endTime:Date.now()+5e3}))}),i(l({},n),{nationalProjects:t})}),b("Projects sped up to 5 seconds!","success")};window.speedUpProjects=pt;const ht=n=>{u(t=>i(l({},t),{playerProfile:n})),localStorage.setItem(`playerProfile_${n.id}`,JSON.stringify(n)),b(`Welcome, ${n.rulerName} ${n.rulerId}!`,"success"),E(!1)},yt=()=>se(null,null,function*(){ft()}),vt=n=>se(null,null,function*(){var t;if(!((t=o.playerProfile)!=null&&t.id)){b("Error: Player profile not found","error");return}try{yield Zt(o.playerProfile.id,n);const r=i(l({},o.playerProfile),{rulerName:n});u(f=>i(l({},f),{playerProfile:r}));const s=i(l({},o),{playerProfile:r}),d=K(s);localStorage.setItem("kingdom_save",JSON.stringify(d)),b(`Name successfully changed to "${n}"!`,"success")}catch(r){console.error("Error changing name:",r),b("Failed to change name. Please try again.","error")}}),bt=n=>se(null,null,function*(){var s;const t=((s=o.playerProfile)==null?void 0:s.id)||"default_player",r=yield eo.redeemPromoCode(t,n);if(!r){b("Invalid or expired promo code!","error");return}switch(r.type){case"gold":u(d=>i(l({},d),{gold:d.gold.plus(e(r.value)),totalGold:d.totalGold.plus(e(r.value))})),b(`Received ${q(e(r.value))} gold!`,"success");break;case"betaTester":u(d=>{const f=d.playerProfile?i(l({},d.playerProfile),{usedPromoCodes:[...d.playerProfile.usedPromoCodes||[],"beta_tester"],specialIcon:r.icon||"ðŸ§ª",specialTitle:r.title||"Beta Tester",isBetaTester:!0}):null;return f&&localStorage.setItem(`playerProfile_${t}`,JSON.stringify(f)),i(l({},d),{playerProfile:f})}),b("Beta Tester rewards unlocked! ðŸ§ª","success");break;case"icon":u(d=>{const f=d.playerProfile?i(l({},d.playerProfile),{usedPromoCodes:[...d.playerProfile.usedPromoCodes||[],n],specialIcon:r.icon||"â­",specialTitle:r.title||"Special"}):null;return f&&localStorage.setItem(`playerProfile_${t}`,JSON.stringify(f)),i(l({},d),{playerProfile:f})}),b(`Special icon unlocked: ${r.icon}!`,"success");break;case"title":u(d=>{const f=d.playerProfile?i(l({},d.playerProfile),{usedPromoCodes:[...d.playerProfile.usedPromoCodes||[],n],specialTitle:r.title||"Special"}):null;return f&&localStorage.setItem(`playerProfile_${t}`,JSON.stringify(f)),i(l({},d),{playerProfile:f})}),b(`Special title unlocked: ${r.title}!`,"success");break;default:b("Promo code redeemed!","success")}}),Le=n=>{u(t=>i(l({},t),{interface:i(l({},t.interface),{lastBuyAmount:n})}))},Te=n=>({flex:n==="left"?"var(--col-left)":"var(--col-right)",display:"flex",flexDirection:"column",borderRight:n==="left"?"var(--custom-border-width) double var(--border-color)":"none",borderLeft:n==="right"?"var(--custom-border-width) double var(--border-color)":"none",background:"var(--panel-bg)",minWidth:0,transition:"transform 0.8s ease-in-out",transform:S&&o.idleModeEnabled?n==="left"?"translateX(-120%)":"translateX(120%)":"translateX(0)",zIndex:10});return a.jsxs("div",{style:{display:"flex",height:"100dvh",width:"100vw",backgroundColor:"var(--bg-color)",overflow:"hidden",position:"relative",flexDirection:ee?"column":"row"},children:[a.jsx(_t,{toasts:W}),a.jsx(Ft,{}),S&&o.idleModeEnabled&&a.jsx(to,{gameState:o}),!ee&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:Te("left"),children:[a.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)"},children:a.jsx("button",{className:`tab-btn ${pe==="buildings"?"active":""}`,onClick:()=>Qe("buildings"),children:"Estates"})}),a.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden"},children:pe==="buildings"&&a.jsx(Ke,{gameState:o,onBuyBuilding:Se,onSellBuilding:ke,onSetBuyAmount:Le})})]}),a.jsx("div",{style:{flex:"var(--col-center)",display:"flex",flexDirection:"column",position:"relative",borderRight:S&&o.idleModeEnabled?"none":"var(--custom-border-width) double var(--border-color)",minWidth:0,zIndex:5,transition:"border 0.8s"},children:a.jsx(Ve,{gameState:o,gps:V,onClick:()=>xe(!1),onEventInteract:Ce,onOpenTavern:()=>ce(!0),onOpenPrestige:()=>oe(!0),onOpenSettings:()=>z(!0),onOpenStatistics:()=>de(!0),onOpenLeaderboard:()=>{ue(!0)},onOpenEmpire:()=>ne(!0),isIdle:S&&o.idleModeEnabled})}),a.jsxs("div",{style:Te("right"),children:[a.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)"},children:a.jsx("button",{className:`tab-btn ${he==="army"?"active":""}`,onClick:()=>Ze("army"),children:"Future"})}),a.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",WebkitOverflowScrolling:"touch",touchAction:"pan-y",scrollbarWidth:"thin",scrollbarColor:"var(--accent-color) transparent"},children:he==="army"&&a.jsx(Xe,{gameState:o,onBuyTowerFloor:()=>{const n=ge(o.infiniteTowerLevel||0);o.darkMatterGold.gte(n)&&(u(t=>i(l({},t),{darkMatterGold:t.darkMatterGold.minus(n),infiniteTowerLevel:(t.infiniteTowerLevel||0)+1,stats:i(l({},t.stats),{infiniteTowerLevel:(t.infiniteTowerLevel||0)+1,darkMatterGold:t.darkMatterGold.minus(n)})})),b("Built another floor of the Infinite Tower! +100% income bonus","success"))}})})]})]}),ee&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",position:"relative",minHeight:0,height:"100%"},children:[B==="buildings"&&a.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0},children:[a.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:a.jsx("button",{className:"tab-btn active",onClick:()=>{},children:"Estates"})}),a.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:a.jsx(Ke,{gameState:o,onBuyBuilding:Se,onSellBuilding:ke,onSetBuyAmount:Le})})]}),B==="throne"&&a.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,height:"100%"},children:a.jsx(Ve,{gameState:o,gps:V,onClick:()=>xe(!1),onEventInteract:Ce,onOpenTavern:()=>ce(!0),onOpenPrestige:()=>oe(!0),onOpenSettings:()=>z(!0),onOpenStatistics:()=>de(!0),onOpenLeaderboard:()=>ue(!0),onOpenEmpire:()=>ne(!0),isIdle:S&&o.idleModeEnabled})}),B==="army"&&a.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0},children:[a.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:a.jsx("button",{className:"tab-btn active",children:"Future"})}),a.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:a.jsx(Xe,{gameState:o,onBuyTowerFloor:()=>{const n=ge(o.infiniteTowerLevel||0);o.darkMatterGold.gte(n)&&(u(t=>i(l({},t),{darkMatterGold:t.darkMatterGold.minus(n),infiniteTowerLevel:(t.infiniteTowerLevel||0)+1,stats:i(l({},t.stats),{infiniteTowerLevel:(t.infiniteTowerLevel||0)+1,darkMatterGold:t.darkMatterGold.minus(n)})})),b("Built another floor of the Infinite Tower! +100% income bonus","success"))}})})]}),B==="empire"&&a.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,height:"100%"},children:a.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:a.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"var(--text-secondary)"},children:[a.jsx("h3",{children:"ðŸ—ï¸ National Projects"}),a.jsx("p",{children:"Construct massive infrastructure to boost global production."}),a.jsx("button",{className:"btn",onClick:()=>ne(!0),style:{margin:"10px",padding:"15px 20px",fontSize:"16px"},children:"ðŸ—ï¸ Manage Projects"})]})})})]}),a.jsxs("div",{style:{display:"flex",justifyContent:"space-around",alignItems:"center",height:"60px",backgroundColor:"var(--panel-bg)",borderTop:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:[a.jsxs("button",{className:`mobile-nav-btn ${B==="buildings"?"active":""}`,onClick:()=>{H("light"),te("buildings")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:B==="buildings"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[a.jsx("div",{style:{fontSize:"20px"},children:"ðŸ˜ï¸"}),a.jsx("div",{children:"Estates"})]}),a.jsxs("button",{className:`mobile-nav-btn ${B==="throne"?"active":""}`,onClick:()=>{H("light"),te("throne")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:B==="throne"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[a.jsx("div",{style:{fontSize:"20px"},children:"ðŸ‘‘"}),a.jsx("div",{children:"Throne"})]}),a.jsxs("button",{className:`mobile-nav-btn ${B==="army"?"active":""}`,onClick:()=>{H("light"),te("army")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:B==="army"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[a.jsx("div",{style:{fontSize:"20px"},children:"ðŸ‘·"}),a.jsx("div",{children:"Future"})]}),a.jsxs("button",{className:`mobile-nav-btn ${B==="empire"?"active":""}`,onClick:()=>{H("light"),te("empire")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:B==="empire"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[a.jsx("div",{style:{fontSize:"20px"},children:"ðŸ—ï¸"}),a.jsx("div",{children:"Projects"})]})]})]}),!(S&&o.idleModeEnabled)&&G&&a.jsxs("div",{className:"achievement-popup",children:[a.jsx("div",{style:{fontSize:"2rem"},children:G.icon}),a.jsxs("div",{children:[a.jsx("div",{style:{fontWeight:"bold",color:"var(--text-color)"},children:"Achievement Unlocked!"}),a.jsx("div",{style:{color:"var(--accent-color)"},children:G.name})]})]}),O&&a.jsx(Wt,{gained:O.gained,effectiveTime:O.effectiveTime,totalTime:O.totalTime,efficiency:O.efficiency,completedProjects:O.completedProjects,currentLevel:O.currentLevel,maxDuration:O.maxDuration,numberFormat:o.numberFormat,onClose:()=>Z(null)}),it&&a.jsx($t,{gameState:o,onClose:()=>ne(!1),onStartProject:n=>{var d;const t=((d=o.nationalProjects[n])==null?void 0:d.level)||0;if(t>=It)return;const r=Dt(n,t+1);if(o.gold.lt(r.gold))return;const s=Rt();u(f=>i(l({},f),{gold:f.gold.minus(r.gold),nationalProjects:i(l({},f.nationalProjects),{[n]:{level:t,active:!0,startTime:Date.now(),endTime:Date.now()+s*1e3}})})),b("Construction started!","info")},onUpgradeClickPower:dt,onUpgradeOffline:ut}),tt&&a.jsx(zt,{gameState:o,onGamble:(n,t)=>{const r=e(n);u(s=>i(l({},s),{gold:t?s.gold.plus(r):s.gold.minus(r).max(0),stats:i(l({},s.stats),{tavernGamesPlayed:s.stats.tavernGamesPlayed.plus(e(1))})}))},onClose:()=>ce(!1)}),ot&&a.jsx(Ht,{gameState:o,onPrestige:yt,onClose:()=>oe(!1)}),nt&&a.jsx(Jt,{gameState:o,onClose:()=>z(!1),onHardReset:mt,onSave:gt,onSetTheme:n=>u(t=>i(l({},t),{theme:n})),onSetNumberFormat:n=>u(t=>i(l({},t),{numberFormat:n})),onToggleIdleMode:()=>u(n=>i(l({},n),{idleModeEnabled:!n.idleModeEnabled})),onUpdateInterface:n=>u(t=>i(l({},t),{interface:l(l({},t.interface),n)})),onOpenPromoCodes:()=>{z(!1),fe(!0)},onChangeName:()=>Pe(!0)}),at&&a.jsx(Kt,{gameState:o,onClose:()=>fe(!1),onRedeemPromoCode:bt,onBackToSettings:()=>{fe(!1),z(!0)}}),st&&a.jsx(Xt,{gameState:o,currentGps:V,onClose:()=>de(!1)}),rt&&a.jsx(Vt,{onClose:()=>lt(!1)}),ye&&a.jsx(Yt,{isOpen:ye,onClose:()=>{ve(!1),E(!0)},onConfirm:ht,gameState:o}),be&&a.jsx(qt,{isOpen:be,onClose:()=>ue(!1),playerProfile:o.playerProfile,gameState:o,addToast:b}),we&&a.jsx(Qt,{isOpen:we,onClose:()=>Pe(!1),onConfirm:vt,currentName:((je=o.playerProfile)==null?void 0:je.rulerName)||""})]})},qe=document.getElementById("root");if(!qe)throw new Error("Could not find root element to mount to");const no=Tt.createRoot(qe);no.render(a.jsx(Et.StrictMode,{children:a.jsx(oo,{})}))});export default ro();
