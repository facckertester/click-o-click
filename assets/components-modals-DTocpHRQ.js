var Re=Object.defineProperty,Ne=Object.defineProperties;var Te=Object.getOwnPropertyDescriptors;var xe=Object.getOwnPropertySymbols;var Be=Object.prototype.hasOwnProperty,We=Object.prototype.propertyIsEnumerable;var pe=(t,o,c)=>o in t?Re(t,o,{enumerable:!0,configurable:!0,writable:!0,value:c}):t[o]=c,D=(t,o)=>{for(var c in o||(o={}))Be.call(o,c)&&pe(t,c,o[c]);if(xe)for(var c of xe(o))We.call(o,c)&&pe(t,c,o[c]);return t},G=(t,o)=>Ne(t,Te(o));var U=(t,o,c)=>new Promise((d,n)=>{var s=h=>{try{r(c.next(h))}catch(a){n(a)}},p=h=>{try{r(c.throw(h))}catch(a){n(a)}},r=h=>h.done?d(h.value):Promise.resolve(h.value).then(s,p);r((c=c.apply(t,o)).next())});import{j as e,r as R,R as Z}from"./vendor-react-CUeQczFW.js";import{t as l,N as ze,b as Ae,c as Le,M as ge,f as y,P as le,d as fe,e as re,h as be,i as Y,j as ne,T as Me,C as he,B as Q,W as Fe,A as Ee,g as oe}from"./core-Bsm8WMPA.js";import{c as ue}from"./components-main-DVe_petg.js";import{a as ee}from"./components-ui-DPdqUY33.js";import{A as Ie}from"./components-achievements-Dqws9Cf-.js";import{i as Pe,g as De,s as V,d as K,a as q,q as ye,c as ve,o as je,l as we,b as ke}from"./vendor-firebase-IMiYFFvY.js";import{a as O}from"./vendor-DdgGw12P.js";const it=({building:t,gameState:o,onClose:c})=>{const d=o.buildings[t.id]||l(0),n=ze.find(C=>C.id===t.id);if(!n)return null;const p=(o.nationalProjects[t.id]||{level:0}).level,r=p>=ge,h=p+1,a=Ae(t.id,h),g=Le[h]||0,i=d.gte(g),b=o.gold.gte(a.gold),f=b&&i;return e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"20px"},children:e.jsxs("div",{style:{background:"var(--panel-bg)",border:"2px solid var(--accent-color)",borderRadius:"8px",padding:"20px",maxWidth:"400px",width:"100%",maxHeight:"80vh",overflowY:"auto"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("span",{style:{fontSize:"2rem"},children:"ðŸ—ï¸"}),e.jsxs("h3",{style:{margin:0,color:"var(--text-color)"},children:[n.name.replace(" Infrastructure","")," - Lvl ",p,"/",ge]})]}),e.jsx("button",{onClick:c,style:{background:"none",border:"none",color:"var(--text-secondary)",fontSize:"1.5rem",cursor:"pointer",padding:"5px"},children:"Ã—"})]}),e.jsx("div",{style:{marginBottom:"15px",color:"var(--text-secondary)",fontSize:"0.9rem",lineHeight:"1.4"},children:n.description}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",marginBottom:"15px"},children:[e.jsxs("div",{style:{background:"rgba(0,0,0,0.1)",padding:"10px",borderRadius:"4px"},children:[e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Buildings"}),e.jsx("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:"var(--accent-color)"},children:y(d,o.numberFormat)})]}),e.jsxs("div",{style:{background:"rgba(0,0,0,0.1)",padding:"10px",borderRadius:"4px"},children:[e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Current Bonus"}),e.jsxs("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:"var(--success-color)"},children:["+",(p*le*100).toFixed(0),"%"]})]})]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("h4",{style:{margin:"0 0 10px 0",color:"var(--text-color)"},children:r?"Max Level Reached":`Requirements for Level ${h}`}),e.jsx("div",{style:{background:"rgba(0,0,0,0.1)",padding:"10px",borderRadius:"4px"},children:r?e.jsx("div",{style:{textAlign:"center",color:"var(--gold-color)",fontWeight:"bold"},children:"ðŸ† Maximum level achieved!"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[e.jsx("span",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:"ðŸ° Buildings:"}),e.jsxs("span",{style:{fontSize:"0.9rem",fontWeight:"bold",color:i?"var(--success-color)":"var(--error-color)"},children:[g," (have ",y(d,o.numberFormat),")"]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:"ðŸ’° Gold:"}),e.jsx("span",{style:{fontSize:"0.9rem",fontWeight:"bold",color:b?"var(--success-color)":"var(--error-color)"},children:y(a.gold,o.numberFormat)})]})]})})]}),e.jsxs("div",{style:{background:"rgba(0,0,0,0.1)",padding:"10px",borderRadius:"4px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Status"}),e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:"bold",color:r?"var(--gold-color)":f?"var(--success-color)":"var(--text-secondary)"},children:r?"âœ… MAX LEVEL":f?"ðŸš€ Ready to upgrade!":"â³ Requirements not met"})]})]})})},at=({gameState:t,onClose:o,onUpgrade:c})=>{const d=t.clickUpgradeLevel||0,n=fe(d+1),s=t.gold.gte(n),p=d>=re,r=ue(t),h=G(D({},t),{clickUpgradeLevel:d+1}),a=ue(h);return l(2).pow(Math.min(d,15)),l(2).pow(Math.min(d+1,15)),e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"400px",width:"90%"},children:[e.jsxs("div",{style:{padding:"15px",background:"var(--accent-color)",color:"var(--text-on-accent)"},children:[e.jsx("h3",{style:{margin:0,border:"none",color:"var(--gold-color)"},children:"âš¡ Royal Scepter"}),e.jsx("p",{style:{margin:"5px 0 0 0",fontSize:"0.9rem",opacity:.9},children:"Enhance your clicking power with ancient royal magic."})]}),e.jsxs("div",{style:{padding:"20px",background:"var(--panel-bg)"},children:[e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsxs("div",{style:{color:"var(--text-color)",marginBottom:"10px"},children:[e.jsx("strong",{children:"Current Level:"})," ",d,"/",re]}),e.jsxs("div",{style:{color:"var(--text-color)",marginBottom:"10px"},children:[e.jsx("strong",{children:"Current Power:"})," ",y(r)]}),!p&&e.jsxs("div",{style:{color:"var(--text-color)",marginBottom:"10px"},children:[e.jsx("strong",{children:"Next Power:"})," ",y(a)]})]}),p?e.jsx("div",{style:{color:"var(--gold-color)",textAlign:"center",fontWeight:"bold",padding:"15px",background:"var(--accent-color)",borderRadius:"4px"},children:"Maximum Level Reached!"}):e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsxs("div",{style:{color:s?"var(--gold-color)":"var(--error-color)",marginBottom:"10px",fontWeight:"bold"},children:["Cost: ",y(n)," gold"]}),e.jsx("button",{className:"btn",onClick:c,disabled:!s,style:{width:"100%",background:s?"var(--accent-color)":"var(--disabled-color)",borderColor:s?"var(--gold-color)":"var(--border-color)",cursor:s?"pointer":"not-allowed"},children:"Upgrade Scepter"})]})]}),e.jsx("div",{style:{padding:"15px",borderTop:"1px solid var(--border-color)",textAlign:"right",background:"var(--bg-color)"},children:e.jsx("button",{className:"btn",onClick:o,style:{background:"var(--accent-color)"},children:"Close"})})]})})},dt=({gameState:t,onClose:o,onUpgrade:c})=>{const d=t.offlineUpgradeLevel||0,n=be(d+1),s=ne(d),p=ne(d+1),r=t.renown.gte(n),h=d>=Y,a=g=>{const i=Math.floor(g/3600),b=Math.floor(g%3600/60);return i>0?`${i}h ${b}m`:`${b}m`};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"400px",width:"90%"},children:[e.jsxs("div",{style:{padding:"15px",background:"var(--accent-color)",color:"var(--text-on-accent)"},children:[e.jsx("h3",{style:{margin:0,border:"none",color:"var(--gold-color)"},children:"ðŸ’° Passive Income"}),e.jsx("p",{style:{margin:"5px 0 0 0",fontSize:"0.9rem",opacity:.9},children:"Improve your kingdom's efficiency while you're away."})]}),e.jsxs("div",{style:{padding:"20px",background:"var(--panel-bg)"},children:[e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsxs("div",{style:{color:"var(--text-color)",marginBottom:"10px"},children:[e.jsx("strong",{children:"Current Level:"})," ",d,"/",Y]}),e.jsxs("div",{style:{color:"var(--text-color)",marginBottom:"10px"},children:[e.jsx("strong",{children:"Current Effect:"})," ",(s.efficiency*100).toFixed(0),"% for ",a(s.duration)]}),!h&&e.jsxs("div",{style:{color:"var(--text-color)",marginBottom:"10px"},children:[e.jsx("strong",{children:"Next Effect:"})," ",(p.efficiency*100).toFixed(0),"% for ",a(p.duration)]}),e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"10px",fontStyle:"italic"},children:"Higher levels increase both efficiency % and maximum production time."})]}),h?e.jsx("div",{style:{color:"var(--gold-color)",textAlign:"center",fontWeight:"bold",padding:"15px",background:"var(--accent-color)",borderRadius:"4px"},children:"Maximum Level Reached!"}):e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsxs("div",{style:{color:r?"var(--gold-color)":"var(--error-color)",marginBottom:"10px",fontWeight:"bold"},children:["Cost: ",y(n)," renown"]}),e.jsx("button",{className:"btn",onClick:c,disabled:!r,style:{width:"100%",background:r?"var(--accent-color)":"var(--disabled-color)",borderColor:r?"var(--gold-color)":"var(--border-color)",cursor:r?"pointer":"not-allowed"},children:"Upgrade Passive Income"})]})]}),e.jsx("div",{style:{padding:"15px",borderTop:"1px solid var(--border-color)",textAlign:"right",background:"var(--bg-color)"},children:e.jsx("button",{className:"btn",onClick:o,style:{background:"var(--accent-color)"},children:"Close"})})]})})},ie=({currentBet:t,maxGold:o,onBetChange:c,numberFormat:d})=>{const[n,s]=R.useState(t===0?"":t.toString());R.useEffect(()=>{var g,i;t===0&&((g=document.activeElement)==null?void 0:g.tagName)!=="INPUT"?s(""):Math.abs(parseFloat(n)-t)>1e-4&&((i=document.activeElement)==null?void 0:i.tagName)!=="INPUT"&&s(t>1e9?t.toExponential(2).replace("+",""):t.toString())},[t]);const p=g=>{try{if(g.trim()===""){c(0),s("");return}let i=parseFloat(g);const b=g.toLowerCase().trim(),f={k:1e3,m:1e6,b:1e9,t:1e12,qa:1e15,qi:1e18,sx:1e21,sp:1e24,oc:1e27,no:1e30,dc:1e33,ud:1e36,dd:1e39,td:1e42,qd:1e45,qn:1e48};for(const T of Object.keys(f))if(b.endsWith(T)){const x=parseFloat(b.slice(0,-T.length));isNaN(x)||(i=x*f[T]);break}(isNaN(i)||i<0)&&(i=0);const C=o.toNumber();isFinite(C)&&i>C?i=C:!isFinite(C)&&l(i).gt(o)&&(i=Number.MAX_VALUE),c(i),i===0?s(""):i>=1e6?s(i.toExponential(2).replace("+","")):s(Math.floor(i).toString())}catch(i){s(t===0?"":t.toString())}},r=()=>{p(n)},h=g=>{g.key==="Enter"&&(p(n),g.target.blur())},a=g=>{let b=o.times(g).floor().toNumber();isFinite(b)||(b=Number.MAX_VALUE),b<1&&o.gt(0)&&(b=1),c(b),b>=1e6?s(b.toExponential(2).replace("+","")):s(b.toString())};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px",width:"100%"},children:[e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center"},children:[e.jsx("span",{style:{position:"absolute",left:"10px",pointerEvents:"none",fontSize:"1.2rem"},children:"ðŸ’°"}),e.jsx("input",{type:"text",value:n,onChange:g=>s(g.target.value),onBlur:r,onKeyDown:h,style:{width:"100%",padding:"10px 30px 10px 35px",fontSize:"1.1rem",border:"2px solid var(--border-color)",borderRadius:"4px",fontFamily:"monospace",background:"#fff",color:"#000",outline:"none",fontWeight:"bold"},placeholder:"Wager (100, 1k, 2.5m, 1b, 2e13)..."}),t>0&&e.jsx("button",{onClick:()=>{c(0),s("")},style:{position:"absolute",right:"5px",top:"50%",transform:"translateY(-50%)",background:"transparent",border:"none",color:"#999",fontSize:"1.2rem",cursor:"pointer",padding:"0 5px"},title:"Clear",children:"âœ•"})]}),e.jsxs("div",{style:{display:"flex",gap:"4px",justifyContent:"space-between"},children:[e.jsx("button",{className:"btn",style:{padding:"4px 8px",fontSize:"0.7rem",flex:1,background:"rgba(0,0,0,0.1)",color:"var(--text-color)",border:"1px solid var(--border-color)"},onClick:()=>a(.1),children:"10%"}),e.jsx("button",{className:"btn",style:{padding:"4px 8px",fontSize:"0.7rem",flex:1,background:"rgba(0,0,0,0.1)",color:"var(--text-color)",border:"1px solid var(--border-color)"},onClick:()=>a(.5),children:"50%"}),e.jsx("button",{className:"btn",style:{padding:"4px 8px",fontSize:"0.7rem",flex:1,background:"var(--gold-color)",color:"#000",border:"1px solid #b8860b"},onClick:()=>a(1),children:"MAX"}),e.jsx("div",{style:{width:"4px"}}),e.jsx("button",{className:"btn",style:{padding:"4px 8px",fontSize:"0.7rem",flex:1,background:"rgba(0,0,0,0.1)",color:"var(--text-color)",border:"1px solid var(--border-color)"},onClick:()=>p(Math.floor(t/2).toString()),children:"Â½"}),e.jsx("button",{className:"btn",style:{padding:"4px 8px",fontSize:"0.7rem",flex:1,background:"rgba(0,0,0,0.1)",color:"var(--text-color)",border:"1px solid var(--border-color)"},onClick:()=>p((t*2).toString()),children:"x2"})]})]})},Ge=["Shadowfax","Roach","Bucephalus","Pegasus","Sleipnir","Epona","Agro","Artax","Rapidash","Spirit","Bullseye","Maximus","Khan","Buckbeak","Chestnut","Midnight","Storm","Blaze","Comet","Dakota"],Oe=["#d32f2f","#1976d2","#388e3c","#fbc02d","#8e24aa","#ef6c00"],He=50,Ue=({gameState:t,onGamble:o,onLeave:c})=>{const[d,n]=R.useState([]),[s,p]=R.useState(null),[r,h]=R.useState(0),[a,g]=R.useState("betting"),[i,b]=R.useState(""),[f,C]=R.useState(null),T=R.useRef(null),x=R.useRef([]);R.useEffect(()=>{v()},[]);const v=()=>{const w=[],u=[...Ge].sort(()=>.5-Math.random());for(let S=0;S<6;S++){const A=Math.random()*5+5,k=Math.random()*5+5;let L=25-(A+k);L=L+(Math.random()*4-2),L<1.5&&(L=1.5),L>20&&(L=20),w.push({id:S,name:u[S],color:Oe[S],icon:"ðŸŽ",odds:parseFloat(L.toFixed(1)),progress:0,finished:!1,rank:0,speedRating:A,staminaRating:k})}n(w),p(null),C(null),x.current=[],b("Select a horse and place your bet!")},B=()=>{if(s===null){b("Select a horse first!");return}if(r<=0){b("Place a valid bet!");return}if(t.gold.lt(l(r))){b("Not enough gold!");return}g("racing"),b("And they're off!");let w=0;const u=400;T.current=setInterval(()=>{w++,n(S=>S.map(k=>{if(k.finished)return k;const z=Math.random()<.05?1:0,L=Math.random()<.05?-.5:0,E=.15,P=k.speedRating/10*.15,j=Math.random()*.2;let m=E+P+j+z+L,N=k.progress+m;return N>=100&&(N=100,!x.current.includes(k.id))?(x.current.push(k.id),G(D({},k),{progress:100,finished:!0,rank:x.current.length})):G(D({},k),{progress:N})}).slice(0,6)),(x.current.length===6||w>=u)&&(x.current.length<6&&n(S=>(S.filter(k=>!k.finished).sort((k,z)=>z.progress-k.progress).forEach(k=>{x.current.includes(k.id)||x.current.push(k.id)}),S.map(k=>{const z=x.current.indexOf(k.id);return z!==-1?G(D({},k),{rank:z+1,finished:!0,progress:100}):k}))),M())},He)},M=()=>{T.current&&clearInterval(T.current);const w=d.map(k=>{const z=x.current.indexOf(k.id);return z!==-1?G(D({},k),{rank:z+1,finished:!0}):k});n(w);const u=x.current[0],S=w.find(k=>k.id===u);if(!S)return;if(g("finished"),u===s){const k=w.find(E=>E.id===s),z=(k==null?void 0:k.odds)||1,L=Math.max(1,Math.floor(r*(z-1)));o(L,!0),C({won:!0,amount:L,winnerName:S.name})}else o(r,!1),C({won:!1,amount:r,winnerName:S.name})};R.useEffect(()=>()=>{T.current&&clearInterval(T.current)},[]);const W=()=>{g("betting"),h(0),v()};return f&&(f.won,f.won,f.won,f.won,f.won,f.winnerName,f.won?(e.Fragment,y(l(f.amount),t.numberFormat)):(e.Fragment,y(l(f.amount),t.numberFormat))),e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[e.jsx("div",{style:{padding:"5px",textAlign:"center",background:"#e0cda9",borderBottom:"1px solid #5d4037",color:"#5d4037",fontWeight:"bold"},children:i}),e.jsxs("div",{style:{flex:1,background:"#e0cda9",padding:"10px 0",overflow:"hidden",display:"flex",flexDirection:"column",justifyContent:"space-between",position:"relative"},children:[e.jsx("div",{style:{position:"absolute",right:"40px",top:0,bottom:0,width:"10px",background:"repeating-linear-gradient(45deg, #000, #000 10px, #fff 10px, #fff 20px)",zIndex:0,borderLeft:"2px solid rgba(0,0,0,0.2)",borderRight:"2px solid rgba(0,0,0,0.2)",height:"100%"}}),d.map(w=>e.jsxs("div",{onClick:()=>a==="betting"&&p(w.id),style:{position:"relative",flex:1,minHeight:"30px",borderBottom:"1px dashed rgba(93, 64, 55, 0.3)",display:"flex",alignItems:"center",cursor:a==="betting"?"pointer":"default",background:s===w.id?"rgba(255, 215, 0, 0.3)":"rgba(255,255,255,0.1)",transition:"background 0.2s"},children:[e.jsxs("div",{style:{width:"100px",padding:"0 10px",borderRight:"1px solid var(--border-color)",display:"flex",flexDirection:"column",justifyContent:"center",zIndex:2,background:"var(--panel-bg)",height:"100%"},children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.8rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",color:"var(--text-color)"},children:w.name}),e.jsxs("div",{style:{fontSize:"0.9rem",color:s===w.id?"var(--accent-color)":"var(--text-secondary)",fontWeight:"bold"},children:[w.odds.toFixed(1),"x"]})]}),e.jsx("div",{style:{position:"absolute",left:`calc(100px + ${w.progress}% - ${w.progress*.8}px)`,transition:a==="racing"?"left 0.05s linear":"left 0.3s ease",fontSize:"2rem",zIndex:1,transform:"scaleX(-1) translateY(-5px)",filter:s===w.id?"drop-shadow(0 0 5px gold)":"drop-shadow(0 2px 2px rgba(0,0,0,0.3))",color:w.color},children:e.jsx("div",{style:{fontSize:"2rem"},children:w.icon})}),w.finished&&e.jsx("div",{style:{position:"absolute",right:"10px",fontWeight:"bold",fontSize:"1.2rem",zIndex:5,color:"#000",textShadow:"0 0 2px rgba(0,0,0,0.3)"},children:w.rank===1?"ðŸ¥‡":w.rank===2?"ðŸ¥ˆ":w.rank===3?"ðŸ¥‰":w.rank?`#${w.rank}`:"?"})]},w.id))]}),e.jsxs("div",{style:{padding:"15px 20px",background:"var(--panel-bg)",borderTop:"2px solid var(--border-color)",flexShrink:0,display:"flex",flexDirection:"row",gap:"15px",alignItems:"flex-end"},children:[e.jsx("div",{style:{flex:1},children:e.jsx(ie,{currentBet:r,maxGold:t.gold,onBetChange:h,numberFormat:t.numberFormat})}),e.jsxs("div",{style:{flexShrink:0},children:[a==="betting"&&e.jsx("button",{className:"btn",onClick:B,disabled:s===null||r<=0,style:{opacity:s===null||r<=0?.5:1,fontSize:"1.2rem",padding:"0 30px",height:"60px",background:"var(--accent-color)",boxShadow:"0 4px 0 rgba(0,0,0,0.2)",fontWeight:"bold"},children:"START"}),a==="finished"&&e.jsx("button",{className:"btn",onClick:W,style:{fontSize:"1.2rem",padding:"0 30px",height:"60px",background:"var(--accent-color)",boxShadow:"0 4px 0 rgba(0,0,0,0.2)",fontWeight:"bold"},children:"RACE AGAIN"}),a==="racing"&&e.jsx("div",{style:{width:"100%",height:"60px"}})]})]}),e.jsxs("div",{style:{padding:"10px 20px",background:"var(--panel-bg)",borderTop:"1px solid var(--border-color)",textAlign:"center",fontSize:"1rem",fontWeight:"bold"},children:[e.jsx("span",{style:{marginRight:"10px",color:"var(--text-secondary)"},children:"Result:"}),f?e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{marginRight:"10px"},children:f.won?"ðŸ‡":"ðŸ¢"}),e.jsx("span",{style:{color:f.won?"#4caf50":"#f44336",marginRight:"10px"},children:f.won?"Winner!":"Better luck next time"}),e.jsxs("span",{style:{color:"var(--accent-color)",marginRight:"10px"},children:["Winner: ",f.winnerName]}),e.jsxs("span",{style:{color:f.won?"gold":"#ef5350"},children:[f.won?"+":"-",y(l(f.amount),t.numberFormat)," Gold"]})]}):e.jsx("span",{style:{color:"var(--text-secondary)",fontStyle:"italic"},children:"No results yet"})]})]})},$e=({gameState:t,onGamble:o,onLeave:c})=>{const[d,n]=R.useState(0),[s,p]=R.useState(null),[r,h]=R.useState(!1),[a,g]=R.useState(0),[i,b]=R.useState(null),[f,C]=R.useState("Select a side and place your wager.");i&&(i.won,i.won,i.won,i.won,i.won,i.side,i.won?(e.Fragment,y(l(i.amount),t.numberFormat)):(e.Fragment,y(l(i.amount),t.numberFormat)));const T=()=>{if(!s){C("Please select Heads or Tails!");return}if(d<=0){C("Please enter a valid bet amount.");return}if(t.gold.lt(l(d))){C("Not enough gold!");return}h(!0),C("");const x=Math.random()>.5,v=Math.random()<.65,B=v?s==="heads"?"tails":"heads":x?"heads":"tails",M=!v,W=a,u=360*5;let S=W+u;const A=S%360;B==="heads"?S+=360-A:S+=180-A+360,g(S),setTimeout(()=>{h(!1),M?(o(d,!0),C("Victory!")):(o(d,!1),C("Defeat!")),setTimeout(()=>{b({won:M,amount:d,side:B})},500)},3e3)};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[e.jsx("style",{children:`
            .coin-container {
                perspective: 1000px;
                width: 180px;
                height: 180px;
                margin: 0 auto;
            }
            .coin {
                width: 100%;
                height: 100%;
                position: relative;
                transform-style: preserve-3d;
                transition: transform 3s cubic-bezier(0.1, 0.7, 0.1, 1);
            }
            .coin-face {
                position: absolute;
                width: 100%;
                height: 100%;
                backface-visibility: hidden;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 5rem;
                box-shadow: inset 0 0 30px rgba(0,0,0,0.5), 0 10px 20px rgba(0,0,0,0.3);
                border: 10px solid #b8860b;
            }
            .coin-front {
                background: radial-gradient(#ffd700, #daa520);
                color: #5d4037;
                transform: rotateY(0deg);
            }
            .coin-back {
                background: radial-gradient(#e6c200, #b8860b);
                color: #5d4037;
                transform: rotateY(180deg);
            }
            .coin-text {
                font-family: 'Cinzel', serif;
                font-weight: bold;
                text-shadow: 2px 2px 0 rgba(255,255,255,0.4);
            }
        `}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",position:"relative",background:"var(--bg-color)",overflow:"hidden"},children:[e.jsx("div",{className:"coin-container",children:e.jsxs("div",{className:"coin",style:{transform:`rotateY(${a}deg)`},children:[e.jsx("div",{className:"coin-face coin-front",children:e.jsx("span",{className:"coin-text",children:"ðŸ‘‘"})}),e.jsx("div",{className:"coin-face coin-back",children:e.jsx("span",{className:"coin-text",children:"1"})})]})}),e.jsx("div",{style:{fontSize:"1.4rem",fontWeight:"bold",marginTop:"20px",minHeight:"30px",color:"var(--accent-color)",textAlign:"center",padding:"0 20px"},children:f}),e.jsxs("div",{style:{display:"flex",gap:"20px",marginTop:"20px"},children:[e.jsxs("button",{onClick:()=>p("heads"),disabled:r,style:{padding:"10px 20px",border:`3px solid ${s==="heads"?"var(--gold-color)":"transparent"}`,background:s==="heads"?"rgba(255, 215, 0, 0.2)":"var(--bg-color)",color:"var(--text-color)",borderRadius:"8px",cursor:r?"not-allowed":"pointer",transition:"all 0.2s",display:"flex",flexDirection:"column",alignItems:"center",minWidth:"100px",transform:r?"none":"scale(1)",boxShadow:r?"none":"0 4px 8px rgba(0,0,0,0.15)",opacity:r?.6:1},onMouseEnter:x=>{!r&&s!=="heads"&&(x.currentTarget.style.transform="scale(1.1)",x.currentTarget.style.boxShadow="0 6px 12px rgba(0,0,0,0.3)",x.currentTarget.style.border="3px solid var(--accent-color)",x.currentTarget.style.background="rgba(33, 150, 243, 0.2)")},onMouseLeave:x=>{!r&&s!=="heads"&&(x.currentTarget.style.transform="scale(1)",x.currentTarget.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",x.currentTarget.style.border="3px solid transparent",x.currentTarget.style.background="var(--bg-color)")},children:[e.jsx("div",{style:{fontSize:"1.5rem"},children:"ðŸ‘‘"}),e.jsx("div",{style:{fontWeight:"bold"},children:"Heads"})]}),e.jsxs("button",{onClick:()=>p("tails"),disabled:r,style:{padding:"10px 20px",border:`3px solid ${s==="tails"?"var(--gold-color)":"transparent"}`,background:s==="tails"?"rgba(255, 215, 0, 0.2)":"var(--bg-color)",color:"var(--text-color)",borderRadius:"8px",cursor:r?"not-allowed":"pointer",transition:"all 0.2s",display:"flex",flexDirection:"column",alignItems:"center",minWidth:"100px",transform:r?"none":"scale(1)",boxShadow:r?"none":"0 4px 8px rgba(0,0,0,0.15)",opacity:r?.6:1},onMouseEnter:x=>{!r&&s!=="tails"&&(x.currentTarget.style.transform="scale(1.1)",x.currentTarget.style.boxShadow="0 6px 12px rgba(0,0,0,0.3)",x.currentTarget.style.border="3px solid var(--accent-color)",x.currentTarget.style.background="rgba(33, 150, 243, 0.2)")},onMouseLeave:x=>{!r&&s!=="tails"&&(x.currentTarget.style.transform="scale(1)",x.currentTarget.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",x.currentTarget.style.border="3px solid transparent",x.currentTarget.style.background="var(--bg-color)")},children:[e.jsx("div",{style:{fontSize:"1.5rem"},children:"1"}),e.jsx("div",{style:{fontWeight:"bold"},children:"Tails"})]})]})]}),e.jsxs("div",{style:{padding:"15px 20px",background:"var(--panel-bg)",borderTop:"2px solid var(--border-color)",flexShrink:0,display:"flex",flexDirection:"row",gap:"15px",alignItems:"flex-end"},children:[e.jsx("div",{style:{flex:1},children:e.jsx(ie,{currentBet:d,maxGold:t.gold,onBetChange:n,numberFormat:t.numberFormat})}),e.jsx("button",{className:"btn",onClick:T,disabled:!s||d<=0||r,style:{opacity:!s||d<=0||r?.5:1,fontSize:"1.2rem",padding:"0 30px",height:"60px",background:"var(--accent-color)",boxShadow:"0 4px 0 rgba(0,0,0,0.2)",flexShrink:0,fontWeight:"bold"},children:"FLIP"})]}),e.jsxs("div",{style:{padding:"10px 20px",background:"var(--panel-bg)",borderTop:"1px solid var(--border-color)",textAlign:"center",fontSize:"1rem",fontWeight:"bold"},children:[e.jsx("span",{style:{marginRight:"10px",color:"var(--text-secondary)"},children:"Result:"}),i?e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{marginRight:"10px"},children:i.won?"âœ¨":"ðŸ’¸"}),e.jsx("span",{style:{color:i.won?"#4caf50":"#f44336",marginRight:"10px"},children:i.won?"Victory!":"Defeat!"}),e.jsxs("span",{style:{color:"var(--accent-color)",marginRight:"10px"},children:["Result: ",i.side]}),e.jsxs("span",{style:{color:i.won?"gold":"#ef5350"},children:[i.won?"+":"-",y(l(i.amount),t.numberFormat)," Gold"]})]}):e.jsx("span",{style:{color:"var(--text-secondary)",fontStyle:"italic"},children:"No results yet"})]})]})},me=({value:t,size:o=80,color:c="#3e2723"})=>{const d=o*.18,n=o*.25,s=o*.5,p=o*.75,r=[];return(t===1||t===3||t===5)&&r.push({cx:s,cy:s}),t>1&&(r.push({cx:n,cy:n}),r.push({cx:p,cy:p})),t>3&&(r.push({cx:p,cy:n}),r.push({cx:n,cy:p})),t===6&&(r.push({cx:n,cy:s}),r.push({cx:p,cy:s})),e.jsx("div",{style:{width:o,height:o,backgroundColor:"#fff",borderRadius:o*.15,boxShadow:"0 4px 8px rgba(0,0,0,0.2), inset 0 -4px 4px rgba(0,0,0,0.1)",display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid #ccc"},children:e.jsx("svg",{width:o,height:o,viewBox:`0 0 ${o} ${o}`,children:r.map((h,a)=>e.jsx("circle",{cx:h.cx,cy:h.cy,r:d/2,fill:c},a))})})},_e=({gameState:t,onGamble:o,onLeave:c})=>{const[d,n]=R.useState(0),[s,p]=R.useState(!1),[r,h]=R.useState([1,1]),[a,g]=R.useState(null),[i,b]=R.useState("Place your wager and roll!"),f=()=>{if(d<=0){b("Please enter a valid bet amount.");return}if(t.gold.lt(l(d))){b("Not enough gold!");return}p(!0),b("Rolling..."),g(null);let T=0;const x=10,v=setInterval(()=>{h([Math.floor(Math.random()*6)+1,Math.floor(Math.random()*6)+1]),T++,T>=x&&(clearInterval(v),C())},100)},C=()=>{const T=Math.floor(Math.random()*6)+1,x=Math.floor(Math.random()*6)+1,v=T+x;h([T,x]),p(!1);let B=0,M=!1,W="";if(v===2?(B=10,M=!0,W="Snake Eyes! JACKPOT (x10)!"):v===3?(B=2,M=!0,W="Low Triple! (x2)"):v>=4&&v<=9?(B=0,M=!1,W="House wins..."):v>=10&&v<=11?(B=1.5,M=!0,W="Good roll! (x1.5)"):v===12&&(B=5,M=!0,W="Boxcars! Nice Win (x5)!"),M){const w=Math.max(1,Math.floor(d*(B-1)));o(w,!0),b(W),g({won:!0,amount:w,sum:v})}else o(d,!1),b(W),g({won:!1,amount:d,sum:v})};return a&&(a.won,a.won,a.won,a.won,a.won,a.sum,a.won?(e.Fragment,y(l(a.amount),t.numberFormat)):(e.Fragment,y(l(a.amount),t.numberFormat))),e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"space-evenly",alignItems:"center",background:"var(--bg-color)",overflow:"hidden",padding:"10px"},children:[e.jsxs("div",{style:{background:"var(--panel-bg)",padding:"10px",borderRadius:"8px",fontSize:"0.8rem",border:"1px solid var(--border-color)",width:"100%",maxWidth:"400px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"2px"},children:[e.jsx("span",{style:{color:"var(--text-color)"},children:"Sum 2 (Snake Eyes)"}),e.jsx("span",{style:{color:"var(--gold-color)",fontWeight:"bold"},children:"x10"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"2px"},children:[e.jsx("span",{style:{color:"var(--text-color)"},children:"Sum 3"}),e.jsx("span",{style:{color:"var(--success-color)",fontWeight:"bold"},children:"x2"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"2px"},children:[e.jsx("span",{style:{color:"var(--text-color)"},children:"Sum 10-11"}),e.jsx("span",{style:{color:"var(--success-color)",fontWeight:"bold"},children:"x1.5"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:"var(--text-color)"},children:"Sum 12 (Boxcars)"}),e.jsx("span",{style:{color:"var(--gold-color)",fontWeight:"bold"},children:"x5"})]}),e.jsx("div",{style:{textAlign:"center",color:"var(--danger-color)",marginTop:"15px",fontSize:"0.9rem",fontWeight:"bold"},children:"Sum 4-9: House Wins"})]}),e.jsxs("div",{style:{display:"flex",gap:"30px",transform:"scale(1.2)"},children:[e.jsx(me,{value:r[0],size:100}),e.jsx(me,{value:r[1],size:100})]}),e.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",minHeight:"40px",color:"var(--accent-color)"},children:s?"":`Sum: ${r[0]+r[1]}`}),e.jsx("div",{style:{fontSize:"1rem",minHeight:"20px",color:"var(--text-color)"},children:i})]}),e.jsxs("div",{style:{padding:"15px 20px",background:"var(--panel-bg)",borderTop:"2px solid var(--border-color)",flexShrink:0,display:"flex",flexDirection:"row",gap:"15px",alignItems:"flex-end"},children:[e.jsx("div",{style:{flex:1},children:e.jsx(ie,{currentBet:d,maxGold:t.gold,onBetChange:n,numberFormat:t.numberFormat})}),e.jsx("button",{className:"btn",onClick:f,disabled:d<=0||s,style:{fontSize:"1.2rem",padding:"0 30px",height:"60px",background:"var(--accent-color)",opacity:d<=0||s?.5:1,boxShadow:"0 4px 0 rgba(0,0,0,0.2)",flexShrink:0,fontWeight:"bold"},children:"ROLL"})]}),e.jsxs("div",{style:{padding:"10px 20px",background:"var(--panel-bg)",borderTop:"1px solid var(--border-color)",textAlign:"center",fontSize:"1rem",fontWeight:"bold"},children:[e.jsx("span",{style:{marginRight:"10px",color:"var(--text-secondary)"},children:"Result:"}),a?e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{marginRight:"10px"},children:a.won?"ðŸŽ²":"ðŸ“‰"}),e.jsx("span",{style:{color:a.won?"#4caf50":"#f44336",marginRight:"10px"},children:a.won?"You Won!":"You Lost"}),e.jsxs("span",{style:{color:"var(--accent-color)",marginRight:"10px"},children:["Rolled: ",a.sum]}),e.jsxs("span",{style:{color:a.won?"gold":"#ef5350"},children:[a.won?"+":"-",y(l(a.amount),t.numberFormat)," Gold"]})]}):e.jsx("span",{style:{color:"var(--text-secondary)",fontStyle:"italic"},children:"No results yet"})]})]})},ct=({gameState:t,onGamble:o,onClose:c})=>{const[d,n]=R.useState("racing");return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{height:"95vh",maxWidth:"1000px",width:"98%",padding:"0",display:"flex",flexDirection:"column",overflow:"hidden",borderRadius:"12px",border:"4px double var(--border-color)"},children:[e.jsxs("div",{style:{padding:"10px 20px",borderBottom:"2px solid var(--border-color)",background:"var(--accent-color)",color:"#fff",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h2",{style:{borderBottom:"none",margin:0,fontSize:"1.4rem",textShadow:"1px 1px 0 rgba(0,0,0,0.3)"},children:"ðŸº The Rusty Tankard"}),e.jsxs("div",{style:{fontSize:"0.9rem",background:"rgba(0,0,0,0.2)",padding:"4px 10px",borderRadius:"4px"},children:["Gold: ",e.jsx("span",{style:{color:"var(--gold-color)",fontWeight:"bold"},children:y(t.gold,t.numberFormat)})]})]}),e.jsxs("div",{style:{display:"flex",background:"var(--bg-color)",borderBottom:"2px solid var(--border-color)",overflowX:"auto"},children:[e.jsx("button",{onClick:()=>n("racing"),style:{flex:1,minWidth:"90px",padding:"12px 10px",border:"none",background:d==="racing"?"var(--panel-bg)":"transparent",fontWeight:"bold",color:d==="racing"?"var(--accent-color)":"var(--text-secondary)",cursor:"pointer",borderBottom:d==="racing"?"3px solid var(--accent-color)":"3px solid transparent",transition:"all 0.2s"},children:"ðŸ‡ Racing"}),e.jsx("button",{onClick:()=>n("coin"),style:{flex:1,minWidth:"90px",padding:"12px 10px",border:"none",background:d==="coin"?"var(--panel-bg)":"transparent",fontWeight:"bold",color:d==="coin"?"var(--accent-color)":"var(--text-secondary)",cursor:"pointer",borderBottom:d==="coin"?"3px solid var(--accent-color)":"3px solid transparent",transition:"all 0.2s"},children:"ðŸŸ¡ Coin"}),e.jsx("button",{onClick:()=>n("dice"),style:{flex:1,minWidth:"90px",padding:"12px 10px",border:"none",background:d==="dice"?"var(--panel-bg)":"transparent",fontWeight:"bold",color:d==="dice"?"var(--accent-color)":"var(--text-secondary)",cursor:"pointer",borderBottom:d==="dice"?"3px solid var(--accent-color)":"3px solid transparent",transition:"all 0.2s"},children:"ðŸŽ² Dice"})]}),e.jsxs("div",{style:{background:"var(--bg-color)",flex:1,overflow:"hidden",position:"relative",display:"flex",flexDirection:"column"},children:[d==="racing"&&e.jsx(Ue,{gameState:t,onGamble:(s,p)=>o(s,p),onLeave:c}),d==="coin"&&e.jsx($e,{gameState:t,onGamble:(s,p)=>o(s,p),onLeave:c}),d==="dice"&&e.jsx(_e,{gameState:t,onGamble:(s,p)=>o(s,p),onLeave:c})]}),e.jsx("div",{style:{padding:"8px",borderTop:"2px solid var(--border-color)",background:"var(--panel-bg)",textAlign:"center",flexShrink:0},children:e.jsx("button",{className:"btn",onClick:c,style:{background:"#5d4037",padding:"8px 20px",fontSize:"0.9rem",width:"auto"},children:"Exit Tavern"})})]})})},xt=({gameState:t,onPrestige:o,onClose:c})=>{var v;const n=l(1e12),s=t.totalGold;let p=l(0),r=!1,h=n.minus(s);if(s.gte(n)){const B=s.dividedBy(n);p=l(Math.floor(Math.pow(B.toNumber(),.33))).times(1).minus(t.renown),p.lt(0)&&(p=l(0)),r=p.gt(0)}const a=t.renown.plus(p),g=n.times(Math.pow(Math.floor(a.dividedBy(1).toNumber()+1),1/.33)),i=g.minus(s),f=ee(t.totalRenownEarned).minus(l(1)).times(l(100)),T=ee(t.totalRenownEarned.plus(p)).minus(l(1)).times(l(100)),x=Object.values(t.nationalProjects||{}).some(B=>B==null?void 0:B.active);return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{border:"4px solid #673ab7",maxHeight:"90vh",display:"flex",flexDirection:"column"},children:[e.jsx("h2",{style:{color:"#673ab7"},children:"ðŸ‘‘ Abdication"}),e.jsx("p",{children:"Are you ready to pass the crown to your heir?"}),e.jsxs("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:[!((v=t.playerProfile)!=null&&v.hasChosenName)&&e.jsxs("div",{style:{background:"rgba(255, 235, 59, 0.1)",border:"1px solid #ffc107",padding:"10px",borderRadius:"4px",marginBottom:"15px",fontSize:"0.9rem"},children:["ðŸ’¡ ",e.jsx("strong",{children:"Tip:"})," You can abdicate without choosing a ruler name. Choose a name only if you want to appear in the leaderboard."]}),e.jsxs("div",{style:{textAlign:"left",margin:"20px 0",background:"rgba(243, 229, 245, 0.5)",padding:"15px",borderRadius:"4px"},children:[e.jsx("div",{children:e.jsx("strong",{children:"You will lose:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"All Gold & Treasury"}),e.jsx("li",{children:"All Estates (Buildings)"}),e.jsx("li",{children:"Royal Scepter Levels"})]}),e.jsx("div",{children:e.jsx("strong",{children:"You will keep:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"Achievements"}),e.jsxs("li",{children:["Current Renown (",y(t.renown,t.numberFormat),")"]}),e.jsx("li",{children:"National Projects"}),e.jsx("li",{children:"Lifetime Stats & Leaderboard Rank"})]})]}),x&&e.jsx("div",{style:{marginBottom:"20px",padding:"10px",background:"rgba(255, 0, 0, 0.1)",border:"1px solid red",borderRadius:"4px",color:"#d32f2f",fontSize:"0.9rem",fontWeight:"bold",textAlign:"center"},children:"âš ï¸ WARNING: You have a National Project under construction! Abdication will cancel the construction. All progress and resources invested in the pending level will be lost."}),e.jsxs("div",{style:{fontSize:"1.2rem",marginBottom:"20px"},children:[e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:["Current Renown: ",y(t.renown,t.numberFormat)]}),e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:["Total Renown: ",y(t.totalRenownEarned,t.numberFormat)," (+",f.toNumber().toFixed(1),"%)"]}),e.jsx("hr",{style:{margin:"15px 0",borderTop:"1px dashed #ccc",borderBottom:"none"}}),e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:[e.jsx("strong",{children:"Renown Gain:"})," +",y(p,t.numberFormat)]}),e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:[e.jsx("strong",{children:"Total After Prestige:"})," ",y(t.totalRenownEarned.plus(p),t.numberFormat)," (+",T.toNumber().toFixed(1),"% bonus)"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginTop:"10px",background:"rgba(0,0,0,0.05)",padding:"5px",borderRadius:"4px"},children:[e.jsxs("div",{children:["Next Renown at: ",e.jsx("strong",{children:y(g,t.numberFormat)})," Lifetime Gold"]}),e.jsxs("div",{style:{color:i.gt(0)?"#cc0000":"var(--success-color)",fontWeight:"bold"},children:["(Need ",y(i.gt(0)?i:l(0),t.numberFormat)," more)"]})]})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"20px"},children:[e.jsx("button",{className:"btn",style:{background:"#666"},onClick:c,children:"Cancel"}),e.jsx("button",{className:"btn",style:{background:"#673ab7"},onClick:o,disabled:!r,children:r?"Abdicate":s.lt(n)?`Need ${y(h,t.numberFormat)} more Gold`:"Prestige Unavailable"})]})]})})},pt=({gameState:t,onClose:o,onHardReset:c,onProgressReset:d,onSave:n,onSetTheme:s,onSetNumberFormat:p,onToggleIdleMode:r,onUpdateInterface:h})=>{var M,W,w;const[a,g]=Z.useState(!1),i=t.interface||{density:"normal",showFloatingText:!0,showWeatherWidget:!0,layout:{left:l(1),center:l(1),right:l(1)}},b=(M=i.layout.left)!=null&&M.toNumber?i.layout.left.toNumber():Number(i.layout.left),f=(W=i.layout.center)!=null&&W.toNumber?i.layout.center.toNumber():Number(i.layout.center),C=(w=i.layout.right)!=null&&w.toNumber?i.layout.right.toNumber():Number(i.layout.right),T=()=>{a?d():g(!0)},x=(u,S)=>{h({layout:G(D({},i.layout),{[u]:l(S)})})},v={marginBottom:"8px",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px",background:"rgba(0,0,0,0.03)",borderRadius:"4px"},B={width:"100%",marginBottom:"5px"};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxHeight:"90vh",display:"flex",flexDirection:"column"},children:[e.jsx("h2",{children:"âš™ï¸ Royal Settings"}),t.playerProfile&&e.jsxs("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"12px",marginBottom:"20px",textAlign:"center"},children:[e.jsxs("div",{style:{color:"var(--gold-color)",fontSize:"16px",fontWeight:"bold"},children:["ðŸ‘‘ Your Ruler: ",t.playerProfile.rulerName," ",t.playerProfile.rulerId,t.playerProfile.specialIcon&&e.jsx("span",{style:{marginLeft:"5px"},children:t.playerProfile.specialIcon}),t.playerProfile.specialTitle&&e.jsx("span",{style:{marginLeft:"5px",color:"var(--accent-color)",fontSize:"14px"},children:t.playerProfile.specialTitle})]}),e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"12px",marginTop:"5px"},children:"Registered in Leaderboard System"})]}),e.jsxs("div",{style:{textAlign:"left",marginBottom:"20px",maxHeight:"60vh",overflowY:"auto",paddingRight:"5px",flex:1,overflowX:"hidden",WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:[e.jsx("h3",{style:{marginBottom:"10px"},children:"Layout Configuration"}),e.jsxs("div",{style:{marginBottom:"15px",background:"rgba(0,0,0,0.03)",padding:"10px",borderRadius:"4px"},children:[e.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Column Widths (Ratio)"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"10px",alignItems:"center",marginBottom:"5px"},children:[e.jsx("span",{style:{fontSize:"0.8rem"},children:"Left"}),e.jsx("input",{type:"range",min:"1",max:"5",step:"0.5",value:b,onChange:u=>x("left",parseFloat(u.target.value)),style:B}),e.jsx("span",{style:{fontSize:"0.8rem"},children:b})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"10px",alignItems:"center",marginBottom:"5px"},children:[e.jsx("span",{style:{fontSize:"0.8rem"},children:"Center"}),e.jsx("input",{type:"range",min:"1",max:"5",step:"0.5",value:f,onChange:u=>x("center",parseFloat(u.target.value)),style:B}),e.jsx("span",{style:{fontSize:"0.8rem"},children:f})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"10px",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:"0.8rem"},children:"Right"}),e.jsx("input",{type:"range",min:"1",max:"5",step:"0.5",value:C,onChange:u=>x("right",parseFloat(u.target.value)),style:B}),e.jsx("span",{style:{fontSize:"0.8rem"},children:C})]})]}),e.jsx("div",{style:{borderTop:"1px dashed #ccc",margin:"15px 0"}}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Preset Themes"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(120px, 1fr))",gap:"5px",justifyContent:"center"},children:Object.values(Me).map(u=>e.jsx("button",{className:"btn",style:{background:t.theme===u.id?"var(--accent-color)":"var(--panel-bg)",color:t.theme===u.id?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",padding:"5px 10px",minWidth:"120px",textAlign:"center"},onClick:()=>s(u.id),children:u.name},u.id))})]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Layout Density"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"5px",justifyContent:"center"},children:["compact","normal","spacious"].map(u=>e.jsx("button",{className:"btn",style:{background:i.density===u?"var(--accent-color)":"var(--panel-bg)",color:i.density===u?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",textTransform:"capitalize",minWidth:"120px",textAlign:"center",padding:"5px 10px"},onClick:()=>h({density:u}),children:u},u))})]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Number Format"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"5px",justifyContent:"center"},children:["standard","scientific","plain"].map(u=>e.jsx("button",{className:"btn",style:{background:t.numberFormat===u?"var(--accent-color)":"var(--panel-bg)",color:t.numberFormat===u?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",padding:"5px 10px",textTransform:"capitalize",minWidth:"120px",textAlign:"center"},onClick:()=>p(u),children:u},u))})]}),e.jsx("div",{style:{borderTop:"1px dashed #ccc",margin:"15px 0"}}),e.jsxs("div",{style:v,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Cinematic Idle Mode"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show landscape when inactive. Wait 30 seconds after enabling."})]}),e.jsx("button",{className:"btn",style:{background:t.idleModeEnabled?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:r,children:t.idleModeEnabled?"ON":"OFF"})]}),e.jsxs("div",{style:v,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Click Text"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show floating numbers on click."})]}),e.jsx("button",{className:"btn",style:{background:i.showFloatingText?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>h({showFloatingText:!i.showFloatingText}),children:i.showFloatingText?"ON":"OFF"})]}),e.jsxs("div",{style:v,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Weather Widget"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show weather info in top left."})]}),e.jsx("button",{className:"btn",style:{background:i.showWeatherWidget?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>h({showWeatherWidget:!i.showWeatherWidget}),children:i.showWeatherWidget?"ON":"OFF"})]})]}),e.jsxs("div",{style:{borderTop:"2px solid #ccc",paddingTop:"15px",marginTop:"15px",flexShrink:0},children:[e.jsx("h3",{children:"System"}),e.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"center",flexWrap:"wrap"},children:[e.jsx("button",{className:"btn",onClick:n,children:"Force Save"}),e.jsx("button",{className:"btn",style:{backgroundColor:a?"red":"#d32f2f"},onClick:T,children:a?"CONFIRM WIPE?":"Reset Progress"})]}),a&&e.jsx("div",{style:{color:"red",fontSize:"0.8rem",marginTop:"5px"},children:"Warning: This will delete all progress but keep your settings!"})]}),e.jsx("button",{className:"btn",style:{marginTop:"20px",background:"#5d4037",width:"100%",flexShrink:0},onClick:o,children:"Return to Game"}),e.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)",marginTop:"10px",flexShrink:0},children:"v2.3.0 - Kingdom Clicker"})]})})},gt=({onClose:t})=>e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"600px",maxHeight:"80vh",display:"flex",flexDirection:"column"},children:[e.jsx("h2",{children:"ðŸ“œ Royal Chronicles"}),e.jsx("div",{style:{overflowY:"auto",textAlign:"left",padding:"0 20px",flex:1},children:he.map((o,c)=>e.jsxs("div",{style:{marginBottom:"20px",borderBottom:c<he.length-1?"1px dashed #ccc":"none",paddingBottom:"10px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"5px"},children:[e.jsxs("span",{style:{fontSize:"1.2rem",fontWeight:"bold",color:"var(--accent-color)"},children:["v",o.version]}),e.jsx("span",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:o.date})]}),e.jsx("ul",{style:{margin:"5px 0",paddingLeft:"20px"},children:o.changes.map((d,n)=>e.jsx("li",{style:{marginBottom:"3px"},children:d},n))})]},o.version))}),e.jsx("button",{className:"btn",style:{marginTop:"20px",alignSelf:"center"},onClick:t,children:"Close Chronicles"})]})}),ht=({gameState:t,currentGps:o,currentTotalClicks:c,currentPrestigeClicks:d,onClose:n})=>{var M,W,w;const s=Object.values(t.buildings).reduce((u,S)=>u.plus(S),l(0)),p=t.achievements.length,r=Ee.length;let h="None",a="None",g=-1,i=l(0);Q.forEach((u,S)=>{const A=t.buildings[u.id]||l(0);A.gt(l(0))&&S>g&&(g=S,h=u.name),A.gt(i)&&(i=A,a=u.name)});const f=(()=>{var m;const u=l(1),S=t.clickUpgradeLevel||0,A=Math.min(S,15),k=l(2).pow(A),z=u.times(k),L=ee(t.totalRenownEarned);let E=z;L.gt(l(1))&&(E=z.times(L));const P=oe(S);if(P>0){let N=l(0);Q.forEach(I=>{const J=t.buildings[I.id]||l(0);J.gt(0)&&(N=N.plus(J.times(I.baseProduction)))});let F=N;L.gt(l(1))&&(F=N.times(L));let H=0;t.nationalProjects&&Object.values(t.nationalProjects).forEach(I=>H+=I.level||0);const se=l(1).plus(l(H*le));F=F.times(se);const te=((m=t.weather)==null?void 0:m.current)||"clear";let X=l(0);Q.forEach(I=>{const J=t.buildings[I.id]||l(0);if(J.gt(0)){let _=l(1);te==="sunny"?(I.id==="peasant"||I.id==="field"||I.id==="stable"||I.id==="cathedral")&&(_=l(1.2)):te==="rainy"?(I.id==="silver_mine"||I.id==="alchemist"||I.id==="market"||I.id==="tavern")&&(_=l(1.2)):te==="stormy"?((I.id==="blacksmith"||I.id==="void_portal")&&(_=l(1.3)),(I.id==="field"||I.id==="stable")&&(_=l(.8))):te==="windy"&&(I.id==="market"||I.id==="castle"||I.id==="time_chamber")&&(_=l(1.15));const ce=J.times(I.baseProduction);L.gt(l(1))?X=X.plus(ce.times(L).times(se).times(_.minus(l(1)))):X=X.plus(ce.times(se).times(_.minus(l(1))))}});const Ce=F.plus(X),Se=l(1).plus(l(t.achievements.length*.02)),ae=Ce.times(Se);let de=ae;t.globalIncomeMultiplier&&(de=ae.times(l(t.globalIncomeMultiplier))),E=E.plus(de.times(P))}const j=l(1).plus(l(t.achievements.length*.02));return E=E.times(j),t.globalIncomeMultiplier&&(E=E.times(l(t.globalIncomeMultiplier))),E})(),[C,T]=R.useState("");R.useEffect(()=>{const u=()=>{const A=l(Date.now()).minus(t.startTime),k=A.dividedBy(l(1e3)),z=k.minus(k.dividedBy(l(60)).floor().times(l(60))).floor(),L=A.dividedBy(l(6e4)),E=L.minus(L.dividedBy(l(60)).floor().times(l(60))).floor(),P=A.dividedBy(l(36e5)),j=P.minus(P.dividedBy(l(24)).floor().times(l(24))).floor(),m=A.dividedBy(l(864e5)).floor();let N="";m.gt(l(0))&&(N+=`${m.toString()}d `),j.gt(l(0))&&(N+=`${j.toString()}h `),N+=`${E.toString()}m ${z.toString()}s`,T(N)};u();const S=setInterval(u,1e3);return()=>clearInterval(S)},[t.startTime]);const x={display:"flex",justifyContent:"space-between",padding:"8px 0",borderBottom:"1px dashed rgba(0,0,0,0.1)",fontSize:"0.9rem"},v={fontSize:"1rem",color:"var(--accent-color)",marginTop:"15px",borderBottom:"2px solid var(--border-color)",paddingBottom:"2px",marginBottom:"5px"},B=(M=t.weather)!=null&&M.current&&((W=Fe[t.weather.current])==null?void 0:W.name)||"Unknown";return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"500px",maxHeight:"90vh",display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx("h2",{style:{flexShrink:0},children:"ðŸ“Š Royal Records"}),e.jsxs("div",{style:{textAlign:"left",marginBottom:"20px",overflowY:"auto",paddingRight:"10px",flex:1,minHeight:0},children:[e.jsx("h3",{style:v,children:"âš¡ Current Status"}),e.jsxs("div",{style:x,children:[e.jsx("span",{children:"Gold Per Second:"}),e.jsxs("strong",{style:{color:"var(--success-color)"},children:[y(o,t.numberFormat)," / sec"]})]}),e.jsxs("div",{style:x,children:[e.jsx("span",{children:"Click Power:"}),e.jsxs("strong",{style:{color:"var(--success-color)"},children:[y(f,t.numberFormat)," / click"]})]}),e.jsxs("div",{style:x,children:[e.jsx("span",{children:"Current Weather:"}),e.jsx("strong",{children:B})]}),e.jsxs("div",{style:x,children:[e.jsx("span",{children:"Current Renown:"}),e.jsx("strong",{style:{color:"#673ab7"},children:y(t.renown,t.numberFormat)})]}),e.jsxs("div",{style:x,children:[e.jsx("span",{children:"Total Renown Earned:"}),e.jsx("strong",{style:{color:"#9575cd"},children:y(t.totalRenownEarned,t.numberFormat)})]}),e.jsxs("div",{style:x,children:[e.jsx("span",{children:"Renown Bonus:"}),e.jsxs("strong",{style:{color:"#9575cd"},children:["+",ee(t.totalRenownEarned).minus(l(1)).times(l(100)).toNumber().toString(),"%"]})]}),e.jsx("h3",{style:v,children:"â³ Time & Legacy"}),e.jsxs("div",{style:x,children:[e.jsx("span",{children:"Time Played:"}),e.jsx("strong",{children:C})]}),e.jsxs("div",{style:x,children:[e.jsx("span",{children:"Kingdom Founded:"}),e.jsx("span",{children:new Date(t.startTime.toNumber()).toLocaleDateString()})]}),e.jsxs("div",{style:x,children:[e.jsx("span",{children:"Total Renown:"}),e.jsx("strong",{children:y(t.renown,t.numberFormat)})]}),e.jsx("h3",{style:v,children:"ðŸ’° Economy Summary"}),e.jsxs("div",{style:x,children:[e.jsx("span",{children:"Current Gold:"}),e.jsx("strong",{children:y(t.gold,t.numberFormat)})]}),e.jsxs("div",{style:x,children:[e.jsx("span",{children:"Lifetime Gold:"}),e.jsx("strong",{children:y(t.totalGold,t.numberFormat)})]}),e.jsx("h3",{style:v,children:"ðŸ° Dominion"}),e.jsxs("div",{style:x,children:[e.jsx("span",{children:"Total Buildings:"}),e.jsx("strong",{children:y(s,t.numberFormat)})]}),e.jsxs("div",{style:x,children:[e.jsx("span",{children:"Highest Tech Building:"}),e.jsx("strong",{children:h})]}),e.jsxs("div",{style:x,children:[e.jsx("span",{children:"Most Numerous:"}),e.jsxs("strong",{children:[a," (",y(i,t.numberFormat),")"]})]}),e.jsx("h3",{style:v,children:"ðŸ“ˆ Player Stats"}),e.jsxs("div",{style:x,children:[e.jsx("span",{children:"Total Clicks:"}),e.jsx("span",{children:y(c,t.numberFormat)})]}),e.jsxs("div",{style:x,children:[e.jsx("span",{children:"Current Prestige Clicks:"}),e.jsx("span",{children:y(d,t.numberFormat)})]}),e.jsxs("div",{style:x,children:[e.jsx("span",{children:"Dragons Slain:"}),e.jsx("span",{children:y(t.stats.dragonsKilled,t.numberFormat)})]}),((w=t.buildings.tavern)==null?void 0:w.gt(l(0)))&&e.jsxs("div",{style:x,children:[e.jsx("span",{children:"Tavern Games:"}),e.jsx("span",{children:y(t.stats.tavernGamesPlayed,t.numberFormat)})]}),e.jsxs("div",{style:x,children:[e.jsx("span",{children:"Buildings Purchased:"}),e.jsx("span",{children:y(t.stats.totalBuildingsPurchased,t.numberFormat)})]}),e.jsxs("div",{style:x,children:[e.jsx("span",{children:"Total Gold Spent:"}),e.jsx("span",{children:y(t.stats.totalGoldSpent,t.numberFormat)})]}),t.totalGold.gte(l(1e12))&&e.jsxs("div",{style:x,children:[e.jsx("span",{children:"Times Prestiged:"}),e.jsx("span",{children:t.stats.prestigeCount})]}),(t.stats.clickUpgradeLevel>0||t.stats.offlineUpgradeLevel>0||t.totalGold.gte(l(1e18)))&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{style:v,children:"âš”ï¸ Upgrades & Power"}),e.jsxs("div",{style:x,children:[e.jsx("span",{children:"Royal Scepter Level:"}),e.jsx("span",{children:t.stats.clickUpgradeLevel})]}),e.jsxs("div",{style:x,children:[e.jsx("span",{children:"Passive Income Level:"}),e.jsx("span",{children:t.stats.offlineUpgradeLevel})]}),t.totalGold.gte(l(1e18))&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:x,children:[e.jsx("span",{children:"Infinite Tower Level:"}),e.jsx("span",{children:t.stats.infiniteTowerLevel})]}),e.jsxs("div",{style:x,children:[e.jsx("span",{children:"Dark Matter Gold:"}),e.jsx("span",{style:{color:"#673ab7"},children:y(t.stats.darkMatterGold,t.numberFormat)})]})]})]}),e.jsx("h3",{style:v,children:"ðŸŽ–ï¸ Completion"}),e.jsxs("div",{style:x,children:[e.jsx("span",{children:"Achievements:"}),e.jsxs("span",{children:[p," / ",r," (",Math.floor(p/r*100),"%)"]})]}),e.jsx("h3",{style:v,children:"ðŸ† Achievements"}),e.jsx(Ie,{gameState:t})]}),e.jsx("button",{className:"btn",style:{background:"#5d4037",width:"100%",flexShrink:0},onClick:n,children:"Close Records"})]})})},ut=({gameState:t,onStartProject:o,onUpgradeClickPower:c,onUpgradeOffline:d,onClose:n})=>{const[s,p]=R.useState("royalScepter"),r=i=>{var W;const b=l(1),f=Math.min(i,15),C=l(2).pow(f),T=b.times(C),x=ee(t.totalRenownEarned);let v=T;x.gt(l(1))&&(v=T.times(x));const B=oe(i);if(B>0){let w=l(0);Q.forEach(m=>{const N=t.buildings[m.id]||l(0);N.gt(0)&&(w=w.plus(N.times(m.baseProduction)))});let u=w;x.gt(l(1))&&(u=w.times(x));let S=0;t.nationalProjects&&Object.values(t.nationalProjects).forEach(m=>S+=m.level||0);const A=l(1).plus(l(S*le));u=u.times(A);const k=((W=t.weather)==null?void 0:W.current)||"clear";let z=l(0);Q.forEach(m=>{const N=t.buildings[m.id]||l(0);if(N.gt(0)){let F=l(1);k==="sunny"?(m.id==="peasant"||m.id==="field"||m.id==="stable"||m.id==="cathedral")&&(F=l(1.2)):k==="rainy"?(m.id==="silver_mine"||m.id==="alchemist"||m.id==="market"||m.id==="tavern")&&(F=l(1.2)):k==="stormy"?((m.id==="blacksmith"||m.id==="void_portal")&&(F=l(1.3)),(m.id==="field"||m.id==="stable")&&(F=l(.8))):k==="windy"&&(m.id==="market"||m.id==="castle"||m.id==="time_chamber")&&(F=l(1.15));const H=N.times(m.baseProduction);x.gt(l(1))?z=z.plus(H.times(x).times(A).times(F.minus(l(1)))):z=z.plus(H.times(A).times(F.minus(l(1))))}});const L=u.plus(z),E=l(1).plus(l(t.achievements.length*.02)),P=L.times(E);let j=P;t.globalIncomeMultiplier&&(j=P.times(l(t.globalIncomeMultiplier))),v=v.plus(j.times(B))}const M=l(1).plus(l(t.achievements.length*.02));return v=v.times(M),t.globalIncomeMultiplier&&(v=v.times(l(t.globalIncomeMultiplier))),v};if(!(t.buildings.field||l(0)).gt(0))return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("h2",{children:"ðŸ—ï¸ National Projects"}),e.jsxs("div",{style:{padding:"20px",color:"var(--text-secondary)"},children:[e.jsx("div",{style:{fontSize:"3rem",marginBottom:"10px"},children:"ðŸ”’"}),e.jsx("p",{children:"You must establish a functioning economy before launching national projects."}),e.jsx("p",{style:{fontWeight:"bold",color:"var(--accent-color)"},children:"Requirement: Build a Wheat Field."})]}),e.jsx("button",{className:"btn",onClick:n,children:"Close"})]})});const g=()=>{const i=t.clickUpgradeLevel||0,b=i>=re,f=i+1,C=fe(f),T=t.gold.gte(C),x=l(2).pow(Math.min(i,15)),v=oe(i),B=r(i);v>0?`${y(x)}${(v*100).toFixed(1)}`:y(x);const M=l(2).pow(Math.min(f,15)),W=oe(f),w=r(f);W>0?`${y(M)}${(W*100).toFixed(1)}`:y(M);const u=t.offlineUpgradeLevel||0,S=u>=Y,A=u+1,k=be(A),z=t.renown.gte(k),{efficiency:L,duration:E}=ne(u),{efficiency:P,duration:j}=ne(A),m=N=>{const F=Math.floor(N/3600),H=Math.floor(N%3600/60);return F>0?`${F}h ${H}m`:`${H}m`};return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"15px"},children:[e.jsxs("div",{style:{border:"2px solid var(--border-color)",borderRadius:"8px",background:"var(--bg-color)",overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"10px",background:"rgba(0,0,0,0.05)",color:"var(--text-color)",fontWeight:"bold",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"ðŸ‘‘ Royal Scepter"}),e.jsxs("span",{children:["Lvl ",i," / ",re]})]}),e.jsxs("div",{style:{padding:"15px"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginBottom:"10px",fontStyle:"italic"},children:"Enhance your royal authority to increase click power."}),e.jsxs("div",{style:{marginBottom:"10px",fontSize:"0.9rem",color:"var(--success-color)",fontWeight:"bold"},children:["Current Power: ",y(B)]}),b?e.jsx("div",{style:{textAlign:"center",padding:"10px",color:"var(--gold-color)",fontWeight:"bold",border:"1px solid var(--gold-color)",borderRadius:"4px",background:"rgba(255, 215, 0, 0.1)"},children:"MAXIMUM LEVEL REACHED"}):e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"0.85rem",marginBottom:"10px",background:"rgba(255,255,255,0.5)",padding:"5px",borderRadius:"4px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"Next Level:"}),e.jsxs("div",{style:{marginBottom:"5px"},children:["Power: ",y(w)]}),e.jsxs("div",{style:{color:T?"green":"red",fontWeight:"bold"},children:["ðŸ’° ",y(C)," Gold"]})]}),e.jsx("button",{className:"btn",style:{width:"100%",background:T?"var(--accent-color)":"var(--border-color)",cursor:T?"pointer":"not-allowed"},disabled:!T,onClick:c,children:"Upgrade Scepter"})]})]})]}),e.jsxs("div",{style:{border:"2px solid var(--border-color)",borderRadius:"8px",background:"var(--bg-color)",overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"10px",background:"rgba(0,0,0,0.05)",color:"var(--text-color)",fontWeight:"bold",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"ðŸ’¤ Offline Production"}),e.jsxs("span",{children:["Lvl ",u," / ",Y]})]}),e.jsxs("div",{style:{padding:"15px"},children:[e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginBottom:"10px",fontStyle:"italic"},children:["Improve the efficiency of your kingdom while you are away.",e.jsx("br",{}),"â±ï¸ Higher levels increase both efficiency % and maximum production time."]}),e.jsxs("div",{style:{marginBottom:"10px",fontSize:"0.9rem",color:"var(--success-color)",fontWeight:"bold"},children:["Current: ",(L*100).toFixed(0),"% for ",m(E)]}),!S&&e.jsxs("div",{style:{marginBottom:"10px"},children:[e.jsx("div",{style:{width:"100%",height:"8px",background:"#ccc",borderRadius:"4px",overflow:"hidden"},children:e.jsx("div",{style:{width:`${u/Y*100}%`,height:"100%",background:"var(--success-color)",transition:"width 0.3s ease"}})}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"2px"},children:[Y-u," levels to max"]})]}),S?e.jsx("div",{style:{textAlign:"center",padding:"10px",color:"var(--gold-color)",fontWeight:"bold",border:"1px solid var(--gold-color)",borderRadius:"4px",background:"rgba(255, 215, 0, 0.1)"},children:"MAXIMUM LEVEL REACHED"}):e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"0.85rem",marginBottom:"10px",background:"rgba(255,255,255,0.5)",padding:"5px",borderRadius:"4px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"Next Level:"}),e.jsxs("div",{style:{marginBottom:"5px"},children:["Effect: ",(P*100).toFixed(0),"% for ",m(j)]}),e.jsxs("div",{style:{color:z?"#673ab7":"red",fontWeight:"bold"},children:["ðŸ‘‘ ",y(k)," Renown"]})]}),e.jsx("button",{className:"btn",style:{width:"100%",background:z?"#673ab7":"var(--border-color)",cursor:z?"pointer":"not-allowed"},disabled:!z,onClick:d,children:"Upgrade Passive Income"})]})]})]})]})};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"1000px",width:"95%",height:"85vh",display:"flex",flexDirection:"column",padding:"0"},children:[e.jsxs("div",{style:{padding:"20px",background:"var(--accent-color)",color:"var(--text-on-accent)"},children:[e.jsx("h2",{style:{margin:0,border:"none",color:"var(--gold-color)"},children:"ðŸ›ï¸ National Projects"}),e.jsx("p",{style:{margin:"5px 0 0 0",fontSize:"0.9rem",opacity:.9},children:"Invest resources to permanently improve your kingdom's power. All improvements persist through prestige."})]}),e.jsx("div",{style:{display:"flex",background:"var(--bg-color)",borderBottom:"2px solid var(--border-color)",padding:"0 20px"},children:e.jsx("button",{className:"btn",style:{background:"var(--accent-color)",border:"none",borderBottom:"3px solid var(--gold-color)",borderRadius:"0",padding:"15px 20px",margin:"0",fontWeight:"bold",color:"var(--text-on-accent)"},children:"ðŸ‘‘ Royal Scepter"})}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"20px",background:"var(--panel-bg)"},children:g()}),e.jsx("div",{style:{padding:"15px",borderTop:"1px solid var(--border-color)",textAlign:"right",background:"var(--bg-color)"},children:e.jsx("button",{className:"btn",onClick:n,children:"Return to Kingdom"})})]})})},Ye={apiKey:"AIzaSyA1Dw5M2Zk8bpTCjlU2Tuifvx0ZI3IeRv0",authDomain:"kingdomclicker-156dc.firebaseapp.com",projectId:"kingdomclicker-156dc",storageBucket:"kingdomclicker-156dc.firebasestorage.app",messagingSenderId:"496461589742",appId:"1:496461589742:web:e6413dfa2d1bbabd3ad7ff"},Ve=Pe(Ye),$=De(Ve);function Ke(){return`#${Math.floor(Math.random()*99999).toString().padStart(5,"0")}`}function qe(){const t=new Date,o=t.getDay(),c=t.getDate()-o+(o===0?-6:1);return new Date(t.setDate(c))}function mt(t){return U(this,null,function*(){var o,c,d;try{console.log("ðŸš€ Starting leaderboard submission for:",t.rulerName),console.log("ðŸ“Š Data to submit:",{rulerName:t.rulerName,rulerId:t.rulerId,gold:(o=t.gold)==null?void 0:o.toString(),renown:(c=t.renown)==null?void 0:c.toString(),achievements:t.achievements,totalClicks:(d=t.totalClicks)==null?void 0:d.toString(),period:t.period});const n=G(D({},t),{period:"alltime"}),s=G(D({},t),{period:"weekly"}),p=K($,"leaderboard_alltime",t.rulerId),r=G(D({},n),{gold:Number(n.gold.toString()),achievements:Number(n.achievements),renown:Number(n.renown.toString()),totalClicks:n.totalClicks.toString(),timestamp:V()});n.buildings!==void 0&&(r.buildings=Number(n.buildings)),console.log("ðŸ“¤ Submitting alltime data:",r),yield q(p,r),console.log("âœ… Alltime data submitted successfully");const h=K($,"leaderboard_weekly",t.rulerId),a=G(D({},s),{gold:Number(s.gold.toString()),achievements:Number(s.achievements),renown:Number(s.renown.toString()),totalClicks:s.totalClicks.toString(),timestamp:V()});return s.buildings!==void 0&&(a.buildings=Number(s.buildings)),console.log("ðŸ“¤ Submitting weekly data:",a),yield q(h,a),console.log("âœ… Weekly data submitted successfully"),{allTimeId:t.rulerId,weeklyId:t.rulerId}}catch(n){throw console.error("âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ Ð² Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´:"),console.error("Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",n),n instanceof Error&&(console.error("Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",n.message),console.error("Ð¡Ñ‚ÐµÐº Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",n.stack)),"code"in n&&(console.error("ÐšÐ¾Ð´ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Firebase:",n.code),console.error("Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ:",n.customData)),n}})}function Xe(t=100){return U(this,null,function*(){try{console.log("ðŸ” Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… all-time Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´Ð°...");const o=ye(ve($,"leaderboard_alltime"),je("gold","desc"),we(t));console.log("ðŸ“¡ Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° Ðº Firestore...");const c=yield ke(o);console.log("ðŸ“Š ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¾ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð²:",c.docs.length);const d=c.docs.map(n=>{const s=n.data();return G(D({id:n.id},s),{gold:s.gold instanceof O?s.gold:new O(s.gold),renown:s.renown instanceof O?s.renown:new O(s.renown),totalClicks:s.totalClicks instanceof O?s.totalClicks:typeof s.totalClicks=="string"?new O(s.totalClicks):new O(s.totalClicks),timestamp:s.timestamp})});return console.log("âœ… All-time Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½, Ð·Ð°Ð¿Ð¸ÑÐµÐ¹:",d.length),d}catch(o){throw console.error("âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ all-time Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´Ð°:"),console.error("Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",o),o instanceof Error&&(console.error("Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",o.message),console.error("Ð¡Ñ‚ÐµÐº Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",o.stack)),"code"in o&&console.error("ÐšÐ¾Ð´ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Firebase:",o.code),o}})}function Je(t=100){return U(this,null,function*(){try{console.log("ðŸ” Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… weekly Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´Ð°...");const o=qe();console.log("ðŸ“… ÐÐ°Ñ‡Ð°Ð»Ð¾ Ð½ÐµÐ´ÐµÐ»Ð¸:",o.toISOString());const c=ye(ve($,"leaderboard_weekly"),je("gold","desc"),we(t));console.log("ðŸ“¡ Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° Ðº Firestore...");const d=yield ke(c);console.log("ðŸ“Š ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¾ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð² Ð´Ð¾ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ð¸:",d.docs.length);const s=d.docs.map(p=>{const r=p.data();return G(D({id:p.id},r),{gold:r.gold instanceof O?r.gold:new O(r.gold),renown:r.renown instanceof O?r.renown:new O(r.renown),totalClicks:r.totalClicks instanceof O?r.totalClicks:typeof r.totalClicks=="string"?new O(r.totalClicks):new O(r.totalClicks),timestamp:r.timestamp})}).filter(p=>{var a,g;const r=((g=(a=p.timestamp)==null?void 0:a.toDate)==null?void 0:g.call(a))||new Date(p.timestamp),h=r>=o;return h||console.log("ðŸ—‘ï¸ Ð—Ð°Ð¿Ð¸ÑÑŒ Ð¾Ñ‚Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð¾Ð²Ð°Ð½Ð° (ÑÑ‚Ð°Ñ€Ð°Ñ Ð´Ð°Ñ‚Ð°):",r.toISOString()),h});return console.log("âœ… Weekly Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½, Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ Ð¿Ð¾ÑÐ»Ðµ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ð¸:",s.length),s}catch(o){throw console.error("âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ weekly Ð»Ð¸Ð´ÐµÑ€Ð±Ð¾Ñ€Ð´Ð°:"),console.error("Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",o),o instanceof Error&&(console.error("Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",o.message),console.error("Ð¡Ñ‚ÐµÐº Ð¾ÑˆÐ¸Ð±ÐºÐ¸:",o.stack)),"code"in o&&console.error("ÐšÐ¾Ð´ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Firebase:",o.code),o}})}function ft(t,o,c){return U(this,null,function*(){try{const d=`lastStatsSave_${o}`,n=localStorage.getItem(d),s=Date.now(),p=3600*1e3;if(n&&s-parseInt(n)<p)return;let r=0;const h={};Object.keys(t.buildings).forEach(b=>{const f=Number(t.buildings[b].toString());h[b]=f,r+=f});const a=Math.floor((Date.now()-Number(t.startTime.toString()))/1e3),g={rulerId:o,rulerName:c,totalBuildings:h,totalBuildingsPurchased:r,totalGoldSpent:t.totalGoldSpent||new O(0),totalGoldEarned:t.totalGold,totalClicks:t.stats.totalClicks,currentPrestigeClicks:t.stats.currentPrestigeClicks,prestigeCount:t.prestigeCount||0,totalRenownEarned:t.totalRenownEarned,nationalProjects:Object.keys(t.nationalProjects||{}).reduce((b,f)=>(b[f]=t.nationalProjects[f].level||0,b),{}),clickUpgradeLevel:t.clickUpgradeLevel||0,offlineUpgradeLevel:t.offlineUpgradeLevel||0,tavernGamesPlayed:Number(t.stats.tavernGamesPlayed.toString()),dragonsKilled:Number(t.stats.dragonsKilled.toString()),achievements:t.achievements,playTime:a,lastUpdated:V(),createdAt:V()},i=K($,"playerStats",o);yield q(i,{rulerId:o,rulerName:c,totalBuildings:h,totalBuildingsPurchased:r,totalGoldSpent:g.totalGoldSpent.toString(),totalGoldEarned:g.totalGoldEarned.toString(),totalClicks:g.totalClicks.toString(),currentPrestigeClicks:g.currentPrestigeClicks.toString(),prestigeCount:g.prestigeCount,totalRenownEarned:g.totalRenownEarned.toString(),nationalProjects:g.nationalProjects,clickUpgradeLevel:g.clickUpgradeLevel,offlineUpgradeLevel:g.offlineUpgradeLevel,tavernGamesPlayed:g.tavernGamesPlayed,dragonsKilled:g.dragonsKilled,achievements:g.achievements,playTime:g.playTime,lastUpdated:V(),createdAt:V()}),localStorage.setItem(`lastStatsSave_${o}`,Date.now().toString()),console.log("âœ… Player stats successfully saved")}catch(d){throw console.error("âŒ Error saving player stats:",d),d}})}function bt(t,o){return U(this,null,function*(){try{const c=K($,"players",t);yield q(c,{rulerName:o},{merge:!0});const d=K($,"leaderboard_alltime",t);yield q(d,{rulerName:o},{merge:!0});const n=K($,"leaderboard_weekly",t);yield q(n,{rulerName:o},{merge:!0}),console.log("âœ… Ruler name successfully updated")}catch(c){throw console.error("âŒ Error updating ruler name:",c),c}})}const yt=({isOpen:t,onClose:o,onConfirm:c,gameState:d})=>{const[n,s]=R.useState(""),[p,r]=R.useState(!1);if(!t)return null;const h=()=>U(null,null,function*(){if(n.trim().length<3){alert("Ruler name must contain at least 3 characters!");return}if(n.trim().length>20){alert("Ruler name must not exceed 20 characters!");return}r(!0);try{const g={id:`player_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,rulerName:n.trim(),rulerId:Ke(),lastLeaderboardView:0,lastLeaderboardSubmit:0,hasChosenName:!0,usedPromoCodes:[]};c(g),o()}catch(a){alert("An error occurred while creating profile. Please try again.")}finally{r(!1)}});return e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{backgroundColor:"#fdf6e3",border:"4px solid #8d6e63",borderRadius:"8px",padding:"32px",maxWidth:"500px",width:"90%",textAlign:"center",fontFamily:"Georgia, serif"},children:[e.jsx("h2",{style:{color:"#3e2723",marginBottom:"16px"},children:"ðŸ‘‘ Royal Coronation! ðŸ‘‘"}),e.jsxs("p",{style:{color:"#5d4037",marginBottom:"24px",lineHeight:"1.5"},children:["Congratulations! Your kingdom has reached ",e.jsx("strong",{children:Ze(d.gold)})," gold!",e.jsx("br",{}),"It's time to choose a name for your ruler and enter the history books!"]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("label",{style:{display:"block",color:"#3e2723",marginBottom:"8px",fontWeight:"bold"},children:"Ruler Name:"}),e.jsx("input",{type:"text",value:n,onChange:a=>s(a.target.value),placeholder:"Enter your name...",maxLength:20,style:{width:"100%",padding:"12px",border:"2px solid #a1887f",borderRadius:"4px",fontSize:"16px",fontFamily:"Arial, sans-serif",backgroundColor:"#fff",color:"#3e2723"},onKeyPress:a=>a.key==="Enter"&&h()}),e.jsxs("div",{style:{fontSize:"12px",color:"#8d6e63",marginTop:"4px",textAlign:"left"},children:[n.length,"/20 characters"]})]}),e.jsx("div",{style:{backgroundColor:"#fff3e0",border:"2px solid #bf9000",borderRadius:"4px",padding:"12px",marginBottom:"24px"},children:e.jsx("p",{style:{color:"#bf9000",margin:0,fontSize:"14px",fontWeight:"bold"},children:"âš ï¸ Important: You'll be able to join the leaderboard and compete with players from around the world!"})}),e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[e.jsx("button",{type:"button",onClick:h,disabled:p||n.trim().length<3,style:{padding:"12px 24px",backgroundColor:p||n.trim().length<3?"#cccccc":"#2e7d32",color:"white",border:"none",borderRadius:"4px",fontSize:"16px",fontWeight:"bold",cursor:p||n.trim().length<3?"not-allowed":"pointer",fontFamily:"Georgia, serif"},children:p?"Creating profile...":"Ascend the Throne"}),e.jsx("button",{type:"button",onClick:o,style:{padding:"12px 24px",backgroundColor:"#c62828",color:"white",border:"none",borderRadius:"4px",fontSize:"16px",cursor:"pointer",fontFamily:"Georgia, serif",transition:"background-color 0.2s"},onMouseOver:a=>{a.currentTarget.style.backgroundColor="#d32f2f"},onMouseOut:a=>{a.currentTarget.style.backgroundColor="#c62828"},children:"Later"})]})]})})};function Ze(t){return t.lt(1e3)?t.toFixed(0):t.lt(1e6)?t.toNumber().toLocaleString():t.toExponential(2)}const vt=({isOpen:t,onClose:o,playerProfile:c,onOpenRulerNameModal:d,gameState:n,onForceSubmit:s,addToast:p})=>{const[r,h]=R.useState([]),[a,g]=R.useState([]),[i,b]=R.useState("alltime"),[f,C]=R.useState(!1),[T,x]=R.useState(null),[v,B]=R.useState(0),[M,W]=R.useState(0),w=()=>{const j=localStorage.getItem("leaderboardCache");if(j)try{const{data:m,timestamp:N}=JSON.parse(j),F=Date.now(),H=3600*1e3;if(F-N<H&&m&&m.allTime&&m.weekly)return m}catch(m){console.error("Cache parse error:",m)}return null},u=j=>{const m={data:j,timestamp:Date.now()};localStorage.setItem("leaderboardCache",JSON.stringify(m)),W(Date.now())},S=()=>{const j=localStorage.getItem("leaderboardCache");if(j){const{timestamp:m}=JSON.parse(j),N=Date.now(),F=3600*1e3;return N-m<F}return!1};R.useEffect(()=>{if(t){if(S())try{const j=w();if(j){h(j.allTime),g(j.weekly);const m=JSON.parse(localStorage.getItem("leaderboardCache"));W(m.timestamp);return}}catch(j){console.error("Cache read error:",j)}A()}},[t]);const A=()=>U(null,null,function*(){C(!0),x(null);try{const j=new Promise((F,H)=>setTimeout(()=>H(new Error("Loading timeout")),1e4)),[m,N]=yield Promise.all([Promise.race([Xe(50),j]),Promise.race([Je(50),j])]);h(m),g(N),u({allTime:m,weekly:N})}catch(j){console.error("Error loading leaderboard:",j),x("Failed to load leaderboard. Please check your internet connection and try again.")}finally{C(!1)}}),k=j=>{switch(j){case 1:return"ðŸ¥‡";case 2:return"ðŸ¥ˆ";case 3:return"ðŸ¥‰";default:return`#${j}`}},z=()=>c?(i==="alltime"?r:a).findIndex(m=>m.rulerId===c.rulerId)+1:-1,L=()=>{const j=i==="alltime"?r:a;if(j.length>0){let m=0;if(j.forEach(N=>{if(N.timestamp){let F=0;typeof N.timestamp=="object"&&N.timestamp.toDate?F=N.timestamp.toDate().getTime():typeof N.timestamp=="number"?F=N.timestamp:typeof N.timestamp=="string"&&(F=new Date(N.timestamp).getTime()),F>m&&(m=F)}}),m>0)return m}return M},E=i==="alltime"?r:a,P=E.length>0;return t?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"800px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h2",{children:"ðŸ† Leaderboard ðŸ†"}),e.jsx("button",{className:"btn",onClick:o,children:"Close"})]}),!c&&e.jsxs("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"15px",marginBottom:"16px",textAlign:"center"},children:[e.jsx("h4",{style:{color:"var(--gold-color)",margin:"0 0 8px 0",fontSize:"14px"},children:"ðŸ‘ View Only Mode"}),e.jsxs("p",{style:{color:"var(--text-secondary)",margin:"0",fontSize:"12px",lineHeight:"1.4"},children:[e.jsx("strong",{children:"Anyone can view leaderboard!"})," Choose a name at 10M gold to participate."]}),d&&n&&n.gold&&n.gold.gte(1e7)&&e.jsx("button",{className:"btn",onClick:()=>{o(),d()},style:{backgroundColor:"var(--accent-color)",padding:"6px 12px",fontSize:"12px",marginTop:"8px"},children:"ðŸ‘‘ Choose Ruler Name"})]}),P&&e.jsx("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"12px",marginBottom:"16px",textAlign:"center",fontSize:"12px"},children:e.jsxs("span",{style:{color:"var(--gold-color)"},children:["ðŸ“Š Data updated ",Math.floor((Date.now()-L())/6e4)," minutes ago"]})}),f&&e.jsx("div",{style:{textAlign:"center",padding:"20px",color:"var(--text-secondary)"},children:"Loading leaderboard data..."}),T&&e.jsx("div",{style:{textAlign:"center",padding:"20px",color:"var(--danger-color)"},children:T}),c&&P&&e.jsxs("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"12px",marginBottom:"16px",textAlign:"center"},children:[e.jsxs("div",{style:{color:"var(--gold-color)",fontSize:"14px",fontWeight:"bold"},children:["ðŸ‘‘ You are playing as: ",c.rulerName," ",c.rulerId,c.specialIcon&&e.jsx("span",{style:{marginLeft:"5px"},children:c.specialIcon}),c.specialTitle&&e.jsx("span",{style:{marginLeft:"5px",color:"var(--accent-color)",fontSize:"12px"},children:c.specialTitle})]}),E.length>0&&e.jsxs("div",{style:{color:"var(--text-secondary)",fontSize:"12px",marginTop:"5px"},children:["Your Rank: ",z()>0?`#${z()}`:"Not ranked yet"," in ",i==="alltime"?"All Time":"Weekly"]})]}),P&&e.jsxs("div",{style:{display:"flex",marginBottom:"16px",borderBottom:"2px solid var(--border-color)"},children:[e.jsx("button",{onClick:()=>b("alltime"),className:i==="alltime"?"tab-btn active":"tab-btn",children:"All Time"}),e.jsx("button",{onClick:()=>b("weekly"),className:i==="weekly"?"tab-btn active":"tab-btn",children:"This Week"})]}),P&&!f&&!T&&e.jsx("div",{style:{maxHeight:"400px",overflowY:"auto",border:"2px solid var(--border-color)",borderRadius:"4px",backgroundColor:"var(--panel-bg)"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{style:{backgroundColor:"var(--accent-color)",color:"white",position:"sticky",top:0},children:e.jsxs("tr",{children:[e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Rank"}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Ruler"}),e.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Gold"}),e.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Renown"}),e.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Clicks"}),e.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Achievements"})]})}),e.jsx("tbody",{children:E.map((j,m)=>e.jsxs("tr",{style:{backgroundColor:(c==null?void 0:c.rulerId)===j.rulerId?"rgba(191, 144, 0, 0.1)":m%2===0?"rgba(0, 0, 0, 0.02)":"transparent",borderBottom:"1px solid var(--border-color)"},children:[e.jsx("td",{style:{padding:"10px",fontWeight:"bold",color:"var(--text-color)"},children:k(m+1)}),e.jsx("td",{style:{padding:"10px",color:"var(--text-color)"},children:e.jsxs("div",{children:[e.jsxs("strong",{children:[j.rulerName,(c==null?void 0:c.specialIcon)&&c.rulerId===j.rulerId&&e.jsx("span",{style:{marginLeft:"5px"},children:c.specialIcon})]}),e.jsxs("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:[j.rulerId,(c==null?void 0:c.specialTitle)&&c.rulerId===j.rulerId&&e.jsx("span",{style:{marginLeft:"5px",color:"var(--accent-color)"},children:c.specialTitle})]})]})}),e.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--gold-color)",fontWeight:"bold"},children:y(j.gold,"standard")}),e.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--text-secondary)"},children:y(j.renown,"standard")}),e.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--text-secondary)"},children:y(j.totalClicks,"standard")}),e.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--text-secondary)"},children:j.achievements})]},j.id))})]})}),e.jsx("div",{style:{marginTop:"16px",fontSize:"12px",color:"var(--text-secondary)",textAlign:"center"},children:"ðŸ’¡ Leaderboard updates automatically every hour. Data is cached for performance."})]})}):null},jt=({gained:t,effectiveTime:o,totalTime:c,efficiency:d,completedProjects:n,currentLevel:s,maxDuration:p,onClose:r,numberFormat:h})=>{const a=g=>{const i=Math.floor(g/3600),b=Math.floor(g%3600/60),f=Math.floor(g%60),C=[];return i>0&&C.push(`${i}h`),b>0&&C.push(`${b}m`),(f>0||C.length===0)&&C.push(`${f}s`),C.join(" ")};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{border:"4px solid var(--accent-color)"},children:[e.jsx("h2",{children:"ðŸŒ™ Welcome Back, Ruler!"}),e.jsxs("div",{style:{padding:"20px",textAlign:"left"},children:[e.jsx("p",{children:"Your kingdom continued to operate while you were away."}),e.jsxs("div",{style:{background:"var(--panel-bg)",border:"1px solid var(--border-color)",padding:"15px",borderRadius:"4px",marginBottom:"15px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[e.jsx("span",{children:"Time Away:"}),e.jsx("strong",{children:a(c.toNumber())})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[e.jsx("span",{children:"Effective Production Time:"}),e.jsx("strong",{children:a(o.toNumber())})]}),o.toNumber()<c.toNumber()&&e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",fontStyle:"italic",marginBottom:"5px",textAlign:"center"},children:["âš ï¸ Production time limited by upgrade level (max ",a(p),")"]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[e.jsx("span",{children:"Efficiency:"}),e.jsxs("strong",{children:[(d*100).toFixed(0),"% (Level ",s,"/20)"]})]}),e.jsx("div",{style:{borderTop:"1px dashed var(--border-color)",margin:"10px 0"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"1.2rem",color:"var(--gold-color)"},children:[e.jsx("span",{children:"Gold Earned:"}),e.jsxs("strong",{children:["+",y(t,h)]})]})]}),n.length>0&&e.jsxs("div",{children:[e.jsx("h3",{children:"âœ… Projects Completed"}),e.jsx("ul",{style:{paddingLeft:"20px",maxHeight:"150px",overflowY:"auto"},children:n.map((g,i)=>e.jsx("li",{style:{color:"var(--success-color)",marginBottom:"5px"},children:g},i))})]})]}),e.jsx("button",{className:"btn",onClick:r,style:{width:"100%",padding:"15px",fontSize:"1.1rem"},children:"Collect & Continue"})]})})},wt=({gameState:t,onClose:o,onRedeemPromoCode:c,onBackToSettings:d})=>{const[n,s]=Z.useState(""),[p,r]=Z.useState(""),[h,a]=Z.useState("info"),[g,i]=Z.useState(!1),b=W=>U(null,null,function*(){if(W.preventDefault(),!n.trim()){r("Please enter a promo code"),a("error");return}i(!0),r("");try{yield c(n),s(""),r("Promo code redeemed successfully!"),a("success")}catch(w){r("Error redeeming promo code"),a("error")}finally{i(!1)}}),f={position:"fixed",top:"0",left:"0",right:"0",bottom:"0",backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3,padding:"20px"},C={backgroundColor:"#2c2416",border:"3px solid #8b7355",borderRadius:"12px",padding:"30px",maxWidth:"500px",width:"100%",color:"#f4e4c1",fontFamily:"Georgia, serif",boxShadow:"0 0 30px rgba(0, 0, 0, 0.8)",maxHeight:"80vh",overflowY:"auto"},T={textAlign:"center",fontSize:"2rem",marginBottom:"20px",color:"#d4af37",textShadow:"2px 2px 4px rgba(0, 0, 0, 0.5)"},x={width:"100%",padding:"12px",fontSize:"1rem",backgroundColor:"#1a1611",border:"2px solid #8b7355",borderRadius:"6px",color:"#f4e4c1",fontFamily:"Georgia, serif",textTransform:"uppercase",letterSpacing:"1px",marginBottom:"15px"},v={background:"#9c27b0",color:"white",border:"none",padding:"12px 24px",fontSize:"1rem",borderRadius:"6px",cursor:"pointer",fontFamily:"Georgia, serif",fontWeight:"bold",width:"100%",marginBottom:"10px",opacity:g?.7:1},B={background:"#5d4037",color:"white",border:"none",padding:"12px 24px",fontSize:"1rem",borderRadius:"6px",cursor:"pointer",fontFamily:"Georgia, serif",width:"100%"},M={padding:"10px",borderRadius:"6px",marginBottom:"15px",textAlign:"center",fontSize:"0.9rem",backgroundColor:h==="success"?"#2e7d32":h==="error"?"#c62828":"#1565c0",border:`1px solid ${h==="success"?"#4caf50":h==="error"?"#f44336":"#2196f3"}`};return e.jsx("div",{style:f,onClick:o,children:e.jsxs("div",{style:C,onClick:W=>W.stopPropagation(),children:[e.jsx("h2",{style:T,children:"ðŸŽ« Promo Codes"}),e.jsxs("form",{onSubmit:b,children:[e.jsx("input",{type:"text",value:n,onChange:W=>s(W.target.value),placeholder:"Enter promo code...",style:x,maxLength:50,disabled:g}),e.jsx("button",{type:"submit",style:v,disabled:g,children:g?"Redeeming...":"Redeem Code"})]}),p&&e.jsx("div",{style:M,children:p}),e.jsx("div",{style:{fontSize:"0.8rem",color:"#8b7355",textAlign:"center",marginBottom:"20px",fontStyle:"italic"},children:"Enter promotional codes to receive special rewards!"}),e.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"20px"},children:[d&&e.jsx("button",{style:G(D({},B),{background:"#666"}),onClick:d,children:"Back to Settings"}),e.jsx("button",{style:G(D({},B),{flex:"1"}),onClick:o,children:"Close"})]})]})})},kt=({isOpen:t,onClose:o,onConfirm:c,currentName:d})=>{const[n,s]=R.useState(d),[p,r]=R.useState(!1);if(!t)return null;const h=()=>U(null,null,function*(){if(n.trim().length<3){alert("Ruler name must contain at least 3 characters!");return}if(n.trim().length>20){alert("Ruler name must not exceed 20 characters!");return}if(n.trim()===d.trim()){alert("New name must be different from current name!");return}r(!0);try{yield c(n.trim()),o()}catch(a){alert("Error changing name. Please try again.")}finally{r(!1)}});return e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:3e3},children:e.jsxs("div",{style:{backgroundColor:"#fdf6e3",border:"4px solid #8d6e63",borderRadius:"8px",padding:"32px",maxWidth:"500px",width:"90%",textAlign:"center",fontFamily:"Georgia, serif"},children:[e.jsx("h2",{style:{color:"#3e2723",marginBottom:"16px"},children:"ðŸ‘‘ Change Ruler Name ðŸ‘‘"}),e.jsxs("p",{style:{color:"#5d4037",marginBottom:"24px",lineHeight:"1.5"},children:["Current name: ",e.jsx("strong",{children:d}),e.jsx("br",{}),"Enter new name for your ruler:"]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("label",{style:{display:"block",color:"#3e2723",marginBottom:"8px",fontWeight:"bold"},children:"New Name:"}),e.jsx("input",{type:"text",value:n,onChange:a=>s(a.target.value),placeholder:"Enter new name...",maxLength:20,style:{width:"100%",padding:"12px",border:"2px solid #a1887f",borderRadius:"4px",fontSize:"16px",fontFamily:"Arial, sans-serif",backgroundColor:"#fff",color:"#3e2723"},onKeyPress:a=>a.key==="Enter"&&h()}),e.jsxs("div",{style:{fontSize:"12px",color:"#8d6e63",marginTop:"4px",textAlign:"left"},children:[n.length,"/20 characters"]})]}),e.jsx("div",{style:{backgroundColor:"#fff3e0",border:"2px solid #bf9000",borderRadius:"4px",padding:"12px",marginBottom:"24px"},children:e.jsx("p",{style:{color:"#bf9000",margin:0,fontSize:"14px",fontWeight:"bold"},children:"âš ï¸ Warning: Name change will update your profile in leaderboard!"})}),e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[e.jsx("button",{type:"button",onClick:h,disabled:p||n.trim().length<3||n.trim()===d.trim(),style:{padding:"12px 24px",backgroundColor:p||n.trim().length<3||n.trim()===d.trim()?"#cccccc":"#2e7d32",color:"white",border:"none",borderRadius:"4px",fontSize:"16px",fontWeight:"bold",cursor:p||n.trim().length<3||n.trim()===d.trim()?"not-allowed":"pointer",fontFamily:"Georgia, serif"},children:p?"Saving...":"Change Name"}),e.jsx("button",{type:"button",onClick:o,style:{padding:"12px 24px",backgroundColor:"#c62828",color:"white",border:"none",borderRadius:"4px",fontSize:"16px",cursor:"pointer",fontFamily:"Georgia, serif",transition:"background-color 0.2s"},onMouseOver:a=>{a.currentTarget.style.backgroundColor="#d32f2f"},onMouseOut:a=>{a.currentTarget.style.backgroundColor="#c62828"},children:"Cancel"})]})]})})};export{at as C,it as D,ut as E,vt as L,jt as O,dt as P,yt as R,pt as S,ct as T,mt as a,xt as b,wt as c,ht as d,gt as e,kt as f,ft as s,bt as u};
