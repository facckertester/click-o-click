var Pt=Object.defineProperty,St=Object.defineProperties;var kt=Object.getOwnPropertyDescriptors;var ze=Object.getOwnPropertySymbols;var Tt=Object.prototype.hasOwnProperty,Lt=Object.prototype.propertyIsEnumerable;var We=(e,u,w)=>u in e?Pt(e,u,{enumerable:!0,configurable:!0,writable:!0,value:w}):e[u]=w,s=(e,u)=>{for(var w in u||(u={}))Tt.call(u,w)&&We(e,w,u[w]);if(ze)for(var w of ze(u))Lt.call(u,w)&&We(e,w,u[w]);return e},c=(e,u)=>St(e,kt(u));var Ct=(e,u)=>()=>(u||e((u={exports:{}}).exports,u),u.exports);var ae=(e,u,w)=>new Promise((G,y)=>{var S=T=>{try{E(w.next(T))}catch(B){y(B)}},C=T=>{try{E(w.throw(T))}catch(B){y(B)}},E=T=>T.done?G(T.value):Promise.resolve(T.value).then(S,C);E((w=w.apply(e,u)).next())});import{r as b,j as l,a as jt,R as Mt}from"./vendor-react-CUeQczFW.js";import{h as Et,n as qe,t,o as de,g as Qe,f as F,T as Fe,j as $e,B as V,P as It,p as he,A as Gt,M as Bt,b as Dt,k as He,i as Ot,d as Nt,e as Ut,c as Rt,q as At,a as _t}from"./core-xOYQ6Dy5.js";import{a as Ke,G as zt}from"./components-ui-BlRqXoiM.js";import{B as Xe}from"./components-store-Cek8mz05.js";import{M as Je}from"./components-main-BHU3mL3D.js";import{s as Ve,a as ce,O as Wt,E as Ft,T as $t,P as Ht,S as Kt,b as Xt,c as Jt,C as Vt,R as Yt,L as qt,d as Qt,u as Zt}from"./components-modals-B3FLrWkO.js";import{P as eo}from"./components-services-IDmCsBj4.js";import"./vendor-DdgGw12P.js";import"./components-achievements-CwnycPaU.js";import"./vendor-firebase-IMiYFFvY.js";var no=Ct(ue=>{(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const y of document.querySelectorAll('link[rel="modulepreload"]'))G(y);new MutationObserver(y=>{for(const S of y)if(S.type==="childList")for(const C of S.addedNodes)C.tagName==="LINK"&&C.rel==="modulepreload"&&G(C)}).observe(document,{childList:!0,subtree:!0});function w(y){const S={};return y.integrity&&(S.integrity=y.integrity),y.referrerPolicy&&(S.referrerPolicy=y.referrerPolicy),y.crossOrigin==="use-credentials"?S.credentials="include":y.crossOrigin==="anonymous"?S.credentials="omit":S.credentials="same-origin",S}function G(y){if(y.ep)return;y.ep=!0;const S=w(y);fetch(y.href,S)}})();const Ye=({gameState:e,onBuyTowerFloor:u})=>{const[w,G]=b.useState(0),y=Et(e.totalGold);b.useEffect(()=>{const M=setInterval(()=>{G(R=>(R+1)%360)},50);return()=>clearInterval(M)},[]),qe(e.totalGold);const S=e.darkMatterGold||t(0),C=e.infiniteTowerLevel||0;e.portalProgress;const E=de(C),T=S.gte(E),U=Qe(C).minus(t(1)).times(t(100)),H=(()=>{if(y)return 100;if(e.totalGold.lt(t(1e15)))return 0;const M=Math.log10(1e15),R=Math.log10(1e18),ee=Math.log10(e.totalGold.toNumber()),te=(Math.max(M,Math.min(R,ee))-M)/(R-M)*100;return Math.floor(te)})();return l.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"var(--gap-size)",height:"100%",minHeight:"600px",overflow:"hidden"},children:l.jsxs("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",padding:"var(--panel-padding)",WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:[l.jsxs("div",{style:{textAlign:"center",padding:"20px",background:"var(--panel-bg)",border:y?"2px solid #673ab7":"2px dashed var(--border-color)",borderRadius:"8px",position:"relative",overflow:"hidden",marginBottom:"20px"},children:[l.jsx("div",{style:{width:"120px",height:"120px",margin:"0 auto 15px",borderRadius:"50%",background:y?`radial-gradient(circle, rgba(103, 58, 183, ${.3+Math.sin(w*Math.PI/180)*.2}), rgba(103, 58, 183, 0.1))`:"radial-gradient(circle, rgba(128, 128, 128, 0.2), rgba(128, 128, 128, 0.05))",border:y?`3px solid rgba(103, 58, 183, ${.5+Math.sin(w*Math.PI/180)*.3})`:"3px solid rgba(128, 128, 128, 0.3)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"3rem",animation:y?"pulse 2s infinite":"none",transform:`rotate(${w}deg)`,transition:"all 0.3s ease"},children:y?"ðŸŒ€":"ðŸ”’"}),l.jsx("h3",{style:{fontSize:"1.3rem",color:"#ba68c8",marginBottom:"10px",fontWeight:"bold",textShadow:"0 0 10px rgba(186, 104, 200, 0.5)"},children:y?"Portal to Another Dimension":"Portal Construction"}),!y&&l.jsxs("div",{style:{marginBottom:"15px"},children:[l.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginBottom:"8px"},children:["Progress: ",H,"%"]}),l.jsx("div",{style:{width:"100%",height:"8px",background:"rgba(0,0,0,0.1)",borderRadius:"4px",overflow:"hidden"},children:l.jsx("div",{style:{width:`${H}%`,height:"100%",background:"linear-gradient(90deg, #673ab7, #9575cd)",transition:"width 0.3s ease"}})}),l.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginTop:"5px"}})]}),y&&l.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:"The portal shimmers with infinite possibilities..."})]}),y&&l.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(103, 58, 183, 0.1), rgba(103, 58, 183, 0.05))",padding:"15px",borderRadius:"8px",border:"1px solid #673ab7",marginBottom:"20px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[l.jsx("div",{style:{display:"flex",alignItems:"center"},children:l.jsx("span",{style:{fontSize:"1.1rem",fontWeight:"bold",color:"#ba68c8",textShadow:"0 0 8px rgba(186, 104, 200, 0.4)"},children:"âš« Dark Matter Gold"})}),l.jsx("div",{style:{display:"flex",alignItems:"center"},children:l.jsx("span",{style:{fontSize:"1.2rem",fontWeight:"bold",color:"#ce93d8",textShadow:"0 0 8px rgba(206, 147, 216, 0.4)"},children:F(S,e.numberFormat)})})]}),y&&l.jsxs("div",{style:{background:"var(--panel-bg)",padding:"1px 19px 19px 19px",borderRadius:"px",border:"2px solid #ff9800",marginBottom:"20px"},children:[l.jsx("h4",{style:{fontSize:"1.1rem",color:"#ff9800",marginBottom:"10px",fontWeight:"bold"},children:"ðŸ—ï¸ Infinite Tower of Time & Space"}),l.jsxs("div",{style:{marginBottom:"15px"},children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[l.jsx("span",{style:{fontSize:"0.9rem",color:"var(--text-color)"},children:"Current Level"}),l.jsx("span",{style:{fontSize:"1.1rem",fontWeight:"bold",color:"#ff9800",textShadow:"0 0 8px rgba(255, 152, 0, 0.4)"},children:C})]}),l.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginBottom:"10px"},children:["Income Bonus: +",F(U,e.numberFormat),"%"]}),l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[l.jsx("span",{style:{fontSize:"0.9rem",color:"var(--text-color)"},children:"Next Floor Cost"}),l.jsxs("span",{style:{fontSize:"1rem",fontWeight:"bold",color:T?"#673ab7":"var(--text-secondary)"},children:[F(E,e.numberFormat)," âš«"]})]})]}),l.jsx("button",{className:"btn",onClick:u,disabled:!T,style:{width:"100%",background:T?"#ff9800":"var(--panel-bg)",color:T?"var(--text-on-accent)":"var(--text-color)",border:"2px solid #ff9800",padding:"10px",fontSize:"1rem",fontWeight:"bold",opacity:T?1:.6,cursor:T?"pointer":"default"},children:T?"Build Next Floor":"Not Enough Dark Matter Gold"})]}),l.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(103, 58, 183, 0.1), rgba(103, 58, 183, 0.05))",padding:"15px",borderRadius:"8px",border:"1px solid rgba(103, 58, 183, 0.2)",fontSize:"0.9rem",color:"var(--text-secondary)",lineHeight:"1.6",fontStyle:"italic",marginBottom:"20px"},children:[l.jsx("div",{style:{fontWeight:"bold",marginBottom:"10px",color:"#ba68c8",fontStyle:"normal",textAlign:"center",fontSize:"1rem",textShadow:"0 0 8px rgba(186, 104, 200, 0.3)"},children:"ðŸŒŒ The Infinite Mystery"}),l.jsx("p",{style:{margin:"0 0 10px 0",textAlign:"center"},children:"When a kingdom's treasures transcend mortal comprehension, the very fabric of reality begins to unravel, revealing hidden passages to worlds beyond imagination."}),l.jsx("p",{style:{margin:"0 0 10px 0",textAlign:"center"},children:"Through this gateway flows dark matter - the concentrated essence of time and space itself, capable of rewriting the fundamental laws of creation and transforming the nature of existence."}),l.jsx("p",{style:{margin:"0",textAlign:"center",fontWeight:"bold"},children:"Each floor of the Infinite Tower amplifies the flow's power, creating cascades of limitless possibilities in the eternal dance of universes..."})]})]})})},to=({gameState:e})=>{const{weather:u,buildings:w,totalGold:G}=e,y=H=>{var M;return((M=w[H])==null?void 0:M.toNumber())||0};let S="wilderness";y("palace")>0?S="empire":y("castle")>0||y("market")>0?S="city":(y("peasant")>20||y("field")>10||G.gt(t(500)))&&(S="hamlet");let C="",E="";switch(S){case"wilderness":C="linear-gradient(to bottom, #87CEEB 0%, #87CEEB 60%, #556B2F 60%, #556B2F 100%)",E="ðŸŒ² ðŸŒ³ ðŸŒ² ðŸ¦Œ ðŸŒ² ðŸŒ¿";break;case"hamlet":C="linear-gradient(to bottom, #87CEEB 0%, #87CEEB 65%, #8B4513 65%, #228B22 80%)",E="ðŸ¡ ðŸŒ¾ ðŸ„ ðŸ¡ ðŸŒ¾ ðŸšœ";break;case"city":C="linear-gradient(to bottom, #B0C4DE 0%, #B0C4DE 60%, #696969 60%, #808080 100%)",E="ðŸ° ðŸ  âš’ï¸ ðŸ  âš–ï¸ ðŸ ";break;case"empire":C="linear-gradient(to bottom, #191970 0%, #4B0082 50%, #FFD700 100%)",E="ðŸ¯ ðŸ’‚ ðŸ›ï¸ ðŸ‰ ðŸ›ï¸ ðŸ’‚";break}const T=u.current;let B="none",U="",$=0;return T==="rainy"?(B="linear-gradient(to bottom, rgba(0,0,50,0.3), rgba(0,0,100,0.3))",U="ðŸŒ§ï¸ ðŸŒ§ï¸ ðŸŒ§ï¸ ðŸŒ§ï¸ ðŸŒ§ï¸",$=1):T==="stormy"?(B="linear-gradient(to bottom, rgba(0,0,0,0.6), rgba(50,50,50,0.6))",U="âš¡ â›ˆï¸ âš¡ â›ˆï¸ âš¡",$=1):T==="sunny"?(B="radial-gradient(circle at top right, rgba(255,255,0,0.3), transparent)",U="â˜€ï¸",$=.6):T==="windy"&&(U="ðŸƒ ðŸƒ ðŸƒ",$=.8),l.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:C,display:"flex",flexDirection:"column",justifyContent:"flex-end",alignItems:"center",paddingBottom:"20vh",zIndex:0,overflow:"hidden",transition:"background 2s ease"},children:[l.jsx("div",{style:{position:"absolute",top:"10%",width:"100%",textAlign:"center",fontSize:"5rem",opacity:$,animation:T==="windy"?"float 3s infinite ease-in-out":"none"},children:U}),B!=="none"&&l.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:B,pointerEvents:"none"}}),l.jsx("div",{style:{fontSize:"4rem",textAlign:"center",zIndex:1,textShadow:"0 4px 4px rgba(0,0,0,0.3)",whiteSpace:"nowrap"},children:E}),l.jsx("div",{style:{marginTop:"20px",fontSize:"1.5rem",color:"#fff",textShadow:"2px 2px 4px #000",fontStyle:"italic",zIndex:2,background:"rgba(0,0,0,0.5)",padding:"5px 15px",borderRadius:"15px"},children:"The Kingdom sleeps..."}),l.jsx("style",{children:`
            @keyframes float {
                0% { transform: translateX(0px); }
                50% { transform: translateX(20px); }
                100% { transform: translateX(0px); }
            }
        `})]})},W={density:"normal",showFloatingText:!0,showWeatherWidget:!0,reduceMotion:!1,crownAnimations:!0,lastBuyAmount:t(1),visualStyle:"classic",layout:{left:t(1),center:t(1),right:t(1)},borderWidth:t(4),customColors:{enabled:!1,bg:"#e8dcc5",panel:"#fdf6e3",text:"#3e2723",secondaryText:"#5d4037",accent:"#8d6e63",accentHover:"#6d4c41",gold:"#bf9000",border:"#a1887f",success:"#2e7d32",danger:"#c62828"}},z={gold:t(0),totalGold:t(0),totalRenownEarned:t(0),startTime:t(Date.now()),lastSaveTime:t(Date.now()),buildings:{},achievements:[],renown:t(0),prestigeCount:0,darkMatterGold:t(0),infiniteTowerLevel:0,portalProgress:0,nationalProjects:{},clickUpgradeLevel:0,offlineUpgradeLevel:0,weather:{current:"clear",timeLeft:t(120)},event:null,theme:"default",numberFormat:"standard",idleModeEnabled:!1,interface:W,stats:{totalClicks:t(0),currentPrestigeClicks:t(0),dragonsKilled:t(0),tavernGamesPlayed:t(0),prestigeCount:0,infiniteTowerLevel:0,darkMatterGold:t(0),portalProgress:0,clickUpgradeLevel:0,offlineUpgradeLevel:0,totalBuildingsPurchased:t(0),totalGoldSpent:t(0)},playerProfile:null,isDeveloperWifeBlessingObtained:!1,globalIncomeMultiplier:1,isBetaTesterBlessingObtained:!1,betaTesterIncomeMultiplier:1},Y=e=>{if(e==null||typeof e=="string"||typeof e=="number"||typeof e=="boolean")return e;if(Array.isArray(e))return e.map(Y);if(typeof e=="object"&&e.toString&&typeof e.toString=="function"&&(e.hasOwnProperty("mantissa")||e.hasOwnProperty("exponent")))return e.toString();if(typeof e=="object"){const u={};for(const w in e)e.hasOwnProperty(w)&&(u[w]=Y(e[w]));return u}return e},oo=()=>{var Me,Ee;const[e,u]=b.useState(()=>{var o,n,i,d,f,p,h,P,g,L,v,D,N,A,j,I,K,se,Ie,Ge,Be,De,Oe,Ne,Ue,Re,Ae;const r=localStorage.getItem("kingdom_save");if(r)try{const a=JSON.parse(r);if((o=a.playerProfile)!=null&&o.id){const m=localStorage.getItem(`playerProfile_${a.playerProfile.id}`);m&&(a.playerProfile=JSON.parse(m))}const _=a.interface||{},_e=c(s(s({},W),_),{lastBuyAmount:t((n=_.lastBuyAmount)!=null?n:1),crownAnimations:(i=_.crownAnimations)!=null?i:!0,layout:{left:t((f=(d=_.layout)==null?void 0:d.left)!=null?f:W.layout.left),center:t((h=(p=_.layout)==null?void 0:p.center)!=null?h:W.layout.center),right:t((g=(P=_.layout)==null?void 0:P.right)!=null?g:W.layout.right)},borderWidth:t((L=_.borderWidth)!=null?L:W.borderWidth),customColors:s(s({},W.customColors),_.customColors||{})});return c(s(s({},z),a),{renown:t(a.renown||0),totalRenownEarned:t(a.totalRenownEarned||0),prestigeCount:a.prestigeCount||0,gold:t(a.gold||0),totalGold:t(a.totalGold||0),startTime:t(a.startTime||Date.now()),lastSaveTime:t(a.lastSaveTime||Date.now()),darkMatterGold:t(a.darkMatterGold||0),infiniteTowerLevel:a.infiniteTowerLevel||0,portalProgress:a.portalProgress||0,buildings:Object.keys(a.buildings||{}).reduce((m,k)=>(m[k]=t(a.buildings[k]),m),{}),stats:c(s(s({},z.stats),a.stats||{}),{totalClicks:t(((v=a.stats)==null?void 0:v.totalClicks)||0),currentPrestigeClicks:t(((D=a.stats)==null?void 0:D.currentPrestigeClicks)||0),dragonsKilled:t(((N=a.stats)==null?void 0:N.dragonsKilled)||0),tavernGamesPlayed:t(((A=a.stats)==null?void 0:A.tavernGamesPlayed)||0),prestigeCount:((j=a.stats)==null?void 0:j.prestigeCount)||0,infiniteTowerLevel:((I=a.stats)==null?void 0:I.infiniteTowerLevel)||0,darkMatterGold:t(((K=a.stats)==null?void 0:K.darkMatterGold)||0),portalProgress:((se=a.stats)==null?void 0:se.portalProgress)||0,clickUpgradeLevel:((Ie=a.stats)==null?void 0:Ie.clickUpgradeLevel)||0,offlineUpgradeLevel:((Ge=a.stats)==null?void 0:Ge.offlineUpgradeLevel)||0,totalBuildingsPurchased:t(((Be=a.stats)==null?void 0:Be.totalBuildingsPurchased)||0),totalGoldSpent:t(((De=a.stats)==null?void 0:De.totalGoldSpent)||0)}),nationalProjects:a.nationalProjects||{},clickUpgradeLevel:a.clickUpgradeLevel||0,offlineUpgradeLevel:a.offlineUpgradeLevel||0,interface:_e,playerProfile:a.playerProfile?c(s({},a.playerProfile),{lastLeaderboardSubmit:a.playerProfile.lastLeaderboardSubmit||0}):null,globalIncomeMultiplier:a.globalIncomeMultiplier||1,isDeveloperWifeBlessingObtained:a.isDeveloperWifeBlessingObtained||!1,betaTesterIncomeMultiplier:a.betaTesterIncomeMultiplier||1,isBetaTesterBlessingObtained:a.isBetaTesterBlessingObtained||!1})}catch(a){console.error("Save load failed",a)}return z}),w=b.useRef(e);b.useEffect(()=>{w.current=e},[e]);const G=b.useRef("");b.useEffect(()=>{const r=o=>{G.current=(G.current+o.key).slice(-20);const n=G.current.toLowerCase();n.endsWith("godon")?(u(i=>c(s({},i),{godMode:!0})),x("God Mode Enabled: +99999s per click","success"),G.current=""):n.endsWith("godoff")&&(u(i=>c(s({},i),{godMode:!1})),x("God Mode Disabled","info"),G.current="")};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[]);const y=()=>{R(null);const r=localStorage.getItem("kingdom_last_save_time"),o=Date.now();if(r){const n=o-parseInt(r),i=t(n/1e3);if(i.gte(t(60))){const d=e.offlineUpgradeLevel||0,{efficiency:f,duration:p}=$e(d),h=t(p),P=i.lt(h)?i:h,L=q(e).times(t(f)).times(P).floor();L.gt(t(0))&&(R({gained:L,effectiveTime:P,totalTime:i,efficiency:f,completedProjects:[],currentLevel:d,maxDuration:p}),u(v=>c(s({},v),{gold:v.gold.plus(L),totalGold:v.totalGold.plus(L)})))}}localStorage.setItem("kingdom_last_save_time",o.toString())},[S,C]=b.useState(!1);b.useEffect(()=>{let r;const o=()=>{C(!1),clearTimeout(r),e.idleModeEnabled&&(r=setTimeout(()=>{C(!0)},2e4))};o();const n=["mousemove","mousedown","keydown","touchstart","scroll"];return n.forEach(i=>window.addEventListener(i,o)),()=>{clearTimeout(r),n.forEach(i=>window.removeEventListener(i,o))}},[e.idleModeEnabled]),b.useEffect(()=>{e.event&&C(!1)},[e.event]),b.useEffect(()=>{const r=F(e.gold);document.title=`Gold: ${r} - Kingdom Clicker`},[e.gold]),b.useEffect(()=>{const r=document.documentElement,o=e.interface||W,n=document.body,i=n.classList.contains("modern"),d=o.visualStyle==="modern";i!==d&&(n.classList.add("theme-transitioning"),setTimeout(()=>{d?n.classList.add("modern"):n.classList.remove("modern"),setTimeout(()=>{n.classList.remove("theme-transitioning")},800)},100));const f=e.theme||"default",p=Fe[f]||Fe.default;p&&Object.entries(p.colors).forEach(([g,L])=>{r.style.setProperty(g,L)});const h={compact:"8px",normal:"12px",spacious:"20px"},P={compact:"6px",normal:"12px",spacious:"16px"};r.style.setProperty("--panel-padding",h[o.density]),r.style.setProperty("--gap-size",P[o.density]),r.style.setProperty("--col-left",String(o.layout.left)),r.style.setProperty("--col-center",String(o.layout.center)),r.style.setProperty("--col-right",String(o.layout.right)),o.reduceMotion?document.body.classList.add("no-motion"):document.body.classList.remove("no-motion")},[e.theme,e.interface]);const[E,T]=b.useState(!1);b.useEffect(()=>{var r;e.gold.gte(t(1e7))&&!((r=e.playerProfile)!=null&&r.hasChosenName)&&!E&&ve(!0)},[e.gold,e.playerProfile,E]);const[B,U]=b.useState(null),[$,H]=b.useState([]),[M,R]=b.useState(null),[ee,be]=b.useState("buildings"),[te,et]=b.useState("army"),[oe,tt]=b.useState(!1),[O,re]=b.useState("throne");b.useEffect(()=>{const r=()=>{tt(window.innerWidth<768)};return r(),window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]);const[ot,fe]=b.useState(!1),[rt,ne]=b.useState(!1),[nt,X]=b.useState(!1),[lt,st]=b.useState(!1),[it,me]=b.useState(!1),[at,le]=b.useState(!1),[ye,ve]=b.useState(!1),[xe,ge]=b.useState(!1),[ct,pe]=b.useState(!1),[we,Pe]=b.useState(!1),x=(r,o="info")=>{const n=Date.now().toString()+Math.random();H(i=>[...i,{id:n,message:r,type:o}]),setTimeout(()=>{H(i=>i.filter(d=>d.id!==n))},3e3)};b.useEffect(()=>{const r=Date.now();if(e.lastSaveTime&&t(r).minus(e.lastSaveTime).gt(t(6e4))){const o=t(r).minus(e.lastSaveTime).dividedBy(t(1e3)),{efficiency:n,duration:i}=$e(e.offlineUpgradeLevel||0),d=t(i),f=o.lt(d)?o:d,h=q(e).times(t(n)).times(f).floor(),P=[];let g=s({},e.nationalProjects),L=!1;Object.keys(g).forEach(v=>{var N;const D=g[v];if(D.active&&D.endTime&&r>=D.endTime){g[v]=c(s({},D),{active:!1,level:D.level+1,startTime:0,endTime:0});const A=(N=V.find(j=>j.id===v))==null?void 0:N.name;A&&P.push(`${A} Infrastructure (Lvl ${D.level+1})`),L=!0}}),(h.gt(t(0))||P.length>0)&&(R(v=>v||{gained:h,effectiveTime:f,totalTime:o,efficiency:n,completedProjects:P,currentLevel:e.offlineUpgradeLevel||0,maxDuration:i}),u(v=>c(s({},v),{gold:v.gold.plus(h),totalGold:v.totalGold.plus(h),nationalProjects:L?g:v.nationalProjects})))}},[]),b.useEffect(()=>{const r=setInterval(()=>{Date.now()%3e4<1e3&&u(o=>{const n=c(s({},o),{lastSaveTime:t(Date.now())}),i=Y(n);return localStorage.setItem("kingdom_save",JSON.stringify(i)),n})},1e3);return()=>clearInterval(r)},[]),b.useEffect(()=>{const r=()=>{const n=w.current,i=Y(n);localStorage.setItem("kingdom_save",JSON.stringify(i)),localStorage.setItem("kingdom_last_save_time",Date.now().toString())};window.addEventListener("beforeunload",r);const o=()=>{document.visibilityState==="hidden"?r():document.visibilityState==="visible"&&y()};return document.addEventListener("visibilitychange",o),()=>{window.removeEventListener("beforeunload",r),document.removeEventListener("visibilitychange",o)}},[]),b.useEffect(()=>{var n;if(!((n=e.playerProfile)!=null&&n.hasChosenName))return;(()=>{var p;const i=Date.now(),d=((p=e.playerProfile)==null?void 0:p.lastLeaderboardSubmit)||0,f=3600*1e3;if(i-d>=f){const h={rulerName:e.playerProfile.rulerName,rulerId:e.playerProfile.rulerId,gold:e.totalGold,renown:e.totalRenownEarned,achievements:e.achievements.length,totalClicks:e.stats.totalClicks};Promise.all([ce(c(s({},h),{period:"alltime"})),ce(c(s({},h),{period:"weekly"})),Ve(e,e.playerProfile.rulerId,e.playerProfile.rulerName)]).then(()=>{u(P=>c(s({},P),{playerProfile:c(s({},P.playerProfile),{lastLeaderboardSubmit:Date.now()})})),x("Leaderboard data synced on load!","success")}).catch(P=>{console.error("Initial leaderboard submission failed:",P)})}})();const o=setInterval(()=>{var h;const i=w.current,d=Date.now(),f=((h=i.playerProfile)==null?void 0:h.lastLeaderboardSubmit)||0,p=3600*1e3;if(d-f>=p){Ve(i,i.playerProfile.rulerId,i.playerProfile.rulerName).catch(g=>{console.error("Failed to save player stats:",g)});const P={rulerName:i.playerProfile.rulerName,rulerId:i.playerProfile.rulerId,gold:i.totalGold,renown:i.totalRenownEarned,achievements:i.achievements.length,totalClicks:i.stats.totalClicks};Promise.all([ce(c(s({},P),{period:"alltime"})),ce(c(s({},P),{period:"weekly"}))]).then(()=>{u(g=>c(s({},g),{playerProfile:c(s({},g.playerProfile),{lastLeaderboardSubmit:Date.now()})})),x("Leaderboard data submitted successfully!","success")}).catch(g=>{console.error("Auto leaderboard submission failed:",g)})}},6e4);return()=>clearInterval(o)},[(Me=e.playerProfile)==null?void 0:Me.hasChosenName]),b.useEffect(()=>{const r=setInterval(()=>{if(!e.event&&Math.random()<.05){const i=["dragon","merchant","jester"],d=i[Math.floor(Math.random()*i.length)],f=d==="dragon"?6e5:3e4,p={id:Date.now().toString(),type:d,expiresAt:t(Date.now()).plus(t(f)),hp:d==="dragon"?t(10):void 0,maxHp:d==="dragon"?t(10):void 0,reward:t(0),startTime:d==="dragon"?Date.now():void 0};u(h=>c(s({},h),{event:p}))}},1e4);return()=>clearInterval(r)},[e.event]);const q=r=>{var P;let o=t(0);const n=((P=r.weather)==null?void 0:P.current)||"clear";V.forEach(g=>{const L=r.buildings[g.id]||t(0);let v=g.baseProduction;o=o.plus(L.times(v))});const i=Ke(r.totalRenownEarned);i.gt(t(1))&&(o=o.times(i));let d=0;r.nationalProjects&&Object.values(r.nationalProjects).forEach(g=>{d+=g.level||0});const f=t(1).plus(t(d*It));o=o.times(f);const p=Qe(r.infiniteTowerLevel||0);o=o.times(p),t(1),V.forEach(g=>{const L=r.buildings[g.id]||t(0);if(L.gt(0)){let v=t(1);n==="sunny"?(g.id==="peasant"||g.id==="field"||g.id==="stable"||g.id==="cathedral")&&(v=t(1.2)):n==="rainy"?(g.id==="silver_mine"||g.id==="alchemist"||g.id==="market"||g.id==="tavern")&&(v=t(1.2)):n==="stormy"?((g.id==="blacksmith"||g.id==="void_portal")&&(v=t(1.3)),(g.id==="field"||g.id==="stable")&&(v=t(.8))):n==="windy"&&(g.id==="market"||g.id==="castle"||g.id==="time_chamber")&&(v=t(1.15));const D=L.times(g.baseProduction);if(i.gt(t(1))){const N=D.times(i).times(f).times(v.minus(t(1)));o=o.plus(N)}else{const N=D.times(f).times(v.minus(t(1)));o=o.plus(N)}}});const h=t(1).plus(t(r.achievements.length*.02));if(o=o.times(h),r.globalIncomeMultiplier&&(o=o.times(t(r.globalIncomeMultiplier))),r.betaTesterIncomeMultiplier&&(o=o.times(t(r.betaTesterIncomeMultiplier))),r.event&&r.event.type==="dragon"&&r.event.startTime){const g=Math.floor((Date.now()-r.event.startTime)/1e3),v=1-Math.min(99,g)/100;o=o.times(t(v))}return o},Q=q(e),Z=b.useRef(Q);Z.current=Q,b.useEffect(()=>{const r=setInterval(()=>{u(o=>{const n=Date.now(),i=Z.current.times(t(he)).dividedBy(t(1e3));let d=o.totalGold.plus(i),f=o.gold.plus(i),p=s({},o.weather);const h=t(he/1e3);if(p.timeLeft=t(p.timeLeft||0).minus(h),p.timeLeft.lte(t(0))){const j=["clear","sunny","rainy","stormy","windy"],I=j[Math.floor(Math.random()*j.length)],K=t(Math.floor(Math.random()*120)+60);p={current:I,timeLeft:K}}let P=o.event;P&&P.expiresAt&&t(P.expiresAt).lt(t(n))&&(P=null);let g=s({},o.nationalProjects||{});Object.keys(g).forEach(j=>{var K;const I=g[j];I.active&&I.endTime&&n>=I.endTime&&(g[j]=c(s({},I),{active:!1,level:I.level+1,startTime:0,endTime:0}),x(`Project Completed: ${(K=V.find(se=>se.id===j))==null?void 0:K.name} Infrastructure Level ${I.level+1}!`,"success"))});const L=[...o.achievements];let v=null;Gt.forEach(j=>{L.includes(j.id)||j.condition(c(s({},o),{totalGold:d,gold:f}),Z.current)&&(L.push(j.id),v=j)}),v&&(U(v),setTimeout(()=>U(null),3e3));const D=qe(d),N=(o.infiniteTowerLevel||0)>0?Array.from({length:o.infiniteTowerLevel},(j,I)=>de(I)).reduce((j,I)=>j.plus(I),t(0)):t(0),A=D.minus(N);return c(s({},o),{gold:f,totalGold:d,darkMatterGold:A,achievements:L,event:P,weather:p,nationalProjects:g,stats:c(s({},o.stats),{darkMatterGold:A})})})},he);return()=>clearInterval(r)},[]);const J=(r="light")=>{if("vibrate"in navigator&&oe)switch(r){case"light":navigator.vibrate(10);break;case"medium":navigator.vibrate(20);break;case"heavy":navigator.vibrate([30,10,30]);break}},Se=(r=!1)=>{if(r||J("light"),!r&&!e.isDeveloperWifeBlessingObtained&&e.totalGold.gte(t(1e12))&&Math.random()<1e-6){u(i=>c(s({},i),{globalIncomeMultiplier:(i.globalIncomeMultiplier||1)+1.073,isDeveloperWifeBlessingObtained:!0,achievements:[...new Set([...i.achievements,"developer_wife_blessing"])]})),x("ðŸ’ Developer Wife Blessing received! +107.3% global income!","success");return}const o=dt(w.current);u(n=>c(s({},n),{gold:n.gold.plus(o),totalGold:n.totalGold.plus(o),stats:c(s({},n.stats),{totalClicks:n.stats.totalClicks.plus(t(1)),currentPrestigeClicks:n.stats.currentPrestigeClicks.plus(t(1)),prestigeCount:n.stats.prestigeCount,infiniteTowerLevel:n.stats.infiniteTowerLevel,darkMatterGold:n.stats.darkMatterGold,portalProgress:n.stats.portalProgress,clickUpgradeLevel:n.stats.clickUpgradeLevel,offlineUpgradeLevel:n.stats.offlineUpgradeLevel,totalBuildingsPurchased:n.stats.totalBuildingsPurchased,totalGoldSpent:n.stats.totalGoldSpent,dragonsKilled:n.stats.dragonsKilled,tavernGamesPlayed:n.stats.tavernGamesPlayed})}))},dt=r=>{const o=t(1),n=r.clickUpgradeLevel||0,i=Math.min(n,15),d=t(2).pow(i),f=o.times(d),p=Ke(r.totalRenownEarned);let h=f;p.gt(t(1))&&(h=f.times(p)),r.infiniteTowerLevel&&r.infiniteTowerLevel>0&&(h=h.times(t(1).plus(t(r.infiniteTowerLevel*.01))));const P=_t(n);if(P>0){const v=q(r).times(P);h=h.plus(v)}const g=t(1).plus(t(r.achievements.length*.02));if(h=h.times(g),r.globalIncomeMultiplier&&(h=h.times(t(r.globalIncomeMultiplier))),r.betaTesterIncomeMultiplier&&(h=h.times(t(r.betaTesterIncomeMultiplier))),r.godMode){const v=q(r).times(t(99999));h=h.plus(v)}return h},ut=()=>{const r=e.clickUpgradeLevel||0;if(r>=Ut){x("Maximum Royal Scepter level reached!","warning");return}const o=Rt(r+1);if(e.gold.lt(o)){x("Not enough gold!","error");return}u(n=>c(s({},n),{gold:n.gold.minus(o),clickUpgradeLevel:n.clickUpgradeLevel+1,stats:c(s({},n.stats),{clickUpgradeLevel:n.clickUpgradeLevel+1,totalGoldSpent:n.stats.totalGoldSpent.plus(o)})})),x(`Royal Scepter upgraded to level ${r+1}!`,"success")},ft=()=>{const r=e.offlineUpgradeLevel||0;if(r>=Ot){x("Maximum Passive Income level reached!","warning");return}const o=Nt(r+1);if(e.renown.lt(o)){x("Not enough Renown!","error");return}u(n=>c(s({},n),{renown:n.renown.minus(o),offlineUpgradeLevel:n.offlineUpgradeLevel+1,stats:c(s({},n.stats),{offlineUpgradeLevel:n.offlineUpgradeLevel+1})})),x(`Passive Income upgraded to level ${r+1}!`,"success")},ke=(r,o)=>{const n=V.find(f=>f.id===r);if(!n||o<=0)return;const i=e.buildings[r]||t(0),d=He(n.baseCost,i,t(o)).floor();e.gold.gte(d)&&(J("medium"),u(f=>c(s({},f),{gold:f.gold.minus(d),buildings:c(s({},f.buildings),{[r]:(f.buildings[r]||t(0)).plus(t(o))}),stats:c(s({},f.stats),{totalBuildingsPurchased:f.stats.totalBuildingsPurchased.plus(t(o)),totalGoldSpent:f.stats.totalGoldSpent.plus(d)})})),e.isBetaTesterBlessingObtained||Math.random()<1e-4&&(u(p=>c(s({},p),{betaTesterIncomeMultiplier:(p.betaTesterIncomeMultiplier||1)+1.3,isBetaTesterBlessingObtained:!0,achievements:[...new Set([...p.achievements,"beta_tester_blessing"])]})),x("ðŸ§ª Beta-Tester Legendary blessing received! +130% global income!","success")))},Te=(r,o)=>{const n=V.find(p=>p.id===r);if(!n||o<=0)return;const i=e.buildings[r]||t(0),d=t(Math.min(o,i.toNumber()));if(d.lte(t(0)))return;const f=He(n.baseCost,i.minus(d),d).times(t(.25)).floor();u(p=>c(s({},p),{gold:p.gold.plus(f),buildings:c(s({},p.buildings),{[r]:i.minus(d)})}))},Le=r=>{if(r.type==="merchant"){const o=Z.current.times(t(10));u(n=>c(s({},n),{gold:n.gold.plus(o),totalGold:n.totalGold.plus(o),event:null})),x(`The merchant gifted you ${F(o.floor(),e.numberFormat)} gold!`,"success")}else if(r.type==="jester"){const o=e.gold.times(t(.1)),n=Math.random()>.5;u(i=>c(s({},i),{gold:n?i.gold.plus(o):i.gold.minus(o),totalGold:n?i.totalGold.plus(o):i.totalGold,event:null})),n?x(`Jester pays out! +${F(o.floor(),e.numberFormat)}`,"success"):x(`Jester tricked you! -${F(o.floor(),e.numberFormat)}`,"warning")}else if(r.type==="dragon")try{let o=!1;u(n=>{if(!n.event||n.event.type!=="dragon")return n;const d=t(n.event.hp||10).minus(t(1));if(d.lte(0)){const f=Z.current.times(t(30));return o=!0,c(s({},n),{gold:n.gold.plus(f),totalGold:n.totalGold.plus(f),event:null,stats:c(s({},n.stats),{dragonsKilled:n.stats.dragonsKilled.plus(t(1))})})}return c(s({},n),{event:c(s({},n.event),{hp:d})})}),o&&x("Dragon Slain! +Treasury Boost","success")}catch(o){console.error("Error handling dragon interaction:",o),x("Error interacting with dragon","error")}},mt=()=>{const r=t(1),o=t(1e12),n=e.totalGold;if(n.lt(o))return;const i=n.dividedBy(o),f=t(Math.floor(Math.pow(i.toNumber(),.33))).times(r).minus(e.renown);if(f.lte(0))return;const p=s({},e.nationalProjects);Object.keys(p).forEach(h=>{p[h].active&&(p[h]=c(s({},p[h]),{active:!1,startTime:0,endTime:0}))}),u(c(s({},z),{renown:e.renown.plus(f),totalRenownEarned:e.totalRenownEarned.plus(f),prestigeCount:e.prestigeCount+1,totalGold:e.totalGold,achievements:e.achievements,nationalProjects:p,offlineUpgradeLevel:e.offlineUpgradeLevel,darkMatterGold:e.darkMatterGold,infiniteTowerLevel:e.infiniteTowerLevel,playerProfile:e.playerProfile,startTime:t(Date.now()),lastSaveTime:t(Date.now()),theme:e.theme,idleModeEnabled:e.idleModeEnabled,interface:e.interface,stats:c(s({},z.stats),{totalClicks:e.stats.totalClicks,prestigeCount:e.prestigeCount+1,currentPrestigeClicks:t(0),infiniteTowerLevel:e.infiniteTowerLevel,darkMatterGold:e.darkMatterGold,clickUpgradeLevel:e.clickUpgradeLevel,offlineUpgradeLevel:e.offlineUpgradeLevel})})),ne(!1),x("Abdication Successful. Long live the new King!","success")},gt=()=>{localStorage.removeItem("kingdom_save"),u(c(s({},z),{startTime:t(Date.now())})),X(!1),x("Game Reset","warning")},pt=()=>{const o=Y(e);localStorage.setItem("kingdom_save",JSON.stringify(o)),x("Game Saved","info")},ht=()=>{u(r=>{const o=s({},r.nationalProjects);return Object.keys(o).forEach(n=>{o[n].active&&(o[n]=c(s({},o[n]),{endTime:Date.now()+5e3}))}),c(s({},r),{nationalProjects:o})}),x("Projects sped up to 5 seconds!","success")};window.speedUpProjects=ht;const bt=r=>{u(o=>c(s({},o),{playerProfile:r})),localStorage.setItem(`playerProfile_${r.id}`,JSON.stringify(r)),x(`Welcome, ${r.rulerName} ${r.rulerId}!`,"success"),T(!1)},yt=()=>ae(null,null,function*(){mt()}),vt=r=>ae(null,null,function*(){var o;if(!((o=e.playerProfile)!=null&&o.id)){x("Error: Player profile not found","error");return}try{yield Zt(e.playerProfile.id,r);const n=c(s({},e.playerProfile),{rulerName:r});u(f=>c(s({},f),{playerProfile:n}));const i=c(s({},e),{playerProfile:n}),d=Y(i);localStorage.setItem("kingdom_save",JSON.stringify(d)),x(`Name successfully changed to "${r}"!`,"success")}catch(n){console.error("Error changing name:",n),x("Failed to change name. Please try again.","error")}}),xt=r=>ae(null,null,function*(){var i;const o=((i=e.playerProfile)==null?void 0:i.id)||"default_player",n=yield eo.redeemPromoCode(o,r);if(!n){x("Invalid or expired promo code!","error");return}switch(n.type){case"gold":u(d=>c(s({},d),{gold:d.gold.plus(t(n.value)),totalGold:d.totalGold.plus(t(n.value))})),x(`Received ${F(t(n.value))} gold!`,"success");break;case"betaTester":u(d=>{const f=d.playerProfile?c(s({},d.playerProfile),{usedPromoCodes:[...d.playerProfile.usedPromoCodes||[],"beta_tester"],specialIcon:n.icon||"ðŸ§ª",specialTitle:n.title||"Beta Tester",isBetaTester:!0}):null;return f&&localStorage.setItem(`playerProfile_${o}`,JSON.stringify(f)),c(s({},d),{playerProfile:f})}),x("Beta Tester rewards unlocked! ðŸ§ª","success");break;case"icon":u(d=>{const f=d.playerProfile?c(s({},d.playerProfile),{usedPromoCodes:[...d.playerProfile.usedPromoCodes||[],r],specialIcon:n.icon||"â­",specialTitle:n.title||"Special"}):null;return f&&localStorage.setItem(`playerProfile_${o}`,JSON.stringify(f)),c(s({},d),{playerProfile:f})}),x(`Special icon unlocked: ${n.icon}!`,"success");break;case"title":u(d=>{const f=d.playerProfile?c(s({},d.playerProfile),{usedPromoCodes:[...d.playerProfile.usedPromoCodes||[],r],specialTitle:n.title||"Special"}):null;return f&&localStorage.setItem(`playerProfile_${o}`,JSON.stringify(f)),c(s({},d),{playerProfile:f})}),x(`Special title unlocked: ${n.title}!`,"success");break;default:x("Promo code redeemed!","success")}}),Ce=r=>{u(o=>c(s({},o),{interface:c(s({},o.interface),{lastBuyAmount:r})}))},je=r=>({flex:r==="left"?"var(--col-left)":"var(--col-right)",display:"flex",flexDirection:"column",borderRight:r==="left"?"var(--custom-border-width) double var(--border-color)":"none",borderLeft:r==="right"?"var(--custom-border-width) double var(--border-color)":"none",background:"var(--panel-bg)",minWidth:0,transition:"transform 0.8s ease-in-out",transform:S&&e.idleModeEnabled?r==="left"?"translateX(-120%)":"translateX(120%)":"translateX(0)",zIndex:10});return l.jsxs("div",{style:{display:"flex",height:"100dvh",width:"100vw",backgroundColor:"var(--bg-color)",overflow:"hidden",position:"relative",flexDirection:oe?"column":"row"},children:[l.jsx(zt,{}),S&&e.idleModeEnabled&&l.jsx(to,{gameState:e}),!oe&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:je("left"),children:[l.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)"},children:l.jsx("button",{className:`tab-btn ${ee==="buildings"?"active":""}`,onClick:()=>be("buildings"),children:"Estates"})}),l.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden"},children:ee==="buildings"&&l.jsx(Xe,{gameState:e,onBuyBuilding:ke,onSellBuilding:Te,onSetBuyAmount:Ce})})]}),l.jsx("div",{style:{flex:"var(--col-center)",display:"flex",flexDirection:"column",position:"relative",borderRight:S&&e.idleModeEnabled?"none":"var(--custom-border-width) double var(--border-color)",minWidth:0,zIndex:5,transition:"border 0.8s"},children:l.jsx(Je,{gameState:e,gps:Q,onClick:()=>Se(!1),onEventInteract:Le,onOpenTavern:()=>fe(!0),onOpenPrestige:()=>ne(!0),onOpenSettings:()=>X(!0),onOpenStatistics:()=>me(!0),onOpenLeaderboard:()=>{ge(!0)},onOpenEmpire:()=>le(!0),isIdle:S&&e.idleModeEnabled})}),l.jsxs("div",{style:je("right"),children:[l.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)"},children:l.jsx("button",{className:`tab-btn ${te==="army"?"active":""}`,onClick:()=>et("army"),children:"Future"})}),l.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",WebkitOverflowScrolling:"touch",touchAction:"pan-y",scrollbarWidth:"thin",scrollbarColor:"var(--accent-color) transparent"},children:te==="army"&&l.jsx(Ye,{gameState:e,onBuyTowerFloor:()=>{const r=de(e.infiniteTowerLevel||0);e.darkMatterGold.gte(r)&&(u(o=>c(s({},o),{darkMatterGold:o.darkMatterGold.minus(r),infiniteTowerLevel:(o.infiniteTowerLevel||0)+1,stats:c(s({},o.stats),{infiniteTowerLevel:(o.infiniteTowerLevel||0)+1,darkMatterGold:o.darkMatterGold.minus(r)})})),x("Built another floor of the Infinite Tower! +100% income bonus","success"))}})})]})]}),oe&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",position:"relative",minHeight:0,height:"100%"},children:[O==="buildings"&&l.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0},children:[l.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:l.jsx("button",{className:"tab-btn active",onClick:()=>{},children:"Estates"})}),l.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:l.jsx(Xe,{gameState:e,onBuyBuilding:ke,onSellBuilding:Te,onSetBuyAmount:Ce})})]}),O==="throne"&&l.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,height:"100%"},children:l.jsx(Je,{gameState:e,gps:Q,onClick:()=>Se(!1),onEventInteract:Le,onOpenTavern:()=>fe(!0),onOpenPrestige:()=>ne(!0),onOpenSettings:()=>X(!0),onOpenStatistics:()=>me(!0),onOpenLeaderboard:()=>ge(!0),onOpenEmpire:()=>le(!0),isIdle:S&&e.idleModeEnabled})}),O==="army"&&l.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0},children:[l.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:l.jsx("button",{className:"tab-btn active",children:"Future"})}),l.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:l.jsx(Ye,{gameState:e,onBuyTowerFloor:()=>{const r=de(e.infiniteTowerLevel||0);e.darkMatterGold.gte(r)&&(u(o=>c(s({},o),{darkMatterGold:o.darkMatterGold.minus(r),infiniteTowerLevel:(o.infiniteTowerLevel||0)+1,stats:c(s({},o.stats),{infiniteTowerLevel:(o.infiniteTowerLevel||0)+1,darkMatterGold:o.darkMatterGold.minus(r)})})),x("Built another floor of the Infinite Tower! +100% income bonus","success"))}})})]}),O==="empire"&&l.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,height:"100%"},children:l.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:l.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"var(--text-secondary)"},children:[l.jsx("h3",{children:"ðŸ—ï¸ National Projects"}),l.jsx("p",{children:"Construct massive infrastructure to boost global production."}),l.jsx("button",{className:"btn",onClick:()=>le(!0),style:{margin:"10px",padding:"15px 20px",fontSize:"16px"},children:"ðŸ—ï¸ Manage Projects"})]})})})]}),l.jsxs("div",{style:{display:"flex",justifyContent:"space-around",alignItems:"center",height:"60px",backgroundColor:"var(--panel-bg)",borderTop:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:[l.jsxs("button",{className:`mobile-nav-btn ${O==="buildings"?"active":""}`,onClick:()=>{J("light"),re("buildings")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:O==="buildings"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[l.jsx("div",{style:{fontSize:"20px"},children:"ðŸ˜ï¸"}),l.jsx("div",{children:"Estates"})]}),l.jsxs("button",{className:`mobile-nav-btn ${O==="throne"?"active":""}`,onClick:()=>{J("light"),re("throne")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:O==="throne"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[l.jsx("div",{style:{fontSize:"20px"},children:"ðŸ‘‘"}),l.jsx("div",{children:"Throne"})]}),l.jsxs("button",{className:`mobile-nav-btn ${O==="army"?"active":""}`,onClick:()=>{J("light"),re("army")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:O==="army"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[l.jsx("div",{style:{fontSize:"20px"},children:"ðŸ‘·"}),l.jsx("div",{children:"Future"})]}),l.jsxs("button",{className:`mobile-nav-btn ${O==="empire"?"active":""}`,onClick:()=>{J("light"),re("empire")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:O==="empire"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[l.jsx("div",{style:{fontSize:"20px"},children:"ðŸ—ï¸"}),l.jsx("div",{children:"Projects"})]})]})]}),!(S&&e.idleModeEnabled)&&B&&l.jsxs("div",{className:"achievement-popup",children:[l.jsx("div",{style:{fontSize:"2rem"},children:B.icon}),l.jsxs("div",{children:[l.jsx("div",{style:{fontWeight:"bold",color:"var(--text-color)"},children:"Achievement Unlocked!"}),l.jsx("div",{style:{color:"var(--accent-color)"},children:B.name})]})]}),M&&l.jsx(Wt,{gained:M.gained,effectiveTime:M.effectiveTime,totalTime:M.totalTime,efficiency:M.efficiency,completedProjects:M.completedProjects,currentLevel:M.currentLevel,maxDuration:M.maxDuration,numberFormat:e.numberFormat,onClose:()=>R(null)}),at&&l.jsx(Ft,{gameState:e,onClose:()=>le(!1),onStartProject:r=>{var d;const o=((d=e.nationalProjects[r])==null?void 0:d.level)||0;if(o>=Bt)return;const n=Dt(r,o+1);if(e.gold.lt(n.gold))return;const i=At();u(f=>c(s({},f),{gold:f.gold.minus(n.gold),nationalProjects:c(s({},f.nationalProjects),{[r]:{level:o,active:!0,startTime:Date.now(),endTime:Date.now()+i*1e3}})})),x("Construction started!","info")},onUpgradeClickPower:ut,onUpgradeOffline:ft}),ot&&l.jsx($t,{gameState:e,onGamble:(r,o)=>{const n=t(r);u(i=>c(s({},i),{gold:o?i.gold.plus(n):i.gold.minus(n).max(0),stats:c(s({},i.stats),{tavernGamesPlayed:i.stats.tavernGamesPlayed.plus(t(1))})}))},onClose:()=>fe(!1)}),rt&&l.jsx(Ht,{gameState:e,onPrestige:yt,onClose:()=>ne(!1)}),nt&&l.jsx(Kt,{gameState:e,onClose:()=>X(!1),onHardReset:gt,onSave:pt,onSetTheme:r=>u(o=>c(s({},o),{theme:r})),onSetNumberFormat:r=>u(o=>c(s({},o),{numberFormat:r})),onToggleIdleMode:()=>u(r=>c(s({},r),{idleModeEnabled:!r.idleModeEnabled})),onUpdateInterface:r=>u(o=>c(s({},o),{interface:s(s({},o.interface),r)})),onOpenPromoCodes:()=>{X(!1),pe(!0)},onChangeName:()=>Pe(!0)}),ct&&l.jsx(Xt,{gameState:e,onClose:()=>pe(!1),onRedeemPromoCode:xt,onBackToSettings:()=>{pe(!1),X(!0)}}),it&&l.jsx(Jt,{gameState:e,currentGps:Q,currentTotalClicks:e.stats.totalClicks,currentPrestigeClicks:e.stats.currentPrestigeClicks,onClose:()=>me(!1)}),lt&&l.jsx(Vt,{onClose:()=>st(!1)}),ye&&l.jsx(Yt,{isOpen:ye,onClose:()=>{ve(!1),T(!0)},onConfirm:bt,gameState:e}),xe&&l.jsx(qt,{isOpen:xe,onClose:()=>ge(!1),playerProfile:e.playerProfile,gameState:e,addToast:x}),we&&l.jsx(Qt,{isOpen:we,onClose:()=>Pe(!1),onConfirm:vt,currentName:((Ee=e.playerProfile)==null?void 0:Ee.rulerName)||""})]})},Ze=document.getElementById("root");if(!Ze)throw new Error("Could not find root element to mount to");const ro=jt.createRoot(Ze);ro.render(l.jsx(Mt.StrictMode,{children:l.jsx(oo,{})}))});export default no();
