import{r as y,j as i}from"./app-CcWZZagg.js";import{e as z}from"./game-BSflrnjg.js";import{t as s,f as m,B as P,P as W,C as _,b as w}from"./constants-CBbNB8eo.js";const L=({gameState:t,building:e,x:o,y:l,visible:c,onHide:p})=>{const a=y.useRef(null),[d,r]=y.useState({x:0,y:0});if(y.useEffect(()=>{if(!c||!a.current)return;const h=a.current.getBoundingClientRect();let b=o+15,g=l-h.height/2;b+h.width>window.innerWidth&&(b=o-h.width-15),g<10&&(g=10),g+h.height>window.innerHeight-10&&(g=window.innerHeight-h.height-10),r({x:b,y:g})},[c,o,l]),!c||!e)return null;const n=t.buildings[e.id]||s(0),f=B(t,e),u=f.times(n),x=T(t),C=x.gt(0)?u.div(x).times(100):s(0),v=S(e.baseCost,n),j=v.gt(0)?f.div(v):s(0),k=j.gt(0)?v.div(f):s(0);return i.jsxs("div",{ref:a,className:"advanced-tooltip",style:{position:"fixed",left:`${d.x}px`,top:`${d.y}px`,background:"var(--panel-bg)",color:"var(--text-color)",padding:"12px",borderRadius:"2px",border:"4px double var(--accent-color)",fontSize:"13px",lineHeight:"1.4",width:"280px",minWidth:"280px",zIndex:1e4,boxShadow:"var(--shadow)",pointerEvents:"none",transition:"all 0.15s ease"},onMouseLeave:p,children:[i.jsxs("div",{style:{fontWeight:"bold",fontSize:"16px",marginBottom:"8px",color:"var(--accent-color)",display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{style:{fontSize:"18px"},children:e.icon}),i.jsx("span",{children:e.name})]}),i.jsxs("div",{style:{marginBottom:"8px",padding:"4px",background:"rgba(33, 150, 243, 0.1)",borderRadius:"4px",border:"1px solid rgba(33, 150, 243, 0.3)"},children:[i.jsxs("div",{style:{color:"rgba(33, 150, 243, 0.9)",fontWeight:"bold",fontSize:"13px"},children:["Count: ",m(n,t.numberFormat)]}),i.jsxs("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:["Each: ",i.jsxs("span",{style:{color:"var(--success-color)"},children:[m(f,t.numberFormat),"/s"]})]}),i.jsxs("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:["Total: ",i.jsxs("span",{style:{color:"var(--success-color)",fontWeight:"bold"},children:[m(u,t.numberFormat),"/s"]})]})]}),i.jsx("div",{style:{marginBottom:"8px",padding:"4px",background:"rgba(76, 175, 80, 0.1)",borderRadius:"4px",border:"1px solid var(--success-color)"},children:i.jsxs("div",{style:{fontWeight:"bold",color:"var(--success-color)",fontSize:"12px"},children:["üìä ",m(C,t.numberFormat),"% of total income"]})}),i.jsxs("div",{style:{marginBottom:"6px",padding:"4px",background:"rgba(141, 110, 99, 0.1)",borderRadius:"4px",border:"1px solid var(--accent-color)"},children:[i.jsx("div",{style:{fontWeight:"bold",color:"var(--accent-color)",fontSize:"12px",marginBottom:"2px"},children:"üí∞ Economy"}),i.jsxs("div",{style:{fontSize:"11px",color:"var(--text-secondary)"},children:["Next: ",i.jsxs("span",{style:{color:"var(--accent-color)"},children:[m(v,t.numberFormat)," gold"]})]}),i.jsxs("div",{style:{fontSize:"11px",color:"var(--text-secondary)"},children:["Payoff: ",i.jsx("span",{style:{color:"#ff9800"},children:A(k)})]}),i.jsxs("div",{style:{fontSize:"11px",color:"var(--text-secondary)"},children:["Efficiency: ",i.jsxs("span",{style:{color:"var(--success-color)"},children:[m(j.times(100),t.numberFormat)," gold/s per gold"]})]})]}),i.jsx("div",{style:{fontSize:"11px",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"8px",borderTop:"1px solid var(--border-color)",paddingTop:"6px"},children:e.description})]})};function B(t,e){var r;let o=e.baseProduction;const l=((r=t.weather)==null?void 0:r.current)||"clear";l==="sunny"&&(e.id==="peasant"||e.id==="field")?o=o.times(s(1.2)):l==="rainy"&&(e.id==="silver_mine"||e.id==="alchemist")?o=o.times(s(1.2)):l==="stormy"?(e.id==="blacksmith"&&(o=o.times(s(1.3))),e.id==="field"&&(o=o.times(s(.8)))):l==="windy"&&e.id==="market"&&(o=o.times(s(1.15)));let c=0;t.nationalProjects&&Object.values(t.nationalProjects).forEach(n=>{c+=n.level||0});const p=1+c*W;o=o.times(s(p));const a=E(t.renown);o=o.times(a);const d=R(t.artifacts);return o=o.times(d),o}function E(t){const e=t.toNumber();if(e<=0)return s(1);let o=s(1);e<=100?o=s(1+e*.01):e<=1e3?o=s(2).plus(s(e-100).times(s(.005))):e<=1e4?o=s(2.5).plus(s(e-1e3).times(s(.001))):o=s(10).plus(s(10).times(Math.log10(e)));const l=s(1e3);return z.min(o,l)}function R(t){let e=s(1);return t.includes("ancient_crown")&&(e=e.times(s(1.5))),t.includes("blessed_chalice")&&(e=e.times(s(1.25))),t.includes("dragon_scale")&&(e=e.times(s(1.35))),t.includes("ancient_tablet")&&(e=e.times(s(1.5))),e}function T(t){let e=s(0);return P.forEach(o=>{const l=t.buildings[o.id]||s(0);if(l.gt(0)){const c=B(t,o);e=e.plus(c.times(l))}}),e}function S(t,e){return t.times(s(1.15).pow(e)).floor()}function A(t){if(t.lte(0))return"Instant";const e=t.toNumber(),o=Math.floor(e/31536e3),l=Math.floor(e%31536e3/86400),c=Math.floor(e%86400/3600),p=Math.floor(e%3600/60),a=Math.floor(e%60),d=[];return o>0&&d.push(`${o}y`),l>0&&d.push(`${l}d`),c>0&&d.push(`${c}h`),p>0&&d.push(`${p}m`),(a>0||d.length===0)&&d.push(`${a}s`),d.length>4?d.slice(0,4).join(" "):d.join(" ")}const D=({onClose:t})=>i.jsx("div",{className:"modal-overlay",children:i.jsxs("div",{className:"modal-content",style:{maxWidth:"600px",maxHeight:"80vh",display:"flex",flexDirection:"column"},children:[i.jsx("h2",{children:"üìú Royal Chronicles"}),i.jsx("div",{style:{overflowY:"auto",textAlign:"left",padding:"0 20px",flex:1},children:_.map((e,o)=>i.jsxs("div",{style:{marginBottom:"20px",borderBottom:o<_.length-1?"1px dashed #ccc":"none",paddingBottom:"10px"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"5px"},children:[i.jsxs("span",{style:{fontSize:"1.2rem",fontWeight:"bold",color:"var(--accent-color)"},children:["v",e.version]}),i.jsx("span",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:e.date})]}),i.jsx("ul",{style:{margin:"5px 0",paddingLeft:"20px"},children:e.changes.map((l,c)=>i.jsx("li",{style:{marginBottom:"3px"},children:l},c))})]},e.version))}),i.jsx("button",{className:"btn",style:{marginTop:"20px",alignSelf:"center"},onClick:t,children:"Close Chronicles"})]})}),F=({gameState:t})=>{var d;const[e,o]=y.useState("all"),l=()=>{const r=w.sort((n,f)=>{const u=t.achievements.includes(n.id),x=t.achievements.includes(f.id);return u&&!x?-1:!u&&x?1:0});return e==="all"?r:r.filter(n=>e==="buildings"?n.id.startsWith("build_"):e==="clicks"?n.id.startsWith("clicks_"):e==="gold"?n.id.startsWith("gold_"):e==="soldiers"?n.id.startsWith("soldiers_"):e==="renown"?n.id.startsWith("renown_"):e==="dragons"?n.id.startsWith("dragons_"):e==="gambler"?n.id.startsWith("gambler_"):e==="total_builds"?n.id.startsWith("total_builds"):e==="efficiency"?["speed_1m","speed_1b","prestige_master"].includes(n.id):e==="wonders"?["first_wonder","complete_wonder","all_wonders"].includes(n.id):e==="artifacts"?["all_artifacts","first_artifact","half_artifacts"].includes(n.id):e==="advisors"?["first_advisor","all_advisors","advisor_upgrade"].includes(n.id):e==="trade"?["first_trade","trade_master"].includes(n.id):e==="secret"?["click_master","idle_time_master"].includes(n.id):e==="bonus"?["gold_veteran","production_master","speed_baker","prestige_novice","golden_touch","combo_master"].includes(n.id):e==="combo"?["building_soldier_combo","advisor_artifact_combo"].includes(n.id):!0)},c=[{id:"all",name:"All",icon:"üèÜ"},{id:"buildings",name:"Buildings",icon:"üèóÔ∏è"},{id:"clicks",name:"Clicks",icon:"üëÜ"},{id:"gold",name:"Gold",icon:"üí∞"},{id:"soldiers",name:"Army",icon:"‚öîÔ∏è"},{id:"renown",name:"Prestige",icon:"üëë"},{id:"dragons",name:"Dragons",icon:"üêâ"},{id:"gambler",name:"Tavern",icon:"üé≤"},{id:"total_builds",name:"Total Buildings",icon:"üèõÔ∏è"},{id:"efficiency",name:"Efficiency",icon:"‚ö°"},{id:"wonders",name:"Wonders",icon:"üåü"},{id:"artifacts",name:"Artifacts",icon:"üèÖ"},{id:"advisors",name:"Advisors",icon:"ü§¥"},{id:"trade",name:"Trade",icon:"üö¢"},{id:"secret",name:"Secret",icon:"üîç"},{id:"bonus",name:"Bonus",icon:"‚ú®"},{id:"combo",name:"Combo",icon:"‚ö°"}],p={display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"5px",padding:"5px",background:"var(--panel-bg)",border:"1px solid var(--border-color)",borderRadius:"4px",marginTop:"10px"},a=r=>({width:"100%",aspectRatio:"1",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",border:`2px solid ${r?"var(--gold-color)":"#ccc"}`,background:r?"#fff8e1":"#eee",borderRadius:"4px",opacity:r?1:.3,cursor:r?"help":"default",position:"relative",fontSize:"0.8rem"});return i.jsxs("div",{style:{marginTop:"auto",padding:"10px"},children:[i.jsx("h3",{style:{fontSize:"1rem",margin:"0 0 5px 0"},children:"Royal Decree (Achievements)"}),i.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginBottom:"10px",textAlign:"center"},children:[t.achievements.length," / ",w.length," Unlocked",e!=="all"&&i.jsxs("span",{children:[" | ",l().filter(r=>t.achievements.includes(r.id)).length," / ",l().length," in ",(d=c.find(r=>r.id===e))==null?void 0:d.name]})]}),i.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"5px",marginBottom:"10px",padding:"5px",background:"var(--panel-bg)",border:"1px solid var(--border-color)",borderRadius:"4px"},children:c.map(r=>i.jsxs("button",{onClick:()=>o(r.id),style:{padding:"4px 8px",fontSize:"0.75rem",border:`1px solid ${e===r.id?"var(--gold-color)":"var(--border-color)"}`,borderRadius:"3px",background:e===r.id?"#fff8e1":"var(--panel-bg)",cursor:"pointer",transition:"all 0.2s"},title:r.name,children:[i.jsx("span",{style:{marginRight:"2px"},children:r.icon}),i.jsx("span",{style:{display:e===r.id?"inline":"none"},children:r.name})]},r.id))}),i.jsx("div",{style:p,children:l().map(r=>{const n=t.achievements.includes(r.id);return i.jsx("div",{style:a(n),"data-tooltip":n?`${r.name}: ${r.description}`:"Locked",children:i.jsx("div",{style:{fontSize:"1rem",filter:n?"none":"grayscale(100%)",opacity:n?1:.2},children:n?r.icon:"‚ùì"})},r.id)})})]})};export{F as A,D as C,L as a,E as g};
