import{r as C,j as n}from"./vendor-react-CUeQczFW.js";import{t as o,B as D,k as B,f as p,l as P,m as K,P as T}from"./core-OW4WOWX7.js";import{A as U}from"./components-ui-CI8XsNbF.js";const W=(l,y=!1,d=!1,h=!1)=>({display:"flex",alignItems:"center",padding:"var(--panel-padding)",background:d?"rgba(0,0,0,0.05)":y?"rgba(46, 125, 50, 0.1)":h?"#f3e5f5":"var(--panel-bg)",border:"1px solid",borderColor:d?"rgba(0,0,0,0.2)":h?"#7b1fa2":l?"var(--accent-color)":"rgba(0,0,0,0.1)",borderRadius:"2px",cursor:l&&!d?"pointer":"default",opacity:l&&!d||y?1:.7,transition:"all 0.2s",boxShadow:l&&!d?"2px 2px 0 rgba(0,0,0,0.1)":"none",position:"relative",userSelect:"none",marginBottom:"var(--gap-size)",filter:d?"grayscale(1)":"none"}),_={display:"flex",flexDirection:"column",gap:"var(--gap-size)",height:"100%",overflowY:"auto",padding:"var(--panel-padding)"},$=({gameState:l,onBuyBuilding:y,onSellBuilding:d,onSetBuyAmount:h})=>{var A;const[b,z]=C.useState({visible:!1,x:0,y:0,building:null}),f=o(1),a=((A=l.interface)==null?void 0:A.lastBuyAmount)||o(1),[v,S]=C.useState(!1),[k,w]=C.useState(1);C.useEffect(()=>{const e=s=>{s.ctrlKey?w(10):s.shiftKey?w(100):w(1)},u=s=>e(s),t=s=>e(s);return window.addEventListener("keydown",u),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",u),window.removeEventListener("keyup",t)}},[]);const q=(e,u)=>{const t=e.currentTarget.getBoundingClientRect();z({visible:!0,x:t.right,y:t.top+t.height/2,building:u})},M=()=>{z({visible:!1,x:0,y:0,building:null})},N=(e,u)=>{var x;let t=u;const s=((x=l.weather)==null?void 0:x.current)||"clear";s==="sunny"&&(e==="peasant"||e==="field")?t=t.times(o(1.2)):s==="rainy"&&(e==="silver_mine"||e==="alchemist")?t=t.times(o(1.2)):s==="stormy"?(e==="blacksmith"&&(t=t.times(o(1.3))),e==="field"&&(t=t.times(o(.8)))):s==="windy"&&e==="market"&&(t=t.times(o(1.15)));let i=o(1),c=0;l.nationalProjects&&Object.values(l.nationalProjects).forEach(m=>c+=m.level||0);const E=1+c*T;i=i.times(o(E));const g=o(1).plus(l.renown.times(.01));return i=i.times(g),t.times(i)};let L=0;return n.jsxs("div",{style:_,children:[n.jsx("div",{style:{display:"flex",gap:"5px",marginBottom:"10px",justifyContent:"center"},children:[o(1),o(10),o(100),o(500),o(1e3),o(-1)].map(e=>n.jsx("button",{onClick:()=>h(e),style:{padding:"5px 10px",border:"1px solid var(--accent-color)",background:a.equals(e)?"var(--accent-color)":"var(--panel-bg)",color:a.equals(e)?"var(--text-on-accent)":"var(--text-color)",cursor:"pointer",fontWeight:"bold",fontSize:"0.8rem"},children:e.equals(o(-1))?"Max":`${e.toString()}`},`amount-${e.toString()}`))}),n.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center"},children:"Hold Ctrl: x10 ‚Ä¢ Hold Shift: x100"}),n.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"10px",justifyContent:"center"},children:[n.jsx("button",{className:"btn",style:{background:v?"var(--panel-bg)":"var(--accent-color)",color:v?"var(--text-color)":"var(--text-on-accent)",border:"1px solid var(--accent-color)",padding:"5px 15px",fontSize:"0.8rem"},onClick:()=>S(!1),children:"üõí Buy Mode"}),n.jsx("button",{className:"btn",style:{background:v?"#e65100":"var(--panel-bg)",color:v?"var(--text-on-accent)":"var(--text-color)",border:"1px solid #e65100",padding:"5px 15px",fontSize:"0.8rem"},onClick:()=>S(!0),children:"üí∞ Sell Mode (25%)"})]}),n.jsx("h3",{style:{fontSize:"1rem",color:"var(--text-secondary)",fontWeight:"bold",borderBottom:"1px solid var(--border-color)",paddingBottom:"5px"},children:"Estates"}),D.map((e,u)=>{const t=l.buildings[e.id]||o(0),s=l.totalGold.gte(e.baseCost)||t.gt(o(0));if(s||L++,!s&&L>2)return null;if(v){if(t.eq(o(0)))return null;let r;a.equals(o(-1))?r=t:(r=a.times(k),r.gt(t)&&(r=t));const F=B(e.baseCost,t.minus(r),r).times(o(.25)).floor();return N(e.id,e.baseProduction),n.jsxs("div",{style:W(!0,!1,!1,!1),onClick:()=>d(e.id,r.toNumber()),onMouseEnter:R=>q(R,e),onMouseLeave:M,children:[n.jsx("div",{style:{fontSize:"2rem",marginRight:"15px",width:"40px",textAlign:"center"},children:e.icon}),n.jsx("div",{style:{flex:1},children:n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[n.jsx("span",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"var(--text-color)"},children:e.name}),n.jsx("span",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"var(--accent-color)"},children:p(t,l.numberFormat)})]})}),n.jsxs("div",{style:{marginLeft:"12px",minWidth:"70px",textAlign:"right"},children:[n.jsxs("div",{style:{color:"var(--accent-color)",fontWeight:"bold"},children:["+",p(F,l.numberFormat)]}),n.jsxs("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)"},children:["for ",p(r,l.numberFormat)]})]})]},e.id)}let i=o(0),c=o(0);a.equals(o(-1))?(i=P(e.baseCost,t,l.gold.div(f)),i.eq(o(0))?(i=o(1),c=K(e.baseCost,t).times(f).floor()):c=B(e.baseCost,t,i).times(f).floor()):(i=a,c=B(e.baseCost,t,i).times(f).floor());const E=l.gold.gte(c),g=a.equals(o(-1))&&P(e.baseCost,t,l.gold.div(f)).eq(o(0));let x=i,m=c,j=E;return a.equals(o(-1))||(x=i.times(k),m=B(e.baseCost,t,x).times(f).floor(),j=l.gold.gte(m)),n.jsxs("div",{style:W(j&&!g,!1,!s),onClick:()=>{if(!(j&&!g))return;const r=a.equals(o(-1))?i:x;y(e.id,r.toNumber())},onMouseEnter:r=>q(r,e),onMouseLeave:M,children:[n.jsx("div",{style:{fontSize:"2rem",marginRight:"15px",width:"40px",textAlign:"center"},children:s?e.icon:"‚ùì"}),n.jsx("div",{style:{flex:1},children:n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[n.jsx("span",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"var(--text-color)"},children:s?e.name:"???"}),n.jsx("span",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"var(--accent-color)"},children:p(t,l.numberFormat)})]})}),n.jsxs("div",{style:{marginLeft:"12px",minWidth:"70px",textAlign:"right"},children:[n.jsx("div",{style:{color:j&&!g?"var(--gold-color)":"var(--text-secondary)",fontWeight:"bold"},children:p(a.equals(o(-1))?c:m,l.numberFormat)}),!a.equals(o(-1))&&n.jsxs("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)"},children:["for ",p(x,l.numberFormat)]})]})]},e.id)}),n.jsx(U,{gameState:l,building:b.building,x:b.x,y:b.y,visible:b.visible,onHide:M})]})};export{$ as B};
