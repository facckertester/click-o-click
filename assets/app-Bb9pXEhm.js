import{r as Gu,g as $u}from"./vendor-B--z-fyW.js";import{a as Je}from"./game-Dc_pgXx_.js";var us={exports:{}},fn={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ua;function Wu(){if(ua)return fn;ua=1;var r=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,i,a){var l=null;if(a!==void 0&&(l=""+a),i.key!==void 0&&(l=""+i.key),"key"in i){a={};for(var d in i)d!=="key"&&(a[d]=i[d])}else a=i;return i=a.ref,{$$typeof:r,type:n,key:l,ref:i!==void 0?i:null,props:a}}return fn.Fragment=e,fn.jsx=t,fn.jsxs=t,fn}var da;function Hu(){return da||(da=1,us.exports=Wu()),us.exports}var c=Hu(),W=Gu();const xs=$u(W),s=r=>r instanceof Je?r:new Je(r),Be=s(2e3),ha=[{version:"2.7.0",date:"Current",changes:["EMPIRE UPDATE: Wonders & Trade","Added 'Empire' menu (Unlocks with Castle).","Great Wonders: Build 3 massive multi-stage monuments for permanent bonuses.","Trade Routes: Invest gold and send caravans to distant lands.","New mechanics for spending excess Gold, Soldiers, and Elite Units."]},{version:"2.6.0",date:"Previous",changes:["ELITE ARMY UPDATE: Quality over Quantity","Added 'Royal Academy': Convert basic soldiers into Elite Units.","New Units: Knights, Paladins, and Void Sentinels.","Updated Crusades: High-level missions now require Elite Units to start.","Fixed 'Train 1M' button visibility."]},{version:"2.5.0",date:"Previous",changes:["WAR UPDATE: The Grand Army","New Crusades: toDecimal(5) new campaigns for massive armies (up to 1 Billion soldiers).","Replayability: Crusades can now be replayed for Gold rewards (Critical Success).","New Artifacts: Cosmic-tier relics providing up to x10,000 production.","Added 'Reality Defense' campaign for the ultimate challenge."]},{version:"2.4.0",date:"Previous",changes:["THE TRANSCENDENCE UPDATE","5 New God-Tier Buildings: Reaching up to 1e240 cost.","Renown Shop Expansion: Upgrades for the ultra-rich (up to 1e200 Renown).","New Advisor: The Time Keeper.","Achievement Extension: Gold and Renown tiers expanded significantly.","Endgame Balancing: New synergies for massive empires."]},{version:"2.3.0",date:"Previous",changes:["COSMIC EXPANSION: The Reality Engine","New Endgame Buildings: Chronosphere & Reality Engine.","Synergy Upgrades: Bonuses based on Achievements, Army, and Clicks.","New Renown Upgrades: Spend your prestige points on massive multipliers.","Progressive Unlocks: Buildings now appear only when you are ready.","Extended Achievement tiers for the ultimate tycoons."]},{version:"2.2.0",date:"Previous",changes:["ENDGAME EXPANSION: The Astral Age","New Building: Astral Rift. Harness the power of the void.","Renown Shop: Added powerful upgrades purchasable with Renown.","Quality of Life: 'Buy Amount' multiplier is now saved between sessions."]},{version:"2.1.0",date:"Previous",changes:["Advanced Design Studio: Customize every color!","Layout Control: Adjust the width of the 3 main columns.","Border Customization: Change border thickness and color.","Created the ultimate personalized experience."]},{version:"2.0.0",date:"Previous",changes:["Major Update: Full Interface Customization!","Added Interface settings for Font Size and Layout Density.","Added toggles for Animations, Floating Text, and Weather Widget.","Refined Settings menu organization."]},{version:"1.9.9",date:"Previous",changes:["Interface Update: Moved Statistics to a separate window.","Settings Update: Added ability to toggle 'Cinematic Idle Mode' on/off.","Settings Layout: Reorganized visual preferences."]},{version:"1.9.8",date:"Previous",changes:["Added Number Formatting Options.","Choose between 'Standard' (1k, 1M), 'Scientific' (1e6), or 'Plain' (1,000,000) notation.","Gold Per Second now displays with proper comma separators."]},{version:"1.9.7",date:"Previous",changes:["Added 'Cinematic Idle Mode'!","If you are inactive for 20 seconds, the UI clears away.","Enjoy procedural landscapes based on your kingdom's progress.","Weather effects are now fully visualized in Idle Mode.","Move your mouse to return to ruling."]},{version:"1.9.6",date:"Previous",changes:["Bug Fix: Click visual effect now shows correct gold amount.","The floating text now accounts for upgrades, renown, and decrees."]},{version:"1.9.5",date:"Previous",changes:["UI Update: Added dedicated 'Upgrades' tab.","Content: Added 6 new Upgrades to fill progression gaps.","Balance: Removed 'Divine Tithe' decree.","Upgrades are now sorted by cost."]},{version:"1.9.4",date:"Previous",changes:["Content Update: Added 2 new Click Upgrades.","Added 'Golden Gauntlet' (75k) and 'Hand of Midas' (3.5m).","Sorted all upgrades by price for better progression."]},{version:"1.9.3",date:"Previous",changes:["Army Update: Added bulk recruitment options.","You can now train 100 or 1,000 soldiers at once.","Improved war logistics for late-game empires."]},{version:"1.9.2",date:"Previous",changes:["UI Update: Detailed production stats.","Buildings now display both 'Per Unit' and 'Total' production.","Stats update in real-time with weather and buffs."]},{version:"1.9.1",date:"Previous",changes:["UI Update: Building stats now show REAL production per second.","Production display now accounts for Weather, Upgrades, Renown, and Artifacts.","Fixed descriptions to be more accurate."]},{version:"1.9.0",date:"Previous",changes:["Added Theme Support!","Choose between 'Royal Parchment', 'Dark Ages', and 'Midnight Realm' in Settings.","Improved visual comfort for different lighting conditions."]},{version:"1.8.1",date:"Previous",changes:["Balance Update: Decrees are no longer available immediately.","Added Unlock Conditions for all Decrees to prevent early-game exploits.","Added 'Emergency Draft' Decree (Unlock: toDecimal(100) Peasants).","Added 'Divine Tithe' Decree (Unlock: toDecimal(3) Cathedrals).","Royal Tax Audit now requires the Treasurer Advisor."]},{version:"1.8.0",date:"Previous",changes:["Added Bulk Buy Options: toDecimal(1)x, 10x, 100x, Max.","Expanded Conquest System: Crusades now have risk!","Risk Mechanics: Failure (Retreat), Success, and Critical Success.","Advisors Update: Warmaster now reduces Crusade risk."]},{version:"1.7.0",date:"Previous",changes:["Massive Achievement Update: Added 30 new achievements!","New Milestones: Early game, Prestige, Total Buildings, and Upgrades.","Can you reach 'Immortal Lineage' or build a 'Megalopolis'?"]},{version:"1.6.1",date:"Previous",changes:["Added 10 new hidden achievements.","Can you discover the requirements to unlock them?"]},{version:"1.6.0",date:"Previous",changes:["Added Dynamic Weather System!","Weather changes periodically, affecting production.","Sunny: Boosts Fields/Peasants.","Rainy: Boosts Mines/Alchemists.","Stormy: Major boost to Blacksmiths, penalty to Fields.","Windy: Speeds up Crusades and boosts Markets."]},{version:"1.5.0",date:"Previous",changes:["Added 'Royal Council' system.","Spend Renown to hire permanent Advisors.","4 Unique Advisors: Treasurer, Warmaster, Guildmaster, Alchemist.","Strategic choices for long-term kingdom planning."]},{version:"1.4.3",date:"Previous",changes:["Added 'Royal Tax Audit' decree.","Instantly collect 800s of production (10m cooldown)."]},{version:"1.4.2",date:"Previous",changes:["Added 10 new secret achievements.","Can you unlock them all?"]},{version:"1.4.1",date:"Previous",changes:["Removed sunburst/glow effect around the main button.","Cleaned up UI visual noise."]},{version:"1.4.0",date:"Previous",changes:["New Layout: Screen divided into 3 equal columns.","Left Column: Buildings & Decrees.","Middle Column: The Throne (Clicker & Stats).","Right Column: Army & Achievements.","Improved UI Organization."]},{version:"1.3.2",date:"Previous",changes:["Improved Auto-Save: Game now saves every 30 seconds.","Added Smart Save: Game immediately saves when tab is closed or refreshed.","Fixed issue where progress could be lost on quick exits."]},{version:"1.3.1",date:"Previous",changes:["Fixed Decree timer display: Now shows Active duration first, then Cooldown.","UI improvements for better timer readability."]},{version:"1.3.0",date:"Previous",changes:["Added 'Stables' building (35k cost)","Added 'Silver Mine' building (280k cost)","Made Prestige/Legacy button visible earlier (50k Gold)","Added explanation to Prestige menu"]},{version:"1.2.0",date:"Previous",changes:["Added Statistics tracking (Clicks, Dragon Kills, etc.)","Added 5 New Achievements","Added 'Updates' menu in Settings","Improved Save System stability"]},{version:"1.1.1",date:"Old",changes:["Added Grand Palace building","Added 'The Last Crusade' campaign","Added Notification System (Toasts)","Removed intrusive alerts"]},{version:"1.1.0",date:"Old",changes:["Added Market and Alchemist Guild buildings","Added Tavern Dice Game","Added Settings Menu","Added Hard Reset option"]},{version:"1.0.0",date:"Release",changes:["Initial Release","Basic Buildings & Upgrades","Prestige System","Day/Night Cycle"]}],F=(r,e="standard")=>{let t;try{typeof r=="number"?t=s(r):typeof r=="string"?t=new Je(r):r&&typeof r=="object"&&typeof r.eq=="function"?t=r:t=s(0)}catch(l){return console.error("Error converting to Decimal in formatNumber:",l,"Input:",r),"0"}if(t.eq(s(0)))return"0";if(e==="scientific")return t.abs().lt(s(1e3))?t.toNumber().toLocaleString(void 0,{maximumFractionDigits:1}):t.toExponential(2);if(e==="plain")return t.toNumber().toLocaleString(void 0,{maximumFractionDigits:1});if(t.abs().lt(1e3))return t.toNumber().toLocaleString(void 0,{maximumFractionDigits:1});const n=["","k","M","B","T","Qa","Qi","Sx","Sp","Oc","No","Dc","Ud","Dd","Td","Qd","Qn","Sx","St","Oa","Nn","Vg"],i=Math.floor(t.log10()/3);return i===0?t.toNumber().toLocaleString(void 0,{maximumFractionDigits:1}):i>=n.length?t.toExponential(2):t.dividedBy(s(10).pow(i*3)).toFixed(2)+n[i]},ws={royal_dawn:{id:"royal_dawn",name:"Royal Dawn",colors:{"--bg-color":"#f0e6d2","--panel-bg":"#faf8f3","--text-color":"#2c1810","--text-secondary":"#5d4037","--text-on-accent":"#ffffff","--accent-color":"#a0522d","--accent-hover":"#8b6914","--gold-color":"#b8860b","--border-color":"#a08c6d","--success-color":"#2d5016","--danger-color":"#8b0000","--shadow":"0 4px 12px rgba(0, 0, 0, 0.15)","--bg-image":"none"}},shadow_realm:{id:"shadow_realm",name:"Shadow Realm",colors:{"--bg-color":"#1a1a1a","--panel-bg":"#2d2d2d","--text-color":"#e8e8e8","--text-secondary":"#b0b0b0","--text-on-accent":"#ffffff","--accent-color":"#888888","--accent-hover":"#999999","--gold-color":"#daa520","--border-color":"#555555","--success-color":"#228b22","--danger-color":"#ff4444","--shadow":"0 4px 12px rgba(0, 0, 0, 0.4)","--bg-image":"none"}},ancient_stone:{id:"ancient_stone",name:"Ancient Stone",colors:{"--bg-color":"#8b7355","--panel-bg":"#a0896d","--text-color":"#1a0f08","--text-secondary":"#4a3929","--text-on-accent":"#ffffff","--accent-color":"#8b6914","--accent-hover":"#6b4f0f","--gold-color":"#daa520","--border-color":"#7a6a5a","--success-color":"#556b2f","--danger-color":"#8b4513","--shadow":"0 4px 12px rgba(0, 0, 0, 0.25)","--bg-image":"none"}}},Nl={clear:{id:"clear",name:"Clear Skies",icon:"‚òÄÔ∏è",description:"A calm day. No special effects.",color:"rgba(255, 243, 224, 0.5)"},sunny:{id:"sunny",name:"Bountiful Sun",icon:"üåÖ",description:"+20% Production for Peasants and Wheat Fields.",color:"rgba(255, 236, 179, 0.5)"},rainy:{id:"rainy",name:"Heavy Rain",icon:"üåßÔ∏è",description:"+20% Production for Silver Mines and Alchemists.",color:"rgba(227, 242, 253, 0.5)"},stormy:{id:"stormy",name:"Thunderstorm",icon:"‚ö°",description:"+30% Blacksmith production (Energy), but -20% Wheat Fields.",color:"rgba(207, 216, 220, 0.5)"},windy:{id:"windy",name:"High Winds",icon:"üçÉ",description:"Crusades are 20% faster. Markets produce +15% more.",color:"rgba(224, 242, 241, 0.5)"}},fi=[{id:"knight",name:"Royal Knight",description:"Heavily armored elite infantry.",icon:"üõ°Ô∏è",goldCost:s(25e3),soldierCost:s(100)},{id:"paladin",name:"Divine Paladin",description:"Blessed warriors who fear no darkness.",icon:"‚ú®",goldCost:s(15e4),soldierCost:s(500)},{id:"void_sentinel",name:"Void Sentinel",description:"Infused with cosmic energy to fight reality itself.",icon:"üîÆ",goldCost:s(5e6),soldierCost:s(2e3)}];s(10),s(1),s(5),s(25),s(2),s(5),s(50),s(3),s(5),s(100),s(5),s(5),s(250),s(10),s(5),s(500),s(20),s(5);const dt=[{id:"peasant",name:"Peasant",baseCost:s(15),baseProduction:s(.1),description:"A loyal subject to work the fields.",icon:"üåæ"},{id:"field",name:"Wheat Field",baseCost:s(100),baseProduction:s(1),description:"Golden wheat to feed the kingdom.",icon:"üöú"},{id:"blacksmith",name:"Blacksmith",baseCost:s(1100),baseProduction:s(8),description:"Forging tools and weapons for profit.",icon:"üî®"},{id:"market",name:"Market",baseCost:s(12e3),baseProduction:s(47),description:"Trade hub for exotic goods.",icon:"‚öñÔ∏è"},{id:"tavern",name:"Tavern",baseCost:s(13e4),baseProduction:s(260),description:"Where gold flows as freely as ale.",icon:"üç∫"},{id:"stable",name:"Stables",baseCost:s(14e5),baseProduction:s(1400),description:"Horses for trade and war.",icon:"üêé"},{id:"castle",name:"Castle",baseCost:s(2e7),baseProduction:s(7800),description:"The seat of your power.",icon:"üè∞"},{id:"silver_mine",name:"Silver Mine",baseCost:s(33e7),baseProduction:s(44e3),description:"Deep shafts rich with precious metal.",icon:"‚õèÔ∏è"},{id:"alchemist",name:"Alchemist Guild",baseCost:s(51e8),baseProduction:s(26e4),description:"Transmuting lead into gold.",icon:"‚öóÔ∏è"},{id:"cathedral",name:"Cathedral",baseCost:s(75e9),baseProduction:s(16e5),description:"Divine blessings bring great fortune.",icon:"‚õ™"},{id:"palace",name:"Grand Palace",baseCost:s(1e12),baseProduction:s(1e7),description:"A wonder of the world to cement your legacy.",icon:"üèØ"},{id:"void_portal",name:"Void Portal",baseCost:s(14e12),baseProduction:s(65e6),description:"Gateway to endless void energy.",icon:"üåÄ"},{id:"time_chamber",name:"Time Chamber",baseCost:s(17e13),baseProduction:s(43e7),description:"Manipulate time flow for infinite wealth.",icon:"‚è∞"},{id:"dimension_gate",name:"Dimension Gate",baseCost:s(2e15),baseProduction:s(29e8),description:"Open portals to parallel dimensions.",icon:"üåå"},{id:"astral_rift",name:"Astral Rift",baseCost:s(24e15),baseProduction:s(21e9),description:"Tear open reality to harvest void energy.",icon:"üåå"},{id:"chronosphere",name:"Chronosphere",baseCost:s(28e16),baseProduction:s(15e10),description:"Manipulate time to generate endless wealth.",icon:"‚è≥"},{id:"reality_engine",name:"Reality Engine",baseCost:s(32e17),baseProduction:s(11e11),description:"Rewrite the physical laws of the universe.",icon:"‚öõÔ∏è"},{id:"quantum_computer",name:"Quantum Supercomputer",baseCost:s(384e17),baseProduction:s(132e11),description:"Simulate infinite universes for profit.",icon:"üíª"},{id:"multiverse_nexus",name:"Multiverse Nexus",baseCost:s(461e18),baseProduction:s(158e12),description:"Trade with parallel realities.",icon:"üåÄ"},{id:"dyson_sphere",name:"Dyson Sphere",baseCost:s(553e19),baseProduction:s(19e14),description:"Harness entire energy of a star.",icon:"üåû"},{id:"matter_replicator",name:"Matter Replicator",baseCost:s(664e20),baseProduction:s(228e14),description:"Convert energy directly into gold.",icon:"üñ®Ô∏è"},{id:"architect_quill",name:"The Architect's Quill",baseCost:s(797e21),baseProduction:s(274e15),description:"Rewrite code of existence itself.",icon:"‚úíÔ∏è"}],Xe=[{id:"reinforced_finger",name:"Reinforced Index Finger",description:"Clicking is 2x more effective.",cost:s(100),type:"click",multiplier:s(2)},{id:"carpal_tunnel",name:"Carpal Tunnel Prevention Cream",description:"Clicking is 2x more effective.",cost:s(500),type:"click",multiplier:s(2)},{id:"ambidextrous",name:"Ambidextrous",description:"Clicking is 2x more effective.",cost:s(1e4),type:"click",multiplier:s(2)},{id:"thousand_fingers",name:"Thousand Fingers",description:"Clicking is 2x more effective.",cost:s(1e5),type:"click",multiplier:s(2)},{id:"million_fingers",name:"Million Fingers",description:"Clicking is 2x more effective.",cost:s(1e7),type:"click",multiplier:s(2)},{id:"billion_fingers",name:"Billion Fingers",description:"Clicking is 2x more effective.",cost:s(1e9),type:"click",multiplier:s(2)},{id:"rusty_pitchfork",name:"Rusty Pitchforks",description:"Peasants work 2x harder.",cost:s(1e3),triggerId:"peasant",triggerCount:s(1),type:"building",targetId:"peasant",multiplier:s(2)},{id:"better_tools",name:"Better Tools",description:"Peasants get better farming tools.",cost:s(5e3),triggerId:"peasant",triggerCount:s(1),type:"building",targetId:"peasant",multiplier:s(2)},{id:"advanced_farming",name:"Advanced Farming",description:"Modern farming techniques.",cost:s(1e4),triggerId:"peasant",triggerCount:s(5),type:"building",targetId:"peasant",multiplier:s(2)},{id:"magical_seeds",name:"Magical Seeds",description:"Seeds enchanted with growth magic.",cost:s(5e4),triggerId:"peasant",triggerCount:s(25),type:"building",targetId:"peasant",multiplier:s(2)},{id:"crop_rotation",name:"Crop Rotation",description:"Advanced crop management.",cost:s(1e5),triggerId:"peasant",triggerCount:s(50),type:"building",targetId:"peasant",multiplier:s(2)},{id:"weather_control",name:"Weather Control",description:"Control weather for perfect harvests.",cost:s(5e5),triggerId:"peasant",triggerCount:s(100),type:"building",targetId:"peasant",multiplier:s(2)},{id:"better_seeds",name:"Better Seeds",description:"Fields yield 2x more wheat.",cost:s(11e3),triggerId:"field",triggerCount:s(1),type:"building",targetId:"field",multiplier:s(2)},{id:"fertilizer",name:"Fertilizer",description:"Fields yield 2x more wheat.",cost:s(55e3),triggerId:"field",triggerCount:s(1),type:"building",targetId:"field",multiplier:s(2)},{id:"irrigation",name:"Irrigation Systems",description:"Fields yield 2x more wheat.",cost:s(11e4),triggerId:"field",triggerCount:s(5),type:"building",targetId:"field",multiplier:s(2)},{id:"golden_wheat",name:"Golden Wheat",description:"Fields yield 2x more wheat.",cost:s(55e4),triggerId:"field",triggerCount:s(25),type:"building",targetId:"field",multiplier:s(2)},{id:"magical_harvest",name:"Magical Harvest",description:"Fields yield 2x more wheat.",cost:s(11e5),triggerId:"field",triggerCount:s(50),type:"building",targetId:"field",multiplier:s(2)},{id:"abundance_ritual",name:"Abundance Ritual",description:"Fields yield 2x more wheat.",cost:s(55e5),triggerId:"field",triggerCount:s(100),type:"building",targetId:"field",multiplier:s(2)},{id:"better_hammers",name:"Better Hammers",description:"Blacksmiths produce 2x more.",cost:s(12e3),triggerId:"blacksmith",triggerCount:s(1),type:"building",targetId:"blacksmith",multiplier:s(2)},{id:"magic_forges",name:"Magic Forges",description:"Blacksmiths produce 2x more.",cost:s(6e4),triggerId:"blacksmith",triggerCount:s(1),type:"building",targetId:"blacksmith",multiplier:s(2)},{id:"enchanted_tools",name:"Enchanted Tools",description:"Blacksmiths produce 2x more.",cost:s(12e4),triggerId:"blacksmith",triggerCount:s(5),type:"building",targetId:"blacksmith",multiplier:s(2)},{id:"elemental_forging",name:"Elemental Forging",description:"Blacksmiths produce 2x more.",cost:s(6e5),triggerId:"blacksmith",triggerCount:s(25),type:"building",targetId:"blacksmith",multiplier:s(2)},{id:"divine_crafting",name:"Divine Crafting",description:"Blacksmiths produce 2x more.",cost:s(12e5),triggerId:"blacksmith",triggerCount:s(50),type:"building",targetId:"blacksmith",multiplier:s(2)},{id:"cosmic_forges",name:"Cosmic Forges",description:"Blacksmiths produce 2x more.",cost:s(6e6),triggerId:"blacksmith",triggerCount:s(100),type:"building",targetId:"blacksmith",multiplier:s(2)},{id:"better_trading",name:"Better Trading",description:"Markets produce 2x more.",cost:s(12e4),triggerId:"market",triggerCount:s(1),type:"building",targetId:"market",multiplier:s(2)},{id:"trade_routes_advanced",name:"Trade Routes",description:"Markets produce 2x more.",cost:s(6e5),triggerId:"market",triggerCount:s(1),type:"building",targetId:"market",multiplier:s(2)},{id:"global_markets",name:"Global Markets",description:"Markets produce 2x more.",cost:s(12e5),triggerId:"market",triggerCount:s(5),type:"building",targetId:"market",multiplier:s(2)},{id:"interdimensional_trade",name:"Interdimensional Trade",description:"Markets produce 2x more.",cost:s(6e6),triggerId:"market",triggerCount:s(25),type:"building",targetId:"market",multiplier:s(2)},{id:"universal_currency",name:"Universal Currency",description:"Markets produce 2x more.",cost:s(12e6),triggerId:"market",triggerCount:s(50),type:"building",targetId:"market",multiplier:s(2)},{id:"quantum_markets",name:"Quantum Markets",description:"Markets produce 2x more.",cost:s(6e7),triggerId:"market",triggerCount:s(100),type:"building",targetId:"market",multiplier:s(2)},{id:"better_ale",name:"Better Ale",description:"Taverns produce 2x more.",cost:s(13e4),triggerId:"tavern",triggerCount:s(1),type:"building",targetId:"tavern",multiplier:s(2)},{id:"entertainment",name:"Better Entertainment",description:"Taverns produce 2x more.",cost:s(65e4),triggerId:"tavern",triggerCount:s(1),type:"building",targetId:"tavern",multiplier:s(2)},{id:"minstrels",name:"Royal Minstrels",description:"Taverns produce 2x more.",cost:s(13e5),triggerId:"tavern",triggerCount:s(5),type:"building",targetId:"tavern",multiplier:s(2)},{id:"gambling_halls",name:"Gambling Halls",description:"Taverns produce 2x more.",cost:s(65e5),triggerId:"tavern",triggerCount:s(25),type:"building",targetId:"tavern",multiplier:s(2)},{id:"luxury_services",name:"Luxury Services",description:"Taverns produce 2x more.",cost:s(13e6),triggerId:"tavern",triggerCount:s(50),type:"building",targetId:"tavern",multiplier:s(2)},{id:"royal_casino",name:"Royal Casino",description:"Taverns produce 2x more.",cost:s(65e6),triggerId:"tavern",triggerCount:s(100),type:"building",targetId:"tavern",multiplier:s(2)},{id:"better_horses",name:"Better Horses",description:"Stables produce 2x more.",cost:s(14e5),triggerId:"stable",triggerCount:s(1),type:"building",targetId:"stable",multiplier:s(2)},{id:"horse_breeding",name:"Advanced Horse Breeding",description:"Stables produce 2x more.",cost:s(7e6),triggerId:"stable",triggerCount:s(1),type:"building",targetId:"stable",multiplier:s(2)},{id:"magical_steed",name:"Magical Steeds",description:"Stables produce 2x more.",cost:s(14e6),triggerId:"stable",triggerCount:s(5),type:"building",targetId:"stable",multiplier:s(2)},{id:"war_horses_advanced",name:"War Horses",description:"Stables produce 2x more.",cost:s(7e7),triggerId:"stable",triggerCount:s(25),type:"building",targetId:"stable",multiplier:s(2)},{id:"pegasus_stables",name:"Pegasus Stables",description:"Stables produce 2x more.",cost:s(14e7),triggerId:"stable",triggerCount:s(50),type:"building",targetId:"stable",multiplier:s(2)},{id:"dragon_nests",name:"Dragon Nests",description:"Stables produce 2x more.",cost:s(7e8),triggerId:"stable",triggerCount:s(100),type:"building",targetId:"stable",multiplier:s(2)},{id:"better_defenses",name:"Better Defenses",description:"Castles produce 2x more.",cost:s(2e7),triggerId:"castle",triggerCount:s(1),type:"building",targetId:"castle",multiplier:s(2)},{id:"royal_court",name:"Royal Court",description:"Castles produce 2x more.",cost:s(1e8),triggerId:"castle",triggerCount:s(1),type:"building",targetId:"castle",multiplier:s(2)},{id:"throne_room",name:"Grand Throne Room",description:"Castles produce 2x more.",cost:s(2e8),triggerId:"castle",triggerCount:s(5),type:"building",targetId:"castle",multiplier:s(2)},{id:"wizard_tower",name:"Castle Wizard Tower",description:"Castles produce 2x more.",cost:s(1e9),triggerId:"castle",triggerCount:s(25),type:"building",targetId:"castle",multiplier:s(2)},{id:"dungeon",name:"Royal Dungeons",description:"Castles produce 2x more.",cost:s(2e9),triggerId:"castle",triggerCount:s(50),type:"building",targetId:"castle",multiplier:s(2)},{id:"flying_castle",name:"Flying Castle",description:"Castles produce 2x more.",cost:s(1e10),triggerId:"castle",triggerCount:s(100),type:"building",targetId:"castle",multiplier:s(2)},{id:"better_pickaxes",name:"Better Pickaxes",description:"Silver Mines produce 2x more.",cost:s(33e7),triggerId:"silver_mine",triggerCount:s(1),type:"building",targetId:"silver_mine",multiplier:s(2)},{id:"mine_carts",name:"Mine Carts",description:"Silver Mines produce 2x more.",cost:s(165e7),triggerId:"silver_mine",triggerCount:s(1),type:"building",targetId:"silver_mine",multiplier:s(2)},{id:"steam_power",name:"Steam Power",description:"Silver Mines produce 2x more.",cost:s(33e8),triggerId:"silver_mine",triggerCount:s(5),type:"building",targetId:"silver_mine",multiplier:s(2)},{id:"deep_shafts_advanced",name:"Deep Shafts",description:"Silver Mines produce 2x more.",cost:s(165e8),triggerId:"silver_mine",triggerCount:s(25),type:"building",targetId:"silver_mine",multiplier:s(2)},{id:"magical_ores",name:"Magical Ores",description:"Silver Mines produce 2x more.",cost:s(33e9),triggerId:"silver_mine",triggerCount:s(50),type:"building",targetId:"silver_mine",multiplier:s(2)},{id:"elemental_mining",name:"Elemental Mining",description:"Silver Mines produce 2x more.",cost:s(165e9),triggerId:"silver_mine",triggerCount:s(100),type:"building",targetId:"silver_mine",multiplier:s(2)},{id:"better_alembics",name:"Better Alembics",description:"Alchemist Guilds produce 2x more.",cost:s(51e8),triggerId:"alchemist",triggerCount:s(1),type:"building",targetId:"alchemist",multiplier:s(2)},{id:"philosopher_stone",name:"Philosopher's Stone",description:"Alchemist Guilds produce 2x more.",cost:s(255e8),triggerId:"alchemist",triggerCount:s(1),type:"building",targetId:"alchemist",multiplier:s(2)},{id:"transmutation_circle",name:"Transmutation Circle",description:"Alchemist Guilds produce 2x more.",cost:s(51e9),triggerId:"alchemist",triggerCount:s(5),type:"building",targetId:"alchemist",multiplier:s(2)},{id:"elixir_of_life",name:"Elixir of Life",description:"Alchemist Guilds produce 2x more.",cost:s(255e9),triggerId:"alchemist",triggerCount:s(25),type:"building",targetId:"alchemist",multiplier:s(2)},{id:"true_gold",name:"True Gold Creation",description:"Alchemist Guilds produce 2x more.",cost:s(51e10),triggerId:"alchemist",triggerCount:s(50),type:"building",targetId:"alchemist",multiplier:s(2)},{id:"divine_transmutation",name:"Divine Transmutation",description:"Alchemist Guilds produce 2x more.",cost:s(255e10),triggerId:"alchemist",triggerCount:s(100),type:"building",targetId:"alchemist",multiplier:s(2)},{id:"better_choir",name:"Better Choir",description:"Cathedrals produce 2x more.",cost:s(75e9),triggerId:"cathedral",triggerCount:s(1),type:"building",targetId:"cathedral",multiplier:s(2)},{id:"holy_relics",name:"Holy Relics",description:"Cathedrals produce 2x more.",cost:s(375e9),triggerId:"cathedral",triggerCount:s(1),type:"building",targetId:"cathedral",multiplier:s(2)},{id:"divine_rituals",name:"Divine Rituals",description:"Cathedrals produce 2x more.",cost:s(75e10),triggerId:"cathedral",triggerCount:s(5),type:"building",targetId:"cathedral",multiplier:s(2)},{id:"angelic_choir",name:"Angelic Choir",description:"Cathedrals produce 2x more.",cost:s(375e10),triggerId:"cathedral",triggerCount:s(25),type:"building",targetId:"cathedral",multiplier:s(2)},{id:"divine_presence",name:"Divine Presence",description:"Cathedrals produce 2x more.",cost:s(75e11),triggerId:"cathedral",triggerCount:s(50),type:"building",targetId:"cathedral",multiplier:s(2)},{id:"heavenly_gates",name:"Heavenly Gates",description:"Cathedrals produce 2x more.",cost:s(375e11),triggerId:"cathedral",triggerCount:s(100),type:"building",targetId:"cathedral",multiplier:s(2)},{id:"royal_guards",name:"Royal Guards",description:"Grand Palaces produce 2x more.",cost:s(1e12),triggerId:"palace",triggerCount:s(1),type:"building",targetId:"palace",multiplier:s(2)},{id:"imperial_court",name:"Imperial Court",description:"Grand Palaces produce 2x more.",cost:s(5e12),triggerId:"palace",triggerCount:s(1),type:"building",targetId:"palace",multiplier:s(2)},{id:"throne_of_power",name:"Throne of Power",description:"Grand Palaces produce 2x more.",cost:s(1e13),triggerId:"palace",triggerCount:s(5),type:"building",targetId:"palace",multiplier:s(2)},{id:"imperial_treasury",name:"Imperial Treasury",description:"Grand Palaces produce 2x more.",cost:s(5e13),triggerId:"palace",triggerCount:s(25),type:"building",targetId:"palace",multiplier:s(2)},{id:"emperor_wisdom",name:"Emperor's Wisdom",description:"Grand Palaces produce 2x more.",cost:s(1e14),triggerId:"palace",triggerCount:s(50),type:"building",targetId:"palace",multiplier:s(2)},{id:"divine_mandate",name:"Divine Mandate",description:"Grand Palaces produce 2x more.",cost:s(5e14),triggerId:"palace",triggerCount:s(100),type:"building",targetId:"palace",multiplier:s(2)},{id:"void_energy",name:"Void Energy Harvesting",description:"Void Portals produce 2x more.",cost:s(14e12),triggerId:"void_portal",triggerCount:s(1),type:"building",targetId:"void_portal",multiplier:s(2)},{id:"dimensional_guards",name:"Dimensional Guards",description:"Void Portals produce 2x more.",cost:s(7e13),triggerId:"void_portal",triggerCount:s(1),type:"building",targetId:"void_portal",multiplier:s(2)},{id:"void_creatures",name:"Void Creatures",description:"Void Portals produce 2x more.",cost:s(14e13),triggerId:"void_portal",triggerCount:s(5),type:"building",targetId:"void_portal",multiplier:s(2)},{id:"void_lords",name:"Void Lords",description:"Void Portals produce 2x more.",cost:s(7e14),triggerId:"void_portal",triggerCount:s(25),type:"building",targetId:"void_portal",multiplier:s(2)},{id:"void_gods",name:"Void Gods",description:"Void Portals produce 2x more.",cost:s(14e14),triggerId:"void_portal",triggerCount:s(50),type:"building",targetId:"void_portal",multiplier:s(2)},{id:"void_mastery",name:"Void Mastery",description:"Void Portals produce 2x more.",cost:s(7e15),triggerId:"void_portal",triggerCount:s(100),type:"building",targetId:"void_portal",multiplier:s(2)},{id:"time_dilation",name:"Time Dilation",description:"Time Chambers produce 2x more.",cost:s(17e13),triggerId:"time_chamber",triggerCount:s(1),type:"building",targetId:"time_chamber",multiplier:s(2)},{id:"temporal_machinery",name:"Temporal Machinery",description:"Time Chambers produce 2x more.",cost:s(85e13),triggerId:"time_chamber",triggerCount:s(1),type:"building",targetId:"time_chamber",multiplier:s(2)},{id:"time_loops",name:"Time Loops",description:"Time Chambers produce 2x more.",cost:s(17e14),triggerId:"time_chamber",triggerCount:s(5),type:"building",targetId:"time_chamber",multiplier:s(2)},{id:"paradox_creation",name:"Paradox Creation",description:"Time Chambers produce 2x more.",cost:s(85e14),triggerId:"time_chamber",triggerCount:s(25),type:"building",targetId:"time_chamber",multiplier:s(2)},{id:"time_gods",name:"Time Gods",description:"Time Chambers produce 2x more.",cost:s(17e15),triggerId:"time_chamber",triggerCount:s(50),type:"building",targetId:"time_chamber",multiplier:s(2)},{id:"eternity",name:"Eternity",description:"Time Chambers produce 2x more.",cost:s(85e15),triggerId:"time_chamber",triggerCount:s(100),type:"building",targetId:"time_chamber",multiplier:s(2)},{id:"dimension_travel",name:"Dimension Travel",description:"Dimension Gates produce 2x more.",cost:s(2e15),triggerId:"dimension_gate",triggerCount:s(1),type:"building",targetId:"dimension_gate",multiplier:s(2)},{id:"parallel_worlds",name:"Parallel Worlds",description:"Dimension Gates produce 2x more.",cost:s(1e16),triggerId:"dimension_gate",triggerCount:s(1),type:"building",targetId:"dimension_gate",multiplier:s(2)},{id:"multiverse_trade",name:"Multiverse Trade",description:"Dimension Gates produce 2x more.",cost:s(2e16),triggerId:"dimension_gate",triggerCount:s(5),type:"building",targetId:"dimension_gate",multiplier:s(2)},{id:"reality_merging",name:"Reality Merging",description:"Dimension Gates produce 2x more.",cost:s(1e17),triggerId:"dimension_gate",triggerCount:s(25),type:"building",targetId:"dimension_gate",multiplier:s(2)},{id:"omniverse",name:"Omniverse",description:"Dimension Gates produce 2x more.",cost:s(2e17),triggerId:"dimension_gate",triggerCount:s(50),type:"building",targetId:"dimension_gate",multiplier:s(2)},{id:"transcendence",name:"Transcendence",description:"Dimension Gates produce 2x more.",cost:s(1e18),triggerId:"dimension_gate",triggerCount:s(100),type:"building",targetId:"dimension_gate",multiplier:s(2)},{id:"astral_energy",name:"Astral Energy",description:"Astral Rifts produce 2x more.",cost:s(24e15),triggerId:"astral_rift",triggerCount:s(1),type:"building",targetId:"astral_rift",multiplier:s(2)},{id:"cosmic_harvest",name:"Cosmic Harvest",description:"Astral Rifts produce 2x more.",cost:s(12e16),triggerId:"astral_rift",triggerCount:s(1),type:"building",targetId:"astral_rift",multiplier:s(2)},{id:"star_forge",name:"Star Forge",description:"Astral Rifts produce 2x more.",cost:s(24e16),triggerId:"astral_rift",triggerCount:s(5),type:"building",targetId:"astral_rift",multiplier:s(2)},{id:"galaxy_creation",name:"Galaxy Creation",description:"Astral Rifts produce 2x more.",cost:s(12e17),triggerId:"astral_rift",triggerCount:s(25),type:"building",targetId:"astral_rift",multiplier:s(2)},{id:"universe_control",name:"Universe Control",description:"Astral Rifts produce 2x more.",cost:s(24e17),triggerId:"astral_rift",triggerCount:s(50),type:"building",targetId:"astral_rift",multiplier:s(2)},{id:"cosmic_godhood",name:"Cosmic Godhood",description:"Astral Rifts produce 2x more.",cost:s(12e18),triggerId:"astral_rift",triggerCount:s(100),type:"building",targetId:"astral_rift",multiplier:s(2)},{id:"time_manulation_chronosphere",name:"Time Manipulation",description:"Chronospheres produce 2x more.",cost:s(28e16),triggerId:"chronosphere",triggerCount:s(1),type:"building",targetId:"chronosphere",multiplier:s(2)},{id:"causality_control",name:"Causality Control",description:"Chronospheres produce 2x more.",cost:s(14e17),triggerId:"chronosphere",triggerCount:s(1),type:"building",targetId:"chronosphere",multiplier:s(2)},{id:"timeline_editing",name:"Timeline Editing",description:"Chronospheres produce 2x more.",cost:s(28e17),triggerId:"chronosphere",triggerCount:s(5),type:"building",targetId:"chronosphere",multiplier:s(2)},{id:"destiny_weaving",name:"Destiny Weaving",description:"Chronospheres produce 2x more.",cost:s(14e18),triggerId:"chronosphere",triggerCount:s(25),type:"building",targetId:"chronosphere",multiplier:s(2)},{id:"fate_mastery",name:"Fate Mastery",description:"Chronospheres produce 2x more.",cost:s(28e18),triggerId:"chronosphere",triggerCount:s(50),type:"building",targetId:"chronosphere",multiplier:s(2)},{id:"temporal_godhood",name:"Temporal Godhood",description:"Chronospheres produce 2x more.",cost:s(14e19),triggerId:"chronosphere",triggerCount:s(100),type:"building",targetId:"chronosphere",multiplier:s(2)},{id:"physics_rewriting",name:"Physics Rewriting",description:"Reality Engines produce 2x more.",cost:s(32e17),triggerId:"reality_engine",triggerCount:s(1),type:"building",targetId:"reality_engine",multiplier:s(2)},{id:"matter_creation",name:"Matter Creation",description:"Reality Engines produce 2x more.",cost:s(16e18),triggerId:"reality_engine",triggerCount:s(1),type:"building",targetId:"reality_engine",multiplier:s(2)},{id:"reality_editing",name:"Reality Editing",description:"Reality Engines produce 2x more.",cost:s(32e18),triggerId:"reality_engine",triggerCount:s(5),type:"building",targetId:"reality_engine",multiplier:s(2)},{id:"existence_control",name:"Existence Control",description:"Reality Engines produce 2x more.",cost:s(16e19),triggerId:"reality_engine",triggerCount:s(25),type:"building",targetId:"reality_engine",multiplier:s(2)},{id:"omnipotence",name:"Omnipotence",description:"Reality Engines produce 2x more.",cost:s(32e19),triggerId:"reality_engine",triggerCount:s(50),type:"building",targetId:"reality_engine",multiplier:s(2)},{id:"absolute_power",name:"Absolute Power",description:"Reality Engines produce 2x more.",cost:s(16e20),triggerId:"reality_engine",triggerCount:s(100),type:"building",targetId:"reality_engine",multiplier:s(2)},{id:"quantum_processing",name:"Quantum Processing",description:"Quantum Supercomputers produce 2x more.",cost:s(384e17),triggerId:"quantum_computer",triggerCount:s(1),type:"building",targetId:"quantum_computer",multiplier:s(2)},{id:"universe_simulation",name:"Universe Simulation",description:"Quantum Supercomputers produce 2x more.",cost:s(192e18),triggerId:"quantum_computer",triggerCount:s(1),type:"building",targetId:"quantum_computer",multiplier:s(2)},{id:"multiverse_computing",name:"Multiverse Computing",description:"Quantum Supercomputers produce 2x more.",cost:s(384e18),triggerId:"quantum_computer",triggerCount:s(5),type:"building",targetId:"quantum_computer",multiplier:s(2)},{id:"reality_calculation",name:"Reality Calculation",description:"Quantum Supercomputers produce 2x more.",cost:s(192e19),triggerId:"quantum_computer",triggerCount:s(25),type:"building",targetId:"quantum_computer",multiplier:s(2)},{id:"omniscience",name:"Omniscience",description:"Quantum Supercomputers produce 2x more.",cost:s(384e19),triggerId:"quantum_computer",triggerCount:s(50),type:"building",targetId:"quantum_computer",multiplier:s(2)},{id:"ultimate_computation",name:"Ultimate Computation",description:"Quantum Supercomputers produce 2x more.",cost:s(192e20),triggerId:"quantum_computer",triggerCount:s(100),type:"building",targetId:"quantum_computer",multiplier:s(2)},{id:"dimensional_trade",name:"Dimensional Trade",description:"Multiverse Nexuses produce 2x more.",cost:s(461e18),triggerId:"multiverse_nexus",triggerCount:s(1),type:"building",targetId:"multiverse_nexus",multiplier:s(2)},{id:"reality_commerce",name:"Reality Commerce",description:"Multiverse Nexuses produce 2x more.",cost:s(231e19),triggerId:"multiverse_nexus",triggerCount:s(1),type:"building",targetId:"multiverse_nexus",multiplier:s(2)},{id:"omniverse_markets",name:"Omniverse Markets",description:"Multiverse Nexuses produce 2x more.",cost:s(461e19),triggerId:"multiverse_nexus",triggerCount:s(5),type:"building",targetId:"multiverse_nexus",multiplier:s(2)},{id:"existence_trading",name:"Existence Trading",description:"Multiverse Nexuses produce 2x more.",cost:s(231e20),triggerId:"multiverse_nexus",triggerCount:s(25),type:"building",targetId:"multiverse_nexus",multiplier:s(2)},{id:"cosmic_commerce",name:"Cosmic Commerce",description:"Multiverse Nexuses produce 2x more.",cost:s(461e20),triggerId:"multiverse_nexus",triggerCount:s(50),type:"building",targetId:"multiverse_nexus",multiplier:s(2)},{id:"ultimate_trade",name:"Ultimate Trade",description:"Multiverse Nexuses produce 2x more.",cost:s(231e21),triggerId:"multiverse_nexus",triggerCount:s(100),type:"building",targetId:"multiverse_nexus",multiplier:s(2)},{id:"stellar_energy",name:"Stellar Energy",description:"Dyson Spheres produce 2x more.",cost:s(553e19),triggerId:"dyson_sphere",triggerCount:s(1),type:"building",targetId:"dyson_sphere",multiplier:s(2)},{id:"solar_harvest",name:"Solar Harvest",description:"Dyson Spheres produce 2x more.",cost:s(277e20),triggerId:"dyson_sphere",triggerCount:s(1),type:"building",targetId:"dyson_sphere",multiplier:s(2)},{id:"galaxy_power",name:"Galaxy Power",description:"Dyson Spheres produce 2x more.",cost:s(553e20),triggerId:"dyson_sphere",triggerCount:s(5),type:"building",targetId:"dyson_sphere",multiplier:s(2)},{id:"universe_energy",name:"Universe Energy",description:"Dyson Spheres produce 2x more.",cost:s(277e21),triggerId:"dyson_sphere",triggerCount:s(25),type:"building",targetId:"dyson_sphere",multiplier:s(2)},{id:"cosmic_power",name:"Cosmic Power",description:"Dyson Spheres produce 2x more.",cost:s(553e21),triggerId:"dyson_sphere",triggerCount:s(50),type:"building",targetId:"dyson_sphere",multiplier:s(2)},{id:"stellar_godhood",name:"Stellar Godhood",description:"Dyson Spheres produce 2x more.",cost:s(277e22),triggerId:"dyson_sphere",triggerCount:s(100),type:"building",targetId:"dyson_sphere",multiplier:s(2)},{id:"energy_conversion",name:"Energy Conversion",description:"Matter Replicators produce 2x more.",cost:s(664e20),triggerId:"matter_replicator",triggerCount:s(1),type:"building",targetId:"matter_replicator",multiplier:s(2)},{id:"mass_production",name:"Mass Production",description:"Matter Replicators produce 2x more.",cost:s(332e21),triggerId:"matter_replicator",triggerCount:s(1),type:"building",targetId:"matter_replicator",multiplier:s(2)},{id:"infinite_creation",name:"Infinite Creation",description:"Matter Replicators produce 2x more.",cost:s(664e21),triggerId:"matter_replicator",triggerCount:s(5),type:"building",targetId:"matter_replicator",multiplier:s(2)},{id:"reality_forging",name:"Reality Forging",description:"Matter Replicators produce 2x more.",cost:s(332e22),triggerId:"matter_replicator",triggerCount:s(25),type:"building",targetId:"matter_replicator",multiplier:s(2)},{id:"existence_crafting",name:"Existence Crafting",description:"Matter Replicators produce 2x more.",cost:s(664e22),triggerId:"matter_replicator",triggerCount:s(50),type:"building",targetId:"matter_replicator",multiplier:s(2)},{id:"ultimate_replication",name:"Ultimate Replication",description:"Matter Replicators produce 2x more.",cost:s(332e23),triggerId:"matter_replicator",triggerCount:s(100),type:"building",targetId:"matter_replicator",multiplier:s(2)},{id:"reality_writing",name:"Reality Writing",description:"Architect's Quills produce 2x more.",cost:s(797e21),triggerId:"architect_quill",triggerCount:s(1),type:"building",targetId:"architect_quill",multiplier:s(2)},{id:"existence_coding",name:"Existence Coding",description:"Architect's Quills produce 2x more.",cost:s(399e22),triggerId:"architect_quill",triggerCount:s(1),type:"building",targetId:"architect_quill",multiplier:s(2)},{id:"universe_programming",name:"Universe Programming",description:"Architect's Quills produce 2x more.",cost:s(797e22),triggerId:"architect_quill",triggerCount:s(5),type:"building",targetId:"architect_quill",multiplier:s(2)},{id:"omniverse_scripting",name:"Omniverse Scripting",description:"Architect's Quills produce 2x more.",cost:s(399e23),triggerId:"architect_quill",triggerCount:s(25),type:"building",targetId:"architect_quill",multiplier:s(2)},{id:"reality_development",name:"Reality Development",description:"Architect's Quills produce 2x more.",cost:s(797e23),triggerId:"architect_quill",triggerCount:s(50),type:"building",targetId:"architect_quill",multiplier:s(2)},{id:"ultimate_creation",name:"Ultimate Creation",description:"Architect's Quills produce 2x more.",cost:s(399e24),triggerId:"architect_quill",triggerCount:s(100),type:"building",targetId:"architect_quill",multiplier:s(2)},{id:"golden_touch",name:"Golden Touch",description:"All production x2",cost:s(1e5),type:"global",multiplier:s(2)},{id:"lucky_charm",name:"Lucky Charm",description:"All production x2",cost:s(1e6),type:"global",multiplier:s(2)},{id:"blessing_of_fortune",name:"Blessing of Fortune",description:"All production x2",cost:s(1e7),type:"global",multiplier:s(2)},{id:"cosmic_prosperity",name:"Cosmic Prosperity",description:"All production x2",cost:s(1e8),type:"global",multiplier:s(2)},{id:"divine_abundance",name:"Divine Abundance",description:"All production x2",cost:s(1e9),type:"global",multiplier:s(2)},{id:"infinite_wealth",name:"Infinite Wealth",description:"All production x2",cost:s(1e10),type:"global",multiplier:s(2)},{id:"architects_vision",name:"Architect's Vision",description:"-10% cost of all buildings.",cost:s(1e5),type:"global",multiplier:s(.9)},{id:"kings_decree",name:"King's Decree",description:"Temporary global bonus x3 for 60 seconds.",cost:s(5e5),type:"global",multiplier:s(3)},{id:"royal_engineers_blueprint",name:"Royal Engineer's Blueprint",description:"Auto-buy most efficient buildings.",cost:s(1e6),type:"global",multiplier:s(1)},{id:"time_manipulation",name:"Time Manipulation",description:"Speed up time for 30 seconds.",cost:s(2e6),type:"global",multiplier:s(2)},{id:"combo_master",name:"Combo Master",description:"Multiplier for combo clicks.",cost:s(5e6),type:"click",multiplier:s(1.5)},{id:"critical_strike",name:"Critical Strike",description:"5% chance for critical hit x5.",cost:s(1e7),type:"click",multiplier:s(1.25)},{id:"multi_click",name:"Multi-Click",description:"Click 5 times simultaneously.",cost:s(25e6),type:"click",multiplier:s(5)},{id:"auto_clicker",name:"Auto-Clicker",description:"Automatic clicks (1 per second).",cost:s(5e7),type:"global",multiplier:s(1)},{id:"iron_plough",name:"Iron Plough",description:"Fields produce +50% more.",cost:s(2500),triggerId:"field",triggerCount:s(10),type:"building",targetId:"field",multiplier:s(1.5)},{id:"steel_plough",name:"Steel Plough",description:"Reinforced steel ploughs.",cost:s(15e3),triggerId:"field",triggerCount:s(25),type:"building",targetId:"field",multiplier:s(2)},{id:"magical_irrigation",name:"Magical Irrigation",description:"Magical water systems.",cost:s(1e5),triggerId:"field",triggerCount:s(50),type:"building",targetId:"field",multiplier:s(3)},{id:"seasonal_crops",name:"Seasonal Crops",description:"Crops for all seasons.",cost:s(1e6),triggerId:"field",triggerCount:s(100),type:"building",targetId:"field",multiplier:s(5)},{id:"elemental_fields",name:"Elemental Fields",description:"Fields powered by elements.",cost:s(1e7),triggerId:"field",triggerCount:s(200),type:"building",targetId:"field",multiplier:s(10)},{id:"heavy_anvil",name:"Heavy Anvil",description:"Blacksmiths produce 2x gold.",cost:s(11e3),triggerId:"blacksmith",triggerCount:s(10),type:"building",targetId:"blacksmith",multiplier:s(2)},{id:"better_hammers",name:"Better Hammers",description:"Improved blacksmith tools.",cost:s(5e4),triggerId:"blacksmith",triggerCount:s(25),type:"building",targetId:"blacksmith",multiplier:s(2)},{id:"magical_forge",name:"Magical Forge",description:"Forge powered by magic.",cost:s(1e5),triggerId:"blacksmith",triggerCount:s(50),type:"building",targetId:"blacksmith",multiplier:s(3)},{id:"dragon_fire",name:"Dragon Fire",description:"Dragon-powered forges.",cost:s(1e6),triggerId:"blacksmith",triggerCount:s(100),type:"building",targetId:"blacksmith",multiplier:s(5)},{id:"soul_forging",name:"Soul Forging",description:"Forge items with soul energy.",cost:s(1e7),triggerId:"blacksmith",triggerCount:s(200),type:"building",targetId:"blacksmith",multiplier:s(10)},{id:"divine_smithing",name:"Divine Smithing",description:"Blessed by gods for ultimate forging.",cost:s(1e8),triggerId:"blacksmith",triggerCount:s(400),type:"building",targetId:"blacksmith",multiplier:s(25)},{id:"merchant_guild",name:"Merchant Guild",description:"Markets generate +50% profit.",cost:s(25e3),triggerId:"market",triggerCount:s(15),type:"building",targetId:"market",multiplier:s(1.5)},{id:"trade_routes",name:"Trade Routes",description:"Establish trade routes with other kingdoms.",cost:s(2e5),triggerId:"market",triggerCount:s(25),type:"building",targetId:"market",multiplier:s(2)},{id:"global_trade",name:"Global Trade",description:"Worldwide trading network.",cost:s(2e6),triggerId:"market",triggerCount:s(50),type:"building",targetId:"market",multiplier:s(3)},{id:"intergalactic_commerce",name:"Intergalactic Commerce",description:"Trade with alien civilizations.",cost:s(2e7),triggerId:"market",triggerCount:s(100),type:"building",targetId:"market",multiplier:s(5)},{id:"dimensional_trading",name:"Dimensional Trading",description:"Trade across dimensions.",cost:s(2e8),triggerId:"market",triggerCount:s(200),type:"building",targetId:"market",multiplier:s(10)},{id:"ale_yeast",name:"Imported Yeast",description:"Taverns produce +50% more.",cost:s(45e3),triggerId:"tavern",triggerCount:s(5),type:"building",targetId:"tavern",multiplier:s(1.5)},{id:"golden_gauntlet",name:"Golden Gauntlet",description:"Clicking is 2x more effective.",cost:s(75e3),type:"click",multiplier:s(2)},{id:"thoroughbreds",name:"Thoroughbreds",description:"Stables produce 2x gold.",cost:s(85e3),triggerId:"stable",triggerCount:s(10),type:"building",targetId:"stable",multiplier:s(2)},{id:"tax_collector",name:"Tax Collector",description:"Global production +20%.",cost:s(1e5),type:"global",multiplier:s(1.2)},{id:"central_bank",name:"Central Bank",description:"Centralized banking system.",cost:s(5e5),type:"global",multiplier:s(1.05)},{id:"economic_boom",name:"Economic Boom",description:"Rapid economic growth.",cost:s(2e6),type:"global",multiplier:s(1.1)},{id:"prosperity",name:"Prosperity",description:"Age of prosperity.",cost:s(1e7),type:"global",multiplier:s(1.15)},{id:"golden_age",name:"Golden Age",description:"Golden age of the kingdom.",cost:s(5e7),type:"global",multiplier:s(1.25)},{id:"renaissance",name:"Renaissance",description:"Cultural and scientific rebirth.",cost:s(25e7),type:"global",multiplier:s(1.5)},{id:"industrial_revolution",name:"Industrial Revolution",description:"Mass production begins.",cost:s(1e9),type:"global",multiplier:s(2)},{id:"digital_age",name:"Digital Age",description:"Information technology era.",cost:s(5e9),type:"global",multiplier:s(3)},{id:"space_age",name:"Space Age",description:"Space exploration and colonization.",cost:s(25e9),type:"global",multiplier:s(6)},{id:"quantum_era",name:"Quantum Era",description:"Quantum computing and reality manipulation.",cost:s(1e11),type:"global",multiplier:s(11)},{id:"standing_army",name:"Standing Army",description:"Professional military force.",cost:s(15e4),type:"global",multiplier:s(1.1)},{id:"castle_walls",name:"Castle Walls",description:"Fortified castle defenses.",cost:s(1e6),type:"global",multiplier:s(1.15)},{id:"royal_guard",name:"Royal Guard",description:"Elite royal protection.",cost:s(5e6),type:"global",multiplier:s(1.2)},{id:"elite_forces",name:"Elite Forces",description:"Special forces units.",cost:s(25e6),type:"global",multiplier:s(1.3)},{id:"secret_service",name:"Secret Service",description:"Intelligence and security agency.",cost:s(1e8),type:"global",multiplier:s(1.5)},{id:"guild_charters",name:"Guild Charters",description:"Markets produce 2x gold.",cost:s(12e4),triggerId:"market",triggerCount:s(25),type:"building",targetId:"market",multiplier:s(2)},{id:"war_horses",name:"War Horses",description:"Stables produce +50% more.",cost:s(18e4),triggerId:"stable",triggerCount:s(20),type:"building",targetId:"stable",multiplier:s(1.5)},{id:"mining_safety",name:"Mining Safety",description:"Silver Mines produce 2x gold.",cost:s(45e4),triggerId:"silver_mine",triggerCount:s(5),type:"building",targetId:"silver_mine",multiplier:s(2)},{id:"deep_shafts",name:"Deep Shafts",description:"Silver Mines produce +50% more.",cost:s(6e5),triggerId:"silver_mine",triggerCount:s(10),type:"building",targetId:"silver_mine",multiplier:s(1.5)},{id:"royal_banner",name:"Royal Banner",description:"Global production +15%.",cost:s(12e5),type:"global",multiplier:s(1.15)},{id:"elixir_life",name:"Elixir of Wealth",description:"Alchemists triple their output.",cost:s(2e6),triggerId:"alchemist",triggerCount:s(5),type:"building",targetId:"alchemist",multiplier:s(3)},{id:"stained_glass",name:"Stained Glass",description:"Cathedrals inspire 2x donations.",cost:s(3e6),triggerId:"cathedral",triggerCount:s(5),type:"building",targetId:"cathedral",multiplier:s(2)},{id:"hand_of_midas",name:"Hand of Midas",description:"Clicking is 3x more effective.",cost:s(35e5),type:"click",multiplier:s(3)},{id:"diamond_click",name:"Diamond Touch",description:"Clicking is 5x more effective.",cost:s(1e7),type:"click",multiplier:s(5)},{id:"royal_treasury",name:"Royal Treasury",description:"Grand Palaces produce 2x gold.",cost:s(5e7),triggerId:"palace",triggerCount:s(1),type:"building",targetId:"palace",multiplier:s(2)},{id:"obsidian_walls",name:"Obsidian Walls",description:"Castles produce 3x gold.",cost:s(2e6),triggerId:"castle",triggerCount:s(200),type:"building",targetId:"castle",multiplier:s(3)},{id:"philosopher_stone",name:"Philosopher's Stone",description:"Alchemists produce 5x gold.",cost:s(8e6),triggerId:"alchemist",triggerCount:s(200),type:"building",targetId:"alchemist",multiplier:s(5)},{id:"divine_intervention",name:"Divine Intervention",description:"Cathedrals produce 5x gold.",cost:s(5e7),triggerId:"cathedral",triggerCount:s(250),type:"building",targetId:"cathedral",multiplier:s(5)},{id:"empire_bureaucracy",name:"Imperial Bureaucracy",description:"Global Production x1.5.",cost:s(3e8),triggerId:"peasant",triggerCount:s(1500),type:"global",multiplier:s(1.5)},{id:"void_harvesting",name:"Void Harvesting",description:"Astral Rifts produce x5 energy.",cost:s(2e16),triggerId:"astral_rift",triggerCount:s(10),type:"building",targetId:"astral_rift",multiplier:s(5)},{id:"temporal_batteries",name:"Temporal Batteries",description:"Chronospheres produce x2 Gold.",cost:s(1e23),triggerId:"chronosphere",triggerCount:s(5),type:"building",targetId:"chronosphere",multiplier:s(2)},{id:"reality_weave",name:"Reality Weave",description:"Reality Engines produce x2 Gold.",cost:s(1e26),triggerId:"reality_engine",triggerCount:s(5),type:"building",targetId:"reality_engine",multiplier:s(2)},{id:"army_synergy",name:"Conqueror's Tithe",description:"Global Production +1% for every 1000 Soldiers.",cost:s(1e15),triggerId:"castle",triggerCount:s(100),type:"global",multiplier:s(1)},{id:"achievement_synergy",name:"Hall of Fame",description:"Global Production +5% per Achievement unlocked.",cost:s(1e18),triggerId:"peasant",triggerCount:s(2e3),type:"global",multiplier:s(1)},{id:"click_synergy",name:"Finger of God",description:"Global Production +0.01% per Manual Click (Lifetime).",cost:s(1e20),triggerId:"peasant",triggerCount:s(2500),type:"global",multiplier:s(1)},{id:"legacy_of_kings",name:"Legacy of Kings",description:"Global Production x5 (Permanent)",cost:s(5e3),currency:"renown",type:"global",multiplier:s(5)},{id:"divine_right",name:"Divine Right",description:"Global Production x10 (Permanent)",cost:s(5e4),currency:"renown",type:"global",multiplier:s(10)},{id:"time_dilation",name:"Time Dilation",description:"Global Production x50 (Permanent)",cost:s(5e5),currency:"renown",type:"global",multiplier:s(50)},{id:"omniscience",name:"Omniscience",description:"Global Production x200 (Permanent)",cost:s(5e6),currency:"renown",type:"global",multiplier:s(200)},{id:"reality_bending",name:"Reality Bending",description:"Global Production x1000 (Permanent)",cost:s(5e7),currency:"renown",type:"global",multiplier:s(1e3)},{id:"ascended_knowledge",name:"Ascended Knowledge",description:"Global Production x10,000 (Permanent)",cost:s(5e8),currency:"renown",type:"global",multiplier:s(1e4)},{id:"universal_truth",name:"Universal Truth",description:"Global Production x1,000,000 (Permanent)",cost:s(1e50),currency:"renown",type:"global",multiplier:s(1e6)},{id:"god_mode",name:"Divinity",description:"Global Production x1e9 (Permanent)",cost:s(1e100),currency:"renown",type:"global",multiplier:s(1e9)},{id:"developer_access",name:"Creative Mode",description:"Global Production x1e12 (Permanent)",cost:s(1e150),currency:"renown",type:"global",multiplier:s(1e12)},{id:"the_end",name:"The End",description:"Global Production x1e20 (Permanent)",cost:s(1e200),currency:"renown",type:"global",multiplier:s(1e20)}],Ku=(r,e)=>r.times(s(1.15).pow(e)).floor(),Ft=(r,e,t)=>{const n=s(1.15),i=r.times(n.pow(e)),a=n.pow(t).minus(s(1)),l=n.minus(s(1));return i.times(a).dividedBy(l).floor()},ma=(r,e,t)=>{const n=s(1.15),i=r.times(n.pow(e));if(t.lt(i))return s(0);let a=s(0),l=s(1);for(;Ft(r,e,l).lte(t)&&(l=l.times(s(2)),!l.gt(s(1e9))););for(;l.minus(a).gt(s(1));){const d=a.plus(l).dividedBy(s(2)).floor();Ft(r,e,d).lte(t)?a=d:l=d}return a},Jt=(r,e,t,n,i,a)=>e.map(l=>({id:`${r}_${l}`,name:t(l),description:n(l),icon:i,condition:d=>a(d,l)})),Qu=[1,10,25,50,100,150,200,300,400,500,750,1e3,1500,2e3,3e3,4e3,5e3],Yu=dt.flatMap(r=>Jt(`build_${r.id}`,Qu,e=>`${r.name} Owner ${e}`,e=>`Own ${e} ${r.name}s.`,r.icon,(e,t)=>(e.buildings[r.id]||s(0)).gte(s(t)))),Xu=[10,50,100,500,1e3,2500,5e3,1e4,25e3,5e4,1e5,25e4,5e5,1e6,25e5,5e6],Ju=Jt("clicks",Xu,r=>`Finger Workout ${F(r)}`,r=>`Click manually ${F(r)} times.`,"üëÜ",(r,e)=>r.stats.totalClicks.gte(s(e))),Zu=()=>{const r=[];let e=s(1e3);for(let t=0;t<100;t++)r.push(e.toNumber()),e=e.times(t%2===0?s(5):s(2));return r},ed=Jt("gold",Zu(),r=>`Hoarder ${F(r)}`,r=>`Amass a lifetime total of ${F(r)} gold.`,"üí∞",(r,e)=>r.totalGold.gte(s(e))),td=[10,25,50,100,200,300,400,500,750,1e3,1500,2e3,3e3,4e3,5e3,7500,1e4],rd=Jt("total_builds",td,r=>`Architect ${r}`,r=>`Own ${r} total buildings.`,"üèóÔ∏è",(r,e)=>Object.values(r.buildings).reduce((t,n)=>t.plus(n),s(0)).gte(s(e))),nd=[10,50,100,500,1e3,5e3,1e4,25e3,5e4,1e5,25e4,5e5,1e6,25e5,5e6],id=Jt("soldiers",nd,r=>`Commander ${F(r)}`,r=>`Train a standing army of ${F(r)}.`,"‚öîÔ∏è",(r,e)=>r.soldiers.gte(s(e))),sd=[1,5,10,25,50,100,250,500,1e3,2500,5e3,1e4,25e3,5e4,1e5,5e5,1e6,1e7,1e8,1e10,1e20,1e50,1e100,1e150,1e200,1e250],od=Jt("renown",sd,r=>`Legend ${F(r)}`,r=>`Reach ${F(r)} Renown (Prestige).`,"üëë",(r,e)=>r.renown.gte(s(e))),ad=[1,5,10,20,50,100,200,300,400,500];Jt("dragons",ad,r=>`Slayer ${r}`,r=>`Defeat ${r} Dragons.`,"üêâ",(r,e)=>r.stats.dragonsKilled.gte(s(e)));const ld=[1,10,25,50,100,250,500,1e3,2500,5e3];Jt("gambler",ld,r=>`High Roller ${r}`,r=>`Play ${r} games in the Tavern.`,"üé≤",(r,e)=>r.stats.tavernGamesPlayed.gte(s(e)));const yi=[...Yu,...Ju,...ed,...rd,...id,...od,{id:"cookie_veteran",name:"Cookie Veteran",description:"Global Production +5% for having 1000 total clicks",icon:"üç™",condition:(r,e)=>r.stats.totalClicks.gte(s(1e3))},{id:"production_master",name:"Production Master",description:"Global Production +10% for reaching 1000 Gold per Second",icon:"‚öôÔ∏è",condition:(r,e)=>e.gte(s(1e3))},{id:"speed_baker",name:"Speed Baker",description:"Global Production +3% for buying 100 buildings in one session",icon:"‚ö°",condition:(r,e)=>Object.values(r.buildings).reduce((t,n)=>t.plus(n),s(0)).gte(s(100))},{id:"prestige_novice",name:"Prestige Novice",description:"Global Production +2% for first prestige reset",icon:"üåü",condition:(r,e)=>r.renown.gte(s(1))},{id:"golden_touch",name:"Golden Touch",description:"Click power +10% for unlocking 50 achievements",icon:"‚ú®",condition:(r,e)=>r.achievements.length>=50},{id:"idle_master",name:"Idle Master",description:"Global Production +15% while idle for 10 minutes total",icon:"üò¥",condition:(r,e)=>!1},{id:"combo_master",name:"Combo Master",description:"Global Production +1% per 100 click combo",icon:"üî•",condition:(r,e)=>!1}],Vl=[{id:"royal_feast",name:"Royal Feast",description:"Production x2 for 30s.",duration:s(30),cooldown:s(300),icon:"üçñ",effectType:"production_mult",value:s(2),unlockCondition:r=>(r.buildings.tavern||s(0)).gte(s(1)),unlockDescription:"Build a Tavern"},{id:"call_to_arms",name:"Call to Arms",description:"Click Power x5 for 20s.",duration:s(20),cooldown:s(180),icon:"‚öîÔ∏è",effectType:"click_mult",value:s(5),unlockCondition:r=>(r.buildings.blacksmith||s(0)).gte(s(1)),unlockDescription:"Build a Blacksmith"},{id:"royal_tax_audit",name:"Royal Tax Audit",description:"Instantly collect 600s of production.",duration:s(0),cooldown:s(600),icon:"üìú",effectType:"instant_gold",value:s(600),unlockCondition:r=>(r.buildings.void_portal||s(0)).gt(s(0)),unlockDescription:"Build at least 1 Void Portal"},{id:"emergency_draft",name:"Emergency Draft",description:"Recruit 50 Soldiers instantly.",duration:s(0),cooldown:s(300),icon:"üíÇ",effectType:"add_soldiers",value:s(50),unlockCondition:r=>(r.buildings.peasant||s(0)).gte(s(100)),unlockDescription:"Own 100 Peasants"}],Gs=[{id:"ancient_crown",name:"Ancient Crown",description:"Global Production +50%.",icon:"üëë",globalMultiplier:s(1.5)},{id:"blessed_chalice",name:"Blessed Chalice",description:"Global Production +25%.",icon:"üèÜ",globalMultiplier:s(1.25)},{id:"dragon_scale",name:"Dragon Scale Shield",description:"Global Production +35%.",icon:"üõ°Ô∏è",globalMultiplier:s(1.35)},{id:"lunar_stone",name:"Lunar Stone",description:"Global Production x5.",icon:"üåë",globalMultiplier:s(5)},{id:"solar_flare",name:"Solar Core",description:"Global Production x25.",icon:"‚òÄÔ∏è",globalMultiplier:s(25)},{id:"void_essence",name:"Void Essence",description:"Global Production x100.",icon:"üü£",globalMultiplier:s(100)},{id:"galactic_map",name:"Galactic Map",description:"Global Production x500.",icon:"üó∫Ô∏è",globalMultiplier:s(500)},{id:"reality_shard",name:"Reality Shard",description:"Global Production x10,000.",icon:"üíé",globalMultiplier:s(1e4)}];s(3e4),s(.001),s(2e4),s(5e-4),s(6e4),s(1e-4),s(6e4),s(.002),s(3e4),s(.0015),s(12e4),s(.001),s(9e4),s(8e-4),s(15e3),s(3e-4),s(45e3),s(5e-4),s(13e3),s(4e-4),s(6e4),s(2e-4);const _i=[{id:"goblin_lands",name:"Goblin Lands",description:"Raid goblin camps for treasure.",duration:s(60),soldierCost:s(200),rewardArtifactId:"ancient_crown",icon:"üëπ",baseRisk:s(.25)},{id:"orc_fortress",name:"Orc Fortress",description:"Assault the orc stronghold.",duration:s(300),soldierCost:s(1e3),rewardArtifactId:"blessed_chalice",icon:"üè∞",baseRisk:s(.35)},{id:"dragon_lair",name:"Dragon's Lair",description:"Slay the dragon for riches.",duration:s(1800),soldierCost:s(5e3),rewardArtifactId:"dragon_scale",icon:"üêâ",baseRisk:s(.45)},{id:"demon_portal",name:"Demon Portal",description:"Close the demonic invasion.",duration:s(7200),soldierCost:s(25e3),rewardArtifactId:"lunar_stone",icon:"üî•",baseRisk:s(.55)},{id:"void_invasion",name:"Void Invasion",description:"Defend reality from void creatures.",duration:s(14400),soldierCost:s(1e5),rewardArtifactId:"solar_flare",icon:"üåå",baseRisk:s(.65)},{id:"dimensional_war",name:"Dimensional War",description:"Fight enemies from parallel universes.",duration:s(43200),soldierCost:s(1e8),requiredUnits:{paladin:s(1e3),void_sentinel:s(20)},rewardArtifactId:"galactic_map",icon:"üåÄ",baseRisk:s(.75)},{id:"reality_defense",name:"Reality Defense",description:"Protect fabric of existence itself.",duration:s(86400),soldierCost:s(2e9),requiredUnits:{void_sentinel:s(200)},rewardArtifactId:"reality_shard",icon:"üõ°Ô∏è",baseRisk:s(.85)}],jl=[{id:"treasurer",name:"Royal Treasurer",description:"Auto-clicks once every 5 seconds. Can be upgraded.",cost:s(12),icon:"üí∞"},{id:"warmaster",name:"Warmaster",description:"Crusades are 25% faster and 30% safer. Can be upgraded.",cost:s(50),icon:"‚öîÔ∏è"},{id:"guildmaster",name:"Guildmaster",description:"Markets produce +50% profit. Can be upgraded.",cost:s(100),icon:"ÔøΩ"},{id:"alchemist",name:"Alchemist",description:"Transmuting lead into gold. Can be upgraded.",cost:s(200),icon:"‚öóÔ∏è"},{id:"engineer",name:"Royal Engineer",description:"Auto-purchases most efficient building every 10 seconds.",cost:s(500),icon:"‚öôÔ∏è"},{id:"merchant",name:"Royal Merchant",description:"Auto-sells excess resources for gold every 15 seconds.",cost:s(1e3),icon:"üí±"},{id:"chronomancer",name:"Chronomancer",description:"Reduces all cooldowns by 50%. Can be upgraded.",cost:s(2500),icon:"‚è∞"},{id:"void_scholar",name:"Void Scholar",description:"Increases Renown gain by 20%. Can be upgraded.",cost:s(25e3),icon:"üìö"},{id:"cosmic_mage",name:"Cosmic Mage",description:"All production bonuses increased by 15%. Can be upgraded.",cost:s(25e4),icon:"üîÆ"},{id:"time_keeper",name:"Time Keeper",description:"Decree cooldowns are 50% shorter. Can be upgraded.",cost:s(25e7),icon:"‚è≥"}],Ml=(r,e)=>r.cost.times(s(2.5).pow(e)),Lt=(r,e)=>{const n={treasurer:s(1),warmaster:s(.25),guildmaster:s(.1),alchemist:s(1),chronomancer:s(.25),void_scholar:s(.2),cosmic_mage:s(.15),time_keeper:s(.5)}[r]||s(1),i=r==="void_scholar"?s(1.2).pow(e):s(1.2).pow(e.minus(s(1)));return n.times(i)};s(10),s(25),s(50),s(100),s(250),s(500);const vi=[{id:"local_villages",name:"Local Villages",description:"Safe, quick trade with neighbors.",baseDuration:s(300),risk:s(.25),maxInvestment:s(1e6),rewardMultiplier:s(1.5),icon:"üèòÔ∏è"},{id:"iron_dwarves",name:"Iron Mountain Dwarves",description:"High risk, high reward trade for precious metals.",baseDuration:s(1800),risk:s(.55),maxInvestment:s(1e9),rewardMultiplier:s(3),icon:"‚öíÔ∏è"},{id:"high_elves",name:"High Elven Spires",description:"Long expeditions for magical artifacts.",baseDuration:s(7200),risk:s(.75),maxInvestment:s(1e18),rewardMultiplier:s(10),icon:"üßù"},{id:"void_traders",name:"Void Walkers",description:"Inter-dimensional trade. Extreme danger.",baseDuration:s(21600),risk:s(.95),maxInvestment:s(1e18),rewardMultiplier:s(100),icon:"üåÄ"}],Ll=[{id:"great_pyramid",name:"The Golden Pyramid",description:"A monument to eternal wealth.",icon:"üî∫",bonusDescription:"Trade Routes are 50% safer and 2x faster.",stages:[{name:"Foundation",description:"Lay base of massive structure.",cost:[{type:"gold",amount:s(5e17)},{type:"soldiers",amount:s(25e3)}]},{name:"Structure",description:"Build limestone walls.",cost:[{type:"gold",amount:s(5e17)},{type:"soldiers",amount:s(1e5)},{type:"knight",amount:s(500)}]},{name:"Capstone",description:"Place golden capstone.",cost:[{type:"gold",amount:s(5e17)},{type:"paladin",amount:s(250)},{type:"renown",amount:s(500)}]}]},{id:"sky_citadel",name:"Sky Citadel",description:"A floating fortress to rule the skies.",icon:"‚òÅÔ∏è",bonusDescription:"Global Production x100 (Permanent).",stages:[{name:"Anti-Gravity Base",description:"Enchant earth to float.",cost:[{type:"gold",amount:s(5e17)},{type:"soldiers",amount:s(5e17)}]},{name:"Cloud Towers",description:"Construct towers that pierce heavens.",cost:[{type:"gold",amount:s(5e17)},{type:"paladin",amount:s(2500)}]},{name:"Storm Core",description:"Harness lightning to power city.",cost:[{type:"gold",amount:s(5e17)},{type:"void_sentinel",amount:s(50)},{type:"renown",amount:s(5e17)}]}]},{id:"void_gate",name:"Gate of Oblivion",description:"A portal to the source of all magic.",icon:"üåå",bonusDescription:"Offline Gains 100%.",stages:[{name:"Rift Stabilizer",description:"Prevent reality from collapsing.",cost:[{type:"gold",amount:s(5e17)},{type:"void_sentinel",amount:s(500)}]},{name:"Event Horizon",description:"Expand tear in space-time.",cost:[{type:"gold",amount:s(5e17)},{type:"renown",amount:s(5e17)}]},{name:"Void Anchor",description:"Bind void to your will.",cost:[{type:"gold",amount:s(5e17)},{type:"void_sentinel",amount:s(5e3)},{type:"renown",amount:s(5e17)}]}]}],ds=100,cd=({gameState:r,building:e,x:t,y:n,visible:i,onHide:a})=>{const l=W.useRef(null),[d,m]=W.useState({x:0,y:0});if(W.useEffect(()=>{if(!i||!l.current)return;const L=l.current.getBoundingClientRect();let U=t+15,G=n-L.height/2;U+L.width>window.innerWidth&&(U=t-L.width-15),G<10&&(G=10),G+L.height>window.innerHeight-10&&(G=window.innerHeight-L.height-10),m({x:U,y:G})},[i,t,n]),!i||!e)return null;const g=r.buildings[e.id]||s(0),f=Ol(r,e),_=f.times(g),w=dd(r),k=w.gt(0)?_.div(w).times(100):s(0),B=hd(e.baseCost,g),q=B.gt(0)?f.div(B):s(0),S=q.gt(0)?B.div(f):s(0);return c.jsxs("div",{ref:l,className:"advanced-tooltip",style:{position:"fixed",left:`${d.x}px`,top:`${d.y}px`,background:"var(--panel-bg)",color:"var(--text-color)",padding:"12px",borderRadius:"6px",border:"1px solid var(--border-color)",fontSize:"13px",lineHeight:"1.4",width:"280px",minWidth:"280px",zIndex:1e4,boxShadow:"0 3px 12px rgba(0,0,0,0.25)",pointerEvents:"none",transition:"all 0.15s ease"},onMouseLeave:a,children:[c.jsxs("div",{style:{fontWeight:"bold",fontSize:"16px",marginBottom:"8px",color:"var(--accent-color)"},children:[e.icon," ",e.name]}),c.jsxs("div",{style:{marginBottom:"6px"},children:[c.jsxs("div",{style:{color:"var(--success-color)",fontWeight:"bold",fontSize:"13px"},children:["Count: ",F(g,r.numberFormat)]}),c.jsxs("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:["Each: ",F(f,r.numberFormat),"/s"]}),c.jsxs("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:["Total: ",F(_,r.numberFormat),"/s"]})]}),c.jsx("div",{style:{marginBottom:"6px",padding:"4px",background:"rgba(76, 175, 80, 0.1)",borderRadius:"4px",border:"1px solid var(--success-color)"},children:c.jsxs("div",{style:{fontWeight:"bold",color:"var(--success-color)",fontSize:"12px"},children:["üìä ",F(k,r.numberFormat),"% of total income"]})}),c.jsxs("div",{style:{marginBottom:"6px"},children:[c.jsx("div",{style:{fontWeight:"bold",color:"var(--accent-color)",fontSize:"12px",marginBottom:"2px"},children:"üí∞ Economy"}),c.jsxs("div",{style:{fontSize:"11px",color:"var(--text-secondary)"},children:["Next: ",F(B,r.numberFormat)," gold"]}),c.jsxs("div",{style:{fontSize:"11px",color:"var(--text-secondary)"},children:["Payoff: ",md(S)]}),c.jsxs("div",{style:{fontSize:"11px",color:"var(--text-secondary)"},children:["Efficiency: ",F(q.times(100),r.numberFormat)," gold/s per gold"]})]}),c.jsx("div",{style:{fontSize:"11px",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"8px",borderTop:"1px solid var(--border-color)",paddingTop:"6px"},children:e.description})]})};function Ol(r,e){var _;let t=e.baseProduction;const n=((_=r.weather)==null?void 0:_.current)||"clear";n==="sunny"&&(e.id==="peasant"||e.id==="field")||n==="rainy"&&(e.id==="silver_mine"||e.id==="alchemist")?t=t.times(s(1.2)):n==="stormy"?(e.id==="blacksmith"&&(t=t.times(s(1.3))),e.id==="field"&&(t=t.times(s(.8)))):n==="windy"&&e.id==="market"&&(t=t.times(s(1.15)));const i=Xe.filter(w=>w.type==="building"&&w.targetId===e.id&&r.upgrades.includes(w.id));let a=s(1);i.forEach(w=>{a=a.times(w.multiplier||s(2))}),t=t.times(a);const l=Xe.filter(w=>w.type==="global"&&r.upgrades.includes(w.id));let d=s(1);l.forEach(w=>{d=d.times(w.multiplier||s(2))}),t=t.times(d);const m=dr(r.renown);t=t.times(m);const g=ud(r.artifacts);t=t.times(g);let f=s(1);return(r.activeDecrees.royal_feast||s(0)).gt(s(Date.now()))&&(f=f.times(s(2))),(r.activeDecrees.call_to_arms||s(0)).gt(s(Date.now()))&&(f=f.times(s(5))),t=t.times(f),t}function dr(r){const e=r.toNumber();if(e<=0)return s(1);let t=s(1);e<=100?t=s(1+e*.01):e<=1e3?t=s(2).plus(s(e-100).times(s(.005))):e<=1e4?t=s(2.5).plus(s(e-1e3).times(s(.001))):t=s(10).plus(s(10).times(Math.log10(e)));const n=s(1e3);return Je.min(t,n)}function ud(r){let e=s(1);return r.includes("golden_cookie")&&(e=e.times(s(2))),r.includes("ancient_tablet")&&(e=e.times(s(1.5))),e}function dd(r){let e=s(0);return dt.forEach(t=>{const n=r.buildings[t.id]||s(0);if(n.gt(0)){const i=Ol(r,t);e=e.plus(i.times(n))}}),e}function hd(r,e){return r.times(s(1.15).pow(e)).floor()}function md(r){return r.lte(0)?"Instant":r.lt(60)?`${Math.floor(r.toNumber())}s`:r.lt(3600)?`${Math.floor(r.div(60).toNumber())}m`:r.lt(86400)?`${Math.floor(r.div(3600).toNumber())}h`:`${Math.floor(r.div(86400).toNumber())}d`}const bi=(r,e=!1,t=!1,n=!1)=>({display:"flex",alignItems:"center",padding:"var(--panel-padding)",background:t?"rgba(0,0,0,0.05)":e?"rgba(46, 125, 50, 0.1)":n?"#f3e5f5":"var(--panel-bg)",border:"1px solid",borderColor:t?"rgba(0,0,0,0.2)":n?"#7b1fa2":r?"var(--accent-color)":"rgba(0,0,0,0.1)",borderRadius:"2px",cursor:r&&!t?"pointer":"default",opacity:r&&!t||e?1:.7,transition:"all 0.2s",boxShadow:r&&!t?"2px 2px 0 rgba(0,0,0,0.1)":"none",position:"relative",userSelect:"none",marginBottom:"var(--gap-size)",filter:t?"grayscale(1)":"none"}),Cn={display:"flex",flexDirection:"column",gap:"var(--gap-size)",height:"100%",overflowY:"auto",padding:"var(--panel-padding)"},ga=({gameState:r,onBuyUpgrade:e})=>{const t=Xe.filter(n=>!(r.upgrades.includes(n.id)||n.type==="building"&&n.targetId&&(r.buildings[n.targetId]||s(0)).lt(s(1))||n.triggerId&&(r.buildings[n.triggerId]||s(0)).lt(n.triggerCount||s(0))||n.currency==="renown"&&r.renown.lt(n.cost.times(s(.1)))));return t.length===0?c.jsxs("div",{style:{...Cn,justifyContent:"center",alignItems:"center",color:"var(--text-secondary)"},children:[c.jsx("div",{children:"No upgrades available yet."}),c.jsx("div",{style:{fontSize:"0.8rem",marginTop:"5px"},children:"Build more structures to unlock new technologies!"})]}):(t.sort((n,i)=>n.currency==="renown"&&i.currency!=="renown"?-1:n.currency!=="renown"&&i.currency==="renown"?1:n.cost.cmp(i.cost)),c.jsx("div",{style:Cn,children:t.map(n=>{const i=n.currency==="renown",a=i?r.renown.gte(n.cost):r.gold.gte(n.cost);return c.jsxs("div",{style:bi(a,!1,!1,i),onClick:()=>a&&e(n.id),"data-tooltip":`${n.name}: ${n.description}`,children:[c.jsx("div",{style:{fontSize:"1.4rem",marginRight:"15px",width:"30px",textAlign:"center"},children:""}),c.jsxs("div",{style:{flex:1},children:[c.jsx("div",{style:{fontWeight:"bold",color:i?"var(--accent-color)":"var(--text-color)"},children:n.name}),c.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:n.description})]}),c.jsxs("div",{style:{textAlign:"right",fontWeight:"bold",color:a?"var(--accent-color)":"var(--text-secondary)"},children:[F(n.cost,r.numberFormat)," ",i?"":"G"]})]},n.id)})}))},pa=({gameState:r,onBuyBuilding:e,onSellBuilding:t,onSetBuyAmount:n})=>{var S;const[i,a]=W.useState({visible:!1,x:0,y:0,building:null}),l=r.advisors.includes("guildmaster"),d=s(l?.9:1),m=((S=r.interface)==null?void 0:S.lastBuyAmount)||s(1),[g,f]=W.useState(!1),[_,w]=W.useState(1);W.useEffect(()=>{const N=G=>{G.ctrlKey?w(10):G.shiftKey?w(100):w(1)},L=G=>N(G),U=G=>N(G);return window.addEventListener("keydown",L),window.addEventListener("keyup",U),()=>{window.removeEventListener("keydown",L),window.removeEventListener("keyup",U)}},[]);const k=(N,L)=>{const U=N.currentTarget.getBoundingClientRect();a({visible:!0,x:U.right,y:U.top+U.height/2,building:L})},B=()=>{a({visible:!1,x:0,y:0,building:null})},q=(N,L)=>{var x;let U=L;const G=((x=r.weather)==null?void 0:x.current)||"clear";G==="sunny"&&(N==="peasant"||N==="field")||G==="rainy"&&(N==="silver_mine"||N==="alchemist")?U=U.times(s(1.2)):G==="stormy"?(N==="blacksmith"&&(U=U.times(s(1.3))),N==="field"&&(U=U.times(s(.8)))):G==="windy"&&N==="market"&&(U=U.times(s(1.15)));let Z=s(0);Xe.forEach(T=>{r.upgrades.includes(T.id)&&T.type==="building"&&T.targetId===N&&T.multiplier&&(Z=Z.plus(L.times(T.multiplier.minus(s(1)))))});let J=U.plus(Z),I=s(1);Xe.forEach(T=>{r.upgrades.includes(T.id)&&T.type==="global"&&T.multiplier&&(I=I.times(T.multiplier))}),r.artifacts.forEach(T=>{const b=Gs.find(E=>E.id===T);b&&(I=I.times(b.globalMultiplier))});const v=dr(r.renown);return I=I.times(v),(r.activeDecrees.royal_feast||s(0)).gt(s(Date.now()))&&(I=I.times(s(2))),N==="astral_rift"&&(r.upgrades.includes("void_harvesting")&&(I=I.times(s(10))),r.upgrades.includes("singularity")&&(I=I.times(s(5)))),J.times(I)};return c.jsxs("div",{style:Cn,children:[c.jsx("div",{style:{display:"flex",gap:"5px",marginBottom:"10px",justifyContent:"center"},children:[s(1),s(10),s(100),s(500),s(1e3),s(-1)].map(N=>c.jsx("button",{onClick:()=>n(N),style:{padding:"5px 10px",border:"1px solid var(--accent-color)",background:m.equals(N)?"var(--accent-color)":"var(--panel-bg)",color:m.equals(N)?"var(--text-on-accent)":"var(--text-color)",cursor:"pointer",fontWeight:"bold",fontSize:"0.8rem"},children:N.equals(s(-1))?"Max":`${N.toString()}`},`amount-${N.toString()}`))}),c.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center"},children:"Hold Ctrl: x10 ‚Ä¢ Hold Shift: x100"}),c.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"10px",justifyContent:"center"},children:[c.jsx("button",{className:"btn",style:{background:g?"var(--panel-bg)":"var(--accent-color)",color:g?"var(--text-color)":"var(--text-on-accent)",border:"1px solid var(--accent-color)",padding:"5px 15px",fontSize:"0.8rem"},onClick:()=>f(!1),children:"üõí Buy Mode"}),c.jsx("button",{className:"btn",style:{background:g?"#e65100":"var(--panel-bg)",color:g?"var(--text-on-accent)":"var(--text-color)",border:"1px solid #e65100",padding:"5px 15px",fontSize:"0.8rem"},onClick:()=>f(!0),children:"üí∞ Sell Mode (25%)"})]}),c.jsxs("h3",{style:{fontSize:"1rem",color:"var(--text-secondary)",fontWeight:"bold",borderBottom:"1px solid var(--border-color)",paddingBottom:"5px"},children:["Estates ",l&&c.jsx("span",{style:{color:"var(--success-color)",fontSize:"0.8rem"},children:"(Guildmaster Discount Active)"})]}),dt.map((N,L)=>{if(L>0){const b=dt[L-1].id,E=r.buildings[b]||s(0),y=r.buildings[N.id]||s(0);if(["quantum_computer","multiverse_nexus","dyson_sphere","matter_replicator","architect_quill"].includes(N.id)){if(r.prestigeCount<3&&y.eq(s(0)))return null}else if(N.id==="astral_rift"){if(E.lt(s(100))&&y.eq(s(0)))return null}else if(L>dt.findIndex(he=>he.id==="astral_rift")){if(E.lt(s(20))&&y.eq(s(0)))return null}else if(E.lt(s(10))&&y.eq(s(0)))return null}const U=r.buildings[N.id]||s(0);if(g){if(U.eq(s(0)))return null;let b;m.equals(s(-1))?b=U:(b=m.times(_),b.gt(U)&&(b=U));const E=Ft(N.baseCost,U.minus(b),b).times(s(.25)).floor();return q(N.id,N.baseProduction),`${F(b,r.numberFormat)}${N.name}${F(E,r.numberFormat)}`,c.jsxs("div",{style:bi(!0,!1,!1,!1),onClick:()=>t(N.id,b.toNumber()),onMouseEnter:y=>k(y,N),onMouseLeave:B,children:[c.jsx("div",{style:{fontSize:"2rem",marginRight:"15px",width:"40px",textAlign:"center"},children:N.icon}),c.jsx("div",{style:{flex:1},children:c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[c.jsx("span",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"var(--text-color)"},children:N.name}),c.jsx("span",{style:{fontSize:"1.4rem",fontWeight:"bold",color:"var(--accent-color)"},children:F(U,r.numberFormat)})]})}),c.jsxs("div",{style:{marginLeft:"12px",minWidth:"70px",textAlign:"right"},children:[c.jsxs("div",{style:{color:"var(--accent-color)",fontWeight:"bold"},children:["+",F(E,r.numberFormat)]}),c.jsxs("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)"},children:["for ",F(b,r.numberFormat)]})]})]},N.id)}let G=s(0),Z=s(0);m.equals(s(-1))?(G=ma(N.baseCost,U,r.gold.div(d)),G.eq(s(0))?(G=s(1),Z=Ku(N.baseCost,U).times(d).floor()):Z=Ft(N.baseCost,U,G).times(d).floor()):(G=m,Z=Ft(N.baseCost,U,G).times(d).floor());const J=r.gold.gte(Z),I=m.equals(s(-1))&&ma(N.baseCost,U,r.gold.div(d)).eq(s(0));q(N.id,N.baseProduction);let v=G,x=Z,T=J;return m.equals(s(-1))||(v=G.times(_),x=Ft(N.baseCost,U,v).times(d).floor(),T=r.gold.gte(x)),c.jsxs("div",{style:bi(T&&!I),onClick:()=>{if(!(T&&!I))return;const b=m.equals(s(-1))?G:v;e(N.id,b.toNumber())},onMouseEnter:b=>k(b,N),onMouseLeave:B,children:[c.jsx("div",{style:{fontSize:"2rem",marginRight:"15px",width:"40px",textAlign:"center"},children:N.icon}),c.jsx("div",{style:{flex:1},children:c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[c.jsx("span",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"var(--text-color)"},children:N.name}),c.jsx("span",{style:{fontSize:"1.4rem",fontWeight:"bold",color:"var(--accent-color)"},children:F(U,r.numberFormat)})]})}),c.jsxs("div",{style:{marginLeft:"12px",minWidth:"70px",textAlign:"right"},children:[c.jsx("div",{style:{color:T&&!I?"var(--gold-color)":"var(--text-secondary)",fontWeight:"bold"},children:F(m.equals(s(-1))?Z:x,r.numberFormat)}),!m.equals(s(-1))&&c.jsxs("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)"},children:["for ",F(v,r.numberFormat)," (",F(v.times(N.baseProduction),r.numberFormat),"/s) for ",F(v,r.numberFormat)]})]})]},N.id)}),c.jsx(cd,{gameState:r,building:i.building,x:i.x,y:i.y,visible:i.visible,onHide:B})]})},fa=({gameState:r,onActivateDecree:e})=>{const[t,n]=W.useState(Date.now());return W.useEffect(()=>{const i=setInterval(()=>n(Date.now()),1e3);return()=>clearInterval(i)},[]),c.jsxs("div",{style:Cn,children:[c.jsx("div",{style:{marginBottom:"10px",fontSize:"0.9rem",fontStyle:"italic",color:"var(--text-secondary)"},children:"Issue Royal Decrees to boost your kingdom."}),Vl.map(i=>{const a=s(t),l=r.activeDecrees[i.id]||s(0),d=r.decreeCooldowns[i.id]||s(0),m=i.unlockCondition?!i.unlockCondition(r):!1,g=l.gt(a),f=d.gt(a),_=!g&&!f&&!m;let w="Ready";return m?w="LOCKED":g?w="Active: "+l.minus(a).dividedBy(s(1e3)).ceil().toString()+"s":f&&(w="Wait: "+d.minus(a).dividedBy(s(1e3)).ceil().toString()+"s"),c.jsxs("div",{style:bi(_,g,m),onClick:()=>_&&e(i.id),"data-tooltip":m?`LOCKED: ${i.unlockDescription}`:`${i.name}: ${i.description}`,children:[c.jsx("div",{style:{fontSize:"1.8rem",marginRight:"15px"},children:m?"":i.icon}),c.jsxs("div",{style:{flex:1},children:[c.jsx("div",{style:{fontWeight:"bold",color:m?"var(--text-secondary)":"var(--text-color)"},children:i.name}),c.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:i.description}),m&&c.jsxs("div",{style:{fontSize:"0.85rem",color:r.theme==="royal_dawn"?"#555555":"#ffffff",marginTop:"2px",fontWeight:"bold"},children:["Requirement: ",i.unlockDescription]})]}),c.jsx("div",{style:{textAlign:"right",fontWeight:"bold",color:_?"var(--success-color)":g?"blue":m?"var(--text-secondary)":"var(--danger-color)",minWidth:"80px"},children:w})]},i.id)})]})},ya=({gameState:r,onTrainSoldier:e,onTrainElite:t})=>{const n=(r.buildings.castle||s(0)).gt(s(0)),[i,a]=W.useState(1);return W.useEffect(()=>{const l=g=>{g.ctrlKey?a(10):g.shiftKey?a(100):a(1)},d=g=>l(g),m=g=>l(g);return window.addEventListener("keydown",d),window.addEventListener("keyup",m),()=>{window.removeEventListener("keydown",d),window.removeEventListener("keyup",m)}},[]),c.jsxs("div",{style:Cn,children:[c.jsxs("div",{style:{padding:"15px",background:"var(--panel-bg)",borderRadius:"4px",marginBottom:"10px",border:"1px solid var(--border-color)"},children:[c.jsx("div",{style:{fontSize:"1.2rem",fontWeight:"bold",marginBottom:"5px",color:"var(--text-color)"},children:" Royal Army"}),c.jsx("div",{style:{fontSize:"2rem",color:"var(--text-color)"},children:F(r.soldiers,r.numberFormat)}),c.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Basic Soldiers Ready"})]}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",marginBottom:"20px"},children:[c.jsxs("button",{className:"btn",disabled:r.gold.lt(Be.times(s(1*i))),onClick:()=>{e(1*i)},"data-tooltip":`Train 1 soldier - Cost: ${F(Be.times(s(1*i)),r.numberFormat)} Gold`,children:["Train ",i>1?`${1*i}`:"1"," (",F(Be.times(s(1*i)),r.numberFormat)," G)"]}),c.jsxs("button",{className:"btn",disabled:r.gold.lt(Be.times(s(10*i))),onClick:()=>{e(10*i)},"data-tooltip":`Train 10 soldiers - Cost: ${F(Be.times(s(10*i)),r.numberFormat)} Gold`,children:["Train ",i>1?`${10*i}`:"10"," (",F(Be.times(s(10*i)),r.numberFormat)," G)"]}),c.jsxs("button",{className:"btn",disabled:r.gold.lt(Be.times(s(100*i))),onClick:()=>{e(100*i)},"data-tooltip":`Train 1M soldiers - Cost: ${F(Be.times(s(100*i)),r.numberFormat)} Gold`,children:["Train ",i>1?`${100*i}`:"100"," (",F(Be.times(s(100*i)),r.numberFormat)," G)"]}),c.jsxs("button",{className:"btn",disabled:r.gold.lt(Be.times(s(1e3*i))),onClick:()=>{e(1e3*i)},"data-tooltip":`Train 1M soldiers - Cost: ${F(Be.times(s(1e3*i)),r.numberFormat)} Gold`,children:["Train ",i>1?`${1e3*i/1e3}K`:"1K"," (",F(Be.times(s(1e3*i)),r.numberFormat)," G)"]}),c.jsxs("button",{className:"btn",disabled:r.gold.lt(Be.times(s(1e6*i))),onClick:()=>{e(1e6*i)},"data-tooltip":`Train 10M soldiers - Cost: ${F(Be.times(s(1e6*i)),r.numberFormat)} Gold`,children:["Train ",i>1?`${1e6*i/1e6}M`:"1M"," (",F(Be.times(s(1e6*i)),r.numberFormat)," G)"]})]}),c.jsxs("div",{style:{borderTop:"2px solid var(--border-color)",paddingTop:"15px"},children:[c.jsxs("h3",{style:{fontSize:"1rem",color:"var(--accent-color)",fontWeight:"bold",marginBottom:"10px"},children:["Royal Academy ",c.jsx("span",{style:{fontSize:"0.8rem",fontWeight:"normal",color:"var(--text-secondary)"},children:"(Convert Soldiers)"})]}),fi.map(l=>{const d=r.eliteUnits[l.id]||s(0),m=s(i),g=l.goldCost.times(m),f=l.soldierCost.times(m),_=r.gold.gte(g)&&r.soldiers.gte(f);return c.jsxs("div",{style:{marginBottom:"10px",padding:"10px",background:"var(--panel-bg)",border:"1px solid var(--border-color)",borderRadius:"4px",display:"flex",alignItems:"center",gap:"10px"},children:[c.jsx("div",{style:{fontSize:"2rem"},children:l.icon}),c.jsxs("div",{style:{flex:1},children:[c.jsxs("div",{style:{fontWeight:"bold",color:"var(--text-color)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[c.jsxs("span",{children:[l.name," ",c.jsxs("span",{style:{color:"var(--text-secondary)"},children:["x",F(d,r.numberFormat)]})]}),c.jsxs("button",{className:"btn",style:{padding:"5px 10px",fontSize:"0.8rem"},disabled:!_,onClick:()=>t(l.id,i),onMouseEnter:w=>{_||(w.currentTarget.style.cursor="not-allowed")},onMouseLeave:w=>{w.currentTarget.style.cursor="pointer"},children:["Train ",i>1?`x${i}`:""]})]}),c.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"4px"},children:l.description}),c.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"2px"},children:["Requires ",F(g,r.numberFormat)," Gold and ",F(f,r.numberFormat)," Soldiers"]})]})]},l.id)})]}),c.jsxs("div",{style:{marginTop:"20px",padding:"15px",background:"var(--panel-bg)",border:"1px solid var(--border-color)",borderRadius:"4px"},children:[c.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px",color:n?"var(--success-color)":"var(--danger-color)"},children:n?"‚úÖ Orders Received":"‚ö†Ô∏è Requirements Missing"}),c.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:n?"Send your army on Crusades via the 'Conquest' menu. Elite units are required for high-level dimensions.":"You have soldiers, but no headquarters! You must build a **Castle** to command your troops."})]})]})},_a=({gameState:r,gps:e,onClick:t,onEventInteract:n,onOpenConquest:i,onOpenTavern:a,onOpenPrestige:l,onOpenSettings:d,onOpenCouncil:m,onOpenStatistics:g,onOpenLeaderboard:f,onOpenEmpire:_,isIdle:w})=>{var I,v,x,T;const[k,B]=W.useState([]),q=W.useRef(null),S=r.interface||{showFloatingText:!0,showWeatherWidget:!0},N=b=>{var E;if(S.showFloatingText){const y=(E=q.current)==null?void 0:E.getBoundingClientRect();if(y){const te=b.clientX-y.left+(Math.random()*40-20),he=b.clientY-y.top+(Math.random()*40-20);let be=s(1);Xe.filter(Ae=>Ae.type==="click"&&r.upgrades.includes(Ae.id)).forEach(Ae=>{Ae.multiplier&&(be=be.times(Ae.multiplier))}),(r.activeDecrees.call_to_arms||s(0)).gt(s(Date.now()))&&(be=be.times(s(5))),be=be.times(dr(r.renown));const Qe="+"+F(be,r.numberFormat),Fe={id:Date.now(),x:te,y:he,val:Qe};B(Ae=>[...Ae,Fe]),setTimeout(()=>{B(Ae=>Ae.filter(yt=>yt.id!==Fe.id))},1e3)}}t(b)},L=Nl[((I=r.weather)==null?void 0:I.current)||"clear"],U={transition:"all 0.8s ease-in-out"},G=w?{position:"fixed",bottom:"120px",right:"30px",transform:"scale(0.8)",transformOrigin:"bottom right",textAlign:"right",zIndex:100,...U}:{transform:"scale(1)",marginBottom:"3rem",zIndex:10,textAlign:"center",...U},Z=w?{width:"80px",height:"80px",fontSize:"2rem",position:"fixed",bottom:"30px",right:"30px",borderRadius:"50%",border:"4px solid #b8860b",background:"radial-gradient(circle, #ffd700 0%, #daa520 100%)",boxShadow:"0 0 0 2px #8b4513, 0 5px 10px rgba(0,0,0,0.3)",zIndex:100,transform:"rotate(-10deg)",...U}:{width:"260px",height:"260px",fontSize:"6rem",borderRadius:"50%",border:"8px solid #b8860b",background:"radial-gradient(circle, #ffd700 0%, #daa520 100%)",boxShadow:"0 0 0 4px #8b4513, 0 10px 20px rgba(0,0,0,0.3)",position:"relative",transform:"rotate(0deg)",zIndex:5,...U},J={opacity:w?0:1,transition:"opacity 0.5s ease-in-out",pointerEvents:w?"none":"auto"};return c.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",padding:"var(--panel-padding)",height:"100%",overflow:"hidden"},children:[S.showWeatherWidget&&c.jsxs("div",{style:{position:"absolute",top:"10px",left:"10px",zIndex:20,background:L.color,padding:"8px 12px",borderRadius:"20px",border:"2px solid rgba(0,0,0,0.1)",boxShadow:"2px 2px 5px rgba(0,0,0,0.1)",display:"flex",alignItems:"center",gap:"8px",cursor:"help",...J},"data-tooltip":`${L.name}: ${L.description}`,children:[c.jsx("span",{style:{fontSize:"1.5rem"},children:L.icon}),c.jsxs("div",{style:{textAlign:"left",lineHeight:"1.1"},children:[c.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem",color:"#222"},children:L.name}),c.jsxs("div",{style:{fontSize:"0.7rem",color:"#444"},children:[s(Number(((v=r.weather)==null?void 0:v.timeLeft)||0)).ceil().toString(),"s remaining"]})]})]}),c.jsxs("div",{style:{position:"absolute",top:"10px",right:"10px",zIndex:20,display:"flex",gap:"5px",...J},children:[c.jsx("button",{onClick:f,style:{background:"transparent",border:"none",fontSize:"1.5rem",cursor:"pointer",opacity:.8,color:"var(--text-color)",transition:"all 0.2s ease"},title:"Leaderboard (Available for all players)",onMouseEnter:b=>{b.currentTarget.style.opacity="1",b.currentTarget.style.transform="scale(1.1)"},onMouseLeave:b=>{b.currentTarget.style.opacity="0.8",b.currentTarget.style.transform="scale(1)"},children:"üèÜ"}),c.jsx("button",{onClick:g,style:{background:"transparent",border:"none",fontSize:"1.5rem",cursor:"pointer",opacity:.7,color:"var(--text-color)"},title:"Statistics",children:"üìä"}),c.jsx("button",{onClick:d,style:{background:"transparent",border:"none",fontSize:"1.5rem",cursor:"pointer",opacity:.7,color:"var(--text-color)"},title:"Kingdom Settings",children:"‚öôÔ∏è"})]}),c.jsxs("div",{style:G,children:[c.jsx("div",{style:{fontSize:"1rem",color:w?"var(--text-color)":"var(--text-secondary)",marginBottom:"5px",textTransform:"uppercase",letterSpacing:"2px",textShadow:w?"1px 1px 2px #000":"none"},children:"Royal Treasury"}),c.jsx("div",{style:{fontSize:"3rem",fontFamily:"var(--font-main)",color:"var(--text-color)",textShadow:w?"2px 2px 4px #000":"2px 2px 0px rgba(255, 215, 0, 0.4)"},children:F(r.gold,r.numberFormat)}),c.jsxs("div",{style:{marginTop:"5px",fontSize:"1.1rem",color:w?"#90ee90":"var(--success-color)",fontStyle:"italic",textShadow:w?"1px 1px 2px #000":"none"},children:["+",F(e,r.numberFormat)," gold / sec"]}),c.jsxs("div",{style:{marginTop:"15px",padding:"5px 15px",background:w?"rgba(0,0,0,0.5)":"rgba(103, 58, 183, 0.1)",border:"1px solid rgba(103, 58, 183, 0.3)",borderRadius:"20px",display:"inline-block"},children:[c.jsxs("span",{style:{color:w?"#b39ddb":"#673ab7",fontWeight:"bold"},children:["üëë Renown: ",F(r.renown,r.numberFormat)]}),!w&&c.jsxs("span",{style:{fontSize:"0.8rem",color:"#673ab7",marginLeft:"5px"},children:["(+",dr(r.renown).minus(s(1)).times(s(100)).floor().toString(),"% Bonus)"]})]})]}),c.jsxs("div",{style:{position:"relative",marginBottom:w?0:"3rem"},children:[c.jsx("button",{ref:q,style:{...Z,display:"flex",alignItems:"center",justifyContent:"center",outline:"none",color:"#5d4037",cursor:"pointer"},onClick:N,onMouseDown:b=>!w&&(b.currentTarget.style.transform="scale(0.96)"),onMouseUp:b=>!w&&(b.currentTarget.style.transform="scale(1)"),onMouseLeave:b=>!w&&(b.currentTarget.style.transform="scale(1)"),children:"üëë"}),!w&&k.map(b=>c.jsx("div",{className:"floating-text",style:{left:b.x,top:b.y},children:b.val},b.id))]}),c.jsxs("div",{style:{display:"flex",gap:"10px",zIndex:10,flexWrap:"wrap",justifyContent:"center",...J},children:[(((x=r.buildings.castle)==null?void 0:x.gt(s(0)))||r.soldiers.gt(s(0)))&&c.jsx("button",{className:"btn",onClick:i,children:"üó∫Ô∏è Conquest"}),r.buildings.castle&&r.buildings.castle.gt(s(0))&&c.jsx("button",{className:"btn",style:{background:"var(--accent-color)",borderColor:"var(--gold-color)"},onClick:_,children:"üëë Empire"}),((T=r.buildings.tavern)==null?void 0:T.gt(s(0)))&&c.jsx("button",{className:"btn",onClick:a,children:"üç∫ Tavern"}),(r.renown.gt(s(0))||r.gold.gt(s(1e5)))&&c.jsx("button",{className:"btn",style:{background:"var(--accent-color)"},onClick:m,children:"‚öñÔ∏è Council"}),(r.totalGold.gt(s(5e5))||r.renown.gt(s(0)))&&c.jsx("button",{className:"btn",style:{background:"var(--accent-color)"},onClick:l,children:"üëë Legacy"})]}),!w&&r.event&&r.event.type==="dragon"&&c.jsx("div",{className:"dragon-event",onMouseDown:()=>n(r.event),style:{top:"20%"},children:"üêâ"}),!w&&r.event&&r.event.type==="merchant"&&c.jsxs("div",{style:{position:"absolute",right:"20px",top:"100px",background:"#fff3e0",padding:"10px",border:"2px solid orange",zIndex:100,cursor:"pointer",animation:"pop 0.5s",borderRadius:"8px",boxShadow:"2px 2px 5px rgba(0,0,0,0.2)"},onClick:()=>n(r.event),children:[c.jsx("div",{style:{fontSize:"1.5rem",textAlign:"center"},children:"üë≥"}),c.jsx("div",{style:{fontWeight:"bold",color:"#000"},children:"Merchant"}),c.jsx("small",{style:{color:"#444"},children:"Click for gift"})]}),!w&&r.event&&r.event.type==="jester"&&c.jsxs("div",{style:{position:"absolute",left:"20px",top:"100px",background:"#fce4ec",padding:"10px",border:"2px solid pink",zIndex:100,cursor:"pointer",animation:"pop 0.5s",borderRadius:"8px",boxShadow:"2px 2px 5px rgba(0,0,0,0.2)"},onClick:()=>n(r.event),children:[c.jsx("div",{style:{fontSize:"1.5rem",textAlign:"center"},children:"ü§°"}),c.jsx("div",{style:{fontWeight:"bold",color:"#000"},children:"Jester"}),c.jsx("small",{style:{color:"#444"},children:"Risk it all?"})]})]})},va=({gameState:r})=>{var d;const[e,t]=W.useState("all"),n=()=>{const m=yi.sort((g,f)=>{const _=r.achievements.includes(g.id),w=r.achievements.includes(f.id);return _&&!w?-1:!_&&w?1:0});return e==="all"?m:m.filter(g=>e==="buildings"?g.id.startsWith("build_"):e==="clicks"?g.id.startsWith("clicks_"):e==="gold"?g.id.startsWith("gold_"):e==="soldiers"?g.id.startsWith("soldiers_"):e==="renown"?g.id.startsWith("renown_"):e==="wonders"?["first_wonder","complete_wonder","all_wonders"].includes(g.id):e==="artifacts"?["all_artifacts","first_artifact","half_artifacts"].includes(g.id):e==="advisors"?["first_advisor","all_advisors","advisor_upgrade"].includes(g.id):e==="trade"?["first_trade","trade_master"].includes(g.id):e==="secret"?["click_master","idle_master"].includes(g.id):e==="combo"?g.id.startsWith("build_")||["first_advisor","all_advisors","advisor_upgrade"].includes(g.id):!0)},i=[{id:"all",name:"All",icon:"üèÜ"},{id:"buildings",name:"Buildings",icon:"üèóÔ∏è"},{id:"clicks",name:"Clicks",icon:"üëÜ"},{id:"gold",name:"Gold",icon:"üí∞"},{id:"soldiers",name:"Army",icon:"‚öîÔ∏è"},{id:"renown",name:"Prestige",icon:"üëë"},{id:"wonders",name:"Wonders",icon:"üåü"},{id:"artifacts",name:"Artifacts",icon:"üèÖ"},{id:"advisors",name:"Advisors",icon:"ü§¥"},{id:"trade",name:"Trade",icon:"üö¢"},{id:"secret",name:"Secret",icon:"üîç"},{id:"combo",name:"Combo",icon:"‚ö°"}],a={display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(60px, 1fr))",gap:"10px",padding:"10px",background:"var(--panel-bg)",border:"1px solid var(--border-color)",borderRadius:"4px",marginTop:"10px"},l=m=>({width:"100%",aspectRatio:"1",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",border:`2px solid ${m?"var(--gold-color)":"#ccc"}`,background:m?"#fff8e1":"#eee",borderRadius:"4px",opacity:m?1:.3,cursor:m?"help":"default",position:"relative"});return c.jsxs("div",{style:{marginTop:"auto",padding:"10px"},children:[c.jsx("h3",{style:{fontSize:"1rem",margin:"0 0 5px 0"},children:"Royal Decree (Achievements)"}),c.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"5px",marginBottom:"10px",padding:"5px",background:"var(--panel-bg)",border:"1px solid var(--border-color)",borderRadius:"4px"},children:i.map(m=>c.jsxs("button",{onClick:()=>t(m.id),style:{padding:"4px 8px",fontSize:"0.75rem",border:`1px solid ${e===m.id?"var(--gold-color)":"var(--border-color)"}`,borderRadius:"3px",background:e===m.id?"#fff8e1":"var(--panel-bg)",cursor:"pointer",transition:"all 0.2s"},title:m.name,children:[c.jsx("span",{style:{marginRight:"2px"},children:m.icon}),c.jsx("span",{style:{display:e===m.id?"inline":"none"},children:m.name})]},m.id))}),c.jsx("div",{style:a,children:n().map(m=>{const g=r.achievements.includes(m.id);return c.jsx("div",{style:l(g),"data-tooltip":g?`${m.name}: ${m.description}`:"Locked",children:c.jsx("div",{style:{fontSize:"1.5rem",filter:g?"none":"grayscale(100%)",opacity:g?1:.2},children:g?m.icon:"‚ùì"})},m.id)})}),c.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginTop:"5px",textAlign:"center"},children:[r.achievements.length," / ",yi.length," Unlocked",e!=="all"&&c.jsxs("span",{children:[" | ",n().filter(m=>r.achievements.includes(m.id)).length," / ",n().length," in ",(d=i.find(m=>m.id===e))==null?void 0:d.name]})]})]})},gd=({gameState:r,onStartCrusade:e,onClose:t})=>{var q;const n=r.conquest.active?_i.find(S=>S.id===r.conquest.crusadeId):null,i=r.advisors.includes("warmaster"),a=r.advisorLevels.warmaster||s(0),l=r.advisors.includes("warmaster")?a.toNumber()*.1:0;let d=1-l;r.weather.current==="windy"&&(d=d*.8);const[m,g]=W.useState(0),[f,_]=W.useState(0),w=n&&r.conquest.startTime&&r.conquest.active,k=w&&r.conquest.startTime?s(Date.now()-s(r.conquest.startTime).toNumber()).dividedBy(s(1e3)).gte(s(n.duration).times(s(d))):!1;console.log("Conquest Debug:",{conquestActive:r.conquest.active,crusadeId:r.conquest.crusadeId,startTime:(q=r.conquest.startTime)==null?void 0:q.toNumber(),activeCrusade:n==null?void 0:n.name,isCrusadeActuallyActive:w,isCrusadeExpired:k,speedMult:d,currentTime:Date.now(),elapsed:r.conquest.startTime?(Date.now()-r.conquest.startTime.toNumber())/1e3:"N/A"});const B=xs.useRef(t);return xs.useEffect(()=>{B.current=t},[t]),W.useEffect(()=>{if(console.log("Timer useEffect:",{isCrusadeActuallyActive:w,isCrusadeExpired:k}),w&&!k){console.log("Setting up interval for:",n==null?void 0:n.name);const S=setInterval(()=>{const N=Date.now(),L=s(r.conquest.startTime).toNumber(),U=s(N-L).dividedBy(s(1e3)),G=s(n.duration).times(s(d)),Z=s(100).min(U.dividedBy(G).times(s(100)));g(Z.toNumber());const J=Je.max(s(0),G.minus(U)).ceil();_(J.toNumber()),console.log("Timer update:",{elapsed:U.toNumber(),duration:G.toNumber(),progress:Z.toNumber(),remaining:J.toNumber()}),J.lte(0)&&Z.gte(100)&&B.current()},1e3);return()=>clearInterval(S)}else g(0),_(0),console.log("Timer reset - no active crusade")},[w,k,n,r.conquest.startTime,d]),c.jsx("div",{className:"modal-overlay",children:c.jsxs("div",{className:"modal-content",style:{maxWidth:"600px"},children:[c.jsx("h2",{children:"War Room"}),c.jsxs("div",{className:"modal-body",style:{maxHeight:"60dvh",overflowY:"auto",WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:[c.jsxs("div",{style:{marginBottom:"20px",display:"flex",gap:"10px",justifyContent:"center",flexWrap:"wrap"},children:[r.artifacts.map(S=>{const N=Gs.find(L=>L.id===S);return c.jsx("div",{"data-tooltip":N==null?void 0:N.description,style:{fontSize:"2rem",width:"3.5rem",height:"3.5rem",display:"flex",justifyContent:"center",alignItems:"center",border:"2px solid gold",borderRadius:"50%",background:"rgba(255, 215, 0, 0.1)",flexShrink:0},children:N==null?void 0:N.icon},S)}),r.artifacts.length===0&&c.jsx("span",{style:{color:"var(--text-secondary)"},children:"No artifacts claimed yet."})]}),w&&!k?c.jsxs("div",{style:{textAlign:"center"},children:[c.jsxs("h3",{children:["Current Crusade: ",n.name]}),c.jsx("div",{style:{width:"100%",height:"20px",background:"#ccc",borderRadius:"10px",overflow:"hidden",margin:"20px 0"},children:c.jsx("div",{style:{width:`${m}%`,height:"100%",background:"var(--accent-color)",transition:"width 1s linear"}})}),i&&c.jsx("div",{style:{color:"var(--success-color)",fontSize:"0.8rem",marginBottom:"5px"},children:"Warmaster Active (Faster & Safer)"}),c.jsxs("div",{children:["Time remaining: ",f,"s"]})]}):c.jsx("div",{style:{textAlign:"center",padding:"20px"},children:c.jsx("div",{style:{color:"var(--text-secondary)",marginBottom:"20px"},children:r.conquest.active?"Previous crusade has completed.":"No active crusades at the moment."})}),(!w||k)&&c.jsx("div",{style:{maxHeight:"300px",overflowY:"auto"},children:_i.map(S=>{var E;const N=r.artifacts.includes(S.rewardArtifactId);let L=r.soldiers.gte(s(S.soldierCost)),U=[];if(S.requiredUnits){for(const[y,te]of Object.entries(S.requiredUnits))if((r.eliteUnits[y]||s(0)).lt(te)){L=!1;const be=((E=fi.find(Qe=>Qe.id===y))==null?void 0:E.name)||y;U.push(`${te} ${be}`)}}const G=s(S.duration).times(s(d)),Z=S.baseRisk||s(0),J=l*2,I=Z.minus(s(J)),v=s(1).minus(I).times(s(100)).floor();let x="var(--success-color)";I.gt(s(.1))&&(x="orange"),I.gt(s(.3))&&(x="var(--danger-color)");const T=N?"#f0f4c3":"transparent",b=N?"gold":"var(--border-color)";return c.jsxs("div",{style:{border:`1px solid ${b}`,background:T,padding:"10px",marginBottom:"10px",borderRadius:"4px",textAlign:"left",position:"relative"},children:[N&&c.jsx("div",{style:{position:"absolute",top:5,right:5,fontSize:"1.2rem"},children:"üèÜ"}),c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",paddingRight:"30px"},children:[c.jsxs("strong",{children:[S.icon," ",S.name]}),c.jsxs("span",{children:[G.gte(s(3600))?`${Math.floor(G.toNumber()/3600)}h `:"",Math.floor(G.toNumber()%3600/60),"m",G.toNumber()%60>0&&` ${Math.floor(G.toNumber()%60)}s`]})]}),c.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:S.description}),c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"10px",fontSize:"0.85rem"},children:[c.jsxs("div",{children:["Cost: ",c.jsxs("strong",{children:[F(S.soldierCost,r.numberFormat)," Soldiers"]})]}),c.jsxs("div",{style:{color:x,fontWeight:"bold"},children:["Success Chance: ",v.toString(),"%"]})]}),S.requiredUnits&&c.jsxs("div",{style:{fontSize:"0.8rem",marginTop:"5px",color:U.length>0?"var(--danger-color)":"var(--success-color)"},children:["Requires: ",Object.entries(S.requiredUnits).map(([y,te])=>{var Qe;const he=((Qe=fi.find(Fe=>Fe.id===y))==null?void 0:Qe.name)||y,be=r.eliteUnits[y]||s(0);return`${he} (${be.toString()}/${te.toString()}) `})]}),I.gt(s(0))&&c.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",marginTop:"2px"},children:"Failure refunds 50% soldiers."}),c.jsx("button",{className:"btn",style:{width:"100%",marginTop:"5px",background:N?"#827717":"var(--accent-color)"},disabled:!L,onClick:()=>e(S.id),children:N?"Replay Mission (Critical Chance)":"Start Campaign"})]},S.id)})})]}),c.jsx("button",{className:"btn",onClick:t,style:{marginTop:"20px"},children:"Close"})]})})},pd=({gameState:r,onGamble:e,onClose:t})=>{const[n,i]=W.useState("coin"),[a,l]=W.useState(10),[d,m]=W.useState(""),[g,f]=W.useState(null),_=()=>{if(r.gold.lt(s(a))){m("Not enough gold!");return}const k=Math.random()>.5;e(a,k),m(k?`Heads! You DOUBLED your money! (+${F(a,r.numberFormat)} Profit)`:`Tails... You lost ${F(a,r.numberFormat)} gold.`),f(null)},w=()=>{if(r.gold.lt(s(a))){m("Not enough gold!");return}const k=Math.floor(Math.random()*6)+1,B=Math.floor(Math.random()*6)+1,q=k+B;f(q);let S=0;if(q===7)m(`Rolled ${q}. A draw! Gold returned.`),e(0,!0);else if(q>7){q>=10?S=2:S=1.5;const N=Math.floor(a*S);e(N,!0),m(`Rolled ${q}! You won ${F(N,r.numberFormat)} gold!`)}else e(a,!1),m(`Rolled ${q}. You lost ${F(a,r.numberFormat)} gold.`)};return c.jsx("div",{className:"modal-overlay",children:c.jsxs("div",{className:"modal-content",style:{minHeight:"450px"},children:[c.jsx("h2",{style:{borderBottom:"none"},children:"üç∫ The Rusty Tankard"}),c.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"20px",justifyContent:"center"},children:[c.jsx("button",{className:"btn ",style:{opacity:n==="coin"?1:.6},onClick:()=>i("coin"),children:"Coin Flip"}),c.jsx("button",{className:"btn ",style:{opacity:n==="dice"?1:.6},onClick:()=>i("dice"),children:"High Dice"})]}),c.jsxs("div",{style:{background:"var(--panel-bg)",padding:"20px",borderRadius:"8px",border:"var(--custom-border-width) solid var(--border-color)"},children:[n==="coin"?c.jsxs("div",{style:{textAlign:"left",background:"var(--bg-color)",padding:"10px",borderRadius:"4px",color:"var(--text-color)"},children:[c.jsx("strong",{children:"Rules:"}),c.jsxs("ul",{style:{margin:"5px 0",paddingLeft:"20px",color:"var(--text-color)"},children:[c.jsx("li",{children:"50% Chance to Win."}),c.jsxs("li",{children:["Win: ",c.jsx("strong",{children:"+100% Profit"})," (Doubles your money)."]}),c.jsx("li",{children:"Lose: Lost the bet."})]})]}):c.jsxs("div",{style:{textAlign:"left",background:"var(--bg-color)",padding:"10px",borderRadius:"4px",color:"var(--text-color)"},children:[c.jsx("strong",{children:"Dice Rules (Roll 2-12):"}),c.jsxs("ul",{style:{margin:"5px 0",paddingLeft:"20px",color:"var(--text-color)"},children:[c.jsxs("li",{children:[c.jsx("strong",{children:"7:"})," Draw (Bet returned)"]}),c.jsxs("li",{children:[c.jsx("strong",{children:"8-9:"})," Win +50% Profit (1.5x)"]}),c.jsxs("li",{children:[c.jsx("strong",{children:"10-12:"})," Win +100% Profit (2x)"]}),c.jsxs("li",{children:[c.jsx("strong",{children:"2-6:"})," Loss"]})]})]}),c.jsxs("div",{style:{margin:"20px 0",color:"var(--text-color)"},children:[c.jsx("label",{style:{color:"var(--text-color)"},children:"Bet Amount: "}),c.jsx("input",{type:"number",value:a,onChange:k=>l(Math.max(1,parseInt(k.target.value)||0)),style:{padding:"8px",width:"120px",fontSize:"1rem",border:"var(--custom-border-width) solid var(--border-color)",backgroundColor:"var(--panel-bg)",color:"var(--text-color)"}})]}),n==="dice"&&g!==null&&c.jsxs("div",{style:{fontSize:"3rem",margin:"10px",color:"var(--text-color)"},children:["üé≤ ",g]}),c.jsx("button",{className:"btn",style:{fontSize:"1.2rem",padding:"10px 30px"},onClick:n==="coin"?_:w,children:n==="coin"?"Flip Coin":"Roll Dice"}),d&&c.jsx("div",{style:{marginTop:"15px",fontWeight:"bold",fontSize:"1.1rem",color:d.includes("won")||d.includes("DOUBLED")||d.includes("draw")?"var(--success-color)":"var(--danger-color)"},children:d})]}),c.jsx("div",{style:{marginTop:"30px"},children:c.jsx("button",{className:"btn",onClick:t,children:"Leave Tavern"})})]})})},fd=({gameState:r,onPrestige:e,onClose:t})=>{var B;const n=r.advisorLevels.void_scholar||s(0),a=1+(r.advisors.includes("void_scholar")?n.toNumber()*.1:0),l=s(1e12),d=r.totalGold;let m=s(0),g=!1,f=l.minus(d);if(d.gte(l)){const q=d.dividedBy(l);m=s(Math.floor(Math.pow(q.toNumber(),.5))).times(a),g=m.gt(0)}const _=l.times(Math.pow(Math.floor(m.dividedBy(a).toNumber()+1),2));_.minus(d);const k=dr(r.renown.plus(m)).minus(s(1)).times(s(100));return c.jsx("div",{className:"modal-overlay",children:c.jsxs("div",{className:"modal-content",style:{border:"4px solid #673ab7"},children:[c.jsx("h2",{style:{color:"#673ab7"},children:"üëë Abdication"}),c.jsx("p",{children:"Are you ready to pass the crown to your heir?"}),!((B=r.playerProfile)!=null&&B.hasChosenName)&&c.jsxs("div",{style:{background:"rgba(255, 235, 59, 0.1)",border:"1px solid #ffc107",padding:"10px",borderRadius:"4px",marginBottom:"15px",fontSize:"0.9rem"},children:["üí° ",c.jsx("strong",{children:"Tip:"})," You can abdicate without choosing a ruler name. Choose a name only if you want to appear in the leaderboard."]}),c.jsxs("div",{style:{textAlign:"left",margin:"20px 0",background:"rgba(243, 229, 245, 0.5)",padding:"15px",borderRadius:"4px"},children:[c.jsx("div",{children:c.jsx("strong",{children:"You will lose:"})}),c.jsxs("ul",{children:[c.jsx("li",{children:"All Gold"}),c.jsx("li",{children:"All Buildings"}),c.jsx("li",{children:"All Gold Upgrades"}),c.jsx("li",{children:"Current Soldiers"})]}),c.jsx("div",{children:c.jsx("strong",{children:"You will keep:"})}),c.jsxs("ul",{children:[c.jsx("li",{children:"Achievements"}),c.jsx("li",{children:"Artifacts"}),c.jsxs("li",{children:["Current Renown (",F(r.renown,r.numberFormat),")"]}),c.jsx("li",{children:"All Renown Upgrades (Permanent)"})]})]}),c.jsxs("div",{style:{fontSize:"1.2rem",marginBottom:"20px"},children:[c.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:["Total Gold Earned: ",F(d,r.numberFormat)]}),c.jsx("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:"Threshold for first prestige: 1,000,000,000,000 Gold"}),!g&&d.lt(l)&&c.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"#cc0000"},children:["Need: ",F(f,r.numberFormat)," more Gold to unlock prestige"]}),g&&c.jsxs(c.Fragment,{children:["You will gain: ",c.jsxs("strong",{children:[F(m,r.numberFormat)," Renown"]}),c.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:["(New Total Renown: ",F(r.renown.plus(m),r.numberFormat),")"]}),c.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:["(Production Bonus: +",k.toNumber().toFixed(1),"%)"]}),m.gt(0)&&c.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginTop:"5px"},children:["Next Renown at: ",F(_,r.numberFormat)," total gold"]})]})]}),c.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[c.jsx("button",{className:"btn",style:{background:"#666"},onClick:t,children:"Cancel"}),c.jsx("button",{className:"btn",style:{background:"#673ab7"},onClick:e,disabled:!g,children:g?"Abdicate":d.lt(l)?`Need ${F(f,r.numberFormat)} more Gold to unlock prestige`:"Prestige Unavailable"})]})]})})},yd=({gameState:r,onClose:e,onHardReset:t,onSave:n,onOpenChangelog:i,onSetTheme:a,onSetNumberFormat:l,onToggleIdleMode:d,onUpdateInterface:m})=>{var Qe,Fe,Ae,yt;const[g,f]=xs.useState(!1),_=r.interface||{density:"normal",fontSize:"medium",showFloatingText:!0,showWeatherWidget:!0,reduceMotion:!1,layout:{left:1,center:1,right:1},borderWidth:4,customColors:{enabled:!1,bg:"",panel:"",text:"",accent:"",border:"",secondaryText:"",accentHover:"",gold:"",success:"",danger:""}},w=(Qe=_.layout.left)!=null&&Qe.toNumber?_.layout.left.toNumber():Number(_.layout.left),k=(Fe=_.layout.center)!=null&&Fe.toNumber?_.layout.center.toNumber():Number(_.layout.center),B=(Ae=_.layout.right)!=null&&Ae.toNumber?_.layout.right.toNumber():Number(_.layout.right),q=(yt=_.borderWidth)!=null&&yt.toNumber?_.borderWidth.toNumber():Number(_.borderWidth),S=_.customColors||{},N=String(S.bg||""),L=String(S.panel||""),U=String(S.text||""),G=String(S.secondaryText||""),Z=String(S.accent||""),J=String(S.accentHover||""),I=String(S.gold||""),v=String(S.border||""),x=String(S.success||""),T=String(S.danger||""),b=()=>{g?t():f(!0)},E=(X,st)=>{m({layout:{..._.layout,[X]:st}})},y=(X,st)=>{m({customColors:{..._.customColors,[X]:st}})},te={display:"flex",gap:"5px",flexWrap:"wrap",justifyContent:"center"},he={marginBottom:"8px",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px",background:"rgba(0,0,0,0.03)",borderRadius:"4px"},be={width:"100%",marginBottom:"5px"};return c.jsx("div",{className:"modal-overlay",children:c.jsxs("div",{className:"modal-content",children:[c.jsx("h2",{children:"‚öôÔ∏è Royal Settings"}),r.playerProfile&&c.jsxs("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"12px",marginBottom:"20px",textAlign:"center"},children:[c.jsxs("div",{style:{color:"var(--gold-color)",fontSize:"16px",fontWeight:"bold"},children:["üëë Your Ruler: ",r.playerProfile.rulerName," ",r.playerProfile.rulerId]}),c.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"12px",marginTop:"5px"},children:"Registered in Leaderboard System"})]}),c.jsxs("div",{style:{textAlign:"left",marginBottom:"20px",maxHeight:"60vh",overflowY:"auto",paddingRight:"5px"},children:[c.jsx("h3",{style:{marginBottom:"10px"},children:"Layout Configuration"}),c.jsxs("div",{style:{marginBottom:"15px",background:"rgba(0,0,0,0.03)",padding:"10px",borderRadius:"4px"},children:[c.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Column Widths (Ratio)"}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"10px",alignItems:"center",marginBottom:"5px"},children:[c.jsx("span",{style:{fontSize:"0.8rem"},children:"Left"}),c.jsx("input",{type:"range",min:"1",max:"5",step:"0.5",value:w,onChange:X=>E("left",parseFloat(X.target.value)),style:be}),c.jsx("span",{style:{fontSize:"0.8rem"},children:w})]}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"10px",alignItems:"center",marginBottom:"5px"},children:[c.jsx("span",{style:{fontSize:"0.8rem"},children:"Center"}),c.jsx("input",{type:"range",min:"1",max:"5",step:"0.5",value:k,onChange:X=>E("center",parseFloat(X.target.value)),style:be}),c.jsx("span",{style:{fontSize:"0.8rem"},children:k})]}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"10px",alignItems:"center"},children:[c.jsx("span",{style:{fontSize:"0.8rem"},children:"Right"}),c.jsx("input",{type:"range",min:"1",max:"5",step:"0.5",value:B,onChange:X=>E("right",parseFloat(X.target.value)),style:be}),c.jsx("span",{style:{fontSize:"0.8rem"},children:B})]})]}),c.jsx("h3",{style:{marginBottom:"10px"},children:"Design Studio"}),c.jsxs("div",{style:he,children:[c.jsx("div",{children:c.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Border Thickness"})}),c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[c.jsx("input",{type:"range",min:"1",max:"10",value:q,onChange:X=>m({borderWidth:parseInt(X.target.value)})}),c.jsxs("span",{children:[q,"px"]})]})]}),c.jsxs("div",{style:he,children:[c.jsxs("div",{children:[c.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Enable Custom Colors"}),c.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Override theme colors."})]}),c.jsx("input",{type:"checkbox",checked:_.customColors.enabled,onChange:X=>y("enabled",X.target.checked),style:{transform:"scale(1.5)"}})]}),_.customColors.enabled&&c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",marginBottom:"15px"},children:[c.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Background",c.jsx("input",{type:"color",value:N,onChange:X=>y("bg",X.target.value),style:{width:"100%"}})]}),c.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Panels",c.jsx("input",{type:"color",value:L,onChange:X=>y("panel",X.target.value),style:{width:"100%"}})]}),c.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Borders",c.jsx("input",{type:"color",value:v,onChange:X=>y("border",X.target.value),style:{width:"100%"}})]}),c.jsx("div",{style:{gridColumn:"1 / -1",height:"1px",background:"#ccc",margin:"5px 0"}}),c.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Primary Text",c.jsx("input",{type:"color",value:U,onChange:X=>y("text",X.target.value),style:{width:"100%"}})]}),c.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Secondary Text",c.jsx("input",{type:"color",value:G,onChange:X=>y("secondaryText",X.target.value),style:{width:"100%"}})]}),c.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Gold/Value",c.jsx("input",{type:"color",value:I,onChange:X=>y("gold",X.target.value),style:{width:"100%"}})]}),c.jsx("div",{style:{gridColumn:"1 / -1",height:"1px",background:"#ccc",margin:"5px 0"}}),c.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Accent/Buttons",c.jsx("input",{type:"color",value:Z,onChange:X=>y("accent",X.target.value),style:{width:"100%"}})]}),c.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Button Hover",c.jsx("input",{type:"color",value:J,onChange:X=>y("accentHover",X.target.value),style:{width:"100%"}})]}),c.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Success/Green",c.jsx("input",{type:"color",value:x,onChange:X=>y("success",X.target.value),style:{width:"100%"}})]}),c.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Danger/Red",c.jsx("input",{type:"color",value:T,onChange:X=>y("danger",X.target.value),style:{width:"100%"}})]})]}),c.jsx("div",{style:{borderTop:"1px dashed #ccc",margin:"15px 0"}}),c.jsxs("div",{style:{marginBottom:"15px",opacity:_.customColors.enabled?.5:1,pointerEvents:_.customColors.enabled?"none":"auto"},children:[c.jsxs("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:["Preset Themes ",_.customColors.enabled&&"(Disabled)"]}),c.jsx("div",{style:te,children:Object.values(ws).map(X=>c.jsx("button",{className:"btn",style:{background:r.theme===X.id?"var(--accent-color)":"var(--panel-bg)",color:r.theme===X.id?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",flex:"1 1 auto",padding:"5px 10px"},onClick:()=>a(X.id),children:X.name},X.id))})]}),c.jsxs("div",{style:{marginBottom:"15px"},children:[c.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Font Size"}),c.jsx("div",{style:te,children:["small","medium","large"].map(X=>c.jsx("button",{className:"btn",style:{background:_.fontSize===X?"var(--accent-color)":"var(--panel-bg)",color:_.fontSize===X?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",flex:"1 1 auto",textTransform:"capitalize"},onClick:()=>m({fontSize:X}),children:X},X))})]}),c.jsxs("div",{style:{marginBottom:"15px"},children:[c.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Layout Density"}),c.jsx("div",{style:te,children:["compact","normal","spacious"].map(X=>c.jsx("button",{className:"btn",style:{background:_.density===X?"var(--accent-color)":"var(--panel-bg)",color:_.density===X?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",flex:"1 1 auto",textTransform:"capitalize"},onClick:()=>m({density:X}),children:X},X))})]}),c.jsx("div",{style:{borderTop:"1px dashed #ccc",margin:"15px 0"}}),c.jsxs("div",{style:he,children:[c.jsxs("div",{children:[c.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Cinematic Idle Mode"}),c.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show landscape when inactive."})]}),c.jsx("button",{className:"btn",style:{background:r.idleModeEnabled?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:d,children:r.idleModeEnabled?"ON":"OFF"})]}),c.jsxs("div",{style:he,children:[c.jsxs("div",{children:[c.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Click Text"}),c.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show floating numbers on click."})]}),c.jsx("button",{className:"btn",style:{background:_.showFloatingText?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>m({showFloatingText:!_.showFloatingText}),children:_.showFloatingText?"ON":"OFF"})]}),c.jsxs("div",{style:he,children:[c.jsxs("div",{children:[c.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Weather Widget"}),c.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show weather info in top left."})]}),c.jsx("button",{className:"btn",style:{background:_.showWeatherWidget?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>m({showWeatherWidget:!_.showWeatherWidget}),children:_.showWeatherWidget?"ON":"OFF"})]}),c.jsxs("div",{style:he,children:[c.jsxs("div",{children:[c.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Reduce Motion"}),c.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Disable animations."})]}),c.jsx("button",{className:"btn",style:{background:_.reduceMotion?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>m({reduceMotion:!_.reduceMotion}),children:_.reduceMotion?"ON":"OFF"})]}),c.jsxs("div",{style:{marginTop:"15px"},children:[c.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Number Format"}),c.jsx("div",{style:te,children:["standard","scientific","plain"].map(X=>c.jsx("button",{className:"btn",style:{background:r.numberFormat===X?"var(--accent-color)":"var(--panel-bg)",color:r.numberFormat===X?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",flex:"1 1 auto",padding:"5px 10px",textTransform:"capitalize"},onClick:()=>l(X),children:X},X))})]})]}),c.jsxs("div",{style:{borderTop:"2px solid #ccc",paddingTop:"15px",marginTop:"15px"},children:[c.jsx("h3",{children:"System"}),c.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"center",flexWrap:"wrap"},children:[c.jsx("button",{className:"btn",onClick:n,children:"Force Save"}),c.jsx("button",{className:"btn",style:{background:"#0288d1"},onClick:i,children:"Update Logs"}),c.jsx("button",{className:"btn",style:{backgroundColor:g?"red":"#d32f2f"},onClick:b,children:g?"CONFIRM WIPE?":"Hard Reset"})]}),g&&c.jsx("div",{style:{color:"red",fontSize:"0.8rem",marginTop:"5px"},children:"Warning: This will delete all progress permanently!"})]}),c.jsx("button",{className:"btn",style:{marginTop:"20px",background:"#5d4037",width:"100%"},onClick:e,children:"Return to Game"}),c.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)",marginTop:"10px"},children:"v2.3.0 - Kingdom Clicker"})]})})},_d=({onClose:r})=>c.jsx("div",{className:"modal-overlay",children:c.jsxs("div",{className:"modal-content",style:{maxWidth:"600px",maxHeight:"80vh",display:"flex",flexDirection:"column"},children:[c.jsx("h2",{children:"üìú Royal Chronicles"}),c.jsx("div",{style:{overflowY:"auto",textAlign:"left",padding:"0 20px",flex:1},children:ha.map((e,t)=>c.jsxs("div",{style:{marginBottom:"20px",borderBottom:t<ha.length-1?"1px dashed #ccc":"none",paddingBottom:"10px"},children:[c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"5px"},children:[c.jsxs("span",{style:{fontSize:"1.2rem",fontWeight:"bold",color:"var(--accent-color)"},children:["v",e.version]}),c.jsx("span",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:e.date})]}),c.jsx("ul",{style:{margin:"5px 0",paddingLeft:"20px"},children:e.changes.map((n,i)=>c.jsx("li",{style:{marginBottom:"3px"},children:n},i))})]},e.version))}),c.jsx("button",{className:"btn",style:{marginTop:"20px",alignSelf:"center"},onClick:r,children:"Close Chronicles"})]})}),vd=({gameState:r,onHireAdvisor:e,onClose:t})=>c.jsx("div",{className:"modal-overlay",children:c.jsxs("div",{className:"modal-content",style:{border:"4px double #4a148c",maxWidth:"900px"},children:[c.jsx("h2",{style:{color:"#4a148c",borderBottomColor:"#4a148c"},children:"‚öñÔ∏è Royal Council"}),c.jsxs("div",{style:{marginBottom:"15px",color:"var(--text-secondary)",fontStyle:"italic"},children:["Hire permanent advisors with Renown. ",c.jsx("br",{}),"These buffs persist across abdications. Advisors can be upgraded for better effects."]}),c.jsxs("div",{style:{background:"rgba(103, 58, 183, 0.1)",padding:"10px",borderRadius:"4px",marginBottom:"20px",fontWeight:"bold",color:"#4a148c"},children:["Available Renown: ",F(r.renown,r.numberFormat)," üëë"]}),c.jsxs("div",{style:{marginBottom:"30px"},children:[c.jsx("h3",{style:{color:"#4a148c",marginBottom:"10px"},children:"üë• Royal Advisors"}),c.jsx("div",{style:{display:"grid",gap:"10px",maxHeight:"350px",overflowY:"auto"},children:jl.map(n=>{const i=r.advisors.includes(n.id),a=r.advisorLevels[n.id]||s(0),l=Ml(n,a),d=!i&&r.renown.gte(n.cost),m=i&&r.renown.gte(l),g=Lt(n.id,a);return c.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"15px",border:`2px solid ${i?"#4a148c":"var(--border-color)"}`,background:i?"rgba(237, 231, 246, 0.5)":"var(--panel-bg)",borderRadius:"8px",opacity:i||d?1:.6},children:[c.jsx("div",{style:{fontSize:"2.5rem",marginRight:"15px"},children:n.icon}),c.jsxs("div",{style:{flex:1,textAlign:"left"},children:[c.jsxs("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:i?"#4a148c":"var(--text-color)"},children:[n.name," ",i&&`(Level ${F(a,r.numberFormat)})`]}),c.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:n.description}),i&&c.jsxs("div",{style:{fontSize:"0.8rem",color:"#4a148c",marginTop:"5px"},children:[n.id==="treasurer"&&`Auto-clicks every ${Math.max(1,5-a.toNumber())} seconds`,n.id==="warmaster"&&`Speed: +${F(g.times(s(100)),r.numberFormat)}%, Safety: +${F(g.times(s(100)),r.numberFormat)}%`,n.id==="guildmaster"&&`Discount: ${F(g.times(s(100)),r.numberFormat)}%`,n.id==="alchemist"&&`Event chance: x${F(g.plus(s(1)),r.numberFormat)}`,(n.id==="chronomancer"||n.id==="time_keeper")&&`Cooldown reduction: ${F(g.times(s(100)),r.numberFormat)}%`,n.id==="void_scholar"&&`Renown bonus: +${F(g.times(s(100)),r.numberFormat)}%`,n.id==="cosmic_mage"&&`Production bonus: +${F(g.times(s(100)),r.numberFormat)}%`]})]}),c.jsx("div",{style:{minWidth:"120px",textAlign:"right"},children:i?c.jsxs("button",{className:"btn",style:{background:m?"#4a148c":"var(--text-secondary)",fontSize:"0.8rem"},disabled:!m,onClick:()=>e(n.id),children:["Upgrade: ",F(l,r.numberFormat)," üëë"]}):c.jsxs("button",{className:"btn",style:{background:d?"#4a148c":"var(--text-secondary)"},disabled:!d,onClick:()=>e(n.id),children:["Hire: ",F(n.cost,r.numberFormat)," üëë"]})})]},n.id)})})]}),c.jsx("button",{className:"btn",style:{marginTop:"20px",background:"#5d4037"},onClick:t,children:"Close Council"})]})}),bd=({gameState:r,currentGps:e,onClose:t})=>{var U;const n=Object.values(r.buildings).reduce((G,Z)=>G.plus(Z),s(0)),i=r.upgrades.length,a=Xe.length,l=r.achievements.length,d=yi.length;let m="None",g="None",f=-1,_=s(0);dt.forEach((G,Z)=>{const J=r.buildings[G.id]||s(0);J.gt(s(0))&&Z>f&&(f=Z,m=G.name),J.gt(_)&&(_=J,g=G.name)});const k=(()=>{let G=s(1);return Xe.filter(Z=>Z.type==="click"&&r.upgrades.includes(Z.id)).forEach(Z=>{Z.multiplier&&(G=G.times(Z.multiplier))}),(r.activeDecrees.call_to_arms||s(0)).gt(s(Date.now()))&&(G=G.times(s(5))),G=G.times(dr(r.renown)),G})(),[B,q]=W.useState("");W.useEffect(()=>{const G=()=>{const J=s(Date.now()).minus(r.startTime),I=J.dividedBy(s(1e3)),v=I.minus(I.dividedBy(s(60)).floor().times(s(60))).floor(),x=J.dividedBy(s(6e4)),T=x.minus(x.dividedBy(s(60)).floor().times(s(60))).floor(),b=J.dividedBy(s(36e5)),E=b.minus(b.dividedBy(s(24)).floor().times(s(24))).floor(),y=J.dividedBy(s(864e5)).floor();let te="";y.gt(s(0))&&(te+=`${y.toString()}d `),E.gt(s(0))&&(te+=`${E.toString()}h `),te+=`${T.toString()}m ${v.toString()}s`,q(te)};G();const Z=setInterval(G,1e3);return()=>clearInterval(Z)},[r.startTime]);const S={display:"flex",justifyContent:"space-between",padding:"8px 0",borderBottom:"1px dashed rgba(0,0,0,0.1)",fontSize:"0.9rem"},N={fontSize:"1rem",color:"var(--accent-color)",marginTop:"15px",borderBottom:"2px solid var(--border-color)",paddingBottom:"2px",marginBottom:"5px"},L=((U=Nl[r.weather.current])==null?void 0:U.name)||"Unknown";return c.jsx("div",{className:"modal-overlay",children:c.jsxs("div",{className:"modal-content",style:{maxWidth:"500px"},children:[c.jsx("h2",{children:"üìä Royal Records"}),c.jsxs("div",{style:{textAlign:"left",marginBottom:"20px",maxHeight:"60vh",overflowY:"auto",paddingRight:"10px"},children:[c.jsx("h3",{style:N,children:"‚ö° Current Status"}),c.jsxs("div",{style:S,children:[c.jsx("span",{children:"Gold Per Second:"}),c.jsxs("strong",{style:{color:"var(--success-color)"},children:[F(e,r.numberFormat)," / sec"]})]}),c.jsxs("div",{style:S,children:[c.jsx("span",{children:"Click Power:"}),c.jsxs("strong",{style:{color:"var(--success-color)"},children:[F(k,r.numberFormat)," / click"]})]}),c.jsxs("div",{style:S,children:[c.jsx("span",{children:"Current Weather:"}),c.jsx("strong",{children:L})]}),c.jsxs("div",{style:S,children:[c.jsx("span",{children:"Renown Bonus:"}),c.jsxs("strong",{style:{color:"#673ab7"},children:["+",dr(r.renown).minus(s(1)).times(s(100)).toNumber().toString(),"%"]})]}),c.jsx("h3",{style:N,children:"‚è≥ Time & Legacy"}),c.jsxs("div",{style:S,children:[c.jsx("span",{children:"Time Played:"}),c.jsx("strong",{children:B})]}),c.jsxs("div",{style:S,children:[c.jsx("span",{children:"Kingdom Founded:"}),c.jsx("span",{children:new Date(r.startTime.toNumber()).toLocaleDateString()})]}),c.jsxs("div",{style:S,children:[c.jsx("span",{children:"Total Renown:"}),c.jsx("strong",{children:F(r.renown,r.numberFormat)})]}),c.jsx("h3",{style:N,children:"üí∞ Economy Summary"}),c.jsxs("div",{style:S,children:[c.jsx("span",{children:"Current Gold:"}),c.jsx("strong",{children:F(r.gold,r.numberFormat)})]}),c.jsxs("div",{style:S,children:[c.jsx("span",{children:"Lifetime Gold:"}),c.jsx("strong",{children:F(r.totalGold,r.numberFormat)})]}),c.jsx("h3",{style:N,children:"üè∞ Dominion"}),c.jsxs("div",{style:S,children:[c.jsx("span",{children:"Total Buildings:"}),c.jsx("strong",{children:F(n,r.numberFormat)})]}),c.jsxs("div",{style:S,children:[c.jsx("span",{children:"Highest Tech Building:"}),c.jsx("strong",{children:m})]}),c.jsxs("div",{style:S,children:[c.jsx("span",{children:"Most Numerous:"}),c.jsxs("strong",{children:[g," (",F(_,r.numberFormat),")"]})]}),c.jsx("h3",{style:N,children:"üéñÔ∏è Completion"}),c.jsxs("div",{style:S,children:[c.jsx("span",{children:"Achievements:"}),c.jsxs("span",{children:[l," / ",d," (",Math.floor(l/d*100),"%)"]})]}),c.jsxs("div",{style:S,children:[c.jsx("span",{children:"Upgrades:"}),c.jsxs("span",{children:[i," / ",a," (",Math.floor(i/a*100),"%)"]})]}),c.jsxs("div",{style:S,children:[c.jsx("span",{children:"Artifacts:"}),c.jsxs("span",{children:[r.artifacts.length," Found"]})]}),c.jsx("h3",{style:N,children:"‚öîÔ∏è Military & Court"}),c.jsxs("div",{style:S,children:[c.jsx("span",{children:"Standing Army:"}),c.jsxs("strong",{children:[F(r.soldiers,r.numberFormat)," Soldiers"]})]}),c.jsxs("div",{style:S,children:[c.jsx("span",{children:"Royal Advisors:"}),c.jsxs("span",{children:[r.advisors.length," Hired"]})]}),c.jsx("h3",{style:N,children:"üìà Player Stats"}),c.jsxs("div",{style:S,children:[c.jsx("span",{children:"Manual Clicks:"}),c.jsx("span",{children:F(r.stats.totalClicks,r.numberFormat)})]}),c.jsxs("div",{style:S,children:[c.jsx("span",{children:"Dragons Slain:"}),c.jsx("span",{children:F(r.stats.dragonsKilled,r.numberFormat)})]}),c.jsxs("div",{style:S,children:[c.jsx("span",{children:"Tavern Games:"}),c.jsx("span",{children:F(r.stats.tavernGamesPlayed,r.numberFormat)})]})]}),c.jsx("button",{className:"btn",style:{background:"#5d4037",width:"100%"},onClick:t,children:"Close Records"})]})})},xd=({gameState:r,onInvestTrade:e,onBuildWonder:t,onClose:n})=>{const[i,a]=W.useState("trade"),l=(r.wonders.great_pyramid||0)>=3;return c.jsx("div",{className:"modal-overlay",children:c.jsxs("div",{className:"modal-content",style:{maxWidth:"800px",width:"95%",height:"80vh",display:"flex",flexDirection:"column",padding:"0"},children:[c.jsxs("div",{style:{padding:"20px",background:"var(--accent-color)",color:"var(--text-on-accent)"},children:[c.jsx("h2",{style:{margin:0,border:"none",color:"var(--gold-color)"},children:"üëë Imperial Management"}),c.jsxs("div",{style:{display:"flex",gap:"10px",marginTop:"15px"},children:[c.jsx("button",{className:"tab-btn",style:{background:i==="trade"?"var(--gold-color)":"transparent",color:i==="trade"?"var(--text-color)":"var(--text-on-accent)",borderBottom:i==="trade"?"2px solid var(--text-color)":"none"},onClick:()=>a("trade"),children:"Trade Routes"}),c.jsx("button",{className:"tab-btn",style:{background:i==="wonders"?"var(--gold-color)":"transparent",color:i==="wonders"?"var(--text-color)":"var(--text-on-accent)",borderBottom:i==="wonders"?"2px solid var(--text-color)":"none"},onClick:()=>a("wonders"),children:"Great Wonders"})]})]}),c.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"20px",background:"var(--panel-bg)"},children:[i==="trade"&&c.jsx(wd,{gameState:r,onInvestTrade:e,hasPyramid:l}),i==="wonders"&&c.jsx(Id,{gameState:r,onBuildWonder:t})]}),c.jsx("div",{style:{padding:"15px",borderTop:"1px solid var(--border-color)",textAlign:"right",background:"var(--bg-color)"},children:c.jsx("button",{className:"btn",onClick:n,children:"Return to Kingdom"})})]})})},wd=({gameState:r,onInvestTrade:e,hasPyramid:t})=>{var B,q,S,N;const[n,i]=W.useState(null),[a,l]=W.useState(0),[d,m]=W.useState(0),[g,f]=W.useState(0),_=r.activeTradeRoutes||[],w=()=>{n&&(e(n.id,a,d,{knight:g}),i(null),l(0),m(0),f(0))},k=L=>{const U=s(d).plus(s(g).times(s(50))),G=s(Math.max(100,a/100)),Z=s(Math.min(.9,U.dividedBy(G).toNumber()));let J=L.risk.times(s(1).minus(Z));return t&&(J=J.times(s(.5))),J};return c.jsxs("div",{children:[c.jsx("h3",{style:{borderBottom:"1px solid var(--border-color)",paddingBottom:"5px"},children:"Active Caravans"}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(250px, 1fr))",gap:"10px",marginBottom:"30px"},children:[_.length===0&&c.jsx("div",{style:{color:"var(--text-secondary)"},children:"No active trade routes."}),_.map(L=>{var v,x;const U=vi.find(T=>T.id===L.routeId);if(!U)return null;const G=(v=L.startTime)!=null&&v.toNumber?L.startTime.toNumber():Number(L.startTime),Z=(x=L.duration)!=null&&x.toNumber?L.duration.toNumber():Number(L.duration),J=(Date.now()-G)/1e3,I=Math.min(100,J/Z*100);return c.jsxs("div",{style:{padding:"10px",border:"1px solid var(--accent-color)",borderRadius:"4px",background:"var(--panel-bg)",color:"var(--text-color)"},children:[c.jsxs("div",{style:{fontWeight:"bold"},children:[U.icon," ",U.name]}),c.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["Invested: ",F(L.goldInvested,r.numberFormat)]}),c.jsx("div",{style:{width:"100%",height:"10px",background:"var(--bg-color)",marginTop:"5px",borderRadius:"5px"},children:c.jsx("div",{style:{width:`${I}%`,height:"100%",background:"var(--success-color)",borderRadius:"5px",transition:"width 1s linear"}})}),c.jsxs("div",{style:{textAlign:"right",fontSize:"0.8rem",color:"var(--text-secondary)"},children:[Math.ceil(Z-J),"s left"]})]},L.id)})]}),c.jsx("h3",{style:{borderBottom:"1px solid var(--border-color)",paddingBottom:"5px"},children:"Establish New Route"}),n?c.jsxs("div",{style:{padding:"20px",border:"2px solid var(--accent-color)",borderRadius:"8px",background:"var(--panel-bg)",color:"var(--text-color)"},children:[c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[c.jsxs("h4",{style:{margin:0,color:"var(--text-color)"},children:[n.icon," ",n.name]}),c.jsx("button",{className:"btn",style:{padding:"5px 10px",fontSize:"0.8rem"},onClick:()=>i(null),children:"Cancel"})]}),c.jsxs("div",{style:{marginBottom:"15px"},children:[c.jsxs("label",{style:{display:"block",fontWeight:"bold"},children:["Gold Investment (Max ",F(n.maxInvestment,r.numberFormat),")"]}),c.jsx("input",{type:"range",min:"0",max:Math.min((B=r.gold)!=null&&B.toNumber?r.gold.toNumber():Number(r.gold),(q=n.maxInvestment)!=null&&q.toNumber?n.maxInvestment.toNumber():Number(n.maxInvestment)),value:a,onChange:L=>l(parseInt(L.target.value)),style:{width:"100%"}}),c.jsxs("div",{style:{textAlign:"right"},children:[F(a,r.numberFormat)," G"]})]}),c.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px",marginBottom:"15px"},children:[c.jsxs("div",{children:[c.jsx("label",{style:{display:"block",fontWeight:"bold"},children:"Soldier Escort"}),c.jsx("input",{type:"number",min:"0",max:(S=r.soldiers)!=null&&S.toNumber?r.soldiers.toNumber():Number(r.soldiers),value:d,onChange:L=>m(parseInt(L.target.value)),style:{width:"100%",padding:"5px"}}),c.jsxs("div",{style:{fontSize:"0.8rem"},children:["Available: ",F(r.soldiers,r.numberFormat)]})]}),c.jsxs("div",{children:[c.jsx("label",{style:{display:"block",fontWeight:"bold"},children:"Knight Escort"}),c.jsx("input",{type:"number",min:"0",max:(N=r.eliteUnits.knight)!=null&&N.toNumber?r.eliteUnits.knight.toNumber():Number(r.eliteUnits.knight||0),value:g,onChange:L=>f(parseInt(L.target.value)),style:{width:"100%",padding:"5px"}}),c.jsxs("div",{style:{fontSize:"0.8rem"},children:["Available: ",F(r.eliteUnits.knight||0,r.numberFormat)]})]})]}),c.jsxs("div",{style:{background:"#fff",padding:"10px",borderRadius:"4px",marginBottom:"15px"},children:[c.jsxs("div",{children:[c.jsx("strong",{children:"Projected Return:"})," ",F(s(a).times(n.rewardMultiplier),r.numberFormat)," G"]}),c.jsxs("div",{children:[c.jsx("strong",{children:"Duration:"})," ",(()=>{var G;const L=(G=n.baseDuration)!=null&&G.toNumber?n.baseDuration.toNumber():Number(n.baseDuration),U=t?L*.5:L;return Math.ceil(U)/60})()," min"]}),c.jsxs("div",{children:[c.jsx("strong",{children:"Risk:"})," ",c.jsxs("span",{style:{color:k(n).gt(s(.3))?"red":"green"},children:[k(n).times(s(100)).toFixed(1),"%"]})]})]}),c.jsx("button",{className:"btn",style:{width:"100%"},disabled:a<=0||d===0&&g===0,onClick:w,children:"Dispatch Caravan"})]}):c.jsx("div",{style:{display:"grid",gap:"10px"},children:vi.map(L=>c.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"15px",border:"1px solid var(--border-color)",borderRadius:"4px",cursor:"pointer",background:"var(--panel-bg)",color:"var(--text-color)"},onClick:()=>i(L),children:[c.jsx("div",{style:{fontSize:"2rem",marginRight:"15px"},children:L.icon}),c.jsxs("div",{style:{flex:1},children:[c.jsx("div",{style:{fontWeight:"bold"},children:L.name}),c.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:L.description}),c.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--success-color)"},children:["Max Profit: ",F(L.rewardMultiplier,r.numberFormat),"x"]})]}),c.jsx("button",{className:"btn",style:{fontSize:"0.8rem"},children:"Select"})]},L.id))})]})},Id=({gameState:r,onBuildWonder:e})=>{const t=i=>{for(const a of i)if(a.type==="gold"&&r.gold.lt(s(a.amount))||a.type==="soldiers"&&r.soldiers.lt(s(a.amount))||a.type==="renown"&&r.renown.lt(s(a.amount))||["knight","paladin","void_sentinel"].includes(a.type)&&(r.eliteUnits[a.type]||s(0)).lt(s(a.amount)))return!1;return!0},n=i=>i.map((a,l)=>c.jsxs("span",{style:{marginRight:"10px",color:t([a])?"green":"red"},children:[F(a.amount,r.numberFormat)," ",a.type==="gold"?"G":a.type]},l));return c.jsx("div",{style:{display:"grid",gap:"20px"},children:Ll.map(i=>{const a=r.wonders[i.id]||0,l=a>=i.stages.length,d=l?null:i.stages[a],m=d?t(d.cost):!1;return c.jsxs("div",{style:{border:"2px solid var(--accent-color)",borderRadius:"8px",overflow:"hidden"},children:[c.jsxs("div",{style:{background:l?"var(--gold-color)":"var(--bg-color)",padding:"15px",display:"flex",alignItems:"center",color:"var(--text-color)"},children:[c.jsx("div",{style:{fontSize:"3rem",marginRight:"15px"},children:i.icon}),c.jsxs("div",{style:{flex:1},children:[c.jsx("h3",{style:{margin:0,color:"var(--text-color)"},children:i.name}),c.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:i.description}),c.jsxs("div",{style:{marginTop:"5px",fontWeight:"bold",color:"var(--accent-color)"},children:["Bonus: ",i.bonusDescription]})]}),c.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-color)"},children:l?"COMPLETED":`${a} / ${i.stages.length}`})]}),!l&&d&&c.jsxs("div",{style:{padding:"15px",background:"var(--panel-bg)",color:"var(--text-color)"},children:[c.jsxs("h4",{style:{marginTop:0,color:"var(--text-color)"},children:["Next Stage: ",d.name]}),c.jsx("p",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:d.description}),c.jsxs("div",{style:{background:"var(--bg-color)",padding:"10px",borderRadius:"4px",marginBottom:"15px",color:"var(--text-color)"},children:[c.jsx("strong",{children:"Requirements: "}),n(d.cost)]}),c.jsxs("button",{className:"btn",style:{width:"100%",background:m?"var(--accent-color)":"var(--border-color)"},disabled:!m,onClick:()=>e(i.id),children:["Build Stage (",a+1,")"]})]}),l&&c.jsx("div",{style:{padding:"10px",background:"var(--bg-color)",textAlign:"center",color:"var(--gold-color)",fontWeight:"bold"},children:"This Wonder stands eternal."})]},i.id)})})},Td=({toasts:r})=>c.jsx("div",{className:"toast-container",children:r.map(e=>c.jsxs("div",{className:`toast ${e.type}`,children:[e.type==="success"&&"‚úÖ",e.type==="warning"&&"‚ö†Ô∏è",e.type==="info"&&"‚ÑπÔ∏è",e.type==="error"&&"‚ùå",c.jsx("span",{children:e.message})]},e.id))}),Ed=()=>{const[r,e]=W.useState(null);if(W.useEffect(()=>{const n=l=>{const m=l.target.closest("[data-tooltip]");if(m){const g=m.getAttribute("data-tooltip");g&&e({text:g,x:l.clientX,y:l.clientY})}else e(null)},i=l=>{r&&e(d=>d?{...d,x:l.clientX,y:l.clientY}:null)},a=()=>{e(null)};return document.addEventListener("mouseover",n),document.addEventListener("mousemove",i),document.addEventListener("mouseout",a),()=>{document.removeEventListener("mouseover",n),document.removeEventListener("mousemove",i),document.removeEventListener("mouseout",a)}},[r]),!r)return null;const t={left:r.x+15,top:r.y+15};return r.x+250>window.innerWidth&&(t.left=r.x-260),r.y+100>window.innerHeight&&(t.top=r.y-50),c.jsx("div",{className:"game-tooltip",style:t,children:r.text})},Cd=({gameState:r})=>{const{weather:e,buildings:t,totalGold:n}=r,i=w=>t[w]||0;let a="wilderness";i("palace")>0?a="empire":i("castle")>0||i("market")>0?a="city":(i("peasant")>20||i("field")>10||n>500)&&(a="hamlet");let l="",d="";switch(a){case"wilderness":l="linear-gradient(to bottom, #87CEEB 0%, #87CEEB 60%, #556B2F 60%, #556B2F 100%)",d="üå≤ üå≥ üå≤ ü¶å üå≤ üåø";break;case"hamlet":l="linear-gradient(to bottom, #87CEEB 0%, #87CEEB 65%, #8B4513 65%, #228B22 80%)",d="üè° üåæ üêÑ üè° üåæ üöú";break;case"city":l="linear-gradient(to bottom, #B0C4DE 0%, #B0C4DE 60%, #696969 60%, #808080 100%)",d="üè∞ üè† ‚öíÔ∏è üè† ‚öñÔ∏è üè†";break;case"empire":l="linear-gradient(to bottom, #191970 0%, #4B0082 50%, #FFD700 100%)",d="üèØ üíÇ üèõÔ∏è üêâ üèõÔ∏è üíÇ";break}const m=e.current;let g="none",f="",_=0;return m==="rainy"?(g="linear-gradient(to bottom, rgba(0,0,50,0.3), rgba(0,0,100,0.3))",f="üåßÔ∏è üåßÔ∏è üåßÔ∏è üåßÔ∏è üåßÔ∏è",_=1):m==="stormy"?(g="linear-gradient(to bottom, rgba(0,0,0,0.6), rgba(50,50,50,0.6))",f="‚ö° ‚õàÔ∏è ‚ö° ‚õàÔ∏è ‚ö°",_=1):m==="sunny"?(g="radial-gradient(circle at top right, rgba(255,255,0,0.3), transparent)",f="‚òÄÔ∏è",_=.6):m==="windy"&&(f="üçÉ üçÉ üçÉ",_=.8),c.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:l,display:"flex",flexDirection:"column",justifyContent:"flex-end",alignItems:"center",paddingBottom:"20vh",zIndex:0,overflow:"hidden",transition:"background 2s ease"},children:[c.jsx("div",{style:{position:"absolute",top:"10%",width:"100%",textAlign:"center",fontSize:"5rem",opacity:_,animation:m==="windy"?"float 3s infinite ease-in-out":"none"},children:f}),g!=="none"&&c.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:g,pointerEvents:"none"}}),c.jsx("div",{style:{fontSize:"4rem",textAlign:"center",zIndex:1,textShadow:"0 4px 4px rgba(0,0,0,0.3)",whiteSpace:"nowrap"},children:d}),c.jsx("div",{style:{marginTop:"20px",fontSize:"1.5rem",color:"#fff",textShadow:"2px 2px 4px #000",fontStyle:"italic",zIndex:2,background:"rgba(0,0,0,0.5)",padding:"5px 15px",borderRadius:"15px"},children:"The Kingdom sleeps..."}),c.jsx("style",{children:`
            @keyframes float {
                0% { transform: translateX(0px); }
                50% { transform: translateX(20px); }
                100% { transform: translateX(0px); }
            }
        `})]})},Ad=()=>{};var ba={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fl=function(r){const e=[];let t=0;for(let n=0;n<r.length;n++){let i=r.charCodeAt(n);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(i=65536+((i&1023)<<10)+(r.charCodeAt(++n)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},Rd=function(r){const e=[];let t=0,n=0;for(;t<r.length;){const i=r[t++];if(i<128)e[n++]=String.fromCharCode(i);else if(i>191&&i<224){const a=r[t++];e[n++]=String.fromCharCode((i&31)<<6|a&63)}else if(i>239&&i<365){const a=r[t++],l=r[t++],d=r[t++],m=((i&7)<<18|(a&63)<<12|(l&63)<<6|d&63)-65536;e[n++]=String.fromCharCode(55296+(m>>10)),e[n++]=String.fromCharCode(56320+(m&1023))}else{const a=r[t++],l=r[t++];e[n++]=String.fromCharCode((i&15)<<12|(a&63)<<6|l&63)}}return e.join("")},Bl={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,e){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let i=0;i<r.length;i+=3){const a=r[i],l=i+1<r.length,d=l?r[i+1]:0,m=i+2<r.length,g=m?r[i+2]:0,f=a>>2,_=(a&3)<<4|d>>4;let w=(d&15)<<2|g>>6,k=g&63;m||(k=64,l||(w=64)),n.push(t[f],t[_],t[w],t[k])}return n.join("")},encodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(r):this.encodeByteArray(Fl(r),e)},decodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(r):Rd(this.decodeStringToByteArray(r,e))},decodeStringToByteArray(r,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let i=0;i<r.length;){const a=t[r.charAt(i++)],d=i<r.length?t[r.charAt(i)]:0;++i;const g=i<r.length?t[r.charAt(i)]:64;++i;const _=i<r.length?t[r.charAt(i)]:64;if(++i,a==null||d==null||g==null||_==null)throw new Sd;const w=a<<2|d>>4;if(n.push(w),g!==64){const k=d<<4&240|g>>2;if(n.push(k),_!==64){const B=g<<6&192|_;n.push(B)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class Sd extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Pd=function(r){const e=Fl(r);return Bl.encodeByteArray(e,!0)},xi=function(r){return Pd(r).replace(/\./g,"")},kd=function(r){try{return Bl.decodeString(r,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dd(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nd=()=>Dd().__FIREBASE_DEFAULTS__,Vd=()=>{if(typeof process>"u"||typeof ba>"u")return;const r=ba.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},jd=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=r&&kd(r[1]);return e&&JSON.parse(e)},$s=()=>{try{return Ad()||Nd()||Vd()||jd()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},Md=r=>{var e,t;return(t=(e=$s())==null?void 0:e.emulatorHosts)==null?void 0:t[r]},Ld=r=>{const e=Md(r);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),n]:[e.substring(0,t),n]},Ul=()=>{var r;return(r=$s())==null?void 0:r.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Od{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,n))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ws(r){try{return(r.startsWith("http://")||r.startsWith("https://")?new URL(r).hostname:r).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Fd(r){return(await fetch(r,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bd(r,e){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},n=e||"demo-project",i=r.iat||0,a=r.sub||r.user_id;if(!a)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const l={iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:a,user_id:a,firebase:{sign_in_provider:"custom",identities:{}},...r};return[xi(JSON.stringify(t)),xi(JSON.stringify(l)),""].join(".")}const bn={};function Ud(){const r={prod:[],emulator:[]};for(const e of Object.keys(bn))bn[e]?r.emulator.push(e):r.prod.push(e);return r}function zd(r){let e=document.getElementById(r),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",r),t=!0),{created:t,element:e}}let xa=!1;function qd(r,e){if(typeof window>"u"||typeof document>"u"||!Ws(window.location.host)||bn[r]===e||bn[r]||xa)return;bn[r]=e;function t(w){return`__firebase__banner__${w}`}const n="__firebase__banner",a=Ud().prod.length>0;function l(){const w=document.getElementById(n);w&&w.remove()}function d(w){w.style.display="flex",w.style.background="#7faaf0",w.style.position="fixed",w.style.bottom="5px",w.style.left="5px",w.style.padding=".5em",w.style.borderRadius="5px",w.style.alignItems="center"}function m(w,k){w.setAttribute("width","24"),w.setAttribute("id",k),w.setAttribute("height","24"),w.setAttribute("viewBox","0 0 24 24"),w.setAttribute("fill","none"),w.style.marginLeft="-6px"}function g(){const w=document.createElement("span");return w.style.cursor="pointer",w.style.marginLeft="16px",w.style.fontSize="24px",w.innerHTML=" &times;",w.onclick=()=>{xa=!0,l()},w}function f(w,k){w.setAttribute("id",k),w.innerText="Learn more",w.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",w.setAttribute("target","__blank"),w.style.paddingLeft="5px",w.style.textDecoration="underline"}function _(){const w=zd(n),k=t("text"),B=document.getElementById(k)||document.createElement("span"),q=t("learnmore"),S=document.getElementById(q)||document.createElement("a"),N=t("preprendIcon"),L=document.getElementById(N)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(w.created){const U=w.element;d(U),f(S,q);const G=g();m(L,N),U.append(L,B,S,G),document.body.appendChild(U)}a?(B.innerText="Preview backend disconnected.",L.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(L.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,B.innerText="Preview backend running in this workspace."),B.setAttribute("id",k)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",_):_()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gd(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function $d(){var e;const r=(e=$s())==null?void 0:e.forceEnvironment;if(r==="node")return!0;if(r==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Wd(){return!$d()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Hd(){try{return typeof indexedDB=="object"}catch{return!1}}function Kd(){return new Promise((r,e)=>{try{let t=!0;const n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(n),r(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var a;e(((a=i.error)==null?void 0:a.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qd="FirebaseError";class qr extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name=Qd,Object.setPrototypeOf(this,qr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,zl.prototype.create)}}class zl{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},i=`${this.service}/${e}`,a=this.errors[e],l=a?Yd(a,n):"Error",d=`${this.serviceName}: ${l} (${i}).`;return new qr(i,d,n)}}function Yd(r,e){return r.replace(Xd,(t,n)=>{const i=e[n];return i!=null?String(i):`<${n}?>`})}const Xd=/\{\$([^}]+)}/g;function wi(r,e){if(r===e)return!0;const t=Object.keys(r),n=Object.keys(e);for(const i of t){if(!n.includes(i))return!1;const a=r[i],l=e[i];if(wa(a)&&wa(l)){if(!wi(a,l))return!1}else if(a!==l)return!1}for(const i of n)if(!t.includes(i))return!1;return!0}function wa(r){return r!==null&&typeof r=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mr(r){return r&&r._delegate?r._delegate:r}class An{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cr="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jd{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const n=new Od;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&n.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),n=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(i){if(n)return null;throw i}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(eh(e))try{this.getOrInitializeService({instanceIdentifier:cr})}catch{}for(const[t,n]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const a=this.getOrInitializeService({instanceIdentifier:i});n.resolve(a)}catch{}}}}clearInstance(e=cr){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=cr){return this.instances.has(e)}getOptions(e=cr){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[a,l]of this.instancesDeferred.entries()){const d=this.normalizeInstanceIdentifier(a);n===d&&l.resolve(i)}return i}onInit(e,t){const n=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(n)??new Set;i.add(e),this.onInitCallbacks.set(n,i);const a=this.instances.get(n);return a&&e(a,n),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:Zd(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=cr){return this.component?this.component.multipleInstances?e:cr:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Zd(r){return r===cr?void 0:r}function eh(r){return r.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class th{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Jd(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ge;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(ge||(ge={}));const rh={debug:ge.DEBUG,verbose:ge.VERBOSE,info:ge.INFO,warn:ge.WARN,error:ge.ERROR,silent:ge.SILENT},nh=ge.INFO,ih={[ge.DEBUG]:"log",[ge.VERBOSE]:"log",[ge.INFO]:"info",[ge.WARN]:"warn",[ge.ERROR]:"error"},sh=(r,e,...t)=>{if(e<r.logLevel)return;const n=new Date().toISOString(),i=ih[e];if(i)console[i](`[${n}]  ${r.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class ql{constructor(e){this.name=e,this._logLevel=nh,this._logHandler=sh,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ge))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?rh[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ge.DEBUG,...e),this._logHandler(this,ge.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ge.VERBOSE,...e),this._logHandler(this,ge.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ge.INFO,...e),this._logHandler(this,ge.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ge.WARN,...e),this._logHandler(this,ge.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ge.ERROR,...e),this._logHandler(this,ge.ERROR,...e)}}const oh=(r,e)=>e.some(t=>r instanceof t);let Ia,Ta;function ah(){return Ia||(Ia=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function lh(){return Ta||(Ta=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Gl=new WeakMap,Is=new WeakMap,$l=new WeakMap,hs=new WeakMap,Hs=new WeakMap;function ch(r){const e=new Promise((t,n)=>{const i=()=>{r.removeEventListener("success",a),r.removeEventListener("error",l)},a=()=>{t(Ut(r.result)),i()},l=()=>{n(r.error),i()};r.addEventListener("success",a),r.addEventListener("error",l)});return e.then(t=>{t instanceof IDBCursor&&Gl.set(t,r)}).catch(()=>{}),Hs.set(e,r),e}function uh(r){if(Is.has(r))return;const e=new Promise((t,n)=>{const i=()=>{r.removeEventListener("complete",a),r.removeEventListener("error",l),r.removeEventListener("abort",l)},a=()=>{t(),i()},l=()=>{n(r.error||new DOMException("AbortError","AbortError")),i()};r.addEventListener("complete",a),r.addEventListener("error",l),r.addEventListener("abort",l)});Is.set(r,e)}let Ts={get(r,e,t){if(r instanceof IDBTransaction){if(e==="done")return Is.get(r);if(e==="objectStoreNames")return r.objectStoreNames||$l.get(r);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Ut(r[e])},set(r,e,t){return r[e]=t,!0},has(r,e){return r instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in r}};function dh(r){Ts=r(Ts)}function hh(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const n=r.call(ms(this),e,...t);return $l.set(n,e.sort?e.sort():[e]),Ut(n)}:lh().includes(r)?function(...e){return r.apply(ms(this),e),Ut(Gl.get(this))}:function(...e){return Ut(r.apply(ms(this),e))}}function mh(r){return typeof r=="function"?hh(r):(r instanceof IDBTransaction&&uh(r),oh(r,ah())?new Proxy(r,Ts):r)}function Ut(r){if(r instanceof IDBRequest)return ch(r);if(hs.has(r))return hs.get(r);const e=mh(r);return e!==r&&(hs.set(r,e),Hs.set(e,r)),e}const ms=r=>Hs.get(r);function gh(r,e,{blocked:t,upgrade:n,blocking:i,terminated:a}={}){const l=indexedDB.open(r,e),d=Ut(l);return n&&l.addEventListener("upgradeneeded",m=>{n(Ut(l.result),m.oldVersion,m.newVersion,Ut(l.transaction),m)}),t&&l.addEventListener("blocked",m=>t(m.oldVersion,m.newVersion,m)),d.then(m=>{a&&m.addEventListener("close",()=>a()),i&&m.addEventListener("versionchange",g=>i(g.oldVersion,g.newVersion,g))}).catch(()=>{}),d}const ph=["get","getKey","getAll","getAllKeys","count"],fh=["put","add","delete","clear"],gs=new Map;function Ea(r,e){if(!(r instanceof IDBDatabase&&!(e in r)&&typeof e=="string"))return;if(gs.get(e))return gs.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,i=fh.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(i||ph.includes(t)))return;const a=async function(l,...d){const m=this.transaction(l,i?"readwrite":"readonly");let g=m.store;return n&&(g=g.index(d.shift())),(await Promise.all([g[t](...d),i&&m.done]))[0]};return gs.set(e,a),a}dh(r=>({...r,get:(e,t,n)=>Ea(e,t)||r.get(e,t,n),has:(e,t)=>!!Ea(e,t)||r.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yh{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(_h(t)){const n=t.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(t=>t).join(" ")}}function _h(r){const e=r.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Es="@firebase/app",Ca="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Et=new ql("@firebase/app"),vh="@firebase/app-compat",bh="@firebase/analytics-compat",xh="@firebase/analytics",wh="@firebase/app-check-compat",Ih="@firebase/app-check",Th="@firebase/auth",Eh="@firebase/auth-compat",Ch="@firebase/database",Ah="@firebase/data-connect",Rh="@firebase/database-compat",Sh="@firebase/functions",Ph="@firebase/functions-compat",kh="@firebase/installations",Dh="@firebase/installations-compat",Nh="@firebase/messaging",Vh="@firebase/messaging-compat",jh="@firebase/performance",Mh="@firebase/performance-compat",Lh="@firebase/remote-config",Oh="@firebase/remote-config-compat",Fh="@firebase/storage",Bh="@firebase/storage-compat",Uh="@firebase/firestore",zh="@firebase/ai",qh="@firebase/firestore-compat",Gh="firebase",$h="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cs="[DEFAULT]",Wh={[Es]:"fire-core",[vh]:"fire-core-compat",[xh]:"fire-analytics",[bh]:"fire-analytics-compat",[Ih]:"fire-app-check",[wh]:"fire-app-check-compat",[Th]:"fire-auth",[Eh]:"fire-auth-compat",[Ch]:"fire-rtdb",[Ah]:"fire-data-connect",[Rh]:"fire-rtdb-compat",[Sh]:"fire-fn",[Ph]:"fire-fn-compat",[kh]:"fire-iid",[Dh]:"fire-iid-compat",[Nh]:"fire-fcm",[Vh]:"fire-fcm-compat",[jh]:"fire-perf",[Mh]:"fire-perf-compat",[Lh]:"fire-rc",[Oh]:"fire-rc-compat",[Fh]:"fire-gcs",[Bh]:"fire-gcs-compat",[Uh]:"fire-fst",[qh]:"fire-fst-compat",[zh]:"fire-vertex","fire-js":"fire-js",[Gh]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ii=new Map,Hh=new Map,As=new Map;function Aa(r,e){try{r.container.addComponent(e)}catch(t){Et.debug(`Component ${e.name} failed to register with FirebaseApp ${r.name}`,t)}}function Ti(r){const e=r.name;if(As.has(e))return Et.debug(`There were multiple attempts to register component ${e}.`),!1;As.set(e,r);for(const t of Ii.values())Aa(t,r);for(const t of Hh.values())Aa(t,r);return!0}function Kh(r,e){const t=r.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),r.container.getProvider(e)}function Qh(r){return r==null?!1:r.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yh={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},zt=new zl("app","Firebase",Yh);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xh{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new An("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw zt.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jh=$h;function Wl(r,e={}){let t=r;typeof e!="object"&&(e={name:e});const n={name:Cs,automaticDataCollectionEnabled:!0,...e},i=n.name;if(typeof i!="string"||!i)throw zt.create("bad-app-name",{appName:String(i)});if(t||(t=Ul()),!t)throw zt.create("no-options");const a=Ii.get(i);if(a){if(wi(t,a.options)&&wi(n,a.config))return a;throw zt.create("duplicate-app",{appName:i})}const l=new th(i);for(const m of As.values())l.addComponent(m);const d=new Xh(t,n,l);return Ii.set(i,d),d}function Zh(r=Cs){const e=Ii.get(r);if(!e&&r===Cs&&Ul())return Wl();if(!e)throw zt.create("no-app",{appName:r});return e}function Dr(r,e,t){let n=Wh[r]??r;t&&(n+=`-${t}`);const i=n.match(/\s|\//),a=e.match(/\s|\//);if(i||a){const l=[`Unable to register library "${n}" with version "${e}":`];i&&l.push(`library name "${n}" contains illegal characters (whitespace or "/")`),i&&a&&l.push("and"),a&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Et.warn(l.join(" "));return}Ti(new An(`${n}-version`,()=>({library:n,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const em="firebase-heartbeat-database",tm=1,Rn="firebase-heartbeat-store";let ps=null;function Hl(){return ps||(ps=gh(em,tm,{upgrade:(r,e)=>{switch(e){case 0:try{r.createObjectStore(Rn)}catch(t){console.warn(t)}}}}).catch(r=>{throw zt.create("idb-open",{originalErrorMessage:r.message})})),ps}async function rm(r){try{const t=(await Hl()).transaction(Rn),n=await t.objectStore(Rn).get(Kl(r));return await t.done,n}catch(e){if(e instanceof qr)Et.warn(e.message);else{const t=zt.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Et.warn(t.message)}}}async function Ra(r,e){try{const n=(await Hl()).transaction(Rn,"readwrite");await n.objectStore(Rn).put(e,Kl(r)),await n.done}catch(t){if(t instanceof qr)Et.warn(t.message);else{const n=zt.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Et.warn(n.message)}}}function Kl(r){return`${r.name}!${r.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nm=1024,im=30;class sm{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new am(t),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){var e,t;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),a=Sa();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===a||this._heartbeatsCache.heartbeats.some(l=>l.date===a))return;if(this._heartbeatsCache.heartbeats.push({date:a,agent:i}),this._heartbeatsCache.heartbeats.length>im){const l=lm(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(l,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(n){Et.warn(n)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Sa(),{heartbeatsToSend:n,unsentEntries:i}=om(this._heartbeatsCache.heartbeats),a=xi(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),a}catch(t){return Et.warn(t),""}}}function Sa(){return new Date().toISOString().substring(0,10)}function om(r,e=nm){const t=[];let n=r.slice();for(const i of r){const a=t.find(l=>l.agent===i.agent);if(a){if(a.dates.push(i.date),Pa(t)>e){a.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),Pa(t)>e){t.pop();break}n=n.slice(1)}return{heartbeatsToSend:t,unsentEntries:n}}class am{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Hd()?Kd().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await rm(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const n=await this.read();return Ra(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const n=await this.read();return Ra(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}else return}}function Pa(r){return xi(JSON.stringify({version:2,heartbeats:r})).length}function lm(r){if(r.length===0)return-1;let e=0,t=r[0].date;for(let n=1;n<r.length;n++)r[n].date<t&&(t=r[n].date,e=n);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cm(r){Ti(new An("platform-logger",e=>new yh(e),"PRIVATE")),Ti(new An("heartbeat",e=>new sm(e),"PRIVATE")),Dr(Es,Ca,r),Dr(Es,Ca,"esm2020"),Dr("fire-js","")}cm("");var um="firebase",dm="12.7.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Dr(um,dm,"app");var ka=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var qt,Ql;(function(){var r;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(I,v){function x(){}x.prototype=v.prototype,I.F=v.prototype,I.prototype=new x,I.prototype.constructor=I,I.D=function(T,b,E){for(var y=Array(arguments.length-2),te=2;te<arguments.length;te++)y[te-2]=arguments[te];return v.prototype[b].apply(T,y)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(n,t),n.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(I,v,x){x||(x=0);const T=Array(16);if(typeof v=="string")for(var b=0;b<16;++b)T[b]=v.charCodeAt(x++)|v.charCodeAt(x++)<<8|v.charCodeAt(x++)<<16|v.charCodeAt(x++)<<24;else for(b=0;b<16;++b)T[b]=v[x++]|v[x++]<<8|v[x++]<<16|v[x++]<<24;v=I.g[0],x=I.g[1],b=I.g[2];let E=I.g[3],y;y=v+(E^x&(b^E))+T[0]+3614090360&4294967295,v=x+(y<<7&4294967295|y>>>25),y=E+(b^v&(x^b))+T[1]+3905402710&4294967295,E=v+(y<<12&4294967295|y>>>20),y=b+(x^E&(v^x))+T[2]+606105819&4294967295,b=E+(y<<17&4294967295|y>>>15),y=x+(v^b&(E^v))+T[3]+3250441966&4294967295,x=b+(y<<22&4294967295|y>>>10),y=v+(E^x&(b^E))+T[4]+4118548399&4294967295,v=x+(y<<7&4294967295|y>>>25),y=E+(b^v&(x^b))+T[5]+1200080426&4294967295,E=v+(y<<12&4294967295|y>>>20),y=b+(x^E&(v^x))+T[6]+2821735955&4294967295,b=E+(y<<17&4294967295|y>>>15),y=x+(v^b&(E^v))+T[7]+4249261313&4294967295,x=b+(y<<22&4294967295|y>>>10),y=v+(E^x&(b^E))+T[8]+1770035416&4294967295,v=x+(y<<7&4294967295|y>>>25),y=E+(b^v&(x^b))+T[9]+2336552879&4294967295,E=v+(y<<12&4294967295|y>>>20),y=b+(x^E&(v^x))+T[10]+4294925233&4294967295,b=E+(y<<17&4294967295|y>>>15),y=x+(v^b&(E^v))+T[11]+2304563134&4294967295,x=b+(y<<22&4294967295|y>>>10),y=v+(E^x&(b^E))+T[12]+1804603682&4294967295,v=x+(y<<7&4294967295|y>>>25),y=E+(b^v&(x^b))+T[13]+4254626195&4294967295,E=v+(y<<12&4294967295|y>>>20),y=b+(x^E&(v^x))+T[14]+2792965006&4294967295,b=E+(y<<17&4294967295|y>>>15),y=x+(v^b&(E^v))+T[15]+1236535329&4294967295,x=b+(y<<22&4294967295|y>>>10),y=v+(b^E&(x^b))+T[1]+4129170786&4294967295,v=x+(y<<5&4294967295|y>>>27),y=E+(x^b&(v^x))+T[6]+3225465664&4294967295,E=v+(y<<9&4294967295|y>>>23),y=b+(v^x&(E^v))+T[11]+643717713&4294967295,b=E+(y<<14&4294967295|y>>>18),y=x+(E^v&(b^E))+T[0]+3921069994&4294967295,x=b+(y<<20&4294967295|y>>>12),y=v+(b^E&(x^b))+T[5]+3593408605&4294967295,v=x+(y<<5&4294967295|y>>>27),y=E+(x^b&(v^x))+T[10]+38016083&4294967295,E=v+(y<<9&4294967295|y>>>23),y=b+(v^x&(E^v))+T[15]+3634488961&4294967295,b=E+(y<<14&4294967295|y>>>18),y=x+(E^v&(b^E))+T[4]+3889429448&4294967295,x=b+(y<<20&4294967295|y>>>12),y=v+(b^E&(x^b))+T[9]+568446438&4294967295,v=x+(y<<5&4294967295|y>>>27),y=E+(x^b&(v^x))+T[14]+3275163606&4294967295,E=v+(y<<9&4294967295|y>>>23),y=b+(v^x&(E^v))+T[3]+4107603335&4294967295,b=E+(y<<14&4294967295|y>>>18),y=x+(E^v&(b^E))+T[8]+1163531501&4294967295,x=b+(y<<20&4294967295|y>>>12),y=v+(b^E&(x^b))+T[13]+2850285829&4294967295,v=x+(y<<5&4294967295|y>>>27),y=E+(x^b&(v^x))+T[2]+4243563512&4294967295,E=v+(y<<9&4294967295|y>>>23),y=b+(v^x&(E^v))+T[7]+1735328473&4294967295,b=E+(y<<14&4294967295|y>>>18),y=x+(E^v&(b^E))+T[12]+2368359562&4294967295,x=b+(y<<20&4294967295|y>>>12),y=v+(x^b^E)+T[5]+4294588738&4294967295,v=x+(y<<4&4294967295|y>>>28),y=E+(v^x^b)+T[8]+2272392833&4294967295,E=v+(y<<11&4294967295|y>>>21),y=b+(E^v^x)+T[11]+1839030562&4294967295,b=E+(y<<16&4294967295|y>>>16),y=x+(b^E^v)+T[14]+4259657740&4294967295,x=b+(y<<23&4294967295|y>>>9),y=v+(x^b^E)+T[1]+2763975236&4294967295,v=x+(y<<4&4294967295|y>>>28),y=E+(v^x^b)+T[4]+1272893353&4294967295,E=v+(y<<11&4294967295|y>>>21),y=b+(E^v^x)+T[7]+4139469664&4294967295,b=E+(y<<16&4294967295|y>>>16),y=x+(b^E^v)+T[10]+3200236656&4294967295,x=b+(y<<23&4294967295|y>>>9),y=v+(x^b^E)+T[13]+681279174&4294967295,v=x+(y<<4&4294967295|y>>>28),y=E+(v^x^b)+T[0]+3936430074&4294967295,E=v+(y<<11&4294967295|y>>>21),y=b+(E^v^x)+T[3]+3572445317&4294967295,b=E+(y<<16&4294967295|y>>>16),y=x+(b^E^v)+T[6]+76029189&4294967295,x=b+(y<<23&4294967295|y>>>9),y=v+(x^b^E)+T[9]+3654602809&4294967295,v=x+(y<<4&4294967295|y>>>28),y=E+(v^x^b)+T[12]+3873151461&4294967295,E=v+(y<<11&4294967295|y>>>21),y=b+(E^v^x)+T[15]+530742520&4294967295,b=E+(y<<16&4294967295|y>>>16),y=x+(b^E^v)+T[2]+3299628645&4294967295,x=b+(y<<23&4294967295|y>>>9),y=v+(b^(x|~E))+T[0]+4096336452&4294967295,v=x+(y<<6&4294967295|y>>>26),y=E+(x^(v|~b))+T[7]+1126891415&4294967295,E=v+(y<<10&4294967295|y>>>22),y=b+(v^(E|~x))+T[14]+2878612391&4294967295,b=E+(y<<15&4294967295|y>>>17),y=x+(E^(b|~v))+T[5]+4237533241&4294967295,x=b+(y<<21&4294967295|y>>>11),y=v+(b^(x|~E))+T[12]+1700485571&4294967295,v=x+(y<<6&4294967295|y>>>26),y=E+(x^(v|~b))+T[3]+2399980690&4294967295,E=v+(y<<10&4294967295|y>>>22),y=b+(v^(E|~x))+T[10]+4293915773&4294967295,b=E+(y<<15&4294967295|y>>>17),y=x+(E^(b|~v))+T[1]+2240044497&4294967295,x=b+(y<<21&4294967295|y>>>11),y=v+(b^(x|~E))+T[8]+1873313359&4294967295,v=x+(y<<6&4294967295|y>>>26),y=E+(x^(v|~b))+T[15]+4264355552&4294967295,E=v+(y<<10&4294967295|y>>>22),y=b+(v^(E|~x))+T[6]+2734768916&4294967295,b=E+(y<<15&4294967295|y>>>17),y=x+(E^(b|~v))+T[13]+1309151649&4294967295,x=b+(y<<21&4294967295|y>>>11),y=v+(b^(x|~E))+T[4]+4149444226&4294967295,v=x+(y<<6&4294967295|y>>>26),y=E+(x^(v|~b))+T[11]+3174756917&4294967295,E=v+(y<<10&4294967295|y>>>22),y=b+(v^(E|~x))+T[2]+718787259&4294967295,b=E+(y<<15&4294967295|y>>>17),y=x+(E^(b|~v))+T[9]+3951481745&4294967295,I.g[0]=I.g[0]+v&4294967295,I.g[1]=I.g[1]+(b+(y<<21&4294967295|y>>>11))&4294967295,I.g[2]=I.g[2]+b&4294967295,I.g[3]=I.g[3]+E&4294967295}n.prototype.v=function(I,v){v===void 0&&(v=I.length);const x=v-this.blockSize,T=this.C;let b=this.h,E=0;for(;E<v;){if(b==0)for(;E<=x;)i(this,I,E),E+=this.blockSize;if(typeof I=="string"){for(;E<v;)if(T[b++]=I.charCodeAt(E++),b==this.blockSize){i(this,T),b=0;break}}else for(;E<v;)if(T[b++]=I[E++],b==this.blockSize){i(this,T),b=0;break}}this.h=b,this.o+=v},n.prototype.A=function(){var I=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);I[0]=128;for(var v=1;v<I.length-8;++v)I[v]=0;v=this.o*8;for(var x=I.length-8;x<I.length;++x)I[x]=v&255,v/=256;for(this.v(I),I=Array(16),v=0,x=0;x<4;++x)for(let T=0;T<32;T+=8)I[v++]=this.g[x]>>>T&255;return I};function a(I,v){var x=d;return Object.prototype.hasOwnProperty.call(x,I)?x[I]:x[I]=v(I)}function l(I,v){this.h=v;const x=[];let T=!0;for(let b=I.length-1;b>=0;b--){const E=I[b]|0;T&&E==v||(x[b]=E,T=!1)}this.g=x}var d={};function m(I){return-128<=I&&I<128?a(I,function(v){return new l([v|0],v<0?-1:0)}):new l([I|0],I<0?-1:0)}function g(I){if(isNaN(I)||!isFinite(I))return _;if(I<0)return S(g(-I));const v=[];let x=1;for(let T=0;I>=x;T++)v[T]=I/x|0,x*=4294967296;return new l(v,0)}function f(I,v){if(I.length==0)throw Error("number format error: empty string");if(v=v||10,v<2||36<v)throw Error("radix out of range: "+v);if(I.charAt(0)=="-")return S(f(I.substring(1),v));if(I.indexOf("-")>=0)throw Error('number format error: interior "-" character');const x=g(Math.pow(v,8));let T=_;for(let E=0;E<I.length;E+=8){var b=Math.min(8,I.length-E);const y=parseInt(I.substring(E,E+b),v);b<8?(b=g(Math.pow(v,b)),T=T.j(b).add(g(y))):(T=T.j(x),T=T.add(g(y)))}return T}var _=m(0),w=m(1),k=m(16777216);r=l.prototype,r.m=function(){if(q(this))return-S(this).m();let I=0,v=1;for(let x=0;x<this.g.length;x++){const T=this.i(x);I+=(T>=0?T:4294967296+T)*v,v*=4294967296}return I},r.toString=function(I){if(I=I||10,I<2||36<I)throw Error("radix out of range: "+I);if(B(this))return"0";if(q(this))return"-"+S(this).toString(I);const v=g(Math.pow(I,6));var x=this;let T="";for(;;){const b=G(x,v).g;x=N(x,b.j(v));let E=((x.g.length>0?x.g[0]:x.h)>>>0).toString(I);if(x=b,B(x))return E+T;for(;E.length<6;)E="0"+E;T=E+T}},r.i=function(I){return I<0?0:I<this.g.length?this.g[I]:this.h};function B(I){if(I.h!=0)return!1;for(let v=0;v<I.g.length;v++)if(I.g[v]!=0)return!1;return!0}function q(I){return I.h==-1}r.l=function(I){return I=N(this,I),q(I)?-1:B(I)?0:1};function S(I){const v=I.g.length,x=[];for(let T=0;T<v;T++)x[T]=~I.g[T];return new l(x,~I.h).add(w)}r.abs=function(){return q(this)?S(this):this},r.add=function(I){const v=Math.max(this.g.length,I.g.length),x=[];let T=0;for(let b=0;b<=v;b++){let E=T+(this.i(b)&65535)+(I.i(b)&65535),y=(E>>>16)+(this.i(b)>>>16)+(I.i(b)>>>16);T=y>>>16,E&=65535,y&=65535,x[b]=y<<16|E}return new l(x,x[x.length-1]&-2147483648?-1:0)};function N(I,v){return I.add(S(v))}r.j=function(I){if(B(this)||B(I))return _;if(q(this))return q(I)?S(this).j(S(I)):S(S(this).j(I));if(q(I))return S(this.j(S(I)));if(this.l(k)<0&&I.l(k)<0)return g(this.m()*I.m());const v=this.g.length+I.g.length,x=[];for(var T=0;T<2*v;T++)x[T]=0;for(T=0;T<this.g.length;T++)for(let b=0;b<I.g.length;b++){const E=this.i(T)>>>16,y=this.i(T)&65535,te=I.i(b)>>>16,he=I.i(b)&65535;x[2*T+2*b]+=y*he,L(x,2*T+2*b),x[2*T+2*b+1]+=E*he,L(x,2*T+2*b+1),x[2*T+2*b+1]+=y*te,L(x,2*T+2*b+1),x[2*T+2*b+2]+=E*te,L(x,2*T+2*b+2)}for(I=0;I<v;I++)x[I]=x[2*I+1]<<16|x[2*I];for(I=v;I<2*v;I++)x[I]=0;return new l(x,0)};function L(I,v){for(;(I[v]&65535)!=I[v];)I[v+1]+=I[v]>>>16,I[v]&=65535,v++}function U(I,v){this.g=I,this.h=v}function G(I,v){if(B(v))throw Error("division by zero");if(B(I))return new U(_,_);if(q(I))return v=G(S(I),v),new U(S(v.g),S(v.h));if(q(v))return v=G(I,S(v)),new U(S(v.g),v.h);if(I.g.length>30){if(q(I)||q(v))throw Error("slowDivide_ only works with positive integers.");for(var x=w,T=v;T.l(I)<=0;)x=Z(x),T=Z(T);var b=J(x,1),E=J(T,1);for(T=J(T,2),x=J(x,2);!B(T);){var y=E.add(T);y.l(I)<=0&&(b=b.add(x),E=y),T=J(T,1),x=J(x,1)}return v=N(I,b.j(v)),new U(b,v)}for(b=_;I.l(v)>=0;){for(x=Math.max(1,Math.floor(I.m()/v.m())),T=Math.ceil(Math.log(x)/Math.LN2),T=T<=48?1:Math.pow(2,T-48),E=g(x),y=E.j(v);q(y)||y.l(I)>0;)x-=T,E=g(x),y=E.j(v);B(E)&&(E=w),b=b.add(E),I=N(I,y)}return new U(b,I)}r.B=function(I){return G(this,I).h},r.and=function(I){const v=Math.max(this.g.length,I.g.length),x=[];for(let T=0;T<v;T++)x[T]=this.i(T)&I.i(T);return new l(x,this.h&I.h)},r.or=function(I){const v=Math.max(this.g.length,I.g.length),x=[];for(let T=0;T<v;T++)x[T]=this.i(T)|I.i(T);return new l(x,this.h|I.h)},r.xor=function(I){const v=Math.max(this.g.length,I.g.length),x=[];for(let T=0;T<v;T++)x[T]=this.i(T)^I.i(T);return new l(x,this.h^I.h)};function Z(I){const v=I.g.length+1,x=[];for(let T=0;T<v;T++)x[T]=I.i(T)<<1|I.i(T-1)>>>31;return new l(x,I.h)}function J(I,v){const x=v>>5;v%=32;const T=I.g.length-x,b=[];for(let E=0;E<T;E++)b[E]=v>0?I.i(E+x)>>>v|I.i(E+x+1)<<32-v:I.i(E+x);return new l(b,I.h)}n.prototype.digest=n.prototype.A,n.prototype.reset=n.prototype.u,n.prototype.update=n.prototype.v,Ql=n,l.prototype.add=l.prototype.add,l.prototype.multiply=l.prototype.j,l.prototype.modulo=l.prototype.B,l.prototype.compare=l.prototype.l,l.prototype.toNumber=l.prototype.m,l.prototype.toString=l.prototype.toString,l.prototype.getBits=l.prototype.i,l.fromNumber=g,l.fromString=f,qt=l}).apply(typeof ka<"u"?ka:typeof self<"u"?self:typeof window<"u"?window:{});var ii=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Yl,yn,Xl,ui,Rs,Jl,Zl,ec;(function(){var r,e=Object.defineProperty;function t(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof ii=="object"&&ii];for(var u=0;u<o.length;++u){var h=o[u];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var n=t(this);function i(o,u){if(u)e:{var h=n;o=o.split(".");for(var p=0;p<o.length-1;p++){var R=o[p];if(!(R in h))break e;h=h[R]}o=o[o.length-1],p=h[o],u=u(p),u!=p&&u!=null&&e(h,o,{configurable:!0,writable:!0,value:u})}}i("Symbol.dispose",function(o){return o||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(o){return o||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(o){return o||function(u){var h=[],p;for(p in u)Object.prototype.hasOwnProperty.call(u,p)&&h.push([p,u[p]]);return h}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var a=a||{},l=this||self;function d(o){var u=typeof o;return u=="object"&&o!=null||u=="function"}function m(o,u,h){return o.call.apply(o.bind,arguments)}function g(o,u,h){return g=m,g.apply(null,arguments)}function f(o,u){var h=Array.prototype.slice.call(arguments,1);return function(){var p=h.slice();return p.push.apply(p,arguments),o.apply(this,p)}}function _(o,u){function h(){}h.prototype=u.prototype,o.Z=u.prototype,o.prototype=new h,o.prototype.constructor=o,o.Ob=function(p,R,P){for(var H=Array(arguments.length-2),ce=2;ce<arguments.length;ce++)H[ce-2]=arguments[ce];return u.prototype[R].apply(p,H)}}var w=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?o=>o&&AsyncContext.Snapshot.wrap(o):o=>o;function k(o){const u=o.length;if(u>0){const h=Array(u);for(let p=0;p<u;p++)h[p]=o[p];return h}return[]}function B(o,u){for(let p=1;p<arguments.length;p++){const R=arguments[p];var h=typeof R;if(h=h!="object"?h:R?Array.isArray(R)?"array":h:"null",h=="array"||h=="object"&&typeof R.length=="number"){h=o.length||0;const P=R.length||0;o.length=h+P;for(let H=0;H<P;H++)o[h+H]=R[H]}else o.push(R)}}class q{constructor(u,h){this.i=u,this.j=h,this.h=0,this.g=null}get(){let u;return this.h>0?(this.h--,u=this.g,this.g=u.next,u.next=null):u=this.i(),u}}function S(o){l.setTimeout(()=>{throw o},0)}function N(){var o=I;let u=null;return o.g&&(u=o.g,o.g=o.g.next,o.g||(o.h=null),u.next=null),u}class L{constructor(){this.h=this.g=null}add(u,h){const p=U.get();p.set(u,h),this.h?this.h.next=p:this.g=p,this.h=p}}var U=new q(()=>new G,o=>o.reset());class G{constructor(){this.next=this.g=this.h=null}set(u,h){this.h=u,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let Z,J=!1,I=new L,v=()=>{const o=Promise.resolve(void 0);Z=()=>{o.then(x)}};function x(){for(var o;o=N();){try{o.h.call(o.g)}catch(h){S(h)}var u=U;u.j(o),u.h<100&&(u.h++,o.next=u.g,u.g=o)}J=!1}function T(){this.u=this.u,this.C=this.C}T.prototype.u=!1,T.prototype.dispose=function(){this.u||(this.u=!0,this.N())},T.prototype[Symbol.dispose]=function(){this.dispose()},T.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function b(o,u){this.type=o,this.g=this.target=u,this.defaultPrevented=!1}b.prototype.h=function(){this.defaultPrevented=!0};var E=(function(){if(!l.addEventListener||!Object.defineProperty)return!1;var o=!1,u=Object.defineProperty({},"passive",{get:function(){o=!0}});try{const h=()=>{};l.addEventListener("test",h,u),l.removeEventListener("test",h,u)}catch{}return o})();function y(o){return/^[\s\xa0]*$/.test(o)}function te(o,u){b.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o&&this.init(o,u)}_(te,b),te.prototype.init=function(o,u){const h=this.type=o.type,p=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;this.target=o.target||o.srcElement,this.g=u,u=o.relatedTarget,u||(h=="mouseover"?u=o.fromElement:h=="mouseout"&&(u=o.toElement)),this.relatedTarget=u,p?(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=o.pointerType,this.state=o.state,this.i=o,o.defaultPrevented&&te.Z.h.call(this)},te.prototype.h=function(){te.Z.h.call(this);const o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var he="closure_listenable_"+(Math.random()*1e6|0),be=0;function Qe(o,u,h,p,R){this.listener=o,this.proxy=null,this.src=u,this.type=h,this.capture=!!p,this.ha=R,this.key=++be,this.da=this.fa=!1}function Fe(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function Ae(o,u,h){for(const p in o)u.call(h,o[p],p,o)}function yt(o,u){for(const h in o)u.call(void 0,o[h],h,o)}function X(o){const u={};for(const h in o)u[h]=o[h];return u}const st="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function oe(o,u){let h,p;for(let R=1;R<arguments.length;R++){p=arguments[R];for(h in p)o[h]=p[h];for(let P=0;P<st.length;P++)h=st[P],Object.prototype.hasOwnProperty.call(p,h)&&(o[h]=p[h])}}function _t(o){this.src=o,this.g={},this.h=0}_t.prototype.add=function(o,u,h,p,R){const P=o.toString();o=this.g[P],o||(o=this.g[P]=[],this.h++);const H=Ze(o,u,p,R);return H>-1?(u=o[H],h||(u.fa=!1)):(u=new Qe(u,this.src,P,!!p,R),u.fa=h,o.push(u)),u};function vt(o,u){const h=u.type;if(h in o.g){var p=o.g[h],R=Array.prototype.indexOf.call(p,u,void 0),P;(P=R>=0)&&Array.prototype.splice.call(p,R,1),P&&(Fe(u),o.g[h].length==0&&(delete o.g[h],o.h--))}}function Ze(o,u,h,p){for(let R=0;R<o.length;++R){const P=o[R];if(!P.da&&P.listener==u&&P.capture==!!h&&P.ha==p)return R}return-1}var Qr="closure_lm_"+(Math.random()*1e6|0),ot={};function _r(o,u,h,p,R){if(Array.isArray(u)){for(let P=0;P<u.length;P++)_r(o,u[P],h,p,R);return null}return h=Zr(h),o&&o[he]?o.J(u,h,d(p)?!!p.capture:!1,R):qn(o,u,h,!1,p,R)}function qn(o,u,h,p,R,P){if(!u)throw Error("Invalid event type");const H=d(R)?!!R.capture:!!R;let ce=Jr(o);if(ce||(o[Qr]=ce=new _t(o)),h=ce.add(u,h,p,H,P),h.proxy)return h;if(p=Yr(),h.proxy=p,p.src=o,p.listener=h,o.addEventListener)E||(R=H),R===void 0&&(R=!1),o.addEventListener(u.toString(),p,R);else if(o.attachEvent)o.attachEvent(St(u.toString()),p);else if(o.addListener&&o.removeListener)o.addListener(p);else throw Error("addEventListener and attachEvent are unavailable.");return h}function Yr(){function o(h){return u.call(o.src,o.listener,h)}const u=Xr;return o}function Rt(o,u,h,p,R){if(Array.isArray(u))for(var P=0;P<u.length;P++)Rt(o,u[P],h,p,R);else p=d(p)?!!p.capture:!!p,h=Zr(h),o&&o[he]?(o=o.i,P=String(u).toString(),P in o.g&&(u=o.g[P],h=Ze(u,h,p,R),h>-1&&(Fe(u[h]),Array.prototype.splice.call(u,h,1),u.length==0&&(delete o.g[P],o.h--)))):o&&(o=Jr(o))&&(u=o.g[u.toString()],o=-1,u&&(o=Ze(u,h,p,R)),(h=o>-1?u[o]:null)&&er(h))}function er(o){if(typeof o!="number"&&o&&!o.da){var u=o.src;if(u&&u[he])vt(u.i,o);else{var h=o.type,p=o.proxy;u.removeEventListener?u.removeEventListener(h,p,o.capture):u.detachEvent?u.detachEvent(St(h),p):u.addListener&&u.removeListener&&u.removeListener(p),(h=Jr(u))?(vt(h,o),h.h==0&&(h.src=null,u[Qr]=null)):Fe(o)}}}function St(o){return o in ot?ot[o]:ot[o]="on"+o}function Xr(o,u){if(o.da)o=!0;else{u=new te(u,this);const h=o.listener,p=o.ha||o.src;o.fa&&er(o),o=h.call(p,u)}return o}function Jr(o){return o=o[Qr],o instanceof _t?o:null}var vr="__closure_events_fn_"+(Math.random()*1e9>>>0);function Zr(o){return typeof o=="function"?o:(o[vr]||(o[vr]=function(u){return o.handleEvent(u)}),o[vr])}function De(){T.call(this),this.i=new _t(this),this.M=this,this.G=null}_(De,T),De.prototype[he]=!0,De.prototype.removeEventListener=function(o,u,h,p){Rt(this,o,u,h,p)};function Me(o,u){var h,p=o.G;if(p)for(h=[];p;p=p.G)h.push(p);if(o=o.M,p=u.type||u,typeof u=="string")u=new b(u,o);else if(u instanceof b)u.target=u.target||o;else{var R=u;u=new b(p,o),oe(u,R)}R=!0;let P,H;if(h)for(H=h.length-1;H>=0;H--)P=u.g=h[H],R=tr(P,p,!0,u)&&R;if(P=u.g=o,R=tr(P,p,!0,u)&&R,R=tr(P,p,!1,u)&&R,h)for(H=0;H<h.length;H++)P=u.g=h[H],R=tr(P,p,!1,u)&&R}De.prototype.N=function(){if(De.Z.N.call(this),this.i){var o=this.i;for(const u in o.g){const h=o.g[u];for(let p=0;p<h.length;p++)Fe(h[p]);delete o.g[u],o.h--}}this.G=null},De.prototype.J=function(o,u,h,p){return this.i.add(String(o),u,!1,h,p)},De.prototype.K=function(o,u,h,p){return this.i.add(String(o),u,!0,h,p)};function tr(o,u,h,p){if(u=o.i.g[String(u)],!u)return!0;u=u.concat();let R=!0;for(let P=0;P<u.length;++P){const H=u[P];if(H&&!H.da&&H.capture==h){const ce=H.listener,Ne=H.ha||H.src;H.fa&&vt(o.i,H),R=ce.call(Ne,p)!==!1&&R}}return R&&!p.defaultPrevented}function Yi(o,u){if(typeof o!="function")if(o&&typeof o.handleEvent=="function")o=g(o.handleEvent,o);else throw Error("Invalid listener argument");return Number(u)>2147483647?-1:l.setTimeout(o,u||0)}function en(o){o.g=Yi(()=>{o.g=null,o.i&&(o.i=!1,en(o))},o.l);const u=o.h;o.h=null,o.m.apply(null,u)}class Gn extends T{constructor(u,h){super(),this.m=u,this.l=h,this.h=null,this.i=!1,this.g=null}j(u){this.h=arguments,this.g?this.i=!0:en(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function rr(o){T.call(this),this.h=o,this.g={}}_(rr,T);var $n=[];function Wn(o){Ae(o.g,function(u,h){this.g.hasOwnProperty(h)&&er(u)},o),o.g={}}rr.prototype.N=function(){rr.Z.N.call(this),Wn(this)},rr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var tn=l.JSON.stringify,Xi=l.JSON.parse,Ji=class{stringify(o){return l.JSON.stringify(o,void 0)}parse(o){return l.JSON.parse(o,void 0)}};function Hn(){}function Kn(){}var Pt={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function br(){b.call(this,"d")}_(br,b);function xr(){b.call(this,"c")}_(xr,b);var at={},A=null;function C(){return A=A||new De}at.Ia="serverreachability";function D(o){b.call(this,at.Ia,o)}_(D,b);function O(o){const u=C();Me(u,new D(u))}at.STAT_EVENT="statevent";function Y(o,u){b.call(this,at.STAT_EVENT,o),this.stat=u}_(Y,b);function $(o){const u=C();Me(u,new Y(u,o))}at.Ja="timingevent";function z(o,u){b.call(this,at.Ja,o),this.size=u}_(z,b);function ie(o,u){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){o()},u)}function M(){this.g=!0}M.prototype.ua=function(){this.g=!1};function le(o,u,h,p,R,P){o.info(function(){if(o.g)if(P){var H="",ce=P.split("&");for(let _e=0;_e<ce.length;_e++){var Ne=ce[_e].split("=");if(Ne.length>1){const Le=Ne[0];Ne=Ne[1];const ct=Le.split("_");H=ct.length>=2&&ct[1]=="type"?H+(Le+"="+Ne+"&"):H+(Le+"=redacted&")}}}else H=null;else H=P;return"XMLHTTP REQ ("+p+") [attempt "+R+"]: "+u+`
`+h+`
`+H})}function Ee(o,u,h,p,R,P,H){o.info(function(){return"XMLHTTP RESP ("+p+") [ attempt "+R+"]: "+u+`
`+h+`
`+P+" "+H})}function re(o,u,h,p){o.info(function(){return"XMLHTTP TEXT ("+u+"): "+rt(o,h)+(p?" "+p:"")})}function fe(o,u){o.info(function(){return"TIMEOUT: "+u})}M.prototype.info=function(){};function rt(o,u){if(!o.g)return u;if(!u)return null;try{const P=JSON.parse(u);if(P){for(o=0;o<P.length;o++)if(Array.isArray(P[o])){var h=P[o];if(!(h.length<2)){var p=h[1];if(Array.isArray(p)&&!(p.length<1)){var R=p[0];if(R!="noop"&&R!="stop"&&R!="close")for(let H=1;H<p.length;H++)p[H]=""}}}}return tn(P)}catch{return u}}var bt={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},wr={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Ir;function pe(){}_(pe,Hn),pe.prototype.g=function(){return new XMLHttpRequest},Ir=new pe;function Re(o){return encodeURIComponent(String(o))}function xt(o){var u=1;o=o.split(":");const h=[];for(;u>0&&o.length;)h.push(o.shift()),u--;return o.length&&h.push(o.join(":")),h}function He(o,u,h,p){this.j=o,this.i=u,this.l=h,this.S=p||1,this.V=new rr(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Tr}function Tr(){this.i=null,this.g="",this.h=!1}var rn={},nr={};function kt(o,u,h){o.M=1,o.A=Yn(lt(u)),o.u=h,o.R=!0,wt(o,null)}function wt(o,u){o.F=Date.now(),sn(o),o.B=lt(o.A);var h=o.B,p=o.S;Array.isArray(p)||(p=[String(p)]),zo(h.i,"t",p),o.C=0,h=o.j.L,o.h=new Tr,o.g=oa(o.j,h?u:null,!o.u),o.P>0&&(o.O=new Gn(g(o.Y,o,o.g),o.P)),u=o.V,h=o.g,p=o.ba;var R="readystatechange";Array.isArray(R)||(R&&($n[0]=R.toString()),R=$n);for(let P=0;P<R.length;P++){const H=_r(h,R[P],p||u.handleEvent,!1,u.h||u);if(!H)break;u.g[H.key]=H}u=o.J?X(o.J):{},o.u?(o.v||(o.v="POST"),u["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.B,o.v,o.u,u)):(o.v="GET",o.g.ea(o.B,o.v,null,u)),O(),le(o.i,o.v,o.B,o.l,o.S,o.u)}He.prototype.ba=function(o){o=o.target;const u=this.O;u&&Vt(o)==3?u.j():this.Y(o)},He.prototype.Y=function(o){try{if(o==this.g)e:{const ce=Vt(this.g),Ne=this.g.ya(),_e=this.g.ca();if(!(ce<3)&&(ce!=3||this.g&&(this.h.h||this.g.la()||Qo(this.g)))){this.K||ce!=4||Ne==7||(Ne==8||_e<=0?O(3):O(2)),Zi(this);var u=this.g.ca();this.X=u;var h=It(this);if(this.o=u==200,Ee(this.i,this.v,this.B,this.l,this.S,ce,u),this.o){if(this.U&&!this.L){t:{if(this.g){var p,R=this.g;if((p=R.g?R.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!y(p)){var P=p;break t}}P=null}if(o=P)re(this.i,this.l,o,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,es(this,o);else{this.o=!1,this.m=3,$(12),ir(this),on(this);break e}}if(this.R){o=!0;let Le;for(;!this.K&&this.C<h.length;)if(Le=nn(this,h),Le==nr){ce==4&&(this.m=4,$(14),o=!1),re(this.i,this.l,null,"[Incomplete Response]");break}else if(Le==rn){this.m=4,$(15),re(this.i,this.l,h,"[Invalid Chunk]"),o=!1;break}else re(this.i,this.l,Le,null),es(this,Le);if(Qn(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),ce!=4||h.length!=0||this.h.h||(this.m=1,$(16),o=!1),this.o=this.o&&o,!o)re(this.i,this.l,h,"[Invalid Chunked Response]"),ir(this),on(this);else if(h.length>0&&!this.W){this.W=!0;var H=this.j;H.g==this&&H.aa&&!H.P&&(H.j.info("Great, no buffering proxy detected. Bytes received: "+h.length),ls(H),H.P=!0,$(11))}}else re(this.i,this.l,h,null),es(this,h);ce==4&&ir(this),this.o&&!this.K&&(ce==4?ra(this.j,this):(this.o=!1,sn(this)))}else zu(this.g),u==400&&h.indexOf("Unknown SID")>0?(this.m=3,$(12)):(this.m=0,$(13)),ir(this),on(this)}}}catch{}finally{}};function It(o){if(!Qn(o))return o.g.la();const u=Qo(o.g);if(u==="")return"";let h="";const p=u.length,R=Vt(o.g)==4;if(!o.h.i){if(typeof TextDecoder>"u")return ir(o),on(o),"";o.h.i=new l.TextDecoder}for(let P=0;P<p;P++)o.h.h=!0,h+=o.h.i.decode(u[P],{stream:!(R&&P==p-1)});return u.length=0,o.h.g+=h,o.C=0,o.h.g}function Qn(o){return o.g?o.v=="GET"&&o.M!=2&&o.j.Aa:!1}function nn(o,u){var h=o.C,p=u.indexOf(`
`,h);return p==-1?nr:(h=Number(u.substring(h,p)),isNaN(h)?rn:(p+=1,p+h>u.length?nr:(u=u.slice(p,p+h),o.C=p+h,u)))}He.prototype.cancel=function(){this.K=!0,ir(this)};function sn(o){o.T=Date.now()+o.H,Er(o,o.H)}function Er(o,u){if(o.D!=null)throw Error("WatchDog timer not null");o.D=ie(g(o.aa,o),u)}function Zi(o){o.D&&(l.clearTimeout(o.D),o.D=null)}He.prototype.aa=function(){this.D=null;const o=Date.now();o-this.T>=0?(fe(this.i,this.B),this.M!=2&&(O(),$(17)),ir(this),this.m=2,on(this)):Er(this,this.T-o)};function on(o){o.j.I==0||o.K||ra(o.j,o)}function ir(o){Zi(o);var u=o.O;u&&typeof u.dispose=="function"&&u.dispose(),o.O=null,Wn(o.V),o.g&&(u=o.g,o.g=null,u.abort(),u.dispose())}function es(o,u){try{var h=o.j;if(h.I!=0&&(h.g==o||ts(h.h,o))){if(!o.L&&ts(h.h,o)&&h.I==3){try{var p=h.Ba.g.parse(u)}catch{p=null}if(Array.isArray(p)&&p.length==3){var R=p;if(R[0]==0){e:if(!h.v){if(h.g)if(h.g.F+3e3<o.F)ti(h),Zn(h);else break e;as(h),$(18)}}else h.xa=R[1],0<h.xa-h.K&&R[2]<37500&&h.F&&h.A==0&&!h.C&&(h.C=ie(g(h.Va,h),6e3));Vo(h.h)<=1&&h.ta&&(h.ta=void 0)}else or(h,11)}else if((o.L||h.g==o)&&ti(h),!y(u))for(R=h.Ba.g.parse(u),u=0;u<R.length;u++){let _e=R[u];const Le=_e[0];if(!(Le<=h.K))if(h.K=Le,_e=_e[1],h.I==2)if(_e[0]=="c"){h.M=_e[1],h.ba=_e[2];const ct=_e[3];ct!=null&&(h.ka=ct,h.j.info("VER="+h.ka));const ar=_e[4];ar!=null&&(h.za=ar,h.j.info("SVER="+h.za));const jt=_e[5];jt!=null&&typeof jt=="number"&&jt>0&&(p=1.5*jt,h.O=p,h.j.info("backChannelRequestTimeoutMs_="+p)),p=h;const Mt=o.g;if(Mt){const ni=Mt.g?Mt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ni){var P=p.h;P.g||ni.indexOf("spdy")==-1&&ni.indexOf("quic")==-1&&ni.indexOf("h2")==-1||(P.j=P.l,P.g=new Set,P.h&&(rs(P,P.h),P.h=null))}if(p.G){const cs=Mt.g?Mt.g.getResponseHeader("X-HTTP-Session-Id"):null;cs&&(p.wa=cs,xe(p.J,p.G,cs))}}h.I=3,h.l&&h.l.ra(),h.aa&&(h.T=Date.now()-o.F,h.j.info("Handshake RTT: "+h.T+"ms")),p=h;var H=o;if(p.na=sa(p,p.L?p.ba:null,p.W),H.L){jo(p.h,H);var ce=H,Ne=p.O;Ne&&(ce.H=Ne),ce.D&&(Zi(ce),sn(ce)),p.g=H}else ea(p);h.i.length>0&&ei(h)}else _e[0]!="stop"&&_e[0]!="close"||or(h,7);else h.I==3&&(_e[0]=="stop"||_e[0]=="close"?_e[0]=="stop"?or(h,7):os(h):_e[0]!="noop"&&h.l&&h.l.qa(_e),h.A=0)}}O(4)}catch{}}var Su=class{constructor(o,u){this.g=o,this.map=u}};function Do(o){this.l=o||10,l.PerformanceNavigationTiming?(o=l.performance.getEntriesByType("navigation"),o=o.length>0&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function No(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function Vo(o){return o.h?1:o.g?o.g.size:0}function ts(o,u){return o.h?o.h==u:o.g?o.g.has(u):!1}function rs(o,u){o.g?o.g.add(u):o.h=u}function jo(o,u){o.h&&o.h==u?o.h=null:o.g&&o.g.has(u)&&o.g.delete(u)}Do.prototype.cancel=function(){if(this.i=Mo(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const o of this.g.values())o.cancel();this.g.clear()}};function Mo(o){if(o.h!=null)return o.i.concat(o.h.G);if(o.g!=null&&o.g.size!==0){let u=o.i;for(const h of o.g.values())u=u.concat(h.G);return u}return k(o.i)}var Lo=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Pu(o,u){if(o){o=o.split("&");for(let h=0;h<o.length;h++){const p=o[h].indexOf("=");let R,P=null;p>=0?(R=o[h].substring(0,p),P=o[h].substring(p+1)):R=o[h],u(R,P?decodeURIComponent(P.replace(/\+/g," ")):"")}}}function Dt(o){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let u;o instanceof Dt?(this.l=o.l,an(this,o.j),this.o=o.o,this.g=o.g,ln(this,o.u),this.h=o.h,ns(this,qo(o.i)),this.m=o.m):o&&(u=String(o).match(Lo))?(this.l=!1,an(this,u[1]||"",!0),this.o=cn(u[2]||""),this.g=cn(u[3]||"",!0),ln(this,u[4]),this.h=cn(u[5]||"",!0),ns(this,u[6]||"",!0),this.m=cn(u[7]||"")):(this.l=!1,this.i=new dn(null,this.l))}Dt.prototype.toString=function(){const o=[];var u=this.j;u&&o.push(un(u,Oo,!0),":");var h=this.g;return(h||u=="file")&&(o.push("//"),(u=this.o)&&o.push(un(u,Oo,!0),"@"),o.push(Re(h).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.u,h!=null&&o.push(":",String(h))),(h=this.h)&&(this.g&&h.charAt(0)!="/"&&o.push("/"),o.push(un(h,h.charAt(0)=="/"?Nu:Du,!0))),(h=this.i.toString())&&o.push("?",h),(h=this.m)&&o.push("#",un(h,ju)),o.join("")},Dt.prototype.resolve=function(o){const u=lt(this);let h=!!o.j;h?an(u,o.j):h=!!o.o,h?u.o=o.o:h=!!o.g,h?u.g=o.g:h=o.u!=null;var p=o.h;if(h)ln(u,o.u);else if(h=!!o.h){if(p.charAt(0)!="/")if(this.g&&!this.h)p="/"+p;else{var R=u.h.lastIndexOf("/");R!=-1&&(p=u.h.slice(0,R+1)+p)}if(R=p,R==".."||R==".")p="";else if(R.indexOf("./")!=-1||R.indexOf("/.")!=-1){p=R.lastIndexOf("/",0)==0,R=R.split("/");const P=[];for(let H=0;H<R.length;){const ce=R[H++];ce=="."?p&&H==R.length&&P.push(""):ce==".."?((P.length>1||P.length==1&&P[0]!="")&&P.pop(),p&&H==R.length&&P.push("")):(P.push(ce),p=!0)}p=P.join("/")}else p=R}return h?u.h=p:h=o.i.toString()!=="",h?ns(u,qo(o.i)):h=!!o.m,h&&(u.m=o.m),u};function lt(o){return new Dt(o)}function an(o,u,h){o.j=h?cn(u,!0):u,o.j&&(o.j=o.j.replace(/:$/,""))}function ln(o,u){if(u){if(u=Number(u),isNaN(u)||u<0)throw Error("Bad port number "+u);o.u=u}else o.u=null}function ns(o,u,h){u instanceof dn?(o.i=u,Mu(o.i,o.l)):(h||(u=un(u,Vu)),o.i=new dn(u,o.l))}function xe(o,u,h){o.i.set(u,h)}function Yn(o){return xe(o,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),o}function cn(o,u){return o?u?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function un(o,u,h){return typeof o=="string"?(o=encodeURI(o).replace(u,ku),h&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function ku(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var Oo=/[#\/\?@]/g,Du=/[#\?:]/g,Nu=/[#\?]/g,Vu=/[#\?@]/g,ju=/#/g;function dn(o,u){this.h=this.g=null,this.i=o||null,this.j=!!u}function sr(o){o.g||(o.g=new Map,o.h=0,o.i&&Pu(o.i,function(u,h){o.add(decodeURIComponent(u.replace(/\+/g," ")),h)}))}r=dn.prototype,r.add=function(o,u){sr(this),this.i=null,o=Cr(this,o);let h=this.g.get(o);return h||this.g.set(o,h=[]),h.push(u),this.h+=1,this};function Fo(o,u){sr(o),u=Cr(o,u),o.g.has(u)&&(o.i=null,o.h-=o.g.get(u).length,o.g.delete(u))}function Bo(o,u){return sr(o),u=Cr(o,u),o.g.has(u)}r.forEach=function(o,u){sr(this),this.g.forEach(function(h,p){h.forEach(function(R){o.call(u,R,p,this)},this)},this)};function Uo(o,u){sr(o);let h=[];if(typeof u=="string")Bo(o,u)&&(h=h.concat(o.g.get(Cr(o,u))));else for(o=Array.from(o.g.values()),u=0;u<o.length;u++)h=h.concat(o[u]);return h}r.set=function(o,u){return sr(this),this.i=null,o=Cr(this,o),Bo(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[u]),this.h+=1,this},r.get=function(o,u){return o?(o=Uo(this,o),o.length>0?String(o[0]):u):u};function zo(o,u,h){Fo(o,u),h.length>0&&(o.i=null,o.g.set(Cr(o,u),k(h)),o.h+=h.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const o=[],u=Array.from(this.g.keys());for(let p=0;p<u.length;p++){var h=u[p];const R=Re(h);h=Uo(this,h);for(let P=0;P<h.length;P++){let H=R;h[P]!==""&&(H+="="+Re(h[P])),o.push(H)}}return this.i=o.join("&")};function qo(o){const u=new dn;return u.i=o.i,o.g&&(u.g=new Map(o.g),u.h=o.h),u}function Cr(o,u){return u=String(u),o.j&&(u=u.toLowerCase()),u}function Mu(o,u){u&&!o.j&&(sr(o),o.i=null,o.g.forEach(function(h,p){const R=p.toLowerCase();p!=R&&(Fo(this,p),zo(this,R,h))},o)),o.j=u}function Lu(o,u){const h=new M;if(l.Image){const p=new Image;p.onload=f(Nt,h,"TestLoadImage: loaded",!0,u,p),p.onerror=f(Nt,h,"TestLoadImage: error",!1,u,p),p.onabort=f(Nt,h,"TestLoadImage: abort",!1,u,p),p.ontimeout=f(Nt,h,"TestLoadImage: timeout",!1,u,p),l.setTimeout(function(){p.ontimeout&&p.ontimeout()},1e4),p.src=o}else u(!1)}function Ou(o,u){const h=new M,p=new AbortController,R=setTimeout(()=>{p.abort(),Nt(h,"TestPingServer: timeout",!1,u)},1e4);fetch(o,{signal:p.signal}).then(P=>{clearTimeout(R),P.ok?Nt(h,"TestPingServer: ok",!0,u):Nt(h,"TestPingServer: server error",!1,u)}).catch(()=>{clearTimeout(R),Nt(h,"TestPingServer: error",!1,u)})}function Nt(o,u,h,p,R){try{R&&(R.onload=null,R.onerror=null,R.onabort=null,R.ontimeout=null),p(h)}catch{}}function Fu(){this.g=new Ji}function is(o){this.i=o.Sb||null,this.h=o.ab||!1}_(is,Hn),is.prototype.g=function(){return new Xn(this.i,this.h)};function Xn(o,u){De.call(this),this.H=o,this.o=u,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}_(Xn,De),r=Xn.prototype,r.open=function(o,u){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=o,this.D=u,this.readyState=1,mn(this)},r.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const u={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};o&&(u.body=o),(this.H||l).fetch(new Request(this.D,u)).then(this.Pa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,hn(this)),this.readyState=0},r.Pa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,mn(this)),this.g&&(this.readyState=3,mn(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Go(this)}else o.text().then(this.Oa.bind(this),this.ga.bind(this))};function Go(o){o.j.read().then(o.Ma.bind(o)).catch(o.ga.bind(o))}r.Ma=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var u=o.value?o.value:new Uint8Array(0);(u=this.B.decode(u,{stream:!o.done}))&&(this.response=this.responseText+=u)}o.done?hn(this):mn(this),this.readyState==3&&Go(this)}},r.Oa=function(o){this.g&&(this.response=this.responseText=o,hn(this))},r.Na=function(o){this.g&&(this.response=o,hn(this))},r.ga=function(){this.g&&hn(this)};function hn(o){o.readyState=4,o.l=null,o.j=null,o.B=null,mn(o)}r.setRequestHeader=function(o,u){this.A.append(o,u)},r.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const o=[],u=this.h.entries();for(var h=u.next();!h.done;)h=h.value,o.push(h[0]+": "+h[1]),h=u.next();return o.join(`\r
`)};function mn(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(Xn.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function $o(o){let u="";return Ae(o,function(h,p){u+=p,u+=":",u+=h,u+=`\r
`}),u}function ss(o,u,h){e:{for(p in h){var p=!1;break e}p=!0}p||(h=$o(h),typeof o=="string"?h!=null&&Re(h):xe(o,u,h))}function Te(o){De.call(this),this.headers=new Map,this.L=o||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}_(Te,De);var Bu=/^https?$/i,Uu=["POST","PUT"];r=Te.prototype,r.Fa=function(o){this.H=o},r.ea=function(o,u,h,p){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);u=u?u.toUpperCase():"GET",this.D=o,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Ir.g(),this.g.onreadystatechange=w(g(this.Ca,this));try{this.B=!0,this.g.open(u,String(o),!0),this.B=!1}catch(P){Wo(this,P);return}if(o=h||"",h=new Map(this.headers),p)if(Object.getPrototypeOf(p)===Object.prototype)for(var R in p)h.set(R,p[R]);else if(typeof p.keys=="function"&&typeof p.get=="function")for(const P of p.keys())h.set(P,p.get(P));else throw Error("Unknown input type for opt_headers: "+String(p));p=Array.from(h.keys()).find(P=>P.toLowerCase()=="content-type"),R=l.FormData&&o instanceof l.FormData,!(Array.prototype.indexOf.call(Uu,u,void 0)>=0)||p||R||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[P,H]of h)this.g.setRequestHeader(P,H);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(o),this.v=!1}catch(P){Wo(this,P)}};function Wo(o,u){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=u,o.o=5,Ho(o),Jn(o)}function Ho(o){o.A||(o.A=!0,Me(o,"complete"),Me(o,"error"))}r.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=o||7,Me(this,"complete"),Me(this,"abort"),Jn(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Jn(this,!0)),Te.Z.N.call(this)},r.Ca=function(){this.u||(this.B||this.v||this.j?Ko(this):this.Xa())},r.Xa=function(){Ko(this)};function Ko(o){if(o.h&&typeof a<"u"){if(o.v&&Vt(o)==4)setTimeout(o.Ca.bind(o),0);else if(Me(o,"readystatechange"),Vt(o)==4){o.h=!1;try{const P=o.ca();e:switch(P){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var u=!0;break e;default:u=!1}var h;if(!(h=u)){var p;if(p=P===0){let H=String(o.D).match(Lo)[1]||null;!H&&l.self&&l.self.location&&(H=l.self.location.protocol.slice(0,-1)),p=!Bu.test(H?H.toLowerCase():"")}h=p}if(h)Me(o,"complete"),Me(o,"success");else{o.o=6;try{var R=Vt(o)>2?o.g.statusText:""}catch{R=""}o.l=R+" ["+o.ca()+"]",Ho(o)}}finally{Jn(o)}}}}function Jn(o,u){if(o.g){o.m&&(clearTimeout(o.m),o.m=null);const h=o.g;o.g=null,u||Me(o,"ready");try{h.onreadystatechange=null}catch{}}}r.isActive=function(){return!!this.g};function Vt(o){return o.g?o.g.readyState:0}r.ca=function(){try{return Vt(this)>2?this.g.status:-1}catch{return-1}},r.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.La=function(o){if(this.g){var u=this.g.responseText;return o&&u.indexOf(o)==0&&(u=u.substring(o.length)),Xi(u)}};function Qo(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.F){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function zu(o){const u={};o=(o.g&&Vt(o)>=2&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let p=0;p<o.length;p++){if(y(o[p]))continue;var h=xt(o[p]);const R=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();const P=u[R]||[];u[R]=P,P.push(h)}yt(u,function(p){return p.join(", ")})}r.ya=function(){return this.o},r.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function gn(o,u,h){return h&&h.internalChannelParams&&h.internalChannelParams[o]||u}function Yo(o){this.za=0,this.i=[],this.j=new M,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=gn("failFast",!1,o),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=gn("baseRetryDelayMs",5e3,o),this.Za=gn("retryDelaySeedMs",1e4,o),this.Ta=gn("forwardChannelMaxRetries",2,o),this.va=gn("forwardChannelRequestTimeoutMs",2e4,o),this.ma=o&&o.xmlHttpFactory||void 0,this.Ua=o&&o.Rb||void 0,this.Aa=o&&o.useFetchStreams||!1,this.O=void 0,this.L=o&&o.supportsCrossDomainXhr||!1,this.M="",this.h=new Do(o&&o.concurrentRequestLimit),this.Ba=new Fu,this.S=o&&o.fastHandshake||!1,this.R=o&&o.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=o&&o.Pb||!1,o&&o.ua&&this.j.ua(),o&&o.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&o&&o.detectBufferingProxy||!1,this.ia=void 0,o&&o.longPollingTimeout&&o.longPollingTimeout>0&&(this.ia=o.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}r=Yo.prototype,r.ka=8,r.I=1,r.connect=function(o,u,h,p){$(0),this.W=o,this.H=u||{},h&&p!==void 0&&(this.H.OSID=h,this.H.OAID=p),this.F=this.X,this.J=sa(this,null,this.W),ei(this)};function os(o){if(Xo(o),o.I==3){var u=o.V++,h=lt(o.J);if(xe(h,"SID",o.M),xe(h,"RID",u),xe(h,"TYPE","terminate"),pn(o,h),u=new He(o,o.j,u),u.M=2,u.A=Yn(lt(h)),h=!1,l.navigator&&l.navigator.sendBeacon)try{h=l.navigator.sendBeacon(u.A.toString(),"")}catch{}!h&&l.Image&&(new Image().src=u.A,h=!0),h||(u.g=oa(u.j,null),u.g.ea(u.A)),u.F=Date.now(),sn(u)}ia(o)}function Zn(o){o.g&&(ls(o),o.g.cancel(),o.g=null)}function Xo(o){Zn(o),o.v&&(l.clearTimeout(o.v),o.v=null),ti(o),o.h.cancel(),o.m&&(typeof o.m=="number"&&l.clearTimeout(o.m),o.m=null)}function ei(o){if(!No(o.h)&&!o.m){o.m=!0;var u=o.Ea;Z||v(),J||(Z(),J=!0),I.add(u,o),o.D=0}}function qu(o,u){return Vo(o.h)>=o.h.j-(o.m?1:0)?!1:o.m?(o.i=u.G.concat(o.i),!0):o.I==1||o.I==2||o.D>=(o.Sa?0:o.Ta)?!1:(o.m=ie(g(o.Ea,o,u),na(o,o.D)),o.D++,!0)}r.Ea=function(o){if(this.m)if(this.m=null,this.I==1){if(!o){this.V=Math.floor(Math.random()*1e5),o=this.V++;const R=new He(this,this.j,o);let P=this.o;if(this.U&&(P?(P=X(P),oe(P,this.U)):P=this.U),this.u!==null||this.R||(R.J=P,P=null),this.S)e:{for(var u=0,h=0;h<this.i.length;h++){t:{var p=this.i[h];if("__data__"in p.map&&(p=p.map.__data__,typeof p=="string")){p=p.length;break t}p=void 0}if(p===void 0)break;if(u+=p,u>4096){u=h;break e}if(u===4096||h===this.i.length-1){u=h+1;break e}}u=1e3}else u=1e3;u=Zo(this,R,u),h=lt(this.J),xe(h,"RID",o),xe(h,"CVER",22),this.G&&xe(h,"X-HTTP-Session-Id",this.G),pn(this,h),P&&(this.R?u="headers="+Re($o(P))+"&"+u:this.u&&ss(h,this.u,P)),rs(this.h,R),this.Ra&&xe(h,"TYPE","init"),this.S?(xe(h,"$req",u),xe(h,"SID","null"),R.U=!0,kt(R,h,null)):kt(R,h,u),this.I=2}}else this.I==3&&(o?Jo(this,o):this.i.length==0||No(this.h)||Jo(this))};function Jo(o,u){var h;u?h=u.l:h=o.V++;const p=lt(o.J);xe(p,"SID",o.M),xe(p,"RID",h),xe(p,"AID",o.K),pn(o,p),o.u&&o.o&&ss(p,o.u,o.o),h=new He(o,o.j,h,o.D+1),o.u===null&&(h.J=o.o),u&&(o.i=u.G.concat(o.i)),u=Zo(o,h,1e3),h.H=Math.round(o.va*.5)+Math.round(o.va*.5*Math.random()),rs(o.h,h),kt(h,p,u)}function pn(o,u){o.H&&Ae(o.H,function(h,p){xe(u,p,h)}),o.l&&Ae({},function(h,p){xe(u,p,h)})}function Zo(o,u,h){h=Math.min(o.i.length,h);const p=o.l?g(o.l.Ka,o.l,o):null;e:{var R=o.i;let ce=-1;for(;;){const Ne=["count="+h];ce==-1?h>0?(ce=R[0].g,Ne.push("ofs="+ce)):ce=0:Ne.push("ofs="+ce);let _e=!0;for(let Le=0;Le<h;Le++){var P=R[Le].g;const ct=R[Le].map;if(P-=ce,P<0)ce=Math.max(0,R[Le].g-100),_e=!1;else try{P="req"+P+"_"||"";try{var H=ct instanceof Map?ct:Object.entries(ct);for(const[ar,jt]of H){let Mt=jt;d(jt)&&(Mt=tn(jt)),Ne.push(P+ar+"="+encodeURIComponent(Mt))}}catch(ar){throw Ne.push(P+"type="+encodeURIComponent("_badmap")),ar}}catch{p&&p(ct)}}if(_e){H=Ne.join("&");break e}}H=void 0}return o=o.i.splice(0,h),u.G=o,H}function ea(o){if(!o.g&&!o.v){o.Y=1;var u=o.Da;Z||v(),J||(Z(),J=!0),I.add(u,o),o.A=0}}function as(o){return o.g||o.v||o.A>=3?!1:(o.Y++,o.v=ie(g(o.Da,o),na(o,o.A)),o.A++,!0)}r.Da=function(){if(this.v=null,ta(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var o=4*this.T;this.j.info("BP detection timer enabled: "+o),this.B=ie(g(this.Wa,this),o)}},r.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,$(10),Zn(this),ta(this))};function ls(o){o.B!=null&&(l.clearTimeout(o.B),o.B=null)}function ta(o){o.g=new He(o,o.j,"rpc",o.Y),o.u===null&&(o.g.J=o.o),o.g.P=0;var u=lt(o.na);xe(u,"RID","rpc"),xe(u,"SID",o.M),xe(u,"AID",o.K),xe(u,"CI",o.F?"0":"1"),!o.F&&o.ia&&xe(u,"TO",o.ia),xe(u,"TYPE","xmlhttp"),pn(o,u),o.u&&o.o&&ss(u,o.u,o.o),o.O&&(o.g.H=o.O);var h=o.g;o=o.ba,h.M=1,h.A=Yn(lt(u)),h.u=null,h.R=!0,wt(h,o)}r.Va=function(){this.C!=null&&(this.C=null,Zn(this),as(this),$(19))};function ti(o){o.C!=null&&(l.clearTimeout(o.C),o.C=null)}function ra(o,u){var h=null;if(o.g==u){ti(o),ls(o),o.g=null;var p=2}else if(ts(o.h,u))h=u.G,jo(o.h,u),p=1;else return;if(o.I!=0){if(u.o)if(p==1){h=u.u?u.u.length:0,u=Date.now()-u.F;var R=o.D;p=C(),Me(p,new z(p,h)),ei(o)}else ea(o);else if(R=u.m,R==3||R==0&&u.X>0||!(p==1&&qu(o,u)||p==2&&as(o)))switch(h&&h.length>0&&(u=o.h,u.i=u.i.concat(h)),R){case 1:or(o,5);break;case 4:or(o,10);break;case 3:or(o,6);break;default:or(o,2)}}}function na(o,u){let h=o.Qa+Math.floor(Math.random()*o.Za);return o.isActive()||(h*=2),h*u}function or(o,u){if(o.j.info("Error code "+u),u==2){var h=g(o.bb,o),p=o.Ua;const R=!p;p=new Dt(p||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||an(p,"https"),Yn(p),R?Lu(p.toString(),h):Ou(p.toString(),h)}else $(2);o.I=0,o.l&&o.l.pa(u),ia(o),Xo(o)}r.bb=function(o){o?(this.j.info("Successfully pinged google.com"),$(2)):(this.j.info("Failed to ping google.com"),$(1))};function ia(o){if(o.I=0,o.ja=[],o.l){const u=Mo(o.h);(u.length!=0||o.i.length!=0)&&(B(o.ja,u),B(o.ja,o.i),o.h.i.length=0,k(o.i),o.i.length=0),o.l.oa()}}function sa(o,u,h){var p=h instanceof Dt?lt(h):new Dt(h);if(p.g!="")u&&(p.g=u+"."+p.g),ln(p,p.u);else{var R=l.location;p=R.protocol,u=u?u+"."+R.hostname:R.hostname,R=+R.port;const P=new Dt(null);p&&an(P,p),u&&(P.g=u),R&&ln(P,R),h&&(P.h=h),p=P}return h=o.G,u=o.wa,h&&u&&xe(p,h,u),xe(p,"VER",o.ka),pn(o,p),p}function oa(o,u,h){if(u&&!o.L)throw Error("Can't create secondary domain capable XhrIo object.");return u=o.Aa&&!o.ma?new Te(new is({ab:h})):new Te(o.ma),u.Fa(o.L),u}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function aa(){}r=aa.prototype,r.ra=function(){},r.qa=function(){},r.pa=function(){},r.oa=function(){},r.isActive=function(){return!0},r.Ka=function(){};function ri(){}ri.prototype.g=function(o,u){return new Ye(o,u)};function Ye(o,u){De.call(this),this.g=new Yo(u),this.l=o,this.h=u&&u.messageUrlParams||null,o=u&&u.messageHeaders||null,u&&u.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=u&&u.initMessageHeaders||null,u&&u.messageContentType&&(o?o["X-WebChannel-Content-Type"]=u.messageContentType:o={"X-WebChannel-Content-Type":u.messageContentType}),u&&u.sa&&(o?o["X-WebChannel-Client-Profile"]=u.sa:o={"X-WebChannel-Client-Profile":u.sa}),this.g.U=o,(o=u&&u.Qb)&&!y(o)&&(this.g.u=o),this.A=u&&u.supportsCrossDomainXhr||!1,this.v=u&&u.sendRawJson||!1,(u=u&&u.httpSessionIdParam)&&!y(u)&&(this.g.G=u,o=this.h,o!==null&&u in o&&(o=this.h,u in o&&delete o[u])),this.j=new Ar(this)}_(Ye,De),Ye.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Ye.prototype.close=function(){os(this.g)},Ye.prototype.o=function(o){var u=this.g;if(typeof o=="string"){var h={};h.__data__=o,o=h}else this.v&&(h={},h.__data__=tn(o),o=h);u.i.push(new Su(u.Ya++,o)),u.I==3&&ei(u)},Ye.prototype.N=function(){this.g.l=null,delete this.j,os(this.g),delete this.g,Ye.Z.N.call(this)};function la(o){br.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var u=o.__sm__;if(u){e:{for(const h in u){o=h;break e}o=void 0}(this.i=o)&&(o=this.i,u=u!==null&&o in u?u[o]:void 0),this.data=u}else this.data=o}_(la,br);function ca(){xr.call(this),this.status=1}_(ca,xr);function Ar(o){this.g=o}_(Ar,aa),Ar.prototype.ra=function(){Me(this.g,"a")},Ar.prototype.qa=function(o){Me(this.g,new la(o))},Ar.prototype.pa=function(o){Me(this.g,new ca)},Ar.prototype.oa=function(){Me(this.g,"b")},ri.prototype.createWebChannel=ri.prototype.g,Ye.prototype.send=Ye.prototype.o,Ye.prototype.open=Ye.prototype.m,Ye.prototype.close=Ye.prototype.close,ec=function(){return new ri},Zl=function(){return C()},Jl=at,Rs={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},bt.NO_ERROR=0,bt.TIMEOUT=8,bt.HTTP_ERROR=6,ui=bt,wr.COMPLETE="complete",Xl=wr,Kn.EventType=Pt,Pt.OPEN="a",Pt.CLOSE="b",Pt.ERROR="c",Pt.MESSAGE="d",De.prototype.listen=De.prototype.J,yn=Kn,Te.prototype.listenOnce=Te.prototype.K,Te.prototype.getLastError=Te.prototype.Ha,Te.prototype.getLastErrorCode=Te.prototype.ya,Te.prototype.getStatus=Te.prototype.ca,Te.prototype.getResponseJson=Te.prototype.La,Te.prototype.getResponseText=Te.prototype.la,Te.prototype.send=Te.prototype.ea,Te.prototype.setWithCredentials=Te.prototype.Fa,Yl=Te}).apply(typeof ii<"u"?ii:typeof self<"u"?self:typeof window<"u"?window:{});const Da="@firebase/firestore",Na="4.9.3";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $e{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}$e.UNAUTHENTICATED=new $e(null),$e.GOOGLE_CREDENTIALS=new $e("google-credentials-uid"),$e.FIRST_PARTY=new $e("first-party-uid"),$e.MOCK_USER=new $e("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Gr="12.7.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hr=new ql("@firebase/firestore");function Rr(){return hr.logLevel}function Q(r,...e){if(hr.logLevel<=ge.DEBUG){const t=e.map(Ks);hr.debug(`Firestore (${Gr}): ${r}`,...t)}}function Ct(r,...e){if(hr.logLevel<=ge.ERROR){const t=e.map(Ks);hr.error(`Firestore (${Gr}): ${r}`,...t)}}function Lr(r,...e){if(hr.logLevel<=ge.WARN){const t=e.map(Ks);hr.warn(`Firestore (${Gr}): ${r}`,...t)}}function Ks(r){if(typeof r=="string")return r;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(t){return JSON.stringify(t)})(r)}catch{return r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ne(r,e,t){let n="Unexpected state";typeof e=="string"?n=e:t=e,tc(r,n,t)}function tc(r,e,t){let n=`FIRESTORE (${Gr}) INTERNAL ASSERTION FAILED: ${e} (ID: ${r.toString(16)})`;if(t!==void 0)try{n+=" CONTEXT: "+JSON.stringify(t)}catch{n+=" CONTEXT: "+t}throw Ct(n),new Error(n)}function ye(r,e,t,n){let i="Unexpected state";typeof t=="string"?i=t:n=t,r||tc(e,i,n)}function ae(r,e){return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class K extends qr{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gt{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rc{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class hm{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t($e.UNAUTHENTICATED)))}shutdown(){}}class mm{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class gm{constructor(e){this.t=e,this.currentUser=$e.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ye(this.o===void 0,42304);let n=this.i;const i=m=>this.i!==n?(n=this.i,t(m)):Promise.resolve();let a=new Gt;this.o=()=>{this.i++,this.currentUser=this.u(),a.resolve(),a=new Gt,e.enqueueRetryable((()=>i(this.currentUser)))};const l=()=>{const m=a;e.enqueueRetryable((async()=>{await m.promise,await i(this.currentUser)}))},d=m=>{Q("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=m,this.o&&(this.auth.addAuthTokenListener(this.o),l())};this.t.onInit((m=>d(m))),setTimeout((()=>{if(!this.auth){const m=this.t.getImmediate({optional:!0});m?d(m):(Q("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new Gt)}}),0),l()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((n=>this.i!==e?(Q("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(ye(typeof n.accessToken=="string",31837,{l:n}),new rc(n.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ye(e===null||typeof e=="string",2055,{h:e}),new $e(e)}}class pm{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=$e.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class fm{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new pm(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t($e.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Va{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ym{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Qh(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){ye(this.o===void 0,3512);const n=a=>{a.error!=null&&Q("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${a.error.message}`);const l=a.token!==this.m;return this.m=a.token,Q("FirebaseAppCheckTokenProvider",`Received ${l?"new":"existing"} token.`),l?t(a.token):Promise.resolve()};this.o=a=>{e.enqueueRetryable((()=>n(a)))};const i=a=>{Q("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=a,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((a=>i(a))),setTimeout((()=>{if(!this.appCheck){const a=this.V.getImmediate({optional:!0});a?i(a):Q("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Va(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(ye(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Va(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _m(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qs{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let n="";for(;n.length<20;){const i=_m(40);for(let a=0;a<i.length;++a)n.length<20&&i[a]<t&&(n+=e.charAt(i[a]%62))}return n}}function ue(r,e){return r<e?-1:r>e?1:0}function Ss(r,e){const t=Math.min(r.length,e.length);for(let n=0;n<t;n++){const i=r.charAt(n),a=e.charAt(n);if(i!==a)return fs(i)===fs(a)?ue(i,a):fs(i)?1:-1}return ue(r.length,e.length)}const vm=55296,bm=57343;function fs(r){const e=r.charCodeAt(0);return e>=vm&&e<=bm}function Or(r,e,t){return r.length===e.length&&r.every(((n,i)=>t(n,e[i])))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ja="__name__";class ut{constructor(e,t,n){t===void 0?t=0:t>e.length&&ne(637,{offset:t,range:e.length}),n===void 0?n=e.length-t:n>e.length-t&&ne(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return ut.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ut?e.forEach((n=>{t.push(n)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const a=ut.compareSegments(e.get(i),t.get(i));if(a!==0)return a}return ue(e.length,t.length)}static compareSegments(e,t){const n=ut.isNumericId(e),i=ut.isNumericId(t);return n&&!i?-1:!n&&i?1:n&&i?ut.extractNumericId(e).compare(ut.extractNumericId(t)):Ss(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return qt.fromString(e.substring(4,e.length-2))}}class ve extends ut{construct(e,t,n){return new ve(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new K(V.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((i=>i.length>0)))}return new ve(t)}static emptyPath(){return new ve([])}}const xm=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ze extends ut{construct(e,t,n){return new ze(e,t,n)}static isValidIdentifier(e){return xm.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ze.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===ja}static keyField(){return new ze([ja])}static fromServerFormat(e){const t=[];let n="",i=0;const a=()=>{if(n.length===0)throw new K(V.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let l=!1;for(;i<e.length;){const d=e[i];if(d==="\\"){if(i+1===e.length)throw new K(V.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const m=e[i+1];if(m!=="\\"&&m!=="."&&m!=="`")throw new K(V.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=m,i+=2}else d==="`"?(l=!l,i++):d!=="."||l?(n+=d,i++):(a(),i++)}if(a(),l)throw new K(V.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ze(t)}static emptyPath(){return new ze([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ee{constructor(e){this.path=e}static fromPath(e){return new ee(ve.fromString(e))}static fromName(e){return new ee(ve.fromString(e).popFirst(5))}static empty(){return new ee(ve.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ve.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ve.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ee(new ve(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nc(r,e,t){if(!t)throw new K(V.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function wm(r,e,t,n){if(e===!0&&n===!0)throw new K(V.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function Ma(r){if(!ee.isDocumentKey(r))throw new K(V.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function La(r){if(ee.isDocumentKey(r))throw new K(V.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function ic(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}function Li(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{const e=(function(n){return n.constructor?n.constructor.name:null})(r);return e?`a custom ${e} object`:"an object"}}return typeof r=="function"?"a function":ne(12329,{type:typeof r})}function Sn(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new K(V.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Li(r);throw new K(V.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}function Im(r,e){if(e<=0)throw new K(V.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ke(r,e){const t={typeString:r};return e&&(t.value=e),t}function On(r,e){if(!ic(r))throw new K(V.INVALID_ARGUMENT,"JSON must be an object");let t;for(const n in e)if(e[n]){const i=e[n].typeString,a="value"in e[n]?{value:e[n].value}:void 0;if(!(n in r)){t=`JSON missing required field: '${n}'`;break}const l=r[n];if(i&&typeof l!==i){t=`JSON field '${n}' must be a ${i}.`;break}if(a!==void 0&&l!==a.value){t=`Expected '${n}' field to equal '${a.value}'`;break}}if(t)throw new K(V.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oa=-62135596800,Fa=1e6;class we{static now(){return we.fromMillis(Date.now())}static fromDate(e){return we.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*Fa);return new we(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new K(V.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new K(V.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Oa)throw new K(V.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new K(V.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Fa}_compareTo(e){return this.seconds===e.seconds?ue(this.nanoseconds,e.nanoseconds):ue(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:we._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(On(e,we._jsonSchema))return new we(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Oa;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}we._jsonSchemaVersion="firestore/timestamp/1.0",we._jsonSchema={type:ke("string",we._jsonSchemaVersion),seconds:ke("number"),nanoseconds:ke("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class se{static fromTimestamp(e){return new se(e)}static min(){return new se(new we(0,0))}static max(){return new se(new we(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pn=-1;function Tm(r,e){const t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=se.fromTimestamp(n===1e9?new we(t+1,0):new we(t,n));return new Wt(i,ee.empty(),e)}function Em(r){return new Wt(r.readTime,r.key,Pn)}class Wt{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Wt(se.min(),ee.empty(),Pn)}static max(){return new Wt(se.max(),ee.empty(),Pn)}}function Cm(r,e){let t=r.readTime.compareTo(e.readTime);return t!==0?t:(t=ee.comparator(r.documentKey,e.documentKey),t!==0?t:ue(r.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Am="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Rm{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $r(r){if(r.code!==V.FAILED_PRECONDITION||r.message!==Am)throw r;Q("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ne(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new j(((n,i)=>{this.nextCallback=a=>{this.wrapSuccess(e,a).next(n,i)},this.catchCallback=a=>{this.wrapFailure(t,a).next(n,i)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof j?t:j.resolve(t)}catch(t){return j.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):j.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):j.reject(t)}static resolve(e){return new j(((t,n)=>{t(e)}))}static reject(e){return new j(((t,n)=>{n(e)}))}static waitFor(e){return new j(((t,n)=>{let i=0,a=0,l=!1;e.forEach((d=>{++i,d.next((()=>{++a,l&&a===i&&t()}),(m=>n(m)))})),l=!0,a===i&&t()}))}static or(e){let t=j.resolve(!1);for(const n of e)t=t.next((i=>i?j.resolve(i):n()));return t}static forEach(e,t){const n=[];return e.forEach(((i,a)=>{n.push(t.call(this,i,a))})),this.waitFor(n)}static mapArray(e,t){return new j(((n,i)=>{const a=e.length,l=new Array(a);let d=0;for(let m=0;m<a;m++){const g=m;t(e[g]).next((f=>{l[g]=f,++d,d===a&&n(l)}),(f=>i(f)))}}))}static doWhile(e,t){return new j(((n,i)=>{const a=()=>{e()===!0?t().next((()=>{a()}),i):n()};a()}))}}function Sm(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Wr(r){return r.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oi{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=n=>this.ae(n),this.ue=n=>t.writeSequenceNumber(n))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Oi.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ys=-1;function Fi(r){return r==null}function Ei(r){return r===0&&1/r==-1/0}function Pm(r){return typeof r=="number"&&Number.isInteger(r)&&!Ei(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sc="";function km(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=Ba(e)),e=Dm(r.get(t),e);return Ba(e)}function Dm(r,e){let t=e;const n=r.length;for(let i=0;i<n;i++){const a=r.charAt(i);switch(a){case"\0":t+="";break;case sc:t+="";break;default:t+=a}}return t}function Ba(r){return r+sc+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ua(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function gr(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function oc(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ie{constructor(e,t){this.comparator=e,this.root=t||Ue.EMPTY}insert(e,t){return new Ie(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ue.BLACK,null,null))}remove(e){return new Ie(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ue.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(i===0)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new si(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new si(this.root,e,this.comparator,!1)}getReverseIterator(){return new si(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new si(this.root,e,this.comparator,!0)}}class si{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let a=1;for(;!e.isEmpty();)if(a=t?n(e.key,t):1,t&&i&&(a*=-1),a<0)e=this.isReverse?e.left:e.right;else{if(a===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ue{constructor(e,t,n,i,a){this.key=e,this.value=t,this.color=n??Ue.RED,this.left=i??Ue.EMPTY,this.right=a??Ue.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,a){return new Ue(e??this.key,t??this.value,n??this.color,i??this.left,a??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const a=n(e,i.key);return i=a<0?i.copy(null,null,null,i.left.insert(e,t,n),null):a===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Ue.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return Ue.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ue.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ue.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ne(43730,{key:this.key,value:this.value});if(this.right.isRed())throw ne(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw ne(27949);return e+(this.isRed()?0:1)}}Ue.EMPTY=null,Ue.RED=!0,Ue.BLACK=!1;Ue.EMPTY=new class{constructor(){this.size=0}get key(){throw ne(57766)}get value(){throw ne(16141)}get color(){throw ne(16727)}get left(){throw ne(29726)}get right(){throw ne(36894)}copy(e,t,n,i,a){return this}insert(e,t,n){return new Ue(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class je{constructor(e){this.comparator=e,this.data=new Ie(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new za(this.data.getIterator())}getIteratorFrom(e){return new za(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((n=>{t=t.add(n)})),t}isEqual(e){if(!(e instanceof je)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,a=n.getNext().key;if(this.comparator(i,a)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new je(this.comparator);return t.data=e,t}}class za{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nt{constructor(e){this.fields=e,e.sort(ze.comparator)}static empty(){return new nt([])}unionWith(e){let t=new je(ze.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new nt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Or(this.fields,e.fields,((t,n)=>t.isEqual(n)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ac extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qe{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(i){try{return atob(i)}catch(a){throw typeof DOMException<"u"&&a instanceof DOMException?new ac("Invalid base64 string: "+a):a}})(e);return new qe(t)}static fromUint8Array(e){const t=(function(i){let a="";for(let l=0;l<i.length;++l)a+=String.fromCharCode(i[l]);return a})(e);return new qe(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ue(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}qe.EMPTY_BYTE_STRING=new qe("");const Nm=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ht(r){if(ye(!!r,39018),typeof r=="string"){let e=0;const t=Nm.exec(r);if(ye(!!t,46558,{timestamp:r}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:Ce(r.seconds),nanos:Ce(r.nanos)}}function Ce(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function Kt(r){return typeof r=="string"?qe.fromBase64String(r):qe.fromUint8Array(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lc="server_timestamp",cc="__type__",uc="__previous_value__",dc="__local_write_time__";function Xs(r){var t,n;return((n=(((t=r==null?void 0:r.mapValue)==null?void 0:t.fields)||{})[cc])==null?void 0:n.stringValue)===lc}function Bi(r){const e=r.mapValue.fields[uc];return Xs(e)?Bi(e):e}function kn(r){const e=Ht(r.mapValue.fields[dc].timestampValue);return new we(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vm{constructor(e,t,n,i,a,l,d,m,g,f){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=a,this.forceLongPolling=l,this.autoDetectLongPolling=d,this.longPollingOptions=m,this.useFetchStreams=g,this.isUsingEmulator=f}}const Ci="(default)";class Dn{constructor(e,t){this.projectId=e,this.database=t||Ci}static empty(){return new Dn("","")}get isDefaultDatabase(){return this.database===Ci}isEqual(e){return e instanceof Dn&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hc="__type__",jm="__max__",oi={mapValue:{}},mc="__vector__",Ai="value";function Qt(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?Xs(r)?4:Lm(r)?9007199254740991:Mm(r)?10:11:ne(28295,{value:r})}function ft(r,e){if(r===e)return!0;const t=Qt(r);if(t!==Qt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return kn(r).isEqual(kn(e));case 3:return(function(i,a){if(typeof i.timestampValue=="string"&&typeof a.timestampValue=="string"&&i.timestampValue.length===a.timestampValue.length)return i.timestampValue===a.timestampValue;const l=Ht(i.timestampValue),d=Ht(a.timestampValue);return l.seconds===d.seconds&&l.nanos===d.nanos})(r,e);case 5:return r.stringValue===e.stringValue;case 6:return(function(i,a){return Kt(i.bytesValue).isEqual(Kt(a.bytesValue))})(r,e);case 7:return r.referenceValue===e.referenceValue;case 8:return(function(i,a){return Ce(i.geoPointValue.latitude)===Ce(a.geoPointValue.latitude)&&Ce(i.geoPointValue.longitude)===Ce(a.geoPointValue.longitude)})(r,e);case 2:return(function(i,a){if("integerValue"in i&&"integerValue"in a)return Ce(i.integerValue)===Ce(a.integerValue);if("doubleValue"in i&&"doubleValue"in a){const l=Ce(i.doubleValue),d=Ce(a.doubleValue);return l===d?Ei(l)===Ei(d):isNaN(l)&&isNaN(d)}return!1})(r,e);case 9:return Or(r.arrayValue.values||[],e.arrayValue.values||[],ft);case 10:case 11:return(function(i,a){const l=i.mapValue.fields||{},d=a.mapValue.fields||{};if(Ua(l)!==Ua(d))return!1;for(const m in l)if(l.hasOwnProperty(m)&&(d[m]===void 0||!ft(l[m],d[m])))return!1;return!0})(r,e);default:return ne(52216,{left:r})}}function Nn(r,e){return(r.values||[]).find((t=>ft(t,e)))!==void 0}function Fr(r,e){if(r===e)return 0;const t=Qt(r),n=Qt(e);if(t!==n)return ue(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return ue(r.booleanValue,e.booleanValue);case 2:return(function(a,l){const d=Ce(a.integerValue||a.doubleValue),m=Ce(l.integerValue||l.doubleValue);return d<m?-1:d>m?1:d===m?0:isNaN(d)?isNaN(m)?0:-1:1})(r,e);case 3:return qa(r.timestampValue,e.timestampValue);case 4:return qa(kn(r),kn(e));case 5:return Ss(r.stringValue,e.stringValue);case 6:return(function(a,l){const d=Kt(a),m=Kt(l);return d.compareTo(m)})(r.bytesValue,e.bytesValue);case 7:return(function(a,l){const d=a.split("/"),m=l.split("/");for(let g=0;g<d.length&&g<m.length;g++){const f=ue(d[g],m[g]);if(f!==0)return f}return ue(d.length,m.length)})(r.referenceValue,e.referenceValue);case 8:return(function(a,l){const d=ue(Ce(a.latitude),Ce(l.latitude));return d!==0?d:ue(Ce(a.longitude),Ce(l.longitude))})(r.geoPointValue,e.geoPointValue);case 9:return Ga(r.arrayValue,e.arrayValue);case 10:return(function(a,l){var w,k,B,q;const d=a.fields||{},m=l.fields||{},g=(w=d[Ai])==null?void 0:w.arrayValue,f=(k=m[Ai])==null?void 0:k.arrayValue,_=ue(((B=g==null?void 0:g.values)==null?void 0:B.length)||0,((q=f==null?void 0:f.values)==null?void 0:q.length)||0);return _!==0?_:Ga(g,f)})(r.mapValue,e.mapValue);case 11:return(function(a,l){if(a===oi.mapValue&&l===oi.mapValue)return 0;if(a===oi.mapValue)return 1;if(l===oi.mapValue)return-1;const d=a.fields||{},m=Object.keys(d),g=l.fields||{},f=Object.keys(g);m.sort(),f.sort();for(let _=0;_<m.length&&_<f.length;++_){const w=Ss(m[_],f[_]);if(w!==0)return w;const k=Fr(d[m[_]],g[f[_]]);if(k!==0)return k}return ue(m.length,f.length)})(r.mapValue,e.mapValue);default:throw ne(23264,{he:t})}}function qa(r,e){if(typeof r=="string"&&typeof e=="string"&&r.length===e.length)return ue(r,e);const t=Ht(r),n=Ht(e),i=ue(t.seconds,n.seconds);return i!==0?i:ue(t.nanos,n.nanos)}function Ga(r,e){const t=r.values||[],n=e.values||[];for(let i=0;i<t.length&&i<n.length;++i){const a=Fr(t[i],n[i]);if(a)return a}return ue(t.length,n.length)}function Br(r){return Ps(r)}function Ps(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?(function(t){const n=Ht(t);return`time(${n.seconds},${n.nanos})`})(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?(function(t){return Kt(t).toBase64()})(r.bytesValue):"referenceValue"in r?(function(t){return ee.fromName(t).toString()})(r.referenceValue):"geoPointValue"in r?(function(t){return`geo(${t.latitude},${t.longitude})`})(r.geoPointValue):"arrayValue"in r?(function(t){let n="[",i=!0;for(const a of t.values||[])i?i=!1:n+=",",n+=Ps(a);return n+"]"})(r.arrayValue):"mapValue"in r?(function(t){const n=Object.keys(t.fields||{}).sort();let i="{",a=!0;for(const l of n)a?a=!1:i+=",",i+=`${l}:${Ps(t.fields[l])}`;return i+"}"})(r.mapValue):ne(61005,{value:r})}function di(r){switch(Qt(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Bi(r);return e?16+di(e):16;case 5:return 2*r.stringValue.length;case 6:return Kt(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return(function(n){return(n.values||[]).reduce(((i,a)=>i+di(a)),0)})(r.arrayValue);case 10:case 11:return(function(n){let i=0;return gr(n.fields,((a,l)=>{i+=a.length+di(l)})),i})(r.mapValue);default:throw ne(13486,{value:r})}}function $a(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function ks(r){return!!r&&"integerValue"in r}function Js(r){return!!r&&"arrayValue"in r}function Wa(r){return!!r&&"nullValue"in r}function Ha(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function hi(r){return!!r&&"mapValue"in r}function Mm(r){var t,n;return((n=(((t=r==null?void 0:r.mapValue)==null?void 0:t.fields)||{})[hc])==null?void 0:n.stringValue)===mc}function xn(r){if(r.geoPointValue)return{geoPointValue:{...r.geoPointValue}};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:{...r.timestampValue}};if(r.mapValue){const e={mapValue:{fields:{}}};return gr(r.mapValue.fields,((t,n)=>e.mapValue.fields[t]=xn(n))),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=xn(r.arrayValue.values[t]);return e}return{...r}}function Lm(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===jm}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class et{constructor(e){this.value=e}static empty(){return new et({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!hi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=xn(t)}setAll(e){let t=ze.emptyPath(),n={},i=[];e.forEach(((l,d)=>{if(!t.isImmediateParentOf(d)){const m=this.getFieldsMap(t);this.applyChanges(m,n,i),n={},i=[],t=d.popLast()}l?n[d.lastSegment()]=xn(l):i.push(d.lastSegment())}));const a=this.getFieldsMap(t);this.applyChanges(a,n,i)}delete(e){const t=this.field(e.popLast());hi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ft(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];hi(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){gr(t,((i,a)=>e[i]=a));for(const i of n)delete e[i]}clone(){return new et(xn(this.value))}}function gc(r){const e=[];return gr(r.fields,((t,n)=>{const i=new ze([t]);if(hi(n)){const a=gc(n.mapValue).fields;if(a.length===0)e.push(i);else for(const l of a)e.push(i.child(l))}else e.push(i)})),new nt(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class We{constructor(e,t,n,i,a,l,d){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=a,this.data=l,this.documentState=d}static newInvalidDocument(e){return new We(e,0,se.min(),se.min(),se.min(),et.empty(),0)}static newFoundDocument(e,t,n,i){return new We(e,1,t,se.min(),n,i,0)}static newNoDocument(e,t){return new We(e,2,t,se.min(),se.min(),et.empty(),0)}static newUnknownDocument(e,t){return new We(e,3,t,se.min(),se.min(),et.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(se.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=et.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=et.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=se.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof We&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new We(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ri{constructor(e,t){this.position=e,this.inclusive=t}}function Ka(r,e,t){let n=0;for(let i=0;i<r.position.length;i++){const a=e[i],l=r.position[i];if(a.field.isKeyField()?n=ee.comparator(ee.fromName(l.referenceValue),t.key):n=Fr(l,t.data.field(a.field)),a.dir==="desc"&&(n*=-1),n!==0)break}return n}function Qa(r,e){if(r===null)return e===null;if(e===null||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!ft(r.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vn{constructor(e,t="asc"){this.field=e,this.dir=t}}function Om(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pc{}class Pe extends pc{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new Bm(e,t,n):t==="array-contains"?new qm(e,n):t==="in"?new Gm(e,n):t==="not-in"?new $m(e,n):t==="array-contains-any"?new Wm(e,n):new Pe(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new Um(e,n):new zm(e,n)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Fr(t,this.value)):t!==null&&Qt(this.value)===Qt(t)&&this.matchesComparison(Fr(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ne(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class it extends pc{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new it(e,t)}matches(e){return fc(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function fc(r){return r.op==="and"}function yc(r){return Fm(r)&&fc(r)}function Fm(r){for(const e of r.filters)if(e instanceof it)return!1;return!0}function Ds(r){if(r instanceof Pe)return r.field.canonicalString()+r.op.toString()+Br(r.value);if(yc(r))return r.filters.map((e=>Ds(e))).join(",");{const e=r.filters.map((t=>Ds(t))).join(",");return`${r.op}(${e})`}}function _c(r,e){return r instanceof Pe?(function(n,i){return i instanceof Pe&&n.op===i.op&&n.field.isEqual(i.field)&&ft(n.value,i.value)})(r,e):r instanceof it?(function(n,i){return i instanceof it&&n.op===i.op&&n.filters.length===i.filters.length?n.filters.reduce(((a,l,d)=>a&&_c(l,i.filters[d])),!0):!1})(r,e):void ne(19439)}function vc(r){return r instanceof Pe?(function(t){return`${t.field.canonicalString()} ${t.op} ${Br(t.value)}`})(r):r instanceof it?(function(t){return t.op.toString()+" {"+t.getFilters().map(vc).join(" ,")+"}"})(r):"Filter"}class Bm extends Pe{constructor(e,t,n){super(e,t,n),this.key=ee.fromName(n.referenceValue)}matches(e){const t=ee.comparator(e.key,this.key);return this.matchesComparison(t)}}class Um extends Pe{constructor(e,t){super(e,"in",t),this.keys=bc("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class zm extends Pe{constructor(e,t){super(e,"not-in",t),this.keys=bc("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function bc(r,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map((n=>ee.fromName(n.referenceValue)))}class qm extends Pe{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Js(t)&&Nn(t.arrayValue,this.value)}}class Gm extends Pe{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Nn(this.value.arrayValue,t)}}class $m extends Pe{constructor(e,t){super(e,"not-in",t)}matches(e){if(Nn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Nn(this.value.arrayValue,t)}}class Wm extends Pe{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Js(t)||!t.arrayValue.values)&&t.arrayValue.values.some((n=>Nn(this.value.arrayValue,n)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hm{constructor(e,t=null,n=[],i=[],a=null,l=null,d=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=a,this.startAt=l,this.endAt=d,this.Te=null}}function Ya(r,e=null,t=[],n=[],i=null,a=null,l=null){return new Hm(r,e,t,n,i,a,l)}function Zs(r){const e=ae(r);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((n=>Ds(n))).join(","),t+="|ob:",t+=e.orderBy.map((n=>(function(a){return a.field.canonicalString()+a.dir})(n))).join(","),Fi(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((n=>Br(n))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((n=>Br(n))).join(",")),e.Te=t}return e.Te}function eo(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!Om(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!_c(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!Qa(r.startAt,e.startAt)&&Qa(r.endAt,e.endAt)}function Ns(r){return ee.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hr{constructor(e,t=null,n=[],i=[],a=null,l="F",d=null,m=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=a,this.limitType=l,this.startAt=d,this.endAt=m,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Km(r,e,t,n,i,a,l,d){return new Hr(r,e,t,n,i,a,l,d)}function xc(r){return new Hr(r)}function Xa(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function wc(r){return r.collectionGroup!==null}function wn(r){const e=ae(r);if(e.Ie===null){e.Ie=[];const t=new Set;for(const a of e.explicitOrderBy)e.Ie.push(a),t.add(a.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(l){let d=new je(ze.comparator);return l.filters.forEach((m=>{m.getFlattenedFilters().forEach((g=>{g.isInequality()&&(d=d.add(g.field))}))})),d})(e).forEach((a=>{t.has(a.canonicalString())||a.isKeyField()||e.Ie.push(new Vn(a,n))})),t.has(ze.keyField().canonicalString())||e.Ie.push(new Vn(ze.keyField(),n))}return e.Ie}function ht(r){const e=ae(r);return e.Ee||(e.Ee=Qm(e,wn(r))),e.Ee}function Qm(r,e){if(r.limitType==="F")return Ya(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map((i=>{const a=i.dir==="desc"?"asc":"desc";return new Vn(i.field,a)}));const t=r.endAt?new Ri(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new Ri(r.startAt.position,r.startAt.inclusive):null;return Ya(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}function Vs(r,e){const t=r.filters.concat([e]);return new Hr(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function Si(r,e,t){return new Hr(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function Ui(r,e){return eo(ht(r),ht(e))&&r.limitType===e.limitType}function Ic(r){return`${Zs(ht(r))}|lt:${r.limitType}`}function Sr(r){return`Query(target=${(function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map((i=>vc(i))).join(", ")}]`),Fi(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map((i=>(function(l){return`${l.field.canonicalString()} (${l.dir})`})(i))).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map((i=>Br(i))).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map((i=>Br(i))).join(",")),`Target(${n})`})(ht(r))}; limitType=${r.limitType})`}function zi(r,e){return e.isFoundDocument()&&(function(n,i){const a=i.key.path;return n.collectionGroup!==null?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(a):ee.isDocumentKey(n.path)?n.path.isEqual(a):n.path.isImmediateParentOf(a)})(r,e)&&(function(n,i){for(const a of wn(n))if(!a.field.isKeyField()&&i.data.field(a.field)===null)return!1;return!0})(r,e)&&(function(n,i){for(const a of n.filters)if(!a.matches(i))return!1;return!0})(r,e)&&(function(n,i){return!(n.startAt&&!(function(l,d,m){const g=Ka(l,d,m);return l.inclusive?g<=0:g<0})(n.startAt,wn(n),i)||n.endAt&&!(function(l,d,m){const g=Ka(l,d,m);return l.inclusive?g>=0:g>0})(n.endAt,wn(n),i))})(r,e)}function Ym(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function Tc(r){return(e,t)=>{let n=!1;for(const i of wn(r)){const a=Xm(i,e,t);if(a!==0)return a;n=n||i.field.isKeyField()}return 0}}function Xm(r,e,t){const n=r.field.isKeyField()?ee.comparator(e.key,t.key):(function(a,l,d){const m=l.data.field(a),g=d.data.field(a);return m!==null&&g!==null?Fr(m,g):ne(42886)})(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return ne(19790,{direction:r.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pr{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(const[i,a]of n)if(this.equalsFn(i,e))return a}}has(e){return this.get(e)!==void 0}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(i===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let a=0;a<i.length;a++)if(this.equalsFn(i[a][0],e))return void(i[a]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return n.length===1?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){gr(this.inner,((t,n)=>{for(const[i,a]of n)e(i,a)}))}isEmpty(){return oc(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jm=new Ie(ee.comparator);function At(){return Jm}const Ec=new Ie(ee.comparator);function _n(...r){let e=Ec;for(const t of r)e=e.insert(t.key,t);return e}function Cc(r){let e=Ec;return r.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function ur(){return In()}function Ac(){return In()}function In(){return new pr((r=>r.toString()),((r,e)=>r.isEqual(e)))}const Zm=new Ie(ee.comparator),eg=new je(ee.comparator);function de(...r){let e=eg;for(const t of r)e=e.add(t);return e}const tg=new je(ue);function rg(){return tg}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function to(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ei(e)?"-0":e}}function Rc(r){return{integerValue:""+r}}function ng(r,e){return Pm(e)?Rc(e):to(r,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qi{constructor(){this._=void 0}}function ig(r,e,t){return r instanceof jn?(function(i,a){const l={fields:{[cc]:{stringValue:lc},[dc]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return a&&Xs(a)&&(a=Bi(a)),a&&(l.fields[uc]=a),{mapValue:l}})(t,e):r instanceof Mn?Pc(r,e):r instanceof Ln?kc(r,e):(function(i,a){const l=Sc(i,a),d=Ja(l)+Ja(i.Ae);return ks(l)&&ks(i.Ae)?Rc(d):to(i.serializer,d)})(r,e)}function sg(r,e,t){return r instanceof Mn?Pc(r,e):r instanceof Ln?kc(r,e):t}function Sc(r,e){return r instanceof Pi?(function(n){return ks(n)||(function(a){return!!a&&"doubleValue"in a})(n)})(e)?e:{integerValue:0}:null}class jn extends qi{}class Mn extends qi{constructor(e){super(),this.elements=e}}function Pc(r,e){const t=Dc(e);for(const n of r.elements)t.some((i=>ft(i,n)))||t.push(n);return{arrayValue:{values:t}}}class Ln extends qi{constructor(e){super(),this.elements=e}}function kc(r,e){let t=Dc(e);for(const n of r.elements)t=t.filter((i=>!ft(i,n)));return{arrayValue:{values:t}}}class Pi extends qi{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Ja(r){return Ce(r.integerValue||r.doubleValue)}function Dc(r){return Js(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class og{constructor(e,t){this.field=e,this.transform=t}}function ag(r,e){return r.field.isEqual(e.field)&&(function(n,i){return n instanceof Mn&&i instanceof Mn||n instanceof Ln&&i instanceof Ln?Or(n.elements,i.elements,ft):n instanceof Pi&&i instanceof Pi?ft(n.Ae,i.Ae):n instanceof jn&&i instanceof jn})(r.transform,e.transform)}class lg{constructor(e,t){this.version=e,this.transformResults=t}}class Tt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Tt}static exists(e){return new Tt(void 0,e)}static updateTime(e){return new Tt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function mi(r,e){return r.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(r.updateTime):r.exists===void 0||r.exists===e.isFoundDocument()}class Gi{}function Nc(r,e){if(!r.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return r.isNoDocument()?new jc(r.key,Tt.none()):new Fn(r.key,r.data,Tt.none());{const t=r.data,n=et.empty();let i=new je(ze.comparator);for(let a of e.fields)if(!i.has(a)){let l=t.field(a);l===null&&a.length>1&&(a=a.popLast(),l=t.field(a)),l===null?n.delete(a):n.set(a,l),i=i.add(a)}return new fr(r.key,n,new nt(i.toArray()),Tt.none())}}function cg(r,e,t){r instanceof Fn?(function(i,a,l){const d=i.value.clone(),m=el(i.fieldTransforms,a,l.transformResults);d.setAll(m),a.convertToFoundDocument(l.version,d).setHasCommittedMutations()})(r,e,t):r instanceof fr?(function(i,a,l){if(!mi(i.precondition,a))return void a.convertToUnknownDocument(l.version);const d=el(i.fieldTransforms,a,l.transformResults),m=a.data;m.setAll(Vc(i)),m.setAll(d),a.convertToFoundDocument(l.version,m).setHasCommittedMutations()})(r,e,t):(function(i,a,l){a.convertToNoDocument(l.version).setHasCommittedMutations()})(0,e,t)}function Tn(r,e,t,n){return r instanceof Fn?(function(a,l,d,m){if(!mi(a.precondition,l))return d;const g=a.value.clone(),f=tl(a.fieldTransforms,m,l);return g.setAll(f),l.convertToFoundDocument(l.version,g).setHasLocalMutations(),null})(r,e,t,n):r instanceof fr?(function(a,l,d,m){if(!mi(a.precondition,l))return d;const g=tl(a.fieldTransforms,m,l),f=l.data;return f.setAll(Vc(a)),f.setAll(g),l.convertToFoundDocument(l.version,f).setHasLocalMutations(),d===null?null:d.unionWith(a.fieldMask.fields).unionWith(a.fieldTransforms.map((_=>_.field)))})(r,e,t,n):(function(a,l,d){return mi(a.precondition,l)?(l.convertToNoDocument(l.version).setHasLocalMutations(),null):d})(r,e,t)}function ug(r,e){let t=null;for(const n of r.fieldTransforms){const i=e.data.field(n.field),a=Sc(n.transform,i||null);a!=null&&(t===null&&(t=et.empty()),t.set(n.field,a))}return t||null}function Za(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&!!(function(n,i){return n===void 0&&i===void 0||!(!n||!i)&&Or(n,i,((a,l)=>ag(a,l)))})(r.fieldTransforms,e.fieldTransforms)&&(r.type===0?r.value.isEqual(e.value):r.type!==1||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask))}class Fn extends Gi{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class fr extends Gi{constructor(e,t,n,i,a=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=a,this.type=1}getFieldMask(){return this.fieldMask}}function Vc(r){const e=new Map;return r.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const n=r.data.field(t);e.set(t,n)}})),e}function el(r,e,t){const n=new Map;ye(r.length===t.length,32656,{Re:t.length,Ve:r.length});for(let i=0;i<t.length;i++){const a=r[i],l=a.transform,d=e.data.field(a.field);n.set(a.field,sg(l,d,t[i]))}return n}function tl(r,e,t){const n=new Map;for(const i of r){const a=i.transform,l=t.data.field(i.field);n.set(i.field,ig(a,l,e))}return n}class jc extends Gi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class dg extends Gi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hg{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const a=this.mutations[i];a.key.isEqual(e.key)&&cg(a,e,n[i])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Tn(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Tn(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Ac();return this.mutations.forEach((i=>{const a=e.get(i.key),l=a.overlayedDocument;let d=this.applyToLocalView(l,a.mutatedFields);d=t.has(i.key)?null:d;const m=Nc(l,d);m!==null&&n.set(i.key,m),l.isValidDocument()||l.convertToNoDocument(se.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),de())}isEqual(e){return this.batchId===e.batchId&&Or(this.mutations,e.mutations,((t,n)=>Za(t,n)))&&Or(this.baseMutations,e.baseMutations,((t,n)=>Za(t,n)))}}class ro{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){ye(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let i=(function(){return Zm})();const a=e.mutations;for(let l=0;l<a.length;l++)i=i.insert(a[l].key,n[l].version);return new ro(e,t,n,i)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mg{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gg{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Se,me;function pg(r){switch(r){case V.OK:return ne(64938);case V.CANCELLED:case V.UNKNOWN:case V.DEADLINE_EXCEEDED:case V.RESOURCE_EXHAUSTED:case V.INTERNAL:case V.UNAVAILABLE:case V.UNAUTHENTICATED:return!1;case V.INVALID_ARGUMENT:case V.NOT_FOUND:case V.ALREADY_EXISTS:case V.PERMISSION_DENIED:case V.FAILED_PRECONDITION:case V.ABORTED:case V.OUT_OF_RANGE:case V.UNIMPLEMENTED:case V.DATA_LOSS:return!0;default:return ne(15467,{code:r})}}function Mc(r){if(r===void 0)return Ct("GRPC error has no .code"),V.UNKNOWN;switch(r){case Se.OK:return V.OK;case Se.CANCELLED:return V.CANCELLED;case Se.UNKNOWN:return V.UNKNOWN;case Se.DEADLINE_EXCEEDED:return V.DEADLINE_EXCEEDED;case Se.RESOURCE_EXHAUSTED:return V.RESOURCE_EXHAUSTED;case Se.INTERNAL:return V.INTERNAL;case Se.UNAVAILABLE:return V.UNAVAILABLE;case Se.UNAUTHENTICATED:return V.UNAUTHENTICATED;case Se.INVALID_ARGUMENT:return V.INVALID_ARGUMENT;case Se.NOT_FOUND:return V.NOT_FOUND;case Se.ALREADY_EXISTS:return V.ALREADY_EXISTS;case Se.PERMISSION_DENIED:return V.PERMISSION_DENIED;case Se.FAILED_PRECONDITION:return V.FAILED_PRECONDITION;case Se.ABORTED:return V.ABORTED;case Se.OUT_OF_RANGE:return V.OUT_OF_RANGE;case Se.UNIMPLEMENTED:return V.UNIMPLEMENTED;case Se.DATA_LOSS:return V.DATA_LOSS;default:return ne(39323,{code:r})}}(me=Se||(Se={}))[me.OK=0]="OK",me[me.CANCELLED=1]="CANCELLED",me[me.UNKNOWN=2]="UNKNOWN",me[me.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",me[me.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",me[me.NOT_FOUND=5]="NOT_FOUND",me[me.ALREADY_EXISTS=6]="ALREADY_EXISTS",me[me.PERMISSION_DENIED=7]="PERMISSION_DENIED",me[me.UNAUTHENTICATED=16]="UNAUTHENTICATED",me[me.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",me[me.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",me[me.ABORTED=10]="ABORTED",me[me.OUT_OF_RANGE=11]="OUT_OF_RANGE",me[me.UNIMPLEMENTED=12]="UNIMPLEMENTED",me[me.INTERNAL=13]="INTERNAL",me[me.UNAVAILABLE=14]="UNAVAILABLE",me[me.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fg(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yg=new qt([4294967295,4294967295],0);function rl(r){const e=fg().encode(r),t=new Ql;return t.update(e),new Uint8Array(t.digest())}function nl(r){const e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),i=e.getUint32(8,!0),a=e.getUint32(12,!0);return[new qt([t,n],0),new qt([i,a],0)]}class no{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new vn(`Invalid padding: ${t}`);if(n<0)throw new vn(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new vn(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new vn(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=qt.fromNumber(this.ge)}ye(e,t,n){let i=e.add(t.multiply(qt.fromNumber(n)));return i.compare(yg)===1&&(i=new qt([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=rl(e),[n,i]=nl(t);for(let a=0;a<this.hashCount;a++){const l=this.ye(n,i,a);if(!this.we(l))return!1}return!0}static create(e,t,n){const i=e%8==0?0:8-e%8,a=new Uint8Array(Math.ceil(e/8)),l=new no(a,i,t);return n.forEach((d=>l.insert(d))),l}insert(e){if(this.ge===0)return;const t=rl(e),[n,i]=nl(t);for(let a=0;a<this.hashCount;a++){const l=this.ye(n,i,a);this.Se(l)}}Se(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class vn extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $i{constructor(e,t,n,i,a){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=a}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const i=new Map;return i.set(e,Bn.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new $i(se.min(),i,new Ie(ue),At(),de())}}class Bn{constructor(e,t,n,i,a){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=a}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Bn(n,t,de(),de(),de())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gi{constructor(e,t,n,i){this.be=e,this.removedTargetIds=t,this.key=n,this.De=i}}class Lc{constructor(e,t){this.targetId=e,this.Ce=t}}class Oc{constructor(e,t,n=qe.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class il{constructor(){this.ve=0,this.Fe=sl(),this.Me=qe.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=de(),t=de(),n=de();return this.Fe.forEach(((i,a)=>{switch(a){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:ne(38017,{changeType:a})}})),new Bn(this.Me,this.xe,e,t,n)}qe(){this.Oe=!1,this.Fe=sl()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,ye(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class _g{constructor(e){this.Ge=e,this.ze=new Map,this.je=At(),this.Je=ai(),this.He=ai(),this.Ye=new Ie(ue)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(e.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.We(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:ne(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((n,i)=>{this.rt(i)&&t(i)}))}st(e){const t=e.targetId,n=e.Ce.count,i=this.ot(t);if(i){const a=i.target;if(Ns(a))if(n===0){const l=new ee(a.path);this.et(t,l,We.newNoDocument(l,se.min()))}else ye(n===1,20013,{expectedCount:n});else{const l=this._t(t);if(l!==n){const d=this.ut(e),m=d?this.ct(d,e,l):1;if(m!==0){this.it(t);const g=m===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,g)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:i=0},hashCount:a=0}=t;let l,d;try{l=Kt(n).toUint8Array()}catch(m){if(m instanceof ac)return Lr("Decoding the base64 bloom filter in existence filter failed ("+m.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw m}try{d=new no(l,i,a)}catch(m){return Lr(m instanceof vn?"BloomFilter error: ":"Applying bloom filter failed: ",m),null}return d.ge===0?null:d}ct(e,t,n){return t.Ce.count===n-this.Pt(e,t.targetId)?0:2}Pt(e,t){const n=this.Ge.getRemoteKeysForTarget(t);let i=0;return n.forEach((a=>{const l=this.Ge.ht(),d=`projects/${l.projectId}/databases/${l.database}/documents/${a.path.canonicalString()}`;e.mightContain(d)||(this.et(t,a,null),i++)})),i}Tt(e){const t=new Map;this.ze.forEach(((a,l)=>{const d=this.ot(l);if(d){if(a.current&&Ns(d.target)){const m=new ee(d.target.path);this.It(m).has(l)||this.Et(l,m)||this.et(l,m,We.newNoDocument(m,e))}a.Be&&(t.set(l,a.ke()),a.qe())}}));let n=de();this.He.forEach(((a,l)=>{let d=!0;l.forEachWhile((m=>{const g=this.ot(m);return!g||g.purpose==="TargetPurposeLimboResolution"||(d=!1,!1)})),d&&(n=n.add(a))})),this.je.forEach(((a,l)=>l.setReadTime(e)));const i=new $i(e,t,this.Ye,this.je,n);return this.je=At(),this.Je=ai(),this.He=ai(),this.Ye=new Ie(ue),i}Xe(e,t){if(!this.rt(e))return;const n=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,n),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;const i=this.nt(e);this.Et(e,t)?i.Qe(t,1):i.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new il,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new je(ue),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new je(ue),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||Q("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new il),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function ai(){return new Ie(ee.comparator)}function sl(){return new Ie(ee.comparator)}const vg={asc:"ASCENDING",desc:"DESCENDING"},bg={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},xg={and:"AND",or:"OR"};class wg{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function js(r,e){return r.useProto3Json||Fi(e)?e:{value:e}}function ki(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Fc(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function Ig(r,e){return ki(r,e.toTimestamp())}function mt(r){return ye(!!r,49232),se.fromTimestamp((function(t){const n=Ht(t);return new we(n.seconds,n.nanos)})(r))}function io(r,e){return Ms(r,e).canonicalString()}function Ms(r,e){const t=(function(i){return new ve(["projects",i.projectId,"databases",i.database])})(r).child("documents");return e===void 0?t:t.child(e)}function Bc(r){const e=ve.fromString(r);return ye($c(e),10190,{key:e.toString()}),e}function Ls(r,e){return io(r.databaseId,e.path)}function ys(r,e){const t=Bc(e);if(t.get(1)!==r.databaseId.projectId)throw new K(V.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new K(V.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new ee(zc(t))}function Uc(r,e){return io(r.databaseId,e)}function Tg(r){const e=Bc(r);return e.length===4?ve.emptyPath():zc(e)}function Os(r){return new ve(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function zc(r){return ye(r.length>4&&r.get(4)==="documents",29091,{key:r.toString()}),r.popFirst(5)}function ol(r,e,t){return{name:Ls(r,e),fields:t.value.mapValue.fields}}function Eg(r,e){let t;if("targetChange"in e){e.targetChange;const n=(function(g){return g==="NO_CHANGE"?0:g==="ADD"?1:g==="REMOVE"?2:g==="CURRENT"?3:g==="RESET"?4:ne(39313,{state:g})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],a=(function(g,f){return g.useProto3Json?(ye(f===void 0||typeof f=="string",58123),qe.fromBase64String(f||"")):(ye(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),qe.fromUint8Array(f||new Uint8Array))})(r,e.targetChange.resumeToken),l=e.targetChange.cause,d=l&&(function(g){const f=g.code===void 0?V.UNKNOWN:Mc(g.code);return new K(f,g.message||"")})(l);t=new Oc(n,i,a,d||null)}else if("documentChange"in e){e.documentChange;const n=e.documentChange;n.document,n.document.name,n.document.updateTime;const i=ys(r,n.document.name),a=mt(n.document.updateTime),l=n.document.createTime?mt(n.document.createTime):se.min(),d=new et({mapValue:{fields:n.document.fields}}),m=We.newFoundDocument(i,a,l,d),g=n.targetIds||[],f=n.removedTargetIds||[];t=new gi(g,f,m.key,m)}else if("documentDelete"in e){e.documentDelete;const n=e.documentDelete;n.document;const i=ys(r,n.document),a=n.readTime?mt(n.readTime):se.min(),l=We.newNoDocument(i,a),d=n.removedTargetIds||[];t=new gi([],d,l.key,l)}else if("documentRemove"in e){e.documentRemove;const n=e.documentRemove;n.document;const i=ys(r,n.document),a=n.removedTargetIds||[];t=new gi([],a,i,null)}else{if(!("filter"in e))return ne(11601,{Rt:e});{e.filter;const n=e.filter;n.targetId;const{count:i=0,unchangedNames:a}=n,l=new gg(i,a),d=n.targetId;t=new Lc(d,l)}}return t}function Cg(r,e){let t;if(e instanceof Fn)t={update:ol(r,e.key,e.value)};else if(e instanceof jc)t={delete:Ls(r,e.key)};else if(e instanceof fr)t={update:ol(r,e.key,e.data),updateMask:jg(e.fieldMask)};else{if(!(e instanceof dg))return ne(16599,{Vt:e.type});t={verify:Ls(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((n=>(function(a,l){const d=l.transform;if(d instanceof jn)return{fieldPath:l.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(d instanceof Mn)return{fieldPath:l.field.canonicalString(),appendMissingElements:{values:d.elements}};if(d instanceof Ln)return{fieldPath:l.field.canonicalString(),removeAllFromArray:{values:d.elements}};if(d instanceof Pi)return{fieldPath:l.field.canonicalString(),increment:d.Ae};throw ne(20930,{transform:l.transform})})(0,n)))),e.precondition.isNone||(t.currentDocument=(function(i,a){return a.updateTime!==void 0?{updateTime:Ig(i,a.updateTime)}:a.exists!==void 0?{exists:a.exists}:ne(27497)})(r,e.precondition)),t}function Ag(r,e){return r&&r.length>0?(ye(e!==void 0,14353),r.map((t=>(function(i,a){let l=i.updateTime?mt(i.updateTime):mt(a);return l.isEqual(se.min())&&(l=mt(a)),new lg(l,i.transformResults||[])})(t,e)))):[]}function Rg(r,e){return{documents:[Uc(r,e.path)]}}function Sg(r,e){const t={structuredQuery:{}},n=e.path;let i;e.collectionGroup!==null?(i=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=Uc(r,i);const a=(function(g){if(g.length!==0)return Gc(it.create(g,"and"))})(e.filters);a&&(t.structuredQuery.where=a);const l=(function(g){if(g.length!==0)return g.map((f=>(function(w){return{field:Pr(w.field),direction:Dg(w.dir)}})(f)))})(e.orderBy);l&&(t.structuredQuery.orderBy=l);const d=js(r,e.limit);return d!==null&&(t.structuredQuery.limit=d),e.startAt&&(t.structuredQuery.startAt=(function(g){return{before:g.inclusive,values:g.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(g){return{before:!g.inclusive,values:g.position}})(e.endAt)),{ft:t,parent:i}}function Pg(r){let e=Tg(r.parent);const t=r.structuredQuery,n=t.from?t.from.length:0;let i=null;if(n>0){ye(n===1,65062);const f=t.from[0];f.allDescendants?i=f.collectionId:e=e.child(f.collectionId)}let a=[];t.where&&(a=(function(_){const w=qc(_);return w instanceof it&&yc(w)?w.getFilters():[w]})(t.where));let l=[];t.orderBy&&(l=(function(_){return _.map((w=>(function(B){return new Vn(kr(B.field),(function(S){switch(S){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(B.direction))})(w)))})(t.orderBy));let d=null;t.limit&&(d=(function(_){let w;return w=typeof _=="object"?_.value:_,Fi(w)?null:w})(t.limit));let m=null;t.startAt&&(m=(function(_){const w=!!_.before,k=_.values||[];return new Ri(k,w)})(t.startAt));let g=null;return t.endAt&&(g=(function(_){const w=!_.before,k=_.values||[];return new Ri(k,w)})(t.endAt)),Km(e,i,l,a,d,"F",m,g)}function kg(r,e){const t=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ne(28987,{purpose:i})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function qc(r){return r.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=kr(t.unaryFilter.field);return Pe.create(n,"==",{doubleValue:NaN});case"IS_NULL":const i=kr(t.unaryFilter.field);return Pe.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const a=kr(t.unaryFilter.field);return Pe.create(a,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const l=kr(t.unaryFilter.field);return Pe.create(l,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return ne(61313);default:return ne(60726)}})(r):r.fieldFilter!==void 0?(function(t){return Pe.create(kr(t.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return ne(58110);default:return ne(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(r):r.compositeFilter!==void 0?(function(t){return it.create(t.compositeFilter.filters.map((n=>qc(n))),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return ne(1026)}})(t.compositeFilter.op))})(r):ne(30097,{filter:r})}function Dg(r){return vg[r]}function Ng(r){return bg[r]}function Vg(r){return xg[r]}function Pr(r){return{fieldPath:r.canonicalString()}}function kr(r){return ze.fromServerFormat(r.fieldPath)}function Gc(r){return r instanceof Pe?(function(t){if(t.op==="=="){if(Ha(t.value))return{unaryFilter:{field:Pr(t.field),op:"IS_NAN"}};if(Wa(t.value))return{unaryFilter:{field:Pr(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Ha(t.value))return{unaryFilter:{field:Pr(t.field),op:"IS_NOT_NAN"}};if(Wa(t.value))return{unaryFilter:{field:Pr(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Pr(t.field),op:Ng(t.op),value:t.value}}})(r):r instanceof it?(function(t){const n=t.getFilters().map((i=>Gc(i)));return n.length===1?n[0]:{compositeFilter:{op:Vg(t.op),filters:n}}})(r):ne(54877,{filter:r})}function jg(r){const e=[];return r.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function $c(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bt{constructor(e,t,n,i,a=se.min(),l=se.min(),d=qe.EMPTY_BYTE_STRING,m=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=a,this.lastLimboFreeSnapshotVersion=l,this.resumeToken=d,this.expectedCount=m}withSequenceNumber(e){return new Bt(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Bt(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Bt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Bt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mg{constructor(e){this.yt=e}}function Lg(r){const e=Pg({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?Si(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Og{constructor(){this.Cn=new Fg}addToCollectionParentIndex(e,t){return this.Cn.add(t),j.resolve()}getCollectionParents(e,t){return j.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return j.resolve()}deleteFieldIndex(e,t){return j.resolve()}deleteAllFieldIndexes(e){return j.resolve()}createTargetIndexes(e,t){return j.resolve()}getDocumentsMatchingTarget(e,t){return j.resolve(null)}getIndexType(e,t){return j.resolve(0)}getFieldIndexes(e,t){return j.resolve([])}getNextCollectionGroupToUpdate(e){return j.resolve(null)}getMinOffset(e,t){return j.resolve(Wt.min())}getMinOffsetFromCollectionGroup(e,t){return j.resolve(Wt.min())}updateCollectionGroup(e,t,n){return j.resolve()}updateIndexEntries(e,t){return j.resolve()}}class Fg{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new je(ve.comparator),a=!i.has(n);return this.index[t]=i.add(n),a}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new je(ve.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const al={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Wc=41943040;class Ke{static withCacheSize(e){return new Ke(e,Ke.DEFAULT_COLLECTION_PERCENTILE,Ke.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ke.DEFAULT_COLLECTION_PERCENTILE=10,Ke.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ke.DEFAULT=new Ke(Wc,Ke.DEFAULT_COLLECTION_PERCENTILE,Ke.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ke.DISABLED=new Ke(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ur{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Ur(0)}static cr(){return new Ur(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ll="LruGarbageCollector",Bg=1048576;function cl([r,e],[t,n]){const i=ue(r,t);return i===0?ue(e,n):i}class Ug{constructor(e){this.Ir=e,this.buffer=new je(cl),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const n=this.buffer.last();cl(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}}class zg{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Q(ll,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Wr(t)?Q(ll,"Ignoring IndexedDB error during garbage collection: ",t):await $r(t)}await this.Vr(3e5)}))}}class qg{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((n=>Math.floor(t/100*n)))}nthSequenceNumber(e,t){if(t===0)return j.resolve(Oi.ce);const n=new Ug(t);return this.mr.forEachTarget(e,(i=>n.Ar(i.sequenceNumber))).next((()=>this.mr.pr(e,(i=>n.Ar(i))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.mr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(Q("LruGarbageCollector","Garbage collection skipped; disabled"),j.resolve(al)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(Q("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),al):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let n,i,a,l,d,m,g;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((_=>(_>this.params.maximumSequenceNumbersToCollect?(Q("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${_}`),i=this.params.maximumSequenceNumbersToCollect):i=_,l=Date.now(),this.nthSequenceNumber(e,i)))).next((_=>(n=_,d=Date.now(),this.removeTargets(e,n,t)))).next((_=>(a=_,m=Date.now(),this.removeOrphanedDocuments(e,n)))).next((_=>(g=Date.now(),Rr()<=ge.DEBUG&&Q("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${l-f}ms
	Determined least recently used ${i} in `+(d-l)+`ms
	Removed ${a} targets in `+(m-d)+`ms
	Removed ${_} documents in `+(g-m)+`ms
Total Duration: ${g-f}ms`),j.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:a,documentsRemoved:_}))))}}function Gg(r,e){return new qg(r,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $g{constructor(){this.changes=new pr((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,We.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return n!==void 0?j.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wg{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hg{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((i=>(n=i,this.remoteDocumentCache.getEntry(e,t)))).next((i=>(n!==null&&Tn(n.mutation,i,nt.empty(),we.now()),i)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((n=>this.getLocalViewOfDocuments(e,n,de()).next((()=>n))))}getLocalViewOfDocuments(e,t,n=de()){const i=ur();return this.populateOverlays(e,i,t).next((()=>this.computeViews(e,t,i,n).next((a=>{let l=_n();return a.forEach(((d,m)=>{l=l.insert(d,m.overlayedDocument)})),l}))))}getOverlayedDocuments(e,t){const n=ur();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,de())))}populateOverlays(e,t,n){const i=[];return n.forEach((a=>{t.has(a)||i.push(a)})),this.documentOverlayCache.getOverlays(e,i).next((a=>{a.forEach(((l,d)=>{t.set(l,d)}))}))}computeViews(e,t,n,i){let a=At();const l=In(),d=(function(){return In()})();return t.forEach(((m,g)=>{const f=n.get(g.key);i.has(g.key)&&(f===void 0||f.mutation instanceof fr)?a=a.insert(g.key,g):f!==void 0?(l.set(g.key,f.mutation.getFieldMask()),Tn(f.mutation,g,f.mutation.getFieldMask(),we.now())):l.set(g.key,nt.empty())})),this.recalculateAndSaveOverlays(e,a).next((m=>(m.forEach(((g,f)=>l.set(g,f))),t.forEach(((g,f)=>d.set(g,new Wg(f,l.get(g)??null)))),d)))}recalculateAndSaveOverlays(e,t){const n=In();let i=new Ie(((l,d)=>l-d)),a=de();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((l=>{for(const d of l)d.keys().forEach((m=>{const g=t.get(m);if(g===null)return;let f=n.get(m)||nt.empty();f=d.applyToLocalView(g,f),n.set(m,f);const _=(i.get(d.batchId)||de()).add(m);i=i.insert(d.batchId,_)}))})).next((()=>{const l=[],d=i.getReverseIterator();for(;d.hasNext();){const m=d.getNext(),g=m.key,f=m.value,_=Ac();f.forEach((w=>{if(!a.has(w)){const k=Nc(t.get(w),n.get(w));k!==null&&_.set(w,k),a=a.add(w)}})),l.push(this.documentOverlayCache.saveOverlays(e,g,_))}return j.waitFor(l)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((n=>this.recalculateAndSaveOverlays(e,n)))}getDocumentsMatchingQuery(e,t,n,i){return(function(l){return ee.isDocumentKey(l.path)&&l.collectionGroup===null&&l.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):wc(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i)}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next((a=>{const l=i-a.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-a.size):j.resolve(ur());let d=Pn,m=a;return l.next((g=>j.forEach(g,((f,_)=>(d<_.largestBatchId&&(d=_.largestBatchId),a.get(f)?j.resolve():this.remoteDocumentCache.getEntry(e,f).next((w=>{m=m.insert(f,w)}))))).next((()=>this.populateOverlays(e,g,a))).next((()=>this.computeViews(e,m,g,de()))).next((f=>({batchId:d,changes:Cc(f)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ee(t)).next((n=>{let i=_n();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){const a=t.collectionGroup;let l=_n();return this.indexManager.getCollectionParents(e,a).next((d=>j.forEach(d,(m=>{const g=(function(_,w){return new Hr(w,null,_.explicitOrderBy.slice(),_.filters.slice(),_.limit,_.limitType,_.startAt,_.endAt)})(t,m.child(a));return this.getDocumentsMatchingCollectionQuery(e,g,n,i).next((f=>{f.forEach(((_,w)=>{l=l.insert(_,w)}))}))})).next((()=>l))))}getDocumentsMatchingCollectionQuery(e,t,n,i){let a;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((l=>(a=l,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,a,i)))).next((l=>{a.forEach(((m,g)=>{const f=g.getKey();l.get(f)===null&&(l=l.insert(f,We.newInvalidDocument(f)))}));let d=_n();return l.forEach(((m,g)=>{const f=a.get(m);f!==void 0&&Tn(f.mutation,g,nt.empty(),we.now()),zi(t,g)&&(d=d.insert(m,g))})),d}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kg{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return j.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(i){return{id:i.id,version:i.version,createTime:mt(i.createTime)}})(t)),j.resolve()}getNamedQuery(e,t){return j.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(i){return{name:i.name,query:Lg(i.bundledQuery),readTime:mt(i.readTime)}})(t)),j.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qg{constructor(){this.overlays=new Ie(ee.comparator),this.qr=new Map}getOverlay(e,t){return j.resolve(this.overlays.get(t))}getOverlays(e,t){const n=ur();return j.forEach(t,(i=>this.getOverlay(e,i).next((a=>{a!==null&&n.set(i,a)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((i,a)=>{this.St(e,t,a)})),j.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.qr.get(n);return i!==void 0&&(i.forEach((a=>this.overlays=this.overlays.remove(a))),this.qr.delete(n)),j.resolve()}getOverlaysForCollection(e,t,n){const i=ur(),a=t.length+1,l=new ee(t.child("")),d=this.overlays.getIteratorFrom(l);for(;d.hasNext();){const m=d.getNext().value,g=m.getKey();if(!t.isPrefixOf(g.path))break;g.path.length===a&&m.largestBatchId>n&&i.set(m.getKey(),m)}return j.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let a=new Ie(((g,f)=>g-f));const l=this.overlays.getIterator();for(;l.hasNext();){const g=l.getNext().value;if(g.getKey().getCollectionGroup()===t&&g.largestBatchId>n){let f=a.get(g.largestBatchId);f===null&&(f=ur(),a=a.insert(g.largestBatchId,f)),f.set(g.getKey(),g)}}const d=ur(),m=a.getIterator();for(;m.hasNext()&&(m.getNext().value.forEach(((g,f)=>d.set(g,f))),!(d.size()>=i)););return j.resolve(d)}St(e,t,n){const i=this.overlays.get(n.key);if(i!==null){const l=this.qr.get(i.largestBatchId).delete(n.key);this.qr.set(i.largestBatchId,l)}this.overlays=this.overlays.insert(n.key,new mg(t,n));let a=this.qr.get(t);a===void 0&&(a=de(),this.qr.set(t,a)),this.qr.set(t,a.add(n.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yg{constructor(){this.sessionToken=qe.EMPTY_BYTE_STRING}getSessionToken(e){return j.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,j.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class so{constructor(){this.Qr=new je(Oe.$r),this.Ur=new je(Oe.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const n=new Oe(e,t);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,t){e.forEach((n=>this.addReference(n,t)))}removeReference(e,t){this.Gr(new Oe(e,t))}zr(e,t){e.forEach((n=>this.removeReference(n,t)))}jr(e){const t=new ee(new ve([])),n=new Oe(t,e),i=new Oe(t,e+1),a=[];return this.Ur.forEachInRange([n,i],(l=>{this.Gr(l),a.push(l.key)})),a}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new ee(new ve([])),n=new Oe(t,e),i=new Oe(t,e+1);let a=de();return this.Ur.forEachInRange([n,i],(l=>{a=a.add(l.key)})),a}containsKey(e){const t=new Oe(e,0),n=this.Qr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}}class Oe{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return ee.comparator(e.key,t.key)||ue(e.Yr,t.Yr)}static Kr(e,t){return ue(e.Yr,t.Yr)||ee.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xg{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new je(Oe.$r)}checkEmpty(e){return j.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,i){const a=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const l=new hg(a,t,n,i);this.mutationQueue.push(l);for(const d of i)this.Zr=this.Zr.add(new Oe(d.key,a)),this.indexManager.addToCollectionParentIndex(e,d.key.path.popLast());return j.resolve(l)}lookupMutationBatch(e,t){return j.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,i=this.ei(n),a=i<0?0:i;return j.resolve(this.mutationQueue.length>a?this.mutationQueue[a]:null)}getHighestUnacknowledgedBatchId(){return j.resolve(this.mutationQueue.length===0?Ys:this.tr-1)}getAllMutationBatches(e){return j.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Oe(t,0),i=new Oe(t,Number.POSITIVE_INFINITY),a=[];return this.Zr.forEachInRange([n,i],(l=>{const d=this.Xr(l.Yr);a.push(d)})),j.resolve(a)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new je(ue);return t.forEach((i=>{const a=new Oe(i,0),l=new Oe(i,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([a,l],(d=>{n=n.add(d.Yr)}))})),j.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let a=n;ee.isDocumentKey(a)||(a=a.child(""));const l=new Oe(new ee(a),0);let d=new je(ue);return this.Zr.forEachWhile((m=>{const g=m.key.path;return!!n.isPrefixOf(g)&&(g.length===i&&(d=d.add(m.Yr)),!0)}),l),j.resolve(this.ti(d))}ti(e){const t=[];return e.forEach((n=>{const i=this.Xr(n);i!==null&&t.push(i)})),t}removeMutationBatch(e,t){ye(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let n=this.Zr;return j.forEach(t.mutations,(i=>{const a=new Oe(i.key,t.batchId);return n=n.delete(a),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((()=>{this.Zr=n}))}ir(e){}containsKey(e,t){const n=new Oe(t,0),i=this.Zr.firstAfterOrEqual(n);return j.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,j.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jg{constructor(e){this.ri=e,this.docs=(function(){return new Ie(ee.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),a=i?i.size:0,l=this.ri(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:l}),this.size+=l-a,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return j.resolve(n?n.document.mutableCopy():We.newInvalidDocument(t))}getEntries(e,t){let n=At();return t.forEach((i=>{const a=this.docs.get(i);n=n.insert(i,a?a.document.mutableCopy():We.newInvalidDocument(i))})),j.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let a=At();const l=t.path,d=new ee(l.child("__id-9223372036854775808__")),m=this.docs.getIteratorFrom(d);for(;m.hasNext();){const{key:g,value:{document:f}}=m.getNext();if(!l.isPrefixOf(g.path))break;g.path.length>l.length+1||Cm(Em(f),n)<=0||(i.has(f.key)||zi(t,f))&&(a=a.insert(f.key,f.mutableCopy()))}return j.resolve(a)}getAllFromCollectionGroup(e,t,n,i){ne(9500)}ii(e,t){return j.forEach(this.docs,(n=>t(n)))}newChangeBuffer(e){return new Zg(this)}getSize(e){return j.resolve(this.size)}}class Zg extends $g{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((n,i)=>{i.isValidDocument()?t.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(n)})),j.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ep{constructor(e){this.persistence=e,this.si=new pr((t=>Zs(t)),eo),this.lastRemoteSnapshotVersion=se.min(),this.highestTargetId=0,this.oi=0,this._i=new so,this.targetCount=0,this.ai=Ur.ur()}forEachTarget(e,t){return this.si.forEach(((n,i)=>t(i))),j.resolve()}getLastRemoteSnapshotVersion(e){return j.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return j.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),j.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.oi&&(this.oi=t),j.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Ur(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,j.resolve()}updateTargetData(e,t){return this.Pr(t),j.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,j.resolve()}removeTargets(e,t,n){let i=0;const a=[];return this.si.forEach(((l,d)=>{d.sequenceNumber<=t&&n.get(d.targetId)===null&&(this.si.delete(l),a.push(this.removeMatchingKeysForTargetId(e,d.targetId)),i++)})),j.waitFor(a).next((()=>i))}getTargetCount(e){return j.resolve(this.targetCount)}getTargetData(e,t){const n=this.si.get(t)||null;return j.resolve(n)}addMatchingKeys(e,t,n){return this._i.Wr(t,n),j.resolve()}removeMatchingKeys(e,t,n){this._i.zr(t,n);const i=this.persistence.referenceDelegate,a=[];return i&&t.forEach((l=>{a.push(i.markPotentiallyOrphaned(e,l))})),j.waitFor(a)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),j.resolve()}getMatchingKeysForTargetId(e,t){const n=this._i.Hr(t);return j.resolve(n)}containsKey(e,t){return j.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hc{constructor(e,t){this.ui={},this.overlays={},this.ci=new Oi(0),this.li=!1,this.li=!0,this.hi=new Yg,this.referenceDelegate=e(this),this.Pi=new ep(this),this.indexManager=new Og,this.remoteDocumentCache=(function(i){return new Jg(i)})((n=>this.referenceDelegate.Ti(n))),this.serializer=new Mg(t),this.Ii=new Kg(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Qg,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ui[e.toKey()];return n||(n=new Xg(t,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,n){Q("MemoryPersistence","Starting transaction:",e);const i=new tp(this.ci.next());return this.referenceDelegate.Ei(),n(i).next((a=>this.referenceDelegate.di(i).next((()=>a)))).toPromise().then((a=>(i.raiseOnCommittedEvent(),a)))}Ai(e,t){return j.or(Object.values(this.ui).map((n=>()=>n.containsKey(e,t))))}}class tp extends Rm{constructor(e){super(),this.currentSequenceNumber=e}}class oo{constructor(e){this.persistence=e,this.Ri=new so,this.Vi=null}static mi(e){return new oo(e)}get fi(){if(this.Vi)return this.Vi;throw ne(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.fi.delete(n.toString()),j.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.fi.add(n.toString()),j.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),j.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((i=>this.fi.add(i.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((i=>{i.forEach((a=>this.fi.add(a.toString())))})).next((()=>n.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return j.forEach(this.fi,(n=>{const i=ee.fromPath(n);return this.gi(e,i).next((a=>{a||t.removeEntry(i,se.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((n=>{n?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return j.or([()=>j.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Di{constructor(e,t){this.persistence=e,this.pi=new pr((n=>km(n.path)),((n,i)=>n.isEqual(i))),this.garbageCollector=Gg(this,t)}static mi(e,t){return new Di(e,t)}Ei(){}di(e){return j.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((n=>t.next((i=>n+i))))}wr(e){let t=0;return this.pr(e,(n=>{t++})).next((()=>t))}pr(e,t){return j.forEach(this.pi,((n,i)=>this.br(e,n,i).next((a=>a?j.resolve():t(i)))))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const i=this.persistence.getRemoteDocumentCache(),a=i.newChangeBuffer();return i.ii(e,(l=>this.br(e,l,t).next((d=>{d||(n++,a.removeEntry(l,se.min()))})))).next((()=>a.apply(e))).next((()=>n))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),j.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),j.resolve()}removeReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),j.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),j.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=di(e.data.value)),t}br(e,t,n){return j.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const i=this.pi.get(t);return j.resolve(i!==void 0&&i>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ao{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.Es=n,this.ds=i}static As(e,t){let n=de(),i=de();for(const a of t.docChanges)switch(a.type){case 0:n=n.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}return new ao(e,t.fromCache,n,i)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rp{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class np{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return Wd()?8:Sm(Gd())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,i){const a={result:null};return this.ys(e,t).next((l=>{a.result=l})).next((()=>{if(!a.result)return this.ws(e,t,i,n).next((l=>{a.result=l}))})).next((()=>{if(a.result)return;const l=new rp;return this.Ss(e,t,l).next((d=>{if(a.result=d,this.Vs)return this.bs(e,t,l,d.size)}))})).next((()=>a.result))}bs(e,t,n,i){return n.documentReadCount<this.fs?(Rr()<=ge.DEBUG&&Q("QueryEngine","SDK will not create cache indexes for query:",Sr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),j.resolve()):(Rr()<=ge.DEBUG&&Q("QueryEngine","Query:",Sr(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.gs*i?(Rr()<=ge.DEBUG&&Q("QueryEngine","The SDK decides to create cache indexes for query:",Sr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ht(t))):j.resolve())}ys(e,t){if(Xa(t))return j.resolve(null);let n=ht(t);return this.indexManager.getIndexType(e,n).next((i=>i===0?null:(t.limit!==null&&i===1&&(t=Si(t,null,"F"),n=ht(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((a=>{const l=de(...a);return this.ps.getDocuments(e,l).next((d=>this.indexManager.getMinOffset(e,n).next((m=>{const g=this.Ds(t,d);return this.Cs(t,g,l,m.readTime)?this.ys(e,Si(t,null,"F")):this.vs(e,g,t,m)}))))})))))}ws(e,t,n,i){return Xa(t)||i.isEqual(se.min())?j.resolve(null):this.ps.getDocuments(e,n).next((a=>{const l=this.Ds(t,a);return this.Cs(t,l,n,i)?j.resolve(null):(Rr()<=ge.DEBUG&&Q("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Sr(t)),this.vs(e,l,t,Tm(i,Pn)).next((d=>d)))}))}Ds(e,t){let n=new je(Tc(e));return t.forEach(((i,a)=>{zi(e,a)&&(n=n.add(a))})),n}Cs(e,t,n,i){if(e.limit===null)return!1;if(n.size!==t.size)return!0;const a=e.limitType==="F"?t.last():t.first();return!!a&&(a.hasPendingWrites||a.version.compareTo(i)>0)}Ss(e,t,n){return Rr()<=ge.DEBUG&&Q("QueryEngine","Using full collection scan to execute query:",Sr(t)),this.ps.getDocumentsMatchingQuery(e,t,Wt.min(),n)}vs(e,t,n,i){return this.ps.getDocumentsMatchingQuery(e,n,i).next((a=>(t.forEach((l=>{a=a.insert(l.key,l)})),a)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lo="LocalStore",ip=3e8;class sp{constructor(e,t,n,i){this.persistence=e,this.Fs=t,this.serializer=i,this.Ms=new Ie(ue),this.xs=new pr((a=>Zs(a)),eo),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Hg(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function op(r,e,t,n){return new sp(r,e,t,n)}async function Kc(r,e){const t=ae(r);return await t.persistence.runTransaction("Handle user change","readonly",(n=>{let i;return t.mutationQueue.getAllMutationBatches(n).next((a=>(i=a,t.Bs(e),t.mutationQueue.getAllMutationBatches(n)))).next((a=>{const l=[],d=[];let m=de();for(const g of i){l.push(g.batchId);for(const f of g.mutations)m=m.add(f.key)}for(const g of a){d.push(g.batchId);for(const f of g.mutations)m=m.add(f.key)}return t.localDocuments.getDocuments(n,m).next((g=>({Ls:g,removedBatchIds:l,addedBatchIds:d})))}))}))}function ap(r,e){const t=ae(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(n=>{const i=e.batch.keys(),a=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(d,m,g,f){const _=g.batch,w=_.keys();let k=j.resolve();return w.forEach((B=>{k=k.next((()=>f.getEntry(m,B))).next((q=>{const S=g.docVersions.get(B);ye(S!==null,48541),q.version.compareTo(S)<0&&(_.applyToRemoteDocument(q,g),q.isValidDocument()&&(q.setReadTime(g.commitVersion),f.addEntry(q)))}))})),k.next((()=>d.mutationQueue.removeMutationBatch(m,_)))})(t,n,e,a).next((()=>a.apply(n))).next((()=>t.mutationQueue.performConsistencyCheck(n))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(n,i,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,(function(d){let m=de();for(let g=0;g<d.mutationResults.length;++g)d.mutationResults[g].transformResults.length>0&&(m=m.add(d.batch.mutations[g].key));return m})(e)))).next((()=>t.localDocuments.getDocuments(n,i)))}))}function Qc(r){const e=ae(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function lp(r,e){const t=ae(r),n=e.snapshotVersion;let i=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(a=>{const l=t.Ns.newChangeBuffer({trackRemovals:!0});i=t.Ms;const d=[];e.targetChanges.forEach(((f,_)=>{const w=i.get(_);if(!w)return;d.push(t.Pi.removeMatchingKeys(a,f.removedDocuments,_).next((()=>t.Pi.addMatchingKeys(a,f.addedDocuments,_))));let k=w.withSequenceNumber(a.currentSequenceNumber);e.targetMismatches.get(_)!==null?k=k.withResumeToken(qe.EMPTY_BYTE_STRING,se.min()).withLastLimboFreeSnapshotVersion(se.min()):f.resumeToken.approximateByteSize()>0&&(k=k.withResumeToken(f.resumeToken,n)),i=i.insert(_,k),(function(q,S,N){return q.resumeToken.approximateByteSize()===0||S.snapshotVersion.toMicroseconds()-q.snapshotVersion.toMicroseconds()>=ip?!0:N.addedDocuments.size+N.modifiedDocuments.size+N.removedDocuments.size>0})(w,k,f)&&d.push(t.Pi.updateTargetData(a,k))}));let m=At(),g=de();if(e.documentUpdates.forEach((f=>{e.resolvedLimboDocuments.has(f)&&d.push(t.persistence.referenceDelegate.updateLimboDocument(a,f))})),d.push(cp(a,l,e.documentUpdates).next((f=>{m=f.ks,g=f.qs}))),!n.isEqual(se.min())){const f=t.Pi.getLastRemoteSnapshotVersion(a).next((_=>t.Pi.setTargetsMetadata(a,a.currentSequenceNumber,n)));d.push(f)}return j.waitFor(d).next((()=>l.apply(a))).next((()=>t.localDocuments.getLocalViewOfDocuments(a,m,g))).next((()=>m))})).then((a=>(t.Ms=i,a)))}function cp(r,e,t){let n=de(),i=de();return t.forEach((a=>n=n.add(a))),e.getEntries(r,n).next((a=>{let l=At();return t.forEach(((d,m)=>{const g=a.get(d);m.isFoundDocument()!==g.isFoundDocument()&&(i=i.add(d)),m.isNoDocument()&&m.version.isEqual(se.min())?(e.removeEntry(d,m.readTime),l=l.insert(d,m)):!g.isValidDocument()||m.version.compareTo(g.version)>0||m.version.compareTo(g.version)===0&&g.hasPendingWrites?(e.addEntry(m),l=l.insert(d,m)):Q(lo,"Ignoring outdated watch update for ",d,". Current version:",g.version," Watch version:",m.version)})),{ks:l,qs:i}}))}function up(r,e){const t=ae(r);return t.persistence.runTransaction("Get next mutation batch","readonly",(n=>(e===void 0&&(e=Ys),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e))))}function dp(r,e){const t=ae(r);return t.persistence.runTransaction("Allocate target","readwrite",(n=>{let i;return t.Pi.getTargetData(n,e).next((a=>a?(i=a,j.resolve(i)):t.Pi.allocateTargetId(n).next((l=>(i=new Bt(e,l,"TargetPurposeListen",n.currentSequenceNumber),t.Pi.addTargetData(n,i).next((()=>i)))))))})).then((n=>{const i=t.Ms.get(n.targetId);return(i===null||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(n.targetId,n),t.xs.set(e,n.targetId)),n}))}async function Fs(r,e,t){const n=ae(r),i=n.Ms.get(e),a=t?"readwrite":"readwrite-primary";try{t||await n.persistence.runTransaction("Release target",a,(l=>n.persistence.referenceDelegate.removeTarget(l,i)))}catch(l){if(!Wr(l))throw l;Q(lo,`Failed to update sequence numbers for target ${e}: ${l}`)}n.Ms=n.Ms.remove(e),n.xs.delete(i.target)}function ul(r,e,t){const n=ae(r);let i=se.min(),a=de();return n.persistence.runTransaction("Execute query","readwrite",(l=>(function(m,g,f){const _=ae(m),w=_.xs.get(f);return w!==void 0?j.resolve(_.Ms.get(w)):_.Pi.getTargetData(g,f)})(n,l,ht(e)).next((d=>{if(d)return i=d.lastLimboFreeSnapshotVersion,n.Pi.getMatchingKeysForTargetId(l,d.targetId).next((m=>{a=m}))})).next((()=>n.Fs.getDocumentsMatchingQuery(l,e,t?i:se.min(),t?a:de()))).next((d=>(hp(n,Ym(e),d),{documents:d,Qs:a})))))}function hp(r,e,t){let n=r.Os.get(e)||se.min();t.forEach(((i,a)=>{a.readTime.compareTo(n)>0&&(n=a.readTime)})),r.Os.set(e,n)}class dl{constructor(){this.activeTargetIds=rg()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class mp{constructor(){this.Mo=new dl,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,n){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new dl,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gp{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hl="ConnectivityMonitor";class ml{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Q(hl,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Q(hl,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let li=null;function Bs(){return li===null?li=(function(){return 268435456+Math.round(2147483648*Math.random())})():li++,"0x"+li.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _s="RestConnection",pp={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class fp{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${n}/databases/${i}`,this.Wo=this.databaseId.database===Ci?`project_id=${n}`:`project_id=${n}&database_id=${i}`}Go(e,t,n,i,a){const l=Bs(),d=this.zo(e,t.toUriEncodedString());Q(_s,`Sending RPC '${e}' ${l}:`,d,n);const m={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(m,i,a);const{host:g}=new URL(d),f=Ws(g);return this.Jo(e,d,m,n,f).then((_=>(Q(_s,`Received RPC '${e}' ${l}: `,_),_)),(_=>{throw Lr(_s,`RPC '${e}' ${l} failed with error: `,_,"url: ",d,"request:",n),_}))}Ho(e,t,n,i,a,l){return this.Go(e,t,n,i,a)}jo(e,t,n){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Gr})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((i,a)=>e[a]=i)),n&&n.headers.forEach(((i,a)=>e[a]=i))}zo(e,t){const n=pp[e];return`${this.Uo}/v1/${t}:${n}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yp{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ge="WebChannelConnection";class _p extends fp{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,i,a){const l=Bs();return new Promise(((d,m)=>{const g=new Yl;g.setWithCredentials(!0),g.listenOnce(Xl.COMPLETE,(()=>{try{switch(g.getLastErrorCode()){case ui.NO_ERROR:const _=g.getResponseJson();Q(Ge,`XHR for RPC '${e}' ${l} received:`,JSON.stringify(_)),d(_);break;case ui.TIMEOUT:Q(Ge,`RPC '${e}' ${l} timed out`),m(new K(V.DEADLINE_EXCEEDED,"Request time out"));break;case ui.HTTP_ERROR:const w=g.getStatus();if(Q(Ge,`RPC '${e}' ${l} failed with status:`,w,"response text:",g.getResponseText()),w>0){let k=g.getResponseJson();Array.isArray(k)&&(k=k[0]);const B=k==null?void 0:k.error;if(B&&B.status&&B.message){const q=(function(N){const L=N.toLowerCase().replace(/_/g,"-");return Object.values(V).indexOf(L)>=0?L:V.UNKNOWN})(B.status);m(new K(q,B.message))}else m(new K(V.UNKNOWN,"Server responded with status "+g.getStatus()))}else m(new K(V.UNAVAILABLE,"Connection failed."));break;default:ne(9055,{l_:e,streamId:l,h_:g.getLastErrorCode(),P_:g.getLastError()})}}finally{Q(Ge,`RPC '${e}' ${l} completed.`)}}));const f=JSON.stringify(i);Q(Ge,`RPC '${e}' ${l} sending request:`,i),g.send(t,"POST",f,n,15)}))}T_(e,t,n){const i=Bs(),a=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],l=ec(),d=Zl(),m={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},g=this.longPollingOptions.timeoutSeconds;g!==void 0&&(m.longPollingTimeout=Math.round(1e3*g)),this.useFetchStreams&&(m.useFetchStreams=!0),this.jo(m.initMessageHeaders,t,n),m.encodeInitMessageHeaders=!0;const f=a.join("");Q(Ge,`Creating RPC '${e}' stream ${i}: ${f}`,m);const _=l.createWebChannel(f,m);this.I_(_);let w=!1,k=!1;const B=new yp({Yo:S=>{k?Q(Ge,`Not sending because RPC '${e}' stream ${i} is closed:`,S):(w||(Q(Ge,`Opening RPC '${e}' stream ${i} transport.`),_.open(),w=!0),Q(Ge,`RPC '${e}' stream ${i} sending:`,S),_.send(S))},Zo:()=>_.close()}),q=(S,N,L)=>{S.listen(N,(U=>{try{L(U)}catch(G){setTimeout((()=>{throw G}),0)}}))};return q(_,yn.EventType.OPEN,(()=>{k||(Q(Ge,`RPC '${e}' stream ${i} transport opened.`),B.o_())})),q(_,yn.EventType.CLOSE,(()=>{k||(k=!0,Q(Ge,`RPC '${e}' stream ${i} transport closed`),B.a_(),this.E_(_))})),q(_,yn.EventType.ERROR,(S=>{k||(k=!0,Lr(Ge,`RPC '${e}' stream ${i} transport errored. Name:`,S.name,"Message:",S.message),B.a_(new K(V.UNAVAILABLE,"The operation could not be completed")))})),q(_,yn.EventType.MESSAGE,(S=>{var N;if(!k){const L=S.data[0];ye(!!L,16349);const U=L,G=(U==null?void 0:U.error)||((N=U[0])==null?void 0:N.error);if(G){Q(Ge,`RPC '${e}' stream ${i} received error:`,G);const Z=G.status;let J=(function(x){const T=Se[x];if(T!==void 0)return Mc(T)})(Z),I=G.message;J===void 0&&(J=V.INTERNAL,I="Unknown error status: "+Z+" with message "+G.message),k=!0,B.a_(new K(J,I)),_.close()}else Q(Ge,`RPC '${e}' stream ${i} received:`,L),B.u_(L)}})),q(d,Jl.STAT_EVENT,(S=>{S.stat===Rs.PROXY?Q(Ge,`RPC '${e}' stream ${i} detected buffering proxy`):S.stat===Rs.NOPROXY&&Q(Ge,`RPC '${e}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{B.__()}),0),B}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function vs(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wi(r){return new wg(r,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yc{constructor(e,t,n=1e3,i=1.5,a=6e4){this.Mi=e,this.timerId=t,this.d_=n,this.A_=i,this.R_=a,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),i=Math.max(0,t-n);i>0&&Q("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gl="PersistentStream";class Xc{constructor(e,t,n,i,a,l,d,m){this.Mi=e,this.S_=n,this.b_=i,this.connection=a,this.authCredentialsProvider=l,this.appCheckCredentialsProvider=d,this.listener=m,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Yc(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===V.RESOURCE_EXHAUSTED?(Ct(t.toString()),Ct("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===V.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([n,i])=>{this.D_===t&&this.G_(n,i)}),(n=>{e((()=>{const i=new K(V.UNKNOWN,"Fetching auth token failed: "+n.message);return this.z_(i)}))}))}G_(e,t){const n=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{n((()=>this.listener.Xo()))})),this.stream.t_((()=>{n((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((i=>{n((()=>this.z_(i)))})),this.stream.onMessage((i=>{n((()=>++this.F_==1?this.J_(i):this.onNext(i)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return Q(gl,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(Q(gl,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class vp extends Xc{constructor(e,t,n,i,a,l){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,l),this.serializer=a}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=Eg(this.serializer,e),n=(function(a){if(!("targetChange"in a))return se.min();const l=a.targetChange;return l.targetIds&&l.targetIds.length?se.min():l.readTime?mt(l.readTime):se.min()})(e);return this.listener.H_(t,n)}Y_(e){const t={};t.database=Os(this.serializer),t.addTarget=(function(a,l){let d;const m=l.target;if(d=Ns(m)?{documents:Rg(a,m)}:{query:Sg(a,m).ft},d.targetId=l.targetId,l.resumeToken.approximateByteSize()>0){d.resumeToken=Fc(a,l.resumeToken);const g=js(a,l.expectedCount);g!==null&&(d.expectedCount=g)}else if(l.snapshotVersion.compareTo(se.min())>0){d.readTime=ki(a,l.snapshotVersion.toTimestamp());const g=js(a,l.expectedCount);g!==null&&(d.expectedCount=g)}return d})(this.serializer,e);const n=kg(this.serializer,e);n&&(t.labels=n),this.q_(t)}Z_(e){const t={};t.database=Os(this.serializer),t.removeTarget=e,this.q_(t)}}class bp extends Xc{constructor(e,t,n,i,a,l){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,l),this.serializer=a}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return ye(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,ye(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){ye(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=Ag(e.writeResults,e.commitTime),n=mt(e.commitTime);return this.listener.na(n,t)}ra(){const e={};e.database=Os(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((n=>Cg(this.serializer,n)))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xp{}class wp extends xp{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new K(V.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,n,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,l])=>this.connection.Go(e,Ms(t,n),i,a,l))).catch((a=>{throw a.name==="FirebaseError"?(a.code===V.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new K(V.UNKNOWN,a.toString())}))}Ho(e,t,n,i,a){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([l,d])=>this.connection.Ho(e,Ms(t,n),i,l,d,a))).catch((l=>{throw l.name==="FirebaseError"?(l.code===V.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new K(V.UNKNOWN,l.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class Ip{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Ct(t),this.aa=!1):Q("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mr="RemoteStore";class Tp{constructor(e,t,n,i,a){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=a,this.Aa.Oo((l=>{n.enqueueAndForget((async()=>{yr(this)&&(Q(mr,"Restarting streams for network reachability change."),await(async function(m){const g=ae(m);g.Ea.add(4),await Un(g),g.Ra.set("Unknown"),g.Ea.delete(4),await Hi(g)})(this))}))})),this.Ra=new Ip(n,i)}}async function Hi(r){if(yr(r))for(const e of r.da)await e(!0)}async function Un(r){for(const e of r.da)await e(!1)}function Jc(r,e){const t=ae(r);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),mo(t)?ho(t):Kr(t).O_()&&uo(t,e))}function co(r,e){const t=ae(r),n=Kr(t);t.Ia.delete(e),n.O_()&&Zc(t,e),t.Ia.size===0&&(n.O_()?n.L_():yr(t)&&t.Ra.set("Unknown"))}function uo(r,e){if(r.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(se.min())>0){const t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Kr(r).Y_(e)}function Zc(r,e){r.Va.Ue(e),Kr(r).Z_(e)}function ho(r){r.Va=new _g({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),At:e=>r.Ia.get(e)||null,ht:()=>r.datastore.serializer.databaseId}),Kr(r).start(),r.Ra.ua()}function mo(r){return yr(r)&&!Kr(r).x_()&&r.Ia.size>0}function yr(r){return ae(r).Ea.size===0}function eu(r){r.Va=void 0}async function Ep(r){r.Ra.set("Online")}async function Cp(r){r.Ia.forEach(((e,t)=>{uo(r,e)}))}async function Ap(r,e){eu(r),mo(r)?(r.Ra.ha(e),ho(r)):r.Ra.set("Unknown")}async function Rp(r,e,t){if(r.Ra.set("Online"),e instanceof Oc&&e.state===2&&e.cause)try{await(async function(i,a){const l=a.cause;for(const d of a.targetIds)i.Ia.has(d)&&(await i.remoteSyncer.rejectListen(d,l),i.Ia.delete(d),i.Va.removeTarget(d))})(r,e)}catch(n){Q(mr,"Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Ni(r,n)}else if(e instanceof gi?r.Va.Ze(e):e instanceof Lc?r.Va.st(e):r.Va.tt(e),!t.isEqual(se.min()))try{const n=await Qc(r.localStore);t.compareTo(n)>=0&&await(function(a,l){const d=a.Va.Tt(l);return d.targetChanges.forEach(((m,g)=>{if(m.resumeToken.approximateByteSize()>0){const f=a.Ia.get(g);f&&a.Ia.set(g,f.withResumeToken(m.resumeToken,l))}})),d.targetMismatches.forEach(((m,g)=>{const f=a.Ia.get(m);if(!f)return;a.Ia.set(m,f.withResumeToken(qe.EMPTY_BYTE_STRING,f.snapshotVersion)),Zc(a,m);const _=new Bt(f.target,m,g,f.sequenceNumber);uo(a,_)})),a.remoteSyncer.applyRemoteEvent(d)})(r,t)}catch(n){Q(mr,"Failed to raise snapshot:",n),await Ni(r,n)}}async function Ni(r,e,t){if(!Wr(e))throw e;r.Ea.add(1),await Un(r),r.Ra.set("Offline"),t||(t=()=>Qc(r.localStore)),r.asyncQueue.enqueueRetryable((async()=>{Q(mr,"Retrying IndexedDB access"),await t(),r.Ea.delete(1),await Hi(r)}))}function tu(r,e){return e().catch((t=>Ni(r,t,e)))}async function Ki(r){const e=ae(r),t=Yt(e);let n=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Ys;for(;Sp(e);)try{const i=await up(e.localStore,n);if(i===null){e.Ta.length===0&&t.L_();break}n=i.batchId,Pp(e,i)}catch(i){await Ni(e,i)}ru(e)&&nu(e)}function Sp(r){return yr(r)&&r.Ta.length<10}function Pp(r,e){r.Ta.push(e);const t=Yt(r);t.O_()&&t.X_&&t.ea(e.mutations)}function ru(r){return yr(r)&&!Yt(r).x_()&&r.Ta.length>0}function nu(r){Yt(r).start()}async function kp(r){Yt(r).ra()}async function Dp(r){const e=Yt(r);for(const t of r.Ta)e.ea(t.mutations)}async function Np(r,e,t){const n=r.Ta.shift(),i=ro.from(n,e,t);await tu(r,(()=>r.remoteSyncer.applySuccessfulWrite(i))),await Ki(r)}async function Vp(r,e){e&&Yt(r).X_&&await(async function(n,i){if((function(l){return pg(l)&&l!==V.ABORTED})(i.code)){const a=n.Ta.shift();Yt(n).B_(),await tu(n,(()=>n.remoteSyncer.rejectFailedWrite(a.batchId,i))),await Ki(n)}})(r,e),ru(r)&&nu(r)}async function pl(r,e){const t=ae(r);t.asyncQueue.verifyOperationInProgress(),Q(mr,"RemoteStore received new credentials");const n=yr(t);t.Ea.add(3),await Un(t),n&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Hi(t)}async function jp(r,e){const t=ae(r);e?(t.Ea.delete(2),await Hi(t)):e||(t.Ea.add(2),await Un(t),t.Ra.set("Unknown"))}function Kr(r){return r.ma||(r.ma=(function(t,n,i){const a=ae(t);return a.sa(),new vp(n,a.connection,a.authCredentials,a.appCheckCredentials,a.serializer,i)})(r.datastore,r.asyncQueue,{Xo:Ep.bind(null,r),t_:Cp.bind(null,r),r_:Ap.bind(null,r),H_:Rp.bind(null,r)}),r.da.push((async e=>{e?(r.ma.B_(),mo(r)?ho(r):r.Ra.set("Unknown")):(await r.ma.stop(),eu(r))}))),r.ma}function Yt(r){return r.fa||(r.fa=(function(t,n,i){const a=ae(t);return a.sa(),new bp(n,a.connection,a.authCredentials,a.appCheckCredentials,a.serializer,i)})(r.datastore,r.asyncQueue,{Xo:()=>Promise.resolve(),t_:kp.bind(null,r),r_:Vp.bind(null,r),ta:Dp.bind(null,r),na:Np.bind(null,r)}),r.da.push((async e=>{e?(r.fa.B_(),await Ki(r)):(await r.fa.stop(),r.Ta.length>0&&(Q(mr,`Stopping write stream with ${r.Ta.length} pending writes`),r.Ta=[]))}))),r.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class go{constructor(e,t,n,i,a){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=a,this.deferred=new Gt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((l=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,a){const l=Date.now()+n,d=new go(e,t,l,i,a);return d.start(n),d}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new K(V.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function po(r,e){if(Ct("AsyncQueue",`${e}: ${r}`),Wr(r))return new K(V.UNAVAILABLE,`${e}: ${r}`);throw r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nr{static emptySet(e){return new Nr(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||ee.comparator(t.key,n.key):(t,n)=>ee.comparator(t.key,n.key),this.keyedMap=_n(),this.sortedSet=new Ie(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Nr)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,a=n.getNext().key;if(!i.isEqual(a))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const n=new Nr;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fl{constructor(){this.ga=new Ie(ee.comparator)}track(e){const t=e.doc.key,n=this.ga.get(t);n?e.type!==0&&n.type===3?this.ga=this.ga.insert(t,e):e.type===3&&n.type!==1?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.ga=this.ga.remove(t):e.type===1&&n.type===2?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):ne(63341,{Rt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,n)=>{e.push(n)})),e}}class zr{constructor(e,t,n,i,a,l,d,m,g){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=a,this.fromCache=l,this.syncStateChanged=d,this.excludesMetadataChanges=m,this.hasCachedResults=g}static fromInitialDocuments(e,t,n,i,a){const l=[];return t.forEach((d=>{l.push({type:0,doc:d})})),new zr(e,t,Nr.emptySet(t),l,n,i,!0,!1,a)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ui(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mp{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class Lp{constructor(){this.queries=yl(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,n){const i=ae(t),a=i.queries;i.queries=yl(),a.forEach(((l,d)=>{for(const m of d.Sa)m.onError(n)}))})(this,new K(V.ABORTED,"Firestore shutting down"))}}function yl(){return new pr((r=>Ic(r)),Ui)}async function Op(r,e){const t=ae(r);let n=3;const i=e.query;let a=t.queries.get(i);a?!a.ba()&&e.Da()&&(n=2):(a=new Mp,n=e.Da()?0:1);try{switch(n){case 0:a.wa=await t.onListen(i,!0);break;case 1:a.wa=await t.onListen(i,!1);break;case 2:await t.onFirstRemoteStoreListen(i)}}catch(l){const d=po(l,`Initialization of query '${Sr(e.query)}' failed`);return void e.onError(d)}t.queries.set(i,a),a.Sa.push(e),e.va(t.onlineState),a.wa&&e.Fa(a.wa)&&fo(t)}async function Fp(r,e){const t=ae(r),n=e.query;let i=3;const a=t.queries.get(n);if(a){const l=a.Sa.indexOf(e);l>=0&&(a.Sa.splice(l,1),a.Sa.length===0?i=e.Da()?0:1:!a.ba()&&e.Da()&&(i=2))}switch(i){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}}function Bp(r,e){const t=ae(r);let n=!1;for(const i of e){const a=i.query,l=t.queries.get(a);if(l){for(const d of l.Sa)d.Fa(i)&&(n=!0);l.wa=i}}n&&fo(t)}function Up(r,e,t){const n=ae(r),i=n.queries.get(e);if(i)for(const a of i.Sa)a.onError(t);n.queries.delete(e)}function fo(r){r.Ca.forEach((e=>{e.next()}))}var Us,_l;(_l=Us||(Us={})).Ma="default",_l.Cache="cache";class zp{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){const n=[];for(const i of e.docChanges)i.type!==3&&n.push(i);e=new zr(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const n=t!=="Offline";return(!this.options.qa||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=zr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Us.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iu{constructor(e){this.key=e}}class su{constructor(e){this.key=e}}class qp{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=de(),this.mutatedKeys=de(),this.eu=Tc(e),this.tu=new Nr(this.eu)}get nu(){return this.Ya}ru(e,t){const n=t?t.iu:new fl,i=t?t.tu:this.tu;let a=t?t.mutatedKeys:this.mutatedKeys,l=i,d=!1;const m=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,g=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(((f,_)=>{const w=i.get(f),k=zi(this.query,_)?_:null,B=!!w&&this.mutatedKeys.has(w.key),q=!!k&&(k.hasLocalMutations||this.mutatedKeys.has(k.key)&&k.hasCommittedMutations);let S=!1;w&&k?w.data.isEqual(k.data)?B!==q&&(n.track({type:3,doc:k}),S=!0):this.su(w,k)||(n.track({type:2,doc:k}),S=!0,(m&&this.eu(k,m)>0||g&&this.eu(k,g)<0)&&(d=!0)):!w&&k?(n.track({type:0,doc:k}),S=!0):w&&!k&&(n.track({type:1,doc:w}),S=!0,(m||g)&&(d=!0)),S&&(k?(l=l.add(k),a=q?a.add(f):a.delete(f)):(l=l.delete(f),a=a.delete(f)))})),this.query.limit!==null)for(;l.size>this.query.limit;){const f=this.query.limitType==="F"?l.last():l.first();l=l.delete(f.key),a=a.delete(f.key),n.track({type:1,doc:f})}return{tu:l,iu:n,Cs:d,mutatedKeys:a}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){const a=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const l=e.iu.ya();l.sort(((f,_)=>(function(k,B){const q=S=>{switch(S){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ne(20277,{Rt:S})}};return q(k)-q(B)})(f.type,_.type)||this.eu(f.doc,_.doc))),this.ou(n),i=i??!1;const d=t&&!i?this._u():[],m=this.Xa.size===0&&this.current&&!i?1:0,g=m!==this.Za;return this.Za=m,l.length!==0||g?{snapshot:new zr(this.query,e.tu,a,l,e.mutatedKeys,m===0,g,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:d}:{au:d}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new fl,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=de(),this.tu.forEach((n=>{this.uu(n.key)&&(this.Xa=this.Xa.add(n.key))}));const t=[];return e.forEach((n=>{this.Xa.has(n)||t.push(new su(n))})),this.Xa.forEach((n=>{e.has(n)||t.push(new iu(n))})),t}cu(e){this.Ya=e.Qs,this.Xa=de();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return zr.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const yo="SyncEngine";class Gp{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class $p{constructor(e){this.key=e,this.hu=!1}}class Wp{constructor(e,t,n,i,a,l){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=a,this.maxConcurrentLimboResolutions=l,this.Pu={},this.Tu=new pr((d=>Ic(d)),Ui),this.Iu=new Map,this.Eu=new Set,this.du=new Ie(ee.comparator),this.Au=new Map,this.Ru=new so,this.Vu={},this.mu=new Map,this.fu=Ur.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function Hp(r,e,t=!0){const n=du(r);let i;const a=n.Tu.get(e);return a?(n.sharedClientState.addLocalQueryTarget(a.targetId),i=a.view.lu()):i=await ou(n,e,t,!0),i}async function Kp(r,e){const t=du(r);await ou(t,e,!0,!1)}async function ou(r,e,t,n){const i=await dp(r.localStore,ht(e)),a=i.targetId,l=r.sharedClientState.addLocalQueryTarget(a,t);let d;return n&&(d=await Qp(r,e,a,l==="current",i.resumeToken)),r.isPrimaryClient&&t&&Jc(r.remoteStore,i),d}async function Qp(r,e,t,n,i){r.pu=(_,w,k)=>(async function(q,S,N,L){let U=S.view.ru(N);U.Cs&&(U=await ul(q.localStore,S.query,!1).then((({documents:I})=>S.view.ru(I,U))));const G=L&&L.targetChanges.get(S.targetId),Z=L&&L.targetMismatches.get(S.targetId)!=null,J=S.view.applyChanges(U,q.isPrimaryClient,G,Z);return bl(q,S.targetId,J.au),J.snapshot})(r,_,w,k);const a=await ul(r.localStore,e,!0),l=new qp(e,a.Qs),d=l.ru(a.documents),m=Bn.createSynthesizedTargetChangeForCurrentChange(t,n&&r.onlineState!=="Offline",i),g=l.applyChanges(d,r.isPrimaryClient,m);bl(r,t,g.au);const f=new Gp(e,t,l);return r.Tu.set(e,f),r.Iu.has(t)?r.Iu.get(t).push(e):r.Iu.set(t,[e]),g.snapshot}async function Yp(r,e,t){const n=ae(r),i=n.Tu.get(e),a=n.Iu.get(i.targetId);if(a.length>1)return n.Iu.set(i.targetId,a.filter((l=>!Ui(l,e)))),void n.Tu.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await Fs(n.localStore,i.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(i.targetId),t&&co(n.remoteStore,i.targetId),zs(n,i.targetId)})).catch($r)):(zs(n,i.targetId),await Fs(n.localStore,i.targetId,!0))}async function Xp(r,e){const t=ae(r),n=t.Tu.get(e),i=t.Iu.get(n.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),co(t.remoteStore,n.targetId))}async function Jp(r,e,t){const n=of(r);try{const i=await(function(l,d){const m=ae(l),g=we.now(),f=d.reduce(((k,B)=>k.add(B.key)),de());let _,w;return m.persistence.runTransaction("Locally write mutations","readwrite",(k=>{let B=At(),q=de();return m.Ns.getEntries(k,f).next((S=>{B=S,B.forEach(((N,L)=>{L.isValidDocument()||(q=q.add(N))}))})).next((()=>m.localDocuments.getOverlayedDocuments(k,B))).next((S=>{_=S;const N=[];for(const L of d){const U=ug(L,_.get(L.key).overlayedDocument);U!=null&&N.push(new fr(L.key,U,gc(U.value.mapValue),Tt.exists(!0)))}return m.mutationQueue.addMutationBatch(k,g,N,d)})).next((S=>{w=S;const N=S.applyToLocalDocumentSet(_,q);return m.documentOverlayCache.saveOverlays(k,S.batchId,N)}))})).then((()=>({batchId:w.batchId,changes:Cc(_)})))})(n.localStore,e);n.sharedClientState.addPendingMutation(i.batchId),(function(l,d,m){let g=l.Vu[l.currentUser.toKey()];g||(g=new Ie(ue)),g=g.insert(d,m),l.Vu[l.currentUser.toKey()]=g})(n,i.batchId,t),await zn(n,i.changes),await Ki(n.remoteStore)}catch(i){const a=po(i,"Failed to persist write");t.reject(a)}}async function au(r,e){const t=ae(r);try{const n=await lp(t.localStore,e);e.targetChanges.forEach(((i,a)=>{const l=t.Au.get(a);l&&(ye(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?l.hu=!0:i.modifiedDocuments.size>0?ye(l.hu,14607):i.removedDocuments.size>0&&(ye(l.hu,42227),l.hu=!1))})),await zn(t,n,e)}catch(n){await $r(n)}}function vl(r,e,t){const n=ae(r);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){const i=[];n.Tu.forEach(((a,l)=>{const d=l.view.va(e);d.snapshot&&i.push(d.snapshot)})),(function(l,d){const m=ae(l);m.onlineState=d;let g=!1;m.queries.forEach(((f,_)=>{for(const w of _.Sa)w.va(d)&&(g=!0)})),g&&fo(m)})(n.eventManager,e),i.length&&n.Pu.H_(i),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}async function Zp(r,e,t){const n=ae(r);n.sharedClientState.updateQueryState(e,"rejected",t);const i=n.Au.get(e),a=i&&i.key;if(a){let l=new Ie(ee.comparator);l=l.insert(a,We.newNoDocument(a,se.min()));const d=de().add(a),m=new $i(se.min(),new Map,new Ie(ue),l,d);await au(n,m),n.du=n.du.remove(a),n.Au.delete(e),_o(n)}else await Fs(n.localStore,e,!1).then((()=>zs(n,e,t))).catch($r)}async function ef(r,e){const t=ae(r),n=e.batch.batchId;try{const i=await ap(t.localStore,e);cu(t,n,null),lu(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),await zn(t,i)}catch(i){await $r(i)}}async function tf(r,e,t){const n=ae(r);try{const i=await(function(l,d){const m=ae(l);return m.persistence.runTransaction("Reject batch","readwrite-primary",(g=>{let f;return m.mutationQueue.lookupMutationBatch(g,d).next((_=>(ye(_!==null,37113),f=_.keys(),m.mutationQueue.removeMutationBatch(g,_)))).next((()=>m.mutationQueue.performConsistencyCheck(g))).next((()=>m.documentOverlayCache.removeOverlaysForBatchId(g,f,d))).next((()=>m.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(g,f))).next((()=>m.localDocuments.getDocuments(g,f)))}))})(n.localStore,e);cu(n,e,t),lu(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),await zn(n,i)}catch(i){await $r(i)}}function lu(r,e){(r.mu.get(e)||[]).forEach((t=>{t.resolve()})),r.mu.delete(e)}function cu(r,e,t){const n=ae(r);let i=n.Vu[n.currentUser.toKey()];if(i){const a=i.get(e);a&&(t?a.reject(t):a.resolve(),i=i.remove(e)),n.Vu[n.currentUser.toKey()]=i}}function zs(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(const n of r.Iu.get(e))r.Tu.delete(n),t&&r.Pu.yu(n,t);r.Iu.delete(e),r.isPrimaryClient&&r.Ru.jr(e).forEach((n=>{r.Ru.containsKey(n)||uu(r,n)}))}function uu(r,e){r.Eu.delete(e.path.canonicalString());const t=r.du.get(e);t!==null&&(co(r.remoteStore,t),r.du=r.du.remove(e),r.Au.delete(t),_o(r))}function bl(r,e,t){for(const n of t)n instanceof iu?(r.Ru.addReference(n.key,e),rf(r,n)):n instanceof su?(Q(yo,"Document no longer in limbo: "+n.key),r.Ru.removeReference(n.key,e),r.Ru.containsKey(n.key)||uu(r,n.key)):ne(19791,{wu:n})}function rf(r,e){const t=e.key,n=t.path.canonicalString();r.du.get(t)||r.Eu.has(n)||(Q(yo,"New document in limbo: "+t),r.Eu.add(n),_o(r))}function _o(r){for(;r.Eu.size>0&&r.du.size<r.maxConcurrentLimboResolutions;){const e=r.Eu.values().next().value;r.Eu.delete(e);const t=new ee(ve.fromString(e)),n=r.fu.next();r.Au.set(n,new $p(t)),r.du=r.du.insert(t,n),Jc(r.remoteStore,new Bt(ht(xc(t.path)),n,"TargetPurposeLimboResolution",Oi.ce))}}async function zn(r,e,t){const n=ae(r),i=[],a=[],l=[];n.Tu.isEmpty()||(n.Tu.forEach(((d,m)=>{l.push(n.pu(m,e,t).then((g=>{var f;if((g||t)&&n.isPrimaryClient){const _=g?!g.fromCache:(f=t==null?void 0:t.targetChanges.get(m.targetId))==null?void 0:f.current;n.sharedClientState.updateQueryState(m.targetId,_?"current":"not-current")}if(g){i.push(g);const _=ao.As(m.targetId,g);a.push(_)}})))})),await Promise.all(l),n.Pu.H_(i),await(async function(m,g){const f=ae(m);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",(_=>j.forEach(g,(w=>j.forEach(w.Es,(k=>f.persistence.referenceDelegate.addReference(_,w.targetId,k))).next((()=>j.forEach(w.ds,(k=>f.persistence.referenceDelegate.removeReference(_,w.targetId,k)))))))))}catch(_){if(!Wr(_))throw _;Q(lo,"Failed to update sequence numbers: "+_)}for(const _ of g){const w=_.targetId;if(!_.fromCache){const k=f.Ms.get(w),B=k.snapshotVersion,q=k.withLastLimboFreeSnapshotVersion(B);f.Ms=f.Ms.insert(w,q)}}})(n.localStore,a))}async function nf(r,e){const t=ae(r);if(!t.currentUser.isEqual(e)){Q(yo,"User change. New user:",e.toKey());const n=await Kc(t.localStore,e);t.currentUser=e,(function(a,l){a.mu.forEach((d=>{d.forEach((m=>{m.reject(new K(V.CANCELLED,l))}))})),a.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),await zn(t,n.Ls)}}function sf(r,e){const t=ae(r),n=t.Au.get(e);if(n&&n.hu)return de().add(n.key);{let i=de();const a=t.Iu.get(e);if(!a)return i;for(const l of a){const d=t.Tu.get(l);i=i.unionWith(d.view.nu)}return i}}function du(r){const e=ae(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=au.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=sf.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Zp.bind(null,e),e.Pu.H_=Bp.bind(null,e.eventManager),e.Pu.yu=Up.bind(null,e.eventManager),e}function of(r){const e=ae(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=ef.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=tf.bind(null,e),e}class Vi{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Wi(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return op(this.persistence,new np,e.initialUser,this.serializer)}Cu(e){return new Hc(oo.mi,this.serializer)}Du(e){return new mp}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Vi.provider={build:()=>new Vi};class af extends Vi{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){ye(this.persistence.referenceDelegate instanceof Di,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new zg(n,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Ke.withCacheSize(this.cacheSizeBytes):Ke.DEFAULT;return new Hc((n=>Di.mi(n,t)),this.serializer)}}class qs{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>vl(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=nf.bind(null,this.syncEngine),await jp(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new Lp})()}createDatastore(e){const t=Wi(e.databaseInfo.databaseId),n=(function(a){return new _p(a)})(e.databaseInfo);return(function(a,l,d,m){return new wp(a,l,d,m)})(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return(function(n,i,a,l,d){return new Tp(n,i,a,l,d)})(this.localStore,this.datastore,e.asyncQueue,(t=>vl(this.syncEngine,t,0)),(function(){return ml.v()?new ml:new gp})())}createSyncEngine(e,t){return(function(i,a,l,d,m,g,f){const _=new Wp(i,a,l,d,m,g);return f&&(_.gu=!0),_})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await(async function(i){const a=ae(i);Q(mr,"RemoteStore shutting down."),a.Ea.add(5),await Un(a),a.Aa.shutdown(),a.Ra.set("Unknown")})(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}qs.provider={build:()=>new qs};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lf{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Ct("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xt="FirestoreClient";class cf{constructor(e,t,n,i,a){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=$e.UNAUTHENTICATED,this.clientId=Qs.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=a,this.authCredentials.start(n,(async l=>{Q(Xt,"Received user=",l.uid),await this.authCredentialListener(l),this.user=l})),this.appCheckCredentials.start(n,(l=>(Q(Xt,"Received new app check token=",l),this.appCheckCredentialListener(l,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Gt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=po(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function bs(r,e){r.asyncQueue.verifyOperationInProgress(),Q(Xt,"Initializing OfflineComponentProvider");const t=r.configuration;await e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener((async i=>{n.isEqual(i)||(await Kc(e.localStore,i),n=i)})),e.persistence.setDatabaseDeletedListener((()=>r.terminate())),r._offlineComponents=e}async function xl(r,e){r.asyncQueue.verifyOperationInProgress();const t=await uf(r);Q(Xt,"Initializing OnlineComponentProvider"),await e.initialize(t,r.configuration),r.setCredentialChangeListener((n=>pl(e.remoteStore,n))),r.setAppCheckTokenChangeListener(((n,i)=>pl(e.remoteStore,i))),r._onlineComponents=e}async function uf(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){Q(Xt,"Using user provided OfflineComponentProvider");try{await bs(r,r._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(i){return i.name==="FirebaseError"?i.code===V.FAILED_PRECONDITION||i.code===V.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(t))throw t;Lr("Error using user provided cache. Falling back to memory cache: "+t),await bs(r,new Vi)}}else Q(Xt,"Using default OfflineComponentProvider"),await bs(r,new af(void 0));return r._offlineComponents}async function hu(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(Q(Xt,"Using user provided OnlineComponentProvider"),await xl(r,r._uninitializedComponentsProvider._online)):(Q(Xt,"Using default OnlineComponentProvider"),await xl(r,new qs))),r._onlineComponents}function df(r){return hu(r).then((e=>e.syncEngine))}async function hf(r){const e=await hu(r),t=e.eventManager;return t.onListen=Hp.bind(null,e.syncEngine),t.onUnlisten=Yp.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Kp.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Xp.bind(null,e.syncEngine),t}function mf(r,e,t={}){const n=new Gt;return r.asyncQueue.enqueueAndForget((async()=>(function(a,l,d,m,g){const f=new lf({next:w=>{f.Nu(),l.enqueueAndForget((()=>Fp(a,_))),w.fromCache&&m.source==="server"?g.reject(new K(V.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):g.resolve(w)},error:w=>g.reject(w)}),_=new zp(d,f,{includeMetadataChanges:!0,qa:!0});return Op(a,_)})(await hf(r),r.asyncQueue,e,t,n))),n.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mu(r){const e={};return r.timeoutSeconds!==void 0&&(e.timeoutSeconds=r.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wl=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gu="firestore.googleapis.com",Il=!0;class Tl{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new K(V.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=gu,this.ssl=Il}else this.host=e.host,this.ssl=e.ssl??Il;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Wc;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Bg)throw new K(V.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}wm("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=mu(e.experimentalLongPollingOptions??{}),(function(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new K(V.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<5)throw new K(V.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is 5)`);if(n.timeoutSeconds>30)throw new K(V.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(n,i){return n.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Qi{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Tl({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new K(V.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new K(V.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Tl(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(n){if(!n)return new hm;switch(n.type){case"firstParty":return new fm(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new K(V.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const n=wl.get(t);n&&(Q("ComponentProvider","Removing Datastore"),wl.delete(t),n.terminate())})(this),Promise.resolve()}}function gf(r,e,t,n={}){var g;r=Sn(r,Qi);const i=Ws(e),a=r._getSettings(),l={...a,emulatorOptions:r._getEmulatorOptions()},d=`${e}:${t}`;i&&(Fd(`https://${d}`),qd("Firestore",!0)),a.host!==gu&&a.host!==d&&Lr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const m={...a,host:d,ssl:i,emulatorOptions:n};if(!wi(m,l)&&(r._setSettings(m),n.mockUserToken)){let f,_;if(typeof n.mockUserToken=="string")f=n.mockUserToken,_=$e.MOCK_USER;else{f=Bd(n.mockUserToken,(g=r._app)==null?void 0:g.options.projectId);const w=n.mockUserToken.sub||n.mockUserToken.user_id;if(!w)throw new K(V.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");_=new $e(w)}r._authCredentials=new mm(new rc(f,_))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zt{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Zt(this.firestore,e,this._query)}}class Ve{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new $t(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ve(this.firestore,e,this._key)}toJSON(){return{type:Ve._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(On(t,Ve._jsonSchema))return new Ve(e,n||null,new ee(ve.fromString(t.referencePath)))}}Ve._jsonSchemaVersion="firestore/documentReference/1.0",Ve._jsonSchema={type:ke("string",Ve._jsonSchemaVersion),referencePath:ke("string")};class $t extends Zt{constructor(e,t,n){super(e,t,xc(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ve(this.firestore,null,new ee(e))}withConverter(e){return new $t(this.firestore,e,this._path)}}function pu(r,e,...t){if(r=Mr(r),nc("collection","path",e),r instanceof Qi){const n=ve.fromString(e,...t);return La(n),new $t(r,null,n)}{if(!(r instanceof Ve||r instanceof $t))throw new K(V.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(ve.fromString(e,...t));return La(n),new $t(r.firestore,null,n)}}function El(r,e,...t){if(r=Mr(r),arguments.length===1&&(e=Qs.newId()),nc("doc","path",e),r instanceof Qi){const n=ve.fromString(e,...t);return Ma(n),new Ve(r,null,new ee(n))}{if(!(r instanceof Ve||r instanceof $t))throw new K(V.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(ve.fromString(e,...t));return Ma(n),new Ve(r.firestore,r instanceof $t?r.converter:null,new ee(n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cl="AsyncQueue";class Al{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Yc(this,"async_queue_retry"),this._c=()=>{const n=vs();n&&Q(Cl,"Visibility state changed to "+n.visibilityState),this.M_.w_()},this.ac=e;const t=vs();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=vs();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new Gt;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Wr(e))throw e;Q(Cl,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((n=>{throw this.nc=n,this.rc=!1,Ct("INTERNAL UNHANDLED ERROR: ",Rl(n)),n})).then((n=>(this.rc=!1,n))))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const i=go.createAndSchedule(this,e,t,n,(a=>this.hc(a)));return this.tc.push(i),i}uc(){this.nc&&ne(47125,{Pc:Rl(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,n)=>t.targetTimeMs-n.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Rl(r){let e=r.message||"";return r.stack&&(e=r.stack.includes(r.message)?r.stack:r.message+`
`+r.stack),e}class vo extends Qi{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new Al,this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Al(e),this._firestoreClient=void 0,await e}}}function pf(r,e){const t=typeof r=="object"?r:Zh(),n=typeof r=="string"?r:Ci,i=Kh(t,"firestore").getImmediate({identifier:n});if(!i._initialized){const a=Ld("firestore");a&&gf(i,...a)}return i}function fu(r){if(r._terminated)throw new K(V.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||ff(r),r._firestoreClient}function ff(r){var n,i,a;const e=r._freezeSettings(),t=(function(d,m,g,f){return new Vm(d,m,g,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,mu(f.experimentalLongPollingOptions),f.useFetchStreams,f.isUsingEmulator)})(r._databaseId,((n=r._app)==null?void 0:n.options.appId)||"",r._persistenceKey,e);r._componentsProvider||(i=e.localCache)!=null&&i._offlineComponentProvider&&((a=e.localCache)!=null&&a._onlineComponentProvider)&&(r._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),r._firestoreClient=new cf(r._authCredentials,r._appCheckCredentials,r._queue,t,r._componentsProvider&&(function(d){const m=d==null?void 0:d._online.build();return{_offline:d==null?void 0:d._offline.build(m),_online:m}})(r._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tt{constructor(e){this._byteString=e}static fromBase64String(e){try{return new tt(qe.fromBase64String(e))}catch(t){throw new K(V.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new tt(qe.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:tt._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(On(e,tt._jsonSchema))return tt.fromBase64String(e.bytes)}}tt._jsonSchemaVersion="firestore/bytes/1.0",tt._jsonSchema={type:ke("string",tt._jsonSchemaVersion),bytes:ke("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bo{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new K(V.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ze(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xo{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gt{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new K(V.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new K(V.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return ue(this._lat,e._lat)||ue(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:gt._jsonSchemaVersion}}static fromJSON(e){if(On(e,gt._jsonSchema))return new gt(e.latitude,e.longitude)}}gt._jsonSchemaVersion="firestore/geoPoint/1.0",gt._jsonSchema={type:ke("string",gt._jsonSchemaVersion),latitude:ke("number"),longitude:ke("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pt{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(n,i){if(n.length!==i.length)return!1;for(let a=0;a<n.length;++a)if(n[a]!==i[a])return!1;return!0})(this._values,e._values)}toJSON(){return{type:pt._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(On(e,pt._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new pt(e.vectorValues);throw new K(V.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}pt._jsonSchemaVersion="firestore/vectorValue/1.0",pt._jsonSchema={type:ke("string",pt._jsonSchemaVersion),vectorValues:ke("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yf=/^__.*__$/;class _f{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new fr(e,this.data,this.fieldMask,t,this.fieldTransforms):new Fn(e,this.data,t,this.fieldTransforms)}}function yu(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ne(40011,{Ac:r})}}class wo{constructor(e,t,n,i,a,l){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,a===void 0&&this.Rc(),this.fieldTransforms=a||[],this.fieldMask=l||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new wo({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var i;const t=(i=this.path)==null?void 0:i.child(e),n=this.Vc({path:t,fc:!1});return n.gc(e),n}yc(e){var i;const t=(i=this.path)==null?void 0:i.child(e),n=this.Vc({path:t,fc:!1});return n.Rc(),n}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return ji(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(yu(this.Ac)&&yf.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class vf{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Wi(e)}Cc(e,t,n,i=!1){return new wo({Ac:e,methodName:t,Dc:n,path:ze.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function _u(r){const e=r._freezeSettings(),t=Wi(r._databaseId);return new vf(r._databaseId,!!e.ignoreUndefinedProperties,t)}function bf(r,e,t,n,i,a={}){const l=r.Cc(a.merge||a.mergeFields?2:0,e,t,i);xu("Data must be an object, but it was:",l,n);const d=vu(n,l);let m,g;if(a.merge)m=new nt(l.fieldMask),g=l.fieldTransforms;else if(a.mergeFields){const f=[];for(const _ of a.mergeFields){const w=wf(e,_,t);if(!l.contains(w))throw new K(V.INVALID_ARGUMENT,`Field '${w}' is specified in your field mask but missing from your input data.`);Tf(f,w)||f.push(w)}m=new nt(f),g=l.fieldTransforms.filter((_=>m.covers(_.field)))}else m=null,g=l.fieldTransforms;return new _f(new et(d),m,g)}class Io extends xo{_toFieldTransform(e){return new og(e.path,new jn)}isEqual(e){return e instanceof Io}}function xf(r,e,t,n=!1){return To(t,r.Cc(n?4:3,e))}function To(r,e){if(bu(r=Mr(r)))return xu("Unsupported field value:",e,r),vu(r,e);if(r instanceof xo)return(function(n,i){if(!yu(i.Ac))throw i.Sc(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Sc(`${n._methodName}() is not currently supported inside arrays`);const a=n._toFieldTransform(i);a&&i.fieldTransforms.push(a)})(r,e),null;if(r===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(n,i){const a=[];let l=0;for(const d of n){let m=To(d,i.wc(l));m==null&&(m={nullValue:"NULL_VALUE"}),a.push(m),l++}return{arrayValue:{values:a}}})(r,e)}return(function(n,i){if((n=Mr(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return ng(i.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const a=we.fromDate(n);return{timestampValue:ki(i.serializer,a)}}if(n instanceof we){const a=new we(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:ki(i.serializer,a)}}if(n instanceof gt)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof tt)return{bytesValue:Fc(i.serializer,n._byteString)};if(n instanceof Ve){const a=i.databaseId,l=n.firestore._databaseId;if(!l.isEqual(a))throw i.Sc(`Document reference is for database ${l.projectId}/${l.database} but should be for database ${a.projectId}/${a.database}`);return{referenceValue:io(n.firestore._databaseId||i.databaseId,n._key.path)}}if(n instanceof pt)return(function(l,d){return{mapValue:{fields:{[hc]:{stringValue:mc},[Ai]:{arrayValue:{values:l.toArray().map((g=>{if(typeof g!="number")throw d.Sc("VectorValues must only contain numeric values.");return to(d.serializer,g)}))}}}}}})(n,i);throw i.Sc(`Unsupported field value: ${Li(n)}`)})(r,e)}function vu(r,e){const t={};return oc(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):gr(r,((n,i)=>{const a=To(i,e.mc(n));a!=null&&(t[n]=a)})),{mapValue:{fields:t}}}function bu(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof we||r instanceof gt||r instanceof tt||r instanceof Ve||r instanceof xo||r instanceof pt)}function xu(r,e,t){if(!bu(t)||!ic(t)){const n=Li(t);throw n==="an object"?e.Sc(r+" a custom object"):e.Sc(r+" "+n)}}function wf(r,e,t){if((e=Mr(e))instanceof bo)return e._internalPath;if(typeof e=="string")return wu(r,e);throw ji("Field path arguments must be of type string or ",r,!1,void 0,t)}const If=new RegExp("[~\\*/\\[\\]]");function wu(r,e,t){if(e.search(If)>=0)throw ji(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new bo(...e.split("."))._internalPath}catch{throw ji(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function ji(r,e,t,n,i){const a=n&&!n.isEmpty(),l=i!==void 0;let d=`Function ${e}() called with invalid data`;t&&(d+=" (via `toFirestore()`)"),d+=". ";let m="";return(a||l)&&(m+=" (found",a&&(m+=` in field ${n}`),l&&(m+=` in document ${i}`),m+=")"),new K(V.INVALID_ARGUMENT,d+r+m)}function Tf(r,e){return r.some((t=>t.isEqual(e)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iu{constructor(e,t,n,i,a){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=a}get id(){return this._key.path.lastSegment()}get ref(){return new Ve(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Ef(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Eo("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class Ef extends Iu{data(){return super.data()}}function Eo(r,e){return typeof e=="string"?wu(r,e):e instanceof bo?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cf(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new K(V.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Co{}class Ao extends Co{}function Tu(r,e,...t){let n=[];e instanceof Co&&n.push(e),n=n.concat(t),(function(a){const l=a.filter((m=>m instanceof So)).length,d=a.filter((m=>m instanceof Ro)).length;if(l>1||l>0&&d>0)throw new K(V.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(n);for(const i of n)r=i._apply(r);return r}class Ro extends Ao{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Ro(e,t,n)}_apply(e){const t=this._parse(e);return Au(e._query,t),new Zt(e.firestore,e.converter,Vs(e._query,t))}_parse(e){const t=_u(e.firestore);return(function(a,l,d,m,g,f,_){let w;if(g.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new K(V.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){Pl(_,f);const B=[];for(const q of _)B.push(Sl(m,a,q));w={arrayValue:{values:B}}}else w=Sl(m,a,_)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||Pl(_,f),w=xf(d,l,_,f==="in"||f==="not-in");return Pe.create(g,f,w)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}class So extends Co{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new So(e,t)}_parse(e){const t=this._queryConstraints.map((n=>n._parse(e))).filter((n=>n.getFilters().length>0));return t.length===1?t[0]:it.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(i,a){let l=i;const d=a.getFlattenedFilters();for(const m of d)Au(l,m),l=Vs(l,m)})(e._query,t),new Zt(e.firestore,e.converter,Vs(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Po extends Ao{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Po(e,t)}_apply(e){const t=(function(i,a,l){if(i.startAt!==null)throw new K(V.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new K(V.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Vn(a,l)})(e._query,this._field,this._direction);return new Zt(e.firestore,e.converter,(function(i,a){const l=i.explicitOrderBy.concat([a]);return new Hr(i.path,i.collectionGroup,l,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)})(e._query,t))}}function Eu(r,e="asc"){const t=e,n=Eo("orderBy",r);return Po._create(n,t)}class ko extends Ao{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new ko(e,t,n)}_apply(e){return new Zt(e.firestore,e.converter,Si(e._query,this._limit,this._limitType))}}function Cu(r){return Im("limit",r),ko._create("limit",r,"F")}function Sl(r,e,t){if(typeof(t=Mr(t))=="string"){if(t==="")throw new K(V.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!wc(e)&&t.indexOf("/")!==-1)throw new K(V.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(ve.fromString(t));if(!ee.isDocumentKey(n))throw new K(V.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return $a(r,new ee(n))}if(t instanceof Ve)return $a(r,t._key);throw new K(V.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Li(t)}.`)}function Pl(r,e){if(!Array.isArray(r)||r.length===0)throw new K(V.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Au(r,e){const t=(function(i,a){for(const l of i)for(const d of l.getFlattenedFilters())if(a.indexOf(d.op)>=0)return d.op;return null})(r.filters,(function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new K(V.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new K(V.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class Af{convertValue(e,t="none"){switch(Qt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ce(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Kt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw ne(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return gr(e,((i,a)=>{n[i]=this.convertValue(a,t)})),n}convertVectorValue(e){var n,i,a;const t=(a=(i=(n=e.fields)==null?void 0:n[Ai].arrayValue)==null?void 0:i.values)==null?void 0:a.map((l=>Ce(l.doubleValue)));return new pt(t)}convertGeoPoint(e){return new gt(Ce(e.latitude),Ce(e.longitude))}convertArray(e,t){return(e.values||[]).map((n=>this.convertValue(n,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Bi(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(kn(e));default:return null}}convertTimestamp(e){const t=Ht(e);return new we(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=ve.fromString(e);ye($c(n),9688,{name:e});const i=new Dn(n.get(1),n.get(3)),a=new ee(n.popFirst(5));return i.isEqual(t)||Ct(`Document ${a} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),a}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rf(r,e,t){let n;return n=r?r.toFirestore(e):e,n}class ci{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Vr extends Iu{constructor(e,t,n,i,a,l){super(e,t,n,i,l),this._firestore=e,this._firestoreImpl=e,this.metadata=a}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new pi(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(Eo("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new K(V.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Vr._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}Vr._jsonSchemaVersion="firestore/documentSnapshot/1.0",Vr._jsonSchema={type:ke("string",Vr._jsonSchemaVersion),bundleSource:ke("string","DocumentSnapshot"),bundleName:ke("string"),bundle:ke("string")};class pi extends Vr{data(e={}){return super.data(e)}}class jr{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new ci(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new pi(this._firestore,this._userDataWriter,n.key,n,new ci(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new K(V.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(i,a){if(i._snapshot.oldDocs.isEmpty()){let l=0;return i._snapshot.docChanges.map((d=>{const m=new pi(i._firestore,i._userDataWriter,d.doc.key,d.doc,new ci(i._snapshot.mutatedKeys.has(d.doc.key),i._snapshot.fromCache),i.query.converter);return d.doc,{type:"added",doc:m,oldIndex:-1,newIndex:l++}}))}{let l=i._snapshot.oldDocs;return i._snapshot.docChanges.filter((d=>a||d.type!==3)).map((d=>{const m=new pi(i._firestore,i._userDataWriter,d.doc.key,d.doc,new ci(i._snapshot.mutatedKeys.has(d.doc.key),i._snapshot.fromCache),i.query.converter);let g=-1,f=-1;return d.type!==0&&(g=l.indexOf(d.doc.key),l=l.delete(d.doc.key)),d.type!==1&&(l=l.add(d.doc),f=l.indexOf(d.doc.key)),{type:Sf(d.type),doc:m,oldIndex:g,newIndex:f}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new K(V.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=jr._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Qs.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],n=[],i=[];return this.docs.forEach((a=>{a._document!==null&&(t.push(a._document),n.push(this._userDataWriter.convertObjectMap(a._document.data.value.mapValue.fields,"previous")),i.push(a.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function Sf(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ne(61501,{type:r})}}jr._jsonSchemaVersion="firestore/querySnapshot/1.0",jr._jsonSchema={type:ke("string",jr._jsonSchemaVersion),bundleSource:ke("string","QuerySnapshot"),bundleName:ke("string"),bundle:ke("string")};class Pf extends Af{constructor(e){super(),this.firestore=e}convertBytes(e){return new tt(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ve(this.firestore,null,t)}}function Ru(r){r=Sn(r,Zt);const e=Sn(r.firestore,vo),t=fu(e),n=new Pf(e);return Cf(r._query),mf(t,r._query).then((i=>new jr(e,n,r,i)))}function kl(r,e,t){r=Sn(r,Ve);const n=Sn(r.firestore,vo),i=Rf(r.converter,e);return kf(n,[bf(_u(n),"setDoc",r._key,i,r.converter!==null,t).toMutation(r._key,Tt.none())])}function kf(r,e){return(function(n,i){const a=new Gt;return n.asyncQueue.enqueueAndForget((async()=>Jp(await df(n),i,a))),a.promise})(fu(r),e)}function Dl(){return new Io("serverTimestamp")}(function(e,t=!0){(function(i){Gr=i})(Jh),Ti(new An("firestore",((n,{instanceIdentifier:i,options:a})=>{const l=n.getProvider("app").getImmediate(),d=new vo(new gm(n.getProvider("auth-internal")),new ym(l,n.getProvider("app-check-internal")),(function(g,f){if(!Object.prototype.hasOwnProperty.apply(g.options,["projectId"]))throw new K(V.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Dn(g.options.projectId,f)})(l,i),l);return a={useFetchStreams:t,...a},d._setSettings(a),d}),"PUBLIC").setMultipleInstances(!0)),Dr(Da,Na,e),Dr(Da,Na,"esm2020")})();const Df={apiKey:"AIzaSyA1Dw5M2Zk8bpTCjlU2Tuifvx0ZI3IeRv0",authDomain:"kingdomclicker-156dc.firebaseapp.com",projectId:"kingdomclicker-156dc",storageBucket:"kingdomclicker-156dc.firebasestorage.app",messagingSenderId:"496461589742",appId:"1:496461589742:web:e6413dfa2d1bbabd3ad7ff"},Nf=Wl(Df),Mi=pf(Nf);function Vf(){return`#${Math.floor(Math.random()*99999).toString().padStart(5,"0")}`}function jf(){const r=new Date,e=r.getDay(),t=r.getDate()-e+(e===0?-6:1);return new Date(r.setDate(t))}async function Mf(r){try{console.log("üöÄ –ù–∞—á–∏–Ω–∞—é –æ—Ç–ø—Ä–∞–≤–∫—É –¥–∞–Ω–Ω—ã—Ö –≤ –ª–∏–¥–µ—Ä–±–æ—Ä–¥:",{rulerName:r.rulerName,rulerId:r.rulerId,gold:r.gold.toString(),renown:r.renown.toString(),buildings:r.buildings,achievements:r.achievements});const e={...r,period:"alltime"},t={...r,period:"weekly"};console.log("üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ leaderboard_alltime...");const n=El(Mi,"leaderboard_alltime",r.rulerId);await kl(n,{...e,gold:Number(e.gold.toString()),renown:Number(e.renown.toString()),timestamp:Dl()}),console.log("‚úÖ –£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ leaderboard_alltime, ID:",r.rulerId),console.log("üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ leaderboard_weekly...");const i=El(Mi,"leaderboard_weekly",r.rulerId);return await kl(i,{...t,gold:Number(t.gold.toString()),renown:Number(t.renown.toString()),timestamp:Dl()}),console.log("‚úÖ –£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ leaderboard_weekly, ID:",r.rulerId),console.log("üéâ –î–∞–Ω–Ω—ã–µ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!"),{allTimeId:r.rulerId,weeklyId:r.rulerId}}catch(e){throw console.error("‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –ª–∏–¥–µ—Ä–±–æ—Ä–¥:"),console.error("–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:",e),e instanceof Error&&(console.error("–°–æ–æ–±—â–µ–Ω–∏–µ –æ—à–∏–±–∫–∏:",e.message),console.error("–°—Ç–µ–∫ –æ—à–∏–±–∫–∏:",e.stack)),"code"in e&&(console.error("–ö–æ–¥ –æ—à–∏–±–∫–∏ Firebase:",e.code),console.error("–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:",e.customData)),e}}async function Lf(r=100){try{console.log("üîç –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö all-time –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞...");const e=Tu(pu(Mi,"leaderboard_alltime"),Eu("gold","desc"),Cu(r));console.log("üì° –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –∫ Firestore...");const t=await Ru(e);console.log("üìä –ü–æ–ª—É—á–µ–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:",t.docs.length);const n=t.docs.map(i=>{const a=i.data();return{id:i.id,...a,gold:a.gold instanceof Je?a.gold:new Je(a.gold),renown:a.renown instanceof Je?a.renown:new Je(a.renown),timestamp:a.timestamp}});return console.log("‚úÖ All-time –ª–∏–¥–µ—Ä–±–æ—Ä–¥ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω, –∑–∞–ø–∏—Å–µ–π:",n.length),n}catch(e){throw console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ all-time –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞:"),console.error("–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:",e),e instanceof Error&&(console.error("–°–æ–æ–±—â–µ–Ω–∏–µ –æ—à–∏–±–∫–∏:",e.message),console.error("–°—Ç–µ–∫ –æ—à–∏–±–∫–∏:",e.stack)),"code"in e&&console.error("–ö–æ–¥ –æ—à–∏–±–∫–∏ Firebase:",e.code),e}}async function Of(r=100){try{console.log("üîç –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö weekly –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞...");const e=jf();console.log("üìÖ –ù–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏:",e.toISOString());const t=Tu(pu(Mi,"leaderboard_weekly"),Eu("gold","desc"),Cu(r));console.log("üì° –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –∫ Firestore...");const n=await Ru(t);console.log("üìä –ü–æ–ª—É—á–µ–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–æ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:",n.docs.length);const a=n.docs.map(l=>{const d=l.data();return{id:l.id,...d,gold:d.gold instanceof Je?d.gold:new Je(d.gold),renown:d.renown instanceof Je?d.renown:new Je(d.renown),timestamp:d.timestamp}}).filter(l=>{var g,f;const d=((f=(g=l.timestamp)==null?void 0:g.toDate)==null?void 0:f.call(g))||new Date(l.timestamp),m=d>=e;return m||console.log("üóëÔ∏è –ó–∞–ø–∏—Å—å –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–∞ (—Å—Ç–∞—Ä–∞—è –¥–∞—Ç–∞):",d.toISOString()),m});return console.log("‚úÖ Weekly –ª–∏–¥–µ—Ä–±–æ—Ä–¥ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω, –∑–∞–ø–∏—Å–µ–π –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:",a.length),a}catch(e){throw console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ weekly –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞:"),console.error("–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:",e),e instanceof Error&&(console.error("–°–æ–æ–±—â–µ–Ω–∏–µ –æ—à–∏–±–∫–∏:",e.message),console.error("–°—Ç–µ–∫ –æ—à–∏–±–∫–∏:",e.stack)),"code"in e&&console.error("–ö–æ–¥ –æ—à–∏–±–∫–∏ Firebase:",e.code),e}}const Ff=({isOpen:r,onClose:e,onConfirm:t,gameState:n})=>{const[i,a]=W.useState(""),[l,d]=W.useState(!1);if(!r)return null;const m=async()=>{if(i.trim().length<3){alert("Ruler name must contain at least 3 characters!");return}if(i.trim().length>20){alert("Ruler name must not exceed 20 characters!");return}d(!0);try{const f={id:`player_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,rulerName:i.trim(),rulerId:Vf(),lastLeaderboardView:0,lastLeaderboardSubmit:0,hasChosenName:!0};t(f),e()}catch{alert("An error occurred while creating profile. Please try again.")}finally{d(!1)}};return c.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:c.jsxs("div",{style:{backgroundColor:"#fdf6e3",border:"4px solid #8d6e63",borderRadius:"8px",padding:"32px",maxWidth:"500px",width:"90%",textAlign:"center",fontFamily:"Georgia, serif"},children:[c.jsx("h2",{style:{color:"#3e2723",marginBottom:"16px"},children:"üëë Royal Coronation! üëë"}),c.jsxs("p",{style:{color:"#5d4037",marginBottom:"24px",lineHeight:"1.5"},children:["Congratulations! Your kingdom has reached ",c.jsx("strong",{children:Bf(n.gold)})," gold!",c.jsx("br",{}),"It's time to choose a name for your ruler and enter the history books!"]}),c.jsxs("div",{style:{marginBottom:"24px"},children:[c.jsx("label",{style:{display:"block",color:"#3e2723",marginBottom:"8px",fontWeight:"bold"},children:"Ruler Name:"}),c.jsx("input",{type:"text",value:i,onChange:g=>a(g.target.value),placeholder:"Enter your name...",maxLength:20,style:{width:"100%",padding:"12px",border:"2px solid #a1887f",borderRadius:"4px",fontSize:"16px",fontFamily:"Arial, sans-serif",backgroundColor:"#fff",color:"#3e2723"},onKeyPress:g=>g.key==="Enter"&&m()}),c.jsxs("div",{style:{fontSize:"12px",color:"#8d6e63",marginTop:"4px",textAlign:"left"},children:[i.length,"/20 characters"]})]}),c.jsx("div",{style:{backgroundColor:"#fff3e0",border:"2px solid #bf9000",borderRadius:"4px",padding:"12px",marginBottom:"24px"},children:c.jsx("p",{style:{color:"#bf9000",margin:0,fontSize:"14px",fontWeight:"bold"},children:"‚ö†Ô∏è Important: You'll be able to join the leaderboard and compete with players from around the world!"})}),c.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[c.jsx("button",{type:"button",onClick:m,disabled:l||i.trim().length<3,style:{padding:"12px 24px",backgroundColor:l||i.trim().length<3?"#cccccc":"#2e7d32",color:"white",border:"none",borderRadius:"4px",fontSize:"16px",fontWeight:"bold",cursor:l||i.trim().length<3?"not-allowed":"pointer",fontFamily:"Georgia, serif"},children:l?"Creating profile...":"Ascend the Throne"}),c.jsx("button",{type:"button",onClick:e,style:{padding:"12px 24px",backgroundColor:"#c62828",color:"white",border:"none",borderRadius:"4px",fontSize:"16px",cursor:"pointer",fontFamily:"Georgia, serif",transition:"background-color 0.2s"},onMouseOver:g=>{g.currentTarget.style.backgroundColor="#d32f2f"},onMouseOut:g=>{g.currentTarget.style.backgroundColor="#c62828"},children:"Later"})]})]})})};function Bf(r){return r.lt(1e3)?r.toFixed(0):r.lt(1e6)?r.toNumber().toLocaleString():r.toExponential(2)}const Uf=({isOpen:r,onClose:e,playerProfile:t,onOpenRulerNameModal:n,gameState:i})=>{const[a,l]=W.useState([]),[d,m]=W.useState([]),[g,f]=W.useState("alltime"),[_,w]=W.useState(!1),[k,B]=W.useState(null),[q,S]=W.useState(0),[N,L]=W.useState(0),U=()=>{const E=localStorage.getItem("leaderboardCache");if(E)try{const{data:y,timestamp:te}=JSON.parse(E),he=Date.now(),be=3600*1e3;if(he-te<be&&y&&y.allTime&&y.weekly)return y}catch(y){console.error("Cache parse error:",y)}return null},G=E=>{const y={data:E,timestamp:Date.now()};localStorage.setItem("leaderboardCache",JSON.stringify(y)),L(Date.now())},Z=()=>{const E=localStorage.getItem("leaderboardCache");if(E){const{timestamp:y}=JSON.parse(E),te=Date.now(),he=3600*1e3;return te-y<he}return!1};W.useEffect(()=>{if(r){if(Z())try{const E=U();if(E){l(E.allTime),m(E.weekly);const y=JSON.parse(localStorage.getItem("leaderboardCache"));L(y.timestamp);return}}catch(E){console.error("Cache read error:",E)}J()}},[r]);const J=async()=>{w(!0),B(null);try{const E=new Promise((he,be)=>setTimeout(()=>be(new Error("Loading timeout")),1e4)),[y,te]=await Promise.all([Promise.race([Lf(50),E]),Promise.race([Of(50),E])]);l(y),m(te),G({allTime:y,weekly:te}),console.log("Leaderboard data loaded successfully!")}catch(E){console.error("Error loading leaderboard:",E),B("Failed to load leaderboard. Please check your internet connection and try again.")}finally{w(!1)}},I=E=>{switch(E){case 1:return"ü•á";case 2:return"ü•à";case 3:return"ü•â";default:return`#${E}`}},v=()=>t?(g==="alltime"?a:d).findIndex(y=>y.rulerId===t.rulerId)+1:-1,x=()=>{const E=g==="alltime"?a:d;if(E.length>0){let y=0;if(E.forEach(te=>{if(te.timestamp){let he=0;typeof te.timestamp=="object"&&te.timestamp.toDate?he=te.timestamp.toDate().getTime():typeof te.timestamp=="number"?he=te.timestamp:typeof te.timestamp=="string"&&(he=new Date(te.timestamp).getTime()),he>y&&(y=he)}}),y>0)return y}return N},T=g==="alltime"?a:d,b=T.length>0;return r?c.jsx("div",{className:"modal-overlay",children:c.jsxs("div",{className:"modal-content",style:{maxWidth:"800px"},children:[c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[c.jsx("h2",{children:"üèÜ Leaderboard üèÜ"}),c.jsx("button",{className:"btn",onClick:e,children:"Close"})]}),!t&&c.jsxs("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"15px",marginBottom:"16px",textAlign:"center"},children:[c.jsx("h4",{style:{color:"var(--gold-color)",margin:"0 0 8px 0",fontSize:"14px"},children:"üëÅ View Only Mode"}),c.jsxs("p",{style:{color:"var(--text-secondary)",margin:"0",fontSize:"12px",lineHeight:"1.4"},children:[c.jsx("strong",{children:"Anyone can view leaderboard!"})," Choose a name at 10M gold to participate."]}),n&&i&&i.gold&&i.gold.gte(1e7)&&c.jsx("button",{className:"btn",onClick:()=>{e(),n()},style:{backgroundColor:"var(--accent-color)",padding:"6px 12px",fontSize:"12px",marginTop:"8px"},children:"üëë Choose Ruler Name"})]}),b&&c.jsx("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"12px",marginBottom:"16px",textAlign:"center",fontSize:"12px"},children:c.jsxs("span",{style:{color:"var(--gold-color)"},children:["üìä Data updated ",Math.floor((Date.now()-x())/6e4)," minutes ago"]})}),_&&c.jsx("div",{style:{textAlign:"center",padding:"20px",color:"var(--text-secondary)"},children:"Loading leaderboard data..."}),k&&c.jsx("div",{style:{textAlign:"center",padding:"20px",color:"var(--danger-color)"},children:k}),t&&b&&c.jsxs("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"12px",marginBottom:"16px",textAlign:"center"},children:[c.jsxs("div",{style:{color:"var(--gold-color)",fontSize:"14px",fontWeight:"bold"},children:["üëë You are playing as: ",t.rulerName," ",t.rulerId]}),T.length>0&&c.jsxs("div",{style:{color:"var(--text-secondary)",fontSize:"12px",marginTop:"5px"},children:["Your Rank: ",v()>0?`#${v()}`:"Not ranked yet"," in ",g==="alltime"?"All Time":"Weekly"]})]}),b&&c.jsxs("div",{style:{display:"flex",marginBottom:"16px",borderBottom:"2px solid var(--border-color)"},children:[c.jsx("button",{onClick:()=>f("alltime"),className:g==="alltime"?"tab-btn active":"tab-btn",children:"All Time"}),c.jsx("button",{onClick:()=>f("weekly"),className:g==="weekly"?"tab-btn active":"tab-btn",children:"This Week"})]}),b&&!_&&!k&&c.jsx("div",{style:{maxHeight:"400px",overflowY:"auto",border:"2px solid var(--border-color)",borderRadius:"4px",backgroundColor:"var(--panel-bg)"},children:c.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[c.jsx("thead",{style:{backgroundColor:"var(--accent-color)",color:"white",position:"sticky",top:0},children:c.jsxs("tr",{children:[c.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Rank"}),c.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Ruler"}),c.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Gold"}),c.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Renown"}),c.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Buildings"})]})}),c.jsx("tbody",{children:T.map((E,y)=>c.jsxs("tr",{style:{backgroundColor:(t==null?void 0:t.rulerId)===E.rulerId?"rgba(191, 144, 0, 0.1)":y%2===0?"rgba(0, 0, 0, 0.02)":"transparent",borderBottom:"1px solid var(--border-color)"},children:[c.jsx("td",{style:{padding:"10px",fontWeight:"bold",color:"var(--text-color)"},children:I(y+1)}),c.jsx("td",{style:{padding:"10px",color:"var(--text-color)"},children:c.jsxs("div",{children:[c.jsx("strong",{children:E.rulerName}),c.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:E.rulerId})]})}),c.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--gold-color)",fontWeight:"bold"},children:F(E.gold,"standard")}),c.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--text-secondary)"},children:F(E.renown,"standard")}),c.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--text-secondary)"},children:E.buildings})]},E.id))})]})}),c.jsx("div",{style:{marginTop:"16px",fontSize:"12px",color:"var(--text-secondary)",textAlign:"center"},children:"üí° Leaderboard updates automatically every hour. Data is cached for performance."})]})}):null},Ot={density:"normal",fontSize:"medium",showFloatingText:!0,showWeatherWidget:!0,reduceMotion:!1,lastBuyAmount:s(1),layout:{left:s(1),center:s(1),right:s(1)},borderWidth:s(4),customColors:{enabled:!1,bg:"#e8dcc5",panel:"#fdf6e3",text:"#3e2723",secondaryText:"#5d4037",accent:"#8d6e63",accentHover:"#6d4c41",gold:"#bf9000",border:"#a1887f",success:"#2e7d32",danger:"#c62828"}},lr={gold:s(0),totalGold:s(0),startTime:s(Date.now()),lastSaveTime:s(Date.now()),buildings:{},upgrades:[],achievements:[],renown:s(0),prestigeCount:0,soldiers:s(0),eliteUnits:{},artifacts:[],advisors:[],advisorLevels:{},intermediateGoods:{},wonders:{},activeTradeRoutes:[],weather:{current:"clear",timeLeft:s(120)},activeDecrees:{},decreeCooldowns:{},conquest:{active:!1,crusadeId:null,startTime:s(0),soldiersSent:s(0)},event:null,theme:"royal_dawn",numberFormat:"standard",idleModeEnabled:!0,interface:Ot,stats:{totalClicks:s(0),dragonsKilled:s(0),tavernGamesPlayed:s(0)},playerProfile:null},En=r=>{if(r==null||typeof r=="string"||typeof r=="number"||typeof r=="boolean")return r;if(Array.isArray(r))return r.map(En);if(typeof r=="object"&&r.toString&&typeof r.toString=="function"&&(r.hasOwnProperty("mantissa")||r.hasOwnProperty("exponent")))return r.toString();if(typeof r=="object"){const e={};for(const t in r)r.hasOwnProperty(t)&&(e[t]=En(r[t]));return e}return r},$f=()=>{var xr,at;const[r,e]=W.useState(()=>{var C,D,O,Y,$,z,ie;const A=localStorage.getItem("kingdom_save");if(A)try{const M=JSON.parse(A),le=M.interface||{},Ee={...Ot,...le,lastBuyAmount:s(le.lastBuyAmount??1),layout:{left:s(((C=le.layout)==null?void 0:C.left)??Ot.layout.left),center:s(((D=le.layout)==null?void 0:D.center)??Ot.layout.center),right:s(((O=le.layout)==null?void 0:O.right)??Ot.layout.right)},borderWidth:s(le.borderWidth??Ot.borderWidth),customColors:{...Ot.customColors,...le.customColors||{}}};return{...lr,...M,renown:s(M.renown||0),prestigeCount:M.prestigeCount||0,gold:s(M.gold||0),totalGold:s(M.totalGold||0),startTime:s(M.startTime||Date.now()),lastSaveTime:s(M.lastSaveTime||Date.now()),soldiers:s(M.soldiers||0),buildings:Object.keys(M.buildings||{}).reduce((re,fe)=>(re[fe]=s(M.buildings[fe]),re),{}),stats:{...lr.stats,...M.stats||{},totalClicks:s(((Y=M.stats)==null?void 0:Y.totalClicks)||0),dragonsKilled:s((($=M.stats)==null?void 0:$.dragonsKilled)||0),tavernGamesPlayed:s(((z=M.stats)==null?void 0:z.tavernGamesPlayed)||0)},eliteUnits:Object.keys(M.eliteUnits||{}).reduce((re,fe)=>(re[fe]=s(M.eliteUnits[fe]),re),{}),advisors:M.advisors||[],advisorLevels:Object.keys(M.advisorLevels||{}).reduce((re,fe)=>(re[fe]=s(M.advisorLevels[fe]),re),{}),intermediateGoods:Object.keys(M.intermediateGoods||{}).reduce((re,fe)=>{const rt=M.intermediateGoods[fe];return re[fe]={level:s(rt.level||0),lastClickTime:s(rt.lastClickTime||Date.now())},re},{}),wonders:Object.keys(M.wonders||{}).reduce((re,fe)=>(re[fe]=s(M.wonders[fe]),re),{}),activeTradeRoutes:(M.activeTradeRoutes||[]).map(re=>({id:re.id,routeId:re.routeId,startTime:s(Number(re.startTime)||0),duration:s(Number(re.duration)||0),goldInvested:s(re.goldInvested||0),soldiersSent:s(re.soldiersSent||0),eliteSent:Object.keys(re.eliteSent||{}).reduce((fe,rt)=>(fe[rt]=s(re.eliteSent[rt]||0),fe),{})})),weather:M.weather?{...M.weather,timeLeft:s(Number(M.weather.timeLeft)||120)}:lr.weather,conquest:{...lr.conquest,...M.conquest||{},startTime:s(Number((ie=M.conquest)==null?void 0:ie.startTime)||Date.now())},activeDecrees:Object.keys(M.activeDecrees||{}).reduce((re,fe)=>(re[fe]=s(M.activeDecrees[fe]),re),{}),decreeCooldowns:Object.keys(M.decreeCooldowns||{}).reduce((re,fe)=>(re[fe]=s(M.decreeCooldowns[fe]),re),{}),theme:M.theme||"royal_dawn",numberFormat:M.numberFormat||"standard",idleModeEnabled:M.idleModeEnabled!==void 0?M.idleModeEnabled:!0,interface:Ee,playerProfile:M.playerProfile?{...M.playerProfile,lastLeaderboardSubmit:M.playerProfile.lastLeaderboardSubmit||0}:null}}catch(M){console.error("Save load failed",M)}return lr}),t=W.useRef(r);W.useEffect(()=>{t.current=r},[r]);const[n,i]=W.useState(!1);W.useEffect(()=>{let A;const C=()=>{i(!1),clearTimeout(A),r.idleModeEnabled&&(A=setTimeout(()=>{i(!0)},2e4))};C();const D=["mousemove","mousedown","keydown","touchstart","scroll"];return D.forEach(O=>window.addEventListener(O,C)),()=>{clearTimeout(A),D.forEach(O=>window.removeEventListener(O,C))}},[r.idleModeEnabled]),W.useEffect(()=>{const A=F(r.gold);document.title=`Gold: ${A} - Kingdom Clicker`},[r.gold]),W.useEffect(()=>{var $;const A=document.documentElement,C=r.interface||Ot;if(($=C.customColors)!=null&&$.enabled){const z=C.customColors;A.style.setProperty("--bg-color",z.bg),A.style.setProperty("--panel-bg",z.panel),A.style.setProperty("--text-color",z.text),A.style.setProperty("--text-secondary",z.secondaryText||"#5d4037"),A.style.setProperty("--text-on-accent","#ffffff"),A.style.setProperty("--accent-color",z.accent),A.style.setProperty("--accent-hover",z.accentHover||z.accent),A.style.setProperty("--gold-color",z.gold||"#bf9000"),A.style.setProperty("--border-color",z.border),A.style.setProperty("--success-color",z.success||"#2e7d32"),A.style.setProperty("--danger-color",z.danger||"#c62828"),A.style.setProperty("--bg-image","none")}else{const z=r.theme||"royal_dawn",ie=ws[z]||ws.royal_dawn;Object.entries(ie.colors).forEach(([M,le])=>{A.style.setProperty(M,le)})}const D={small:"14px",medium:"16px",large:"18px"};A.style.setProperty("--base-font-size",D[C.fontSize]);const O={compact:"8px",normal:"12px",spacious:"20px"},Y={compact:"6px",normal:"12px",spacious:"16px"};A.style.setProperty("--panel-padding",O[C.density]),A.style.setProperty("--gap-size",Y[C.density]),A.style.setProperty("--custom-border-width",`${C.borderWidth}px`),A.style.setProperty("--col-left",String(C.layout.left)),A.style.setProperty("--col-center",String(C.layout.center)),A.style.setProperty("--col-right",String(C.layout.right)),C.reduceMotion?document.body.classList.add("no-motion"):document.body.classList.remove("no-motion")},[r.theme,r.interface]);const[a,l]=W.useState(!1);W.useEffect(()=>{var A;r.gold.gte(s(1e7))&&!((A=r.playerProfile)!=null&&A.hasChosenName)&&!a&&yt(!0)},[r.gold,r.playerProfile,a]);const[d,m]=W.useState(null),[g,f]=W.useState([]),[_,w]=W.useState("buildings"),[k,B]=W.useState("army"),[q,S]=W.useState(!1),[N,L]=W.useState("throne");W.useEffect(()=>{const A=()=>{S(window.innerWidth<768)};return A(),window.addEventListener("resize",A),()=>window.removeEventListener("resize",A)},[]);const[U,G]=W.useState(!1),[Z,J]=W.useState(!1),[I,v]=W.useState(!1),[x,T]=W.useState(!1),[b,E]=W.useState(!1),[y,te]=W.useState(!1),[he,be]=W.useState(!1),[Qe,Fe]=W.useState(!1),[Ae,yt]=W.useState(!1),[X,st]=W.useState(!1),oe=(A,C="info")=>{const D=Date.now().toString()+Math.random();f(O=>[...O,{id:D,message:A,type:C}]),setTimeout(()=>{f(O=>O.filter(Y=>Y.id!==D))},3e3)};W.useEffect(()=>{const A=C=>C.preventDefault();return document.addEventListener("contextmenu",A),()=>document.removeEventListener("contextmenu",A)},[]),W.useEffect(()=>{var C;const A=Date.now();if(r.lastSaveTime&&s(A).minus(r.lastSaveTime).gt(s(6e4))){const D=s(A).minus(r.lastSaveTime).dividedBy(s(1e3)),O=_t(r),Y=(((C=r.wonders)==null?void 0:C.void_gate)||s(0)).gte(s(3)),$=s(Y?1:.5),z=O.times(D).times($).floor();z.gt(s(0))&&(oe(`While you were away, you earned ${F(z,r.numberFormat)} gold! ${Y?"(100% Efficiency)":""}`,"success"),e(ie=>({...ie,gold:ie.gold.plus(z),totalGold:ie.totalGold.plus(z)})))}},[]),W.useEffect(()=>{const A=setInterval(()=>{Date.now()%3e4<1e3&&e(C=>{const D={...C,lastSaveTime:s(Date.now())},O=En(D);return localStorage.setItem("kingdom_save",JSON.stringify(O)),D})},1e3);return()=>clearInterval(A)},[]),W.useEffect(()=>{const A=()=>{const D=t.current,O=En(D);localStorage.setItem("kingdom_save",JSON.stringify(O))};window.addEventListener("beforeunload",A);const C=()=>{document.visibilityState==="hidden"&&A()};return document.addEventListener("visibilitychange",C),()=>{window.removeEventListener("beforeunload",A),document.removeEventListener("visibilitychange",C)}},[]),W.useEffect(()=>{var C;if(!((C=r.playerProfile)!=null&&C.hasChosenName))return;const A=setInterval(()=>{const D=Date.now(),O=r.playerProfile.lastLeaderboardSubmit||0,Y=3600*1e3;D-O>=Y&&Mf({rulerName:r.playerProfile.rulerName,rulerId:r.playerProfile.rulerId,gold:r.gold,renown:r.renown,buildings:Object.keys(r.buildings).length,achievements:r.achievements.length,period:"alltime"}).then(()=>{e($=>({...$,playerProfile:{...$.playerProfile,lastLeaderboardSubmit:Date.now()}})),oe("Leaderboard data submitted successfully!","success")}).catch($=>{console.error("Auto leaderboard submission failed:",$)})},6e4);return()=>clearInterval(A)},[(xr=r.playerProfile)==null?void 0:xr.hasChosenName,(at=r.playerProfile)==null?void 0:at.lastLeaderboardSubmit,r.gold,r.renown,r.buildings,r.achievements]),W.useRef(0),W.useEffect(()=>{if(r.advisors.includes("treasurer")){const A=r.advisorLevels.treasurer||s(1),C=Math.max(1,5-A.toNumber()+1),D=setInterval(()=>{_r(!0)},C*1e3);return()=>clearInterval(D)}},[r.advisors,r.advisorLevels]),W.useEffect(()=>{const A=setInterval(()=>{if(!r.event){r.advisors.includes("alchemist");const C=r.advisorLevels.alchemist||s(1),D=.05,O=Lt("alchemist",C),Y=D*O.toNumber();if(Math.random()<Y){const $=["dragon","merchant","jester"],z=$[Math.floor(Math.random()*$.length)],ie={id:Date.now().toString(),type:z,expiresAt:s(Date.now()).plus(s(z==="dragon"?1e4:3e4)),hp:z==="dragon"?s(10):void 0,maxHp:z==="dragon"?s(10):void 0,reward:s(0)};e(M=>({...M,event:ie}))}}},1e4);return()=>clearInterval(A)},[r.event,r.advisors,r.advisorLevels]);const _t=A=>{var Y,$;let C=s(0);const D=((Y=A.weather)==null?void 0:Y.current)||"clear";dt.forEach(z=>{const ie=A.buildings[z.id]||s(0);let M=z.baseProduction;D==="sunny"?(z.id==="peasant"||z.id==="field")&&(M=M.times(s(1.2))):D==="rainy"?(z.id==="silver_mine"||z.id==="alchemist")&&(M=M.times(s(1.2))):D==="stormy"?(z.id==="blacksmith"&&(M=M.times(s(1.3))),z.id==="field"&&(M=M.times(s(.8)))):D==="windy"&&z.id==="market"&&(M=M.times(s(1.15))),C=C.plus(ie.times(M))});let O=s(1);if(Xe.forEach(z=>{if(A.upgrades.includes(z.id)&&(z.type==="global"&&z.multiplier&&(O=O.times(z.multiplier)),z.type==="building"&&z.multiplier&&z.targetId)){const ie=dt.find(M=>M.id===z.targetId);if(ie){const M=A.buildings[z.targetId]||s(0);C=C.plus(M.times(ie.baseProduction).times(z.multiplier.minus(s(1))))}}}),A.upgrades.includes("army_synergy")){const z=A.soldiers.dividedBy(s(1e3)).times(s(.01));O=O.times(s(1).plus(z))}if(A.upgrades.includes("achievement_synergy")){const z=s(A.achievements.length).times(s(.05));O=O.times(s(1).plus(z))}if(A.upgrades.includes("click_synergy")){const z=A.stats.totalClicks.times(s(1e-4));O=O.times(s(1).plus(z))}if(A.advisors.includes("cosmic_mage")){const z=A.advisorLevels.cosmic_mage||s(0),ie=A.advisors.includes("cosmic_mage")?Lt("cosmic_mage",z):s(0),M=s(1).plus(ie);O=O.times(M)}return((($=A.wonders)==null?void 0:$.sky_citadel)||s(0)).gte(s(3))&&(O=O.times(s(100))),A.artifacts.forEach(z=>{const ie=Gs.find(M=>M.id===z);ie&&(O=O.times(ie.globalMultiplier))}),O=O.times(s(1).plus(A.renown.times(s(.1))).plus(s(A.achievements.length*.02))),(A.activeDecrees.royal_feast||s(0)).gt(s(Date.now()))&&(O=O.times(s(2))),C=C.times(O),C},vt=_t(r),Ze=W.useRef(vt);Ze.current=vt,W.useEffect(()=>{const A=setInterval(()=>{e(C=>{const D=Date.now(),O=Ze.current.times(s(ds)).dividedBy(s(1e3));let Y=C.totalGold.plus(O),$=C.gold.plus(O),z={...C.weather};const ie=s(ds/1e3);if(z.timeLeft=z.timeLeft.minus(ie),z.timeLeft.lte(s(0))){const pe=["clear","sunny","rainy","stormy","windy"],Re=pe[Math.floor(Math.random()*pe.length)],xt=s(Math.floor(Math.random()*120)+60);z={current:Re,timeLeft:xt}}let M=C.event;M&&M.expiresAt&&s(M.expiresAt).lt(s(D))&&(M=null);let le={...C.intermediateGoods},Ee=s(0);if(Ee.gt(0)){const pe=Jr(C),Re=Ee.times(pe);$=$.plus(Re),Y=Y.plus(Re)}let re={...C.conquest},fe=[...C.artifacts],rt=C.soldiers;if(re.active&&re.crusadeId){const pe=_i.find(Re=>Re.id===re.crusadeId);if(pe){const Re=r.advisorLevels.warmaster||s(0),xt=r.advisors.includes("warmaster")?Lt("warmaster",Re):s(0);let He=s(1).minus(xt);const Tr=xt.times(s(2));C.weather.current==="windy"&&(He=He.times(s(.8)));const rn=s(pe.duration).times(s(He));if(s((D-s(re.startTime).toNumber())/1e3).gte(rn)){C.advisors.includes("warmaster");const kt=pe.baseRisk.minus(Tr),wt=Math.random();if(wt<kt.toNumber()){const It=(re.soldiersSent||pe.soldierCost).times(s(.5)).floor();rt=rt.plus(It),oe(`Crusade Failed! Our army retreats. ${F(It,r.numberFormat)} soldiers returned.`,"error")}else if(wt>.9){fe.includes(pe.rewardArtifactId)||fe.push(pe.rewardArtifactId);const It=Ze.current.times(s(300));$=$.plus(It),oe(`CRITICAL VICTORY! Found ${pe.name} Artifact and ${F(It.floor(),r.numberFormat)} Gold!`,"success")}else fe.includes(pe.rewardArtifactId)?oe(`Victory! Crusade ${pe.name} complete (Artifact already owned).`,"info"):(fe.push(pe.rewardArtifactId),oe(`Victory! Retrieved Artifact from ${pe.name}`,"success"));re={active:!1,crusadeId:null,startTime:s(0),soldiersSent:s(0)}}}}let bt=[...C.activeTradeRoutes||[]];bt.length,bt=bt.filter(pe=>{var nr,kt;const Re=vi.find(wt=>wt.id===pe.routeId);if(!Re)return!1;const xt=(((nr=C.wonders)==null?void 0:nr.great_pyramid)||s(0)).gte(3),He=xt?.5:1,Tr=s(pe.duration).times(s(He));if(s((D-s(pe.startTime).toNumber())/1e3).gte(Tr)){const wt=s(pe.soldiersSent).plus(s(((kt=pe.eliteSent)==null?void 0:kt.knight)||0).times(s(50))),It=s(Math.max(100,s(pe.goldInvested).dividedBy(s(100)).toNumber())),Qn=s(Math.min(.9,wt.dividedBy(It).toNumber()));let nn=Re.risk.times(s(1).minus(Qn));if(xt&&(nn=nn.times(s(.5))),Math.random()>nn.toNumber()){const Er=s(pe.goldInvested).times(Re.rewardMultiplier);$=$.plus(Er),Y=Y.plus(Er),oe(`Caravan returned from ${Re.name}! Profit: +${F(Er,C.numberFormat)} Gold`,"success")}else oe(`Caravan to ${Re.name} was raided! Investment lost.`,"error");return!1}return!0});const wr=[...C.achievements];let Ir=null;return yi.forEach(pe=>{wr.includes(pe.id)||pe.condition({...C,totalGold:Y,gold:$},Ze.current)&&(wr.push(pe.id),Ir=pe)}),Ir&&(m(Ir),setTimeout(()=>m(null),3e3)),{...C,gold:$,totalGold:Y,achievements:wr,event:M,conquest:re,artifacts:fe,soldiers:rt,activeTradeRoutes:bt,weather:z,intermediateGoods:le,advisorLevels:C.advisorLevels}})},ds);return()=>clearInterval(A)},[r.advisors,r.advisorLevels]);const Qr=W.useRef(r.artifacts);W.useEffect(()=>{Qr.current=r.artifacts},[r.artifacts]);const ot=(A="light")=>{if("vibrate"in navigator&&q)switch(A){case"light":navigator.vibrate(10);break;case"medium":navigator.vibrate(20);break;case"heavy":navigator.vibrate([30,10,30]);break}},_r=(A=!1)=>{A||ot("light");let C=s(1);if(Xe.filter(D=>D.type==="click"&&t.current.upgrades.includes(D.id)).forEach(D=>{D.multiplier&&(C=C.times(D.multiplier))}),(t.current.activeDecrees.call_to_arms||s(0)).gt(s(Date.now()))&&(C=C.times(s(5))),C=C.times(s(1).plus(t.current.renown.times(s(.1)))),t.current.godMode){const O=_t(t.current).times(s(6e3));C=C.plus(O)}e(D=>({...D,gold:D.gold.plus(C),totalGold:D.totalGold.plus(C),stats:{...D.stats,totalClicks:A?D.stats.totalClicks:D.stats.totalClicks.plus(s(1))}}))},[qn,Yr]=W.useState(""),[Rt,er]=W.useState(null),[St,Xr]=W.useState(null);W.useEffect(()=>{const A=C=>{const D=C.target;if(!(D.tagName==="INPUT"||D.tagName==="TEXTAREA")&&C.key.length===1&&/[a-zA-Z]/.test(C.key)){C.preventDefault(),Rt||er(Date.now());const O=qn+C.key.toLowerCase();if(Yr(O),O==="godon"||O==="godoff"){const Y=Date.now();Y-(Rt||Y)<=7e3&&(O==="godon"?(oe("üî• GOD MODE ACTIVATED! Each click gives +6000 seconds of income!","success"),e(z=>({...z,...z.godMode?{}:{godMode:!0}}))):O==="godoff"&&(oe("üõë GOD MODE DEACTIVATED! Normal clicks restored.","info"),e(z=>{const ie={...z};return delete ie.godMode,ie}))),Yr(""),er(null),St&&(clearTimeout(St),Xr(null))}}};return window.addEventListener("keydown",A),()=>{window.removeEventListener("keydown",A),St&&clearTimeout(St)}},[qn,Rt,St]),W.useEffect(()=>{if(Rt){const A=setTimeout(()=>{Yr(""),er(null),Xr(null)},7e3);return Xr(A),()=>{clearTimeout(A)}}},[Rt]);const Jr=A=>{let C=s(1);if(Xe.filter(D=>D.type==="click"&&A.upgrades.includes(D.id)).forEach(D=>{D.multiplier&&(C=C.times(D.multiplier))}),(A.activeDecrees.call_to_arms||s(0)).gt(s(Date.now()))&&(C=C.times(s(5))),C=C.times(s(1).plus(A.renown.times(s(.1)))),A.godMode){const O=_t(A).times(s(6e3));C=C.plus(O)}return C},vr=(A,C)=>{const D=dt.find(M=>M.id===A);if(!D||C<=0)return;const O=r.buildings[A]||s(0),Y=r.advisorLevels.guildmaster||s(0),$=r.advisors.includes("guildmaster")?Lt("guildmaster",Y):s(0),z=s(1).minus($),ie=Ft(D.baseCost,O,s(C)).times(z).floor();r.gold.gte(ie)&&(ot("medium"),e(M=>({...M,gold:M.gold.minus(ie),buildings:{...M.buildings,[A]:(M.buildings[A]||s(0)).plus(s(C))}})))},Zr=(A,C)=>{const D=dt.find(z=>z.id===A);if(!D||C<=0)return;const O=r.buildings[A]||s(0),Y=s(Math.min(C,O.toNumber()));if(Y.lte(s(0)))return;const $=Ft(D.baseCost,O.minus(Y),Y).times(s(.25)).floor();e(z=>({...z,gold:z.gold.plus($),buildings:{...z.buildings,[A]:O.minus(Y)}}))},De=A=>{const C=Xe.find(D=>D.id===A);C&&(r.upgrades.includes(A)||(C.currency==="renown"?r.renown.gte(C.cost)?(e(D=>({...D,renown:D.renown.minus(C.cost),upgrades:[...D.upgrades,A]})),oe(`Legacy Unlocked: ${C.name}`,"success")):oe(`Not enough Renown! Need ${F(C.cost,r.numberFormat)}`,"error"):r.gold.gte(C.cost)&&e(D=>({...D,gold:D.gold.minus(C.cost),upgrades:[...D.upgrades,A]}))))},Me=A=>{const C=Be.times(s(A));r.gold.gte(C)&&e(D=>({...D,gold:D.gold.minus(C),soldiers:D.soldiers.plus(C.dividedBy(Be))}))},tr=(A,C)=>{const D=fi.find($=>$.id===A);if(!D)return;const O=D.goldCost.times(s(C)),Y=D.soldierCost.times(s(C));r.gold.gte(O)&&r.soldiers.gte(Y)&&(e($=>({...$,gold:$.gold.minus(O),soldiers:$.soldiers.minus(Y),eliteUnits:{...$.eliteUnits,[A]:($.eliteUnits[A]||s(0)).plus(s(C))}})),oe(`Trained ${C} ${D.name}!`,"success"))},Yi=A=>{const C=jl.find(Y=>Y.id===A);if(!C)return;const D=r.advisors.includes(A),O=r.advisorLevels[A]||s(0);if(!D)r.renown.gte(C.cost)?(e(Y=>({...Y,renown:Y.renown.minus(C.cost),advisors:[...Y.advisors,A],advisorLevels:{...Y.advisorLevels,[A]:s(1)}})),oe(`Hired ${C.name}!`,"success")):oe(`Not enough Renown! Need ${F(C.cost,r.numberFormat)}`,"error");else{const Y=Ml(C,O);r.renown.gte(Y)?(e($=>({...$,renown:$.renown.minus(Y),advisorLevels:{...$.advisorLevels,[A]:O.plus(s(1))}})),oe(`Upgraded ${C.name} to Level ${O.plus(s(1))}!`,"success")):oe(`Not enough Renown! Need ${F(Y,r.numberFormat)}`,"error")}},en=A=>{const C=Vl.find(le=>le.id===A);if(!C)return;const D=Date.now(),O=r.advisorLevels.chronomancer||s(0),Y=r.advisorLevels.time_keeper||s(0),$=r.advisors.includes("chronomancer")?Lt("chronomancer",O):s(0),z=r.advisors.includes("time_keeper")?Lt("time_keeper",Y):s(0),ie=$.plus(z),M=C.cooldown.times(s(1).minus(ie));if(!(r.decreeCooldowns[A]||s(0)).gt(s(D))&&!(r.activeDecrees[A]||s(0)).gt(s(D))){if(C.unlockCondition&&!C.unlockCondition(r)){oe("Requirement not met!","error");return}C.effectType==="instant_gold"?(e(le=>({...le,gold:le.gold.plus(Ze.current.times(C.value)),totalGold:le.totalGold.plus(Ze.current.times(C.value)),decreeCooldowns:{...le.decreeCooldowns,[A]:s(D).plus(M.times(s(1e3)))}})),oe(`Decree Enacted: ${C.name}`,"success")):C.effectType==="add_soldiers"?(e(le=>({...le,soldiers:le.soldiers.plus(C.value),decreeCooldowns:{...le.decreeCooldowns,[A]:s(D).plus(M.times(s(1e3)))}})),oe(`Decree Enacted: Recruited ${C.value} Soldiers`,"success")):(e(le=>({...le,activeDecrees:{...le.activeDecrees,[A]:s(D).plus(C.duration.times(s(1e3)))},decreeCooldowns:{...le.decreeCooldowns,[A]:s(D).plus(C.duration.plus(C.cooldown).times(s(1e3)))}})),oe(`Decree Enacted: ${C.name}`,"success"))}},Gn=A=>{if(A.type==="merchant"){const C=Ze.current.times(s(10));e(D=>({...D,gold:D.gold.plus(C),totalGold:D.totalGold.plus(C),event:null})),oe(`The merchant gifted you ${F(C.floor(),r.numberFormat)} gold!`,"success")}else if(A.type==="jester"){const C=r.gold.times(s(.1)),D=Math.random()>.5;e(O=>({...O,gold:D?O.gold.plus(C):O.gold.minus(C),totalGold:D?O.totalGold.plus(C):O.totalGold,event:null})),D?oe(`Jester pays out! +${F(C.floor(),r.numberFormat)}`,"success"):oe(`Jester tricked you! -${F(C.floor(),r.numberFormat)}`,"warning")}else if(A.type==="dragon"){let C=!1;e(D=>{if(!D.event||D.event.type!=="dragon")return D;const O=(D.event.hp||s(1)).minus(s(1));if(O.lte(0)){const Y=Ze.current.times(s(30));return C=!0,{...D,gold:D.gold.plus(Y),totalGold:D.totalGold.plus(Y),event:null,stats:{...D.stats,dragonsKilled:D.stats.dragonsKilled.plus(s(1))}}}return{...D,event:{...D.event,hp:O}}}),C&&oe("Dragon Slain! +Treasury Boost","success")}},rr=(A,C,D,O)=>{const Y=vi.find(M=>M.id===A);if(!Y)return;const $=s(C),z=s(D);if(r.gold.lt($)){oe("Not enough gold!","error");return}if(r.soldiers.lt(z)){oe("Not enough soldiers!","error");return}let ie=!0;if(Object.entries(O).forEach(([M,le])=>{(r.eliteUnits[M]||s(0)).lt(s(le))&&(ie=!1)}),!ie){oe("Not enough elite units!","error");return}e(M=>{const le={...M.eliteUnits};return Object.entries(O).forEach(([Ee,re])=>{le[Ee]=(le[Ee]||s(0)).minus(s(re))}),{...M,gold:M.gold.minus($),soldiers:M.soldiers.minus(z),eliteUnits:le,activeTradeRoutes:[...M.activeTradeRoutes||[],{id:Date.now().toString(),routeId:A,startTime:s(Date.now()),duration:s(Y.baseDuration),goldInvested:$,soldiersSent:z,eliteSent:Object.fromEntries(Object.entries(O).map(([Ee,re])=>[Ee,s(re)]))}]}}),oe("Caravan Dispatched!","success")},$n=A=>{const C=Ll.find($=>$.id===A);if(!C)return;const D=r.wonders[A]||s(0);if(D.gte(s(C.stages.length)))return;const O=C.stages[D].cost;let Y=!0;for(const $ of O)if($.type==="gold"&&r.gold.lt(s($.amount))&&(Y=!1),$.type==="soldiers"&&r.soldiers.lt(s($.amount))&&(Y=!1),$.type==="renown"&&r.renown.lt(s($.amount))&&(Y=!1),["knight","paladin","void_sentinel"].includes($.type)){const z=$.type;(r.eliteUnits[z]||s(0)).lt(s($.amount))&&(Y=!1)}if(!Y){oe("Resources insufficient for construction!","error");return}e($=>{let z=$.gold,ie=$.soldiers,M=$.renown,le={...$.eliteUnits};for(const Ee of O)if(Ee.type==="gold"&&(z=z.minus(s(Ee.amount))),Ee.type==="soldiers"&&(ie=ie.minus(s(Ee.amount))),Ee.type==="renown"&&(M=M.minus(s(Ee.amount))),["knight","paladin","void_sentinel"].includes(Ee.type)){const re=Ee.type;le[re]=(le[re]||s(0)).minus(s(Ee.amount))}return{...$,gold:z,soldiers:ie,renown:M,eliteUnits:le,wonders:{...$.wonders,[A]:D.plus(s(1))}}}),oe("Wonder Stage Complete!","success")},Wn=A=>{const C=_i.find(D=>D.id===A);if(C){if(C.requiredUnits){for(const[D,O]of Object.entries(C.requiredUnits))if((r.eliteUnits[D]||s(0)).lt(O)){oe("Missing elite units required for this mission.","error");return}}r.soldiers.gte(C.soldierCost)&&(e(D=>({...D,soldiers:D.soldiers.minus(C.soldierCost),conquest:{active:!0,crusadeId:A,startTime:s(Date.now()),soldiersSent:C.soldierCost}})),oe(`Crusade Started: ${C.name}`,"info"))}},tn=()=>{const A=r.advisorLevels.void_scholar||s(0),C=r.advisors.includes("void_scholar")?Lt("void_scholar",A):s(0),D=s(1).plus(C),O=s(1e12),Y=r.totalGold;if(Y.lt(O))return;const $=Y.dividedBy(O),z=s(Math.floor(Math.pow($.toNumber(),.5))).times(D);z.lte(0)||(e({...lr,renown:r.renown.plus(z),prestigeCount:r.prestigeCount+1,achievements:r.achievements,artifacts:r.artifacts,upgrades:r.upgrades.filter(ie=>{const M=Xe.find(le=>le.id===ie);return(M==null?void 0:M.currency)==="renown"}),advisors:r.advisors,advisorLevels:r.advisorLevels,wonders:r.wonders,playerProfile:r.playerProfile,startTime:s(Date.now()),lastSaveTime:s(Date.now()),theme:r.theme,idleModeEnabled:r.idleModeEnabled,interface:r.interface}),v(!1),oe("Abdication Successful. Long live the new King!","success"))},Xi=()=>{localStorage.removeItem("kingdom_save"),e({...lr,startTime:s(Date.now())}),T(!1),oe("Game Reset","warning")},Ji=()=>{const C=En(r);localStorage.setItem("kingdom_save",JSON.stringify(C)),oe("Game Saved","info")},Hn=A=>{e(C=>({...C,playerProfile:A})),localStorage.setItem(`playerProfile_${A.id}`,JSON.stringify(A)),oe(`Welcome, ${A.rulerName} ${A.rulerId}!`,"success"),l(!1)},Kn=async()=>{tn()},Pt=A=>{e(C=>({...C,interface:{...C.interface,lastBuyAmount:A}}))},br=A=>({flex:A==="left"?"var(--col-left)":"var(--col-right)",display:"flex",flexDirection:"column",borderRight:A==="left"?"var(--custom-border-width) double var(--border-color)":"none",borderLeft:A==="right"?"var(--custom-border-width) double var(--border-color)":"none",background:"var(--panel-bg)",minWidth:0,transition:"transform 0.8s ease-in-out",transform:n&&r.idleModeEnabled?A==="left"?"translateX(-120%)":"translateX(120%)":"translateX(0)",zIndex:10});return c.jsxs("div",{style:{display:"flex",height:"100dvh",width:"100vw",backgroundColor:"var(--bg-color)",overflow:"hidden",position:"relative",flexDirection:q?"column":"row"},children:[c.jsx(Td,{toasts:g}),c.jsx(Ed,{}),n&&r.idleModeEnabled&&c.jsx(Cd,{gameState:r}),!q&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{style:br("left"),children:[c.jsxs("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)"},children:[c.jsx("button",{className:`tab-btn ${_==="buildings"?"active":""}`,onClick:()=>w("buildings"),children:"Estates"}),c.jsx("button",{className:`tab-btn ${_==="upgrades"?"active":""}`,onClick:()=>w("upgrades"),children:"Upgrades"}),c.jsx("button",{className:`tab-btn ${_==="decrees"?"active":""}`,onClick:()=>w("decrees"),children:"Decrees"})]}),c.jsxs("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden"},children:[_==="buildings"&&c.jsx(pa,{gameState:r,onBuyBuilding:vr,onSellBuilding:Zr,onSetBuyAmount:Pt}),_==="upgrades"&&c.jsx(ga,{gameState:r,onBuyUpgrade:De}),_==="decrees"&&c.jsx(fa,{gameState:r,onActivateDecree:en})]})]}),c.jsx("div",{style:{flex:"var(--col-center)",display:"flex",flexDirection:"column",position:"relative",borderRight:n&&r.idleModeEnabled?"none":"var(--custom-border-width) double var(--border-color)",minWidth:0,zIndex:5,transition:"border 0.8s"},children:c.jsx(_a,{gameState:r,gps:vt,onClick:()=>_r(!1),onEventInteract:Gn,onOpenConquest:()=>{(r.buildings.castle||s(0)).gt(0)?G(!0):oe("You need a Castle to lead your army!","warning")},onOpenTavern:()=>J(!0),onOpenPrestige:()=>v(!0),onOpenSettings:()=>T(!0),onOpenCouncil:()=>te(!0),onOpenStatistics:()=>be(!0),onOpenLeaderboard:()=>{st(!0)},onOpenEmpire:()=>{(r.buildings.castle||s(0)).gt(0)?Fe(!0):oe("You need a Castle to manage an Empire!","warning")},isIdle:n&&r.idleModeEnabled})}),c.jsxs("div",{style:br("right"),children:[c.jsxs("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)"},children:[c.jsx("button",{className:`tab-btn ${k==="army"?"active":""}`,onClick:()=>B("army"),children:"Army"}),c.jsx("button",{className:`tab-btn ${k==="achievements"?"active":""}`,onClick:()=>B("achievements"),children:"Achievements"})]}),c.jsxs("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden"},children:[k==="army"&&c.jsx(ya,{gameState:r,onTrainSoldier:Me,onTrainElite:tr}),k==="achievements"&&c.jsx(va,{gameState:r})]})]})]}),q&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",position:"relative",minHeight:0,height:"100%"},children:[N==="buildings"&&c.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0},children:[c.jsxs("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:[c.jsx("button",{className:`tab-btn ${_==="buildings"?"active":""}`,onClick:()=>w("buildings"),children:"Estates"}),c.jsx("button",{className:`tab-btn ${_==="upgrades"?"active":""}`,onClick:()=>w("upgrades"),children:"Upgrades"}),c.jsx("button",{className:`tab-btn ${_==="decrees"?"active":""}`,onClick:()=>w("decrees"),children:"Decrees"})]}),c.jsxs("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:[_==="buildings"&&c.jsx(pa,{gameState:r,onBuyBuilding:vr,onSellBuilding:Zr,onSetBuyAmount:Pt}),_==="upgrades"&&c.jsx(ga,{gameState:r,onBuyUpgrade:De}),_==="decrees"&&c.jsx(fa,{gameState:r,onActivateDecree:en})]})]}),N==="throne"&&c.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,height:"100%"},children:c.jsx(_a,{gameState:r,gps:vt,onClick:()=>_r(!1),onEventInteract:Gn,onOpenConquest:()=>{(r.buildings.castle||s(0)).gt(0)?G(!0):oe("You need a Castle to lead your army!","warning")},onOpenTavern:()=>J(!0),onOpenPrestige:()=>v(!0),onOpenSettings:()=>T(!0),onOpenCouncil:()=>te(!0),onOpenStatistics:()=>be(!0),onOpenLeaderboard:()=>{st(!0)},onOpenEmpire:()=>{(r.buildings.castle||s(0)).gt(0)?Fe(!0):oe("You need a Castle to manage an Empire!","warning")},isIdle:n&&r.idleModeEnabled})}),N==="army"&&c.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0},children:[c.jsxs("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:[c.jsx("button",{className:`tab-btn ${k==="army"?"active":""}`,onClick:()=>B("army"),children:"Army"}),c.jsx("button",{className:`tab-btn ${k==="achievements"?"active":""}`,onClick:()=>B("achievements"),children:"Achievements"})]}),c.jsxs("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:[k==="army"&&c.jsx(ya,{gameState:r,onTrainSoldier:Me,onTrainElite:tr}),k==="achievements"&&c.jsx(va,{gameState:r})]})]}),N==="empire"&&c.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,height:"100%"},children:c.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:c.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"var(--text-secondary)"},children:[c.jsx("h3",{children:"üè∞ Empire Management"}),c.jsx("p",{children:"Manage your conquests and trade routes here."}),c.jsx("button",{className:"btn",onClick:()=>G(!0),style:{margin:"10px",padding:"15px 20px",fontSize:"16px"},children:"‚öîÔ∏è Conquests"}),c.jsx("button",{className:"btn",onClick:()=>Fe(!0),style:{margin:"10px",padding:"15px 20px",fontSize:"16px"},children:"üåç Trade Empire"})]})})})]}),c.jsxs("div",{style:{display:"flex",justifyContent:"space-around",alignItems:"center",height:"60px",backgroundColor:"var(--panel-bg)",borderTop:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:[c.jsxs("button",{className:`mobile-nav-btn ${N==="buildings"?"active":""}`,onClick:()=>{ot("light"),L("buildings")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:N==="buildings"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer",transition:"all 0.2s ease"},children:[c.jsx("div",{style:{fontSize:"20px"},children:"üèòÔ∏è"}),c.jsx("div",{children:"Estates"})]}),c.jsxs("button",{className:`mobile-nav-btn ${N==="throne"?"active":""}`,onClick:()=>{ot("light"),L("throne")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:N==="throne"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer",transition:"all 0.2s ease"},children:[c.jsx("div",{style:{fontSize:"20px"},children:"üëë"}),c.jsx("div",{children:"Throne"})]}),c.jsxs("button",{className:`mobile-nav-btn ${N==="army"?"active":""}`,onClick:()=>{ot("light"),L("army")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:N==="army"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer",transition:"all 0.2s ease"},children:[c.jsx("div",{style:{fontSize:"20px"},children:"‚öîÔ∏è"}),c.jsx("div",{children:"Army"})]}),c.jsxs("button",{className:`mobile-nav-btn ${N==="empire"?"active":""}`,onClick:()=>{ot("light"),L("empire")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:N==="empire"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer",transition:"all 0.2s ease"},children:[c.jsx("div",{style:{fontSize:"20px"},children:"üó∫Ô∏è"}),c.jsx("div",{children:"Empire"})]})]})]}),!(n&&r.idleModeEnabled)&&d&&c.jsxs("div",{className:"achievement-popup",children:[c.jsx("div",{style:{fontSize:"2rem"},children:d.icon}),c.jsxs("div",{children:[c.jsx("div",{style:{fontWeight:"bold",color:"var(--text-color)"},children:"Achievement Unlocked!"}),c.jsx("div",{style:{color:"var(--accent-color)"},children:d.name})]})]}),U&&c.jsx(gd,{gameState:r,onStartCrusade:Wn,onClose:()=>G(!1)}),Qe&&c.jsx(xd,{gameState:r,onInvestTrade:rr,onBuildWonder:$n,onClose:()=>Fe(!1)}),Z&&c.jsx(pd,{gameState:r,onGamble:(A,C)=>{const D=s(A);e(O=>({...O,gold:C?O.gold.plus(D):O.gold.minus(D),stats:{...O.stats,tavernGamesPlayed:O.stats.tavernGamesPlayed.plus(s(1))}}))},onClose:()=>J(!1)}),I&&c.jsx(fd,{gameState:r,onPrestige:Kn,onClose:()=>v(!1)}),x&&c.jsx(yd,{gameState:r,onClose:()=>T(!1),onHardReset:Xi,onSave:Ji,onOpenChangelog:()=>E(!0),onSetTheme:A=>e(C=>({...C,theme:A})),onSetNumberFormat:A=>e(C=>({...C,numberFormat:A})),onToggleIdleMode:()=>e(A=>({...A,idleModeEnabled:!A.idleModeEnabled})),onUpdateInterface:A=>e(C=>({...C,interface:{...C.interface,...A}}))}),he&&c.jsx(bd,{gameState:r,currentGps:vt,onClose:()=>be(!1)}),b&&c.jsx(_d,{onClose:()=>E(!1)}),y&&c.jsx(vd,{gameState:r,onHireAdvisor:Yi,onClose:()=>te(!1)}),Ae&&c.jsx(Ff,{isOpen:Ae,onClose:()=>{yt(!1),l(!0)},onConfirm:Hn,gameState:r}),X&&c.jsx(Uf,{isOpen:X,onClose:()=>st(!1),playerProfile:r.playerProfile})]})};export{$f as A,xs as R,c as j};
