import{r as it,g as at}from"./vendor-B--z-fyW.js";import{T as he}from"./types-BFQ43cev.js";import{g as ae,A as dt,C as ct}from"./ui-CxLZDZ-W.js";import{t as o,f as j,T as pe,B as ie,W as ut,A as Ge,N as mt,g as Ue,M as fe,P as $e,a as _e,b as He,c as ye,d as be,e as Ye,h as ve,i as je,j as Le,U as xt,S as Be}from"./constants-5rt-Ld5C.js";import{i as ht,g as gt,d as Me,s as Ae,a as De,q as Je,c as Ve,o as Xe,l as qe,b as Ke,e as oe}from"./game-BSflrnjg.js";import{I as pt,B as Ie,M as ze,A as We}from"./components-Dlmnre5R.js";var ge={exports:{}},ce={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fe;function ft(){if(Fe)return ce;Fe=1;var t=Symbol.for("react.transitional.element"),l=Symbol.for("react.fragment");function g(S,m,d){var f=null;if(d!==void 0&&(f=""+d),m.key!==void 0&&(f=""+m.key),"key"in m){d={};for(var y in m)y!=="key"&&(d[y]=m[y])}else d=m;return m=d.ref,{$$typeof:t,type:S,key:f,ref:m!==void 0?m:null,props:d}}return ce.Fragment=l,ce.jsx=g,ce.jsxs=g,ce}var Oe;function yt(){return Oe||(Oe=1,ge.exports=ft()),ge.exports}var e=yt(),x=it();const bt=at(x),vt=({gameState:t,onGamble:l,onClose:g})=>{const[S,m]=x.useState("coin"),[d,f]=x.useState(10),[y,T]=x.useState(""),[w,F]=x.useState(null),u=()=>{if(t.gold.lt(o(d))){T("Not enough gold!");return}const L=Math.random()>.5;l(d,L),T(L?`Heads! You DOUBLED your money! (+${j(d,t.numberFormat)} Profit)`:`Tails... You lost ${j(d,t.numberFormat)} gold.`),F(null)},O=()=>{if(t.gold.lt(o(d))){T("Not enough gold!");return}const L=Math.floor(Math.random()*6)+1,N=Math.floor(Math.random()*6)+1,R=L+N;F(R);let E=0;if(R===7)T(`Rolled ${R}. A draw! Gold returned.`),l(0,!0);else if(R>7){R>=10?E=2:E=1.5;const I=Math.floor(d*E);l(I,!0),T(`Rolled ${R}! You won ${j(I,t.numberFormat)} gold!`)}else l(d,!1),T(`Rolled ${R}. You lost ${j(d,t.numberFormat)} gold.`)};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{minHeight:"450px"},children:[e.jsx("h2",{style:{borderBottom:"none"},children:"üç∫ The Rusty Tankard"}),e.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"20px",justifyContent:"center"},children:[e.jsx("button",{className:"btn ",style:{opacity:S==="coin"?1:.6},onClick:()=>m("coin"),children:"Coin Flip"}),e.jsx("button",{className:"btn ",style:{opacity:S==="dice"?1:.6},onClick:()=>m("dice"),children:"High Dice"})]}),e.jsxs("div",{style:{background:"var(--panel-bg)",padding:"20px",borderRadius:"8px",border:"var(--custom-border-width) solid var(--border-color)"},children:[S==="coin"?e.jsxs("div",{style:{textAlign:"left",background:"var(--bg-color)",padding:"10px",borderRadius:"4px",color:"var(--text-color)"},children:[e.jsx("strong",{children:"Rules:"}),e.jsxs("ul",{style:{margin:"5px 0",paddingLeft:"20px",color:"var(--text-color)"},children:[e.jsx("li",{children:"50% Chance to Win."}),e.jsxs("li",{children:["Win: ",e.jsx("strong",{children:"+100% Profit"})," (Doubles your money)."]}),e.jsx("li",{children:"Lose: Lost the bet."})]})]}):e.jsxs("div",{style:{textAlign:"left",background:"var(--bg-color)",padding:"10px",borderRadius:"4px",color:"var(--text-color)"},children:[e.jsx("strong",{children:"Dice Rules (Roll 2-12):"}),e.jsxs("ul",{style:{margin:"5px 0",paddingLeft:"20px",color:"var(--text-color)"},children:[e.jsxs("li",{children:[e.jsx("strong",{children:"7:"})," Draw (Bet returned)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"8-9:"})," Win +50% Profit (1.5x)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"10-12:"})," Win +100% Profit (2x)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"2-6:"})," Loss"]})]})]}),e.jsxs("div",{style:{margin:"20px 0",color:"var(--text-color)"},children:[e.jsx("label",{style:{color:"var(--text-color)"},children:"Bet Amount: "}),e.jsx("input",{type:"number",value:d,onChange:L=>f(Math.max(1,parseInt(L.target.value)||0)),style:{padding:"8px",width:"120px",fontSize:"1rem",border:"var(--custom-border-width) solid var(--border-color)",backgroundColor:"var(--panel-bg)",color:"var(--text-color)"}})]}),S==="dice"&&w!==null&&e.jsxs("div",{style:{fontSize:"3rem",margin:"10px",color:"var(--text-color)"},children:["üé≤ ",w]}),e.jsx("button",{className:"btn",style:{fontSize:"1.2rem",padding:"10px 30px"},onClick:S==="coin"?u:O,children:S==="coin"?"Flip Coin":"Roll Dice"}),y&&e.jsx("div",{style:{marginTop:"15px",fontWeight:"bold",fontSize:"1.1rem",color:y.includes("won")||y.includes("DOUBLED")||y.includes("draw")?"var(--success-color)":"var(--danger-color)"},children:y})]}),e.jsx("div",{style:{marginTop:"30px"},children:e.jsx("button",{className:"btn",onClick:g,children:"Leave Tavern"})})]})})},jt=({gameState:t,onPrestige:l,onClose:g})=>{var E;const m=o(1e12),d=t.totalGold;let f=o(0),y=!1,T=m.minus(d);if(d.gte(m)){const I=d.dividedBy(m);f=o(Math.floor(Math.pow(I.toNumber(),.33))).times(1).minus(t.renown),f.lt(0)&&(f=o(0)),y=f.gt(0)}const w=t.renown.plus(f),F=m.times(Math.pow(Math.floor(w.dividedBy(1).toNumber()+1),3));F.minus(d);const O=ae(t.renown).minus(o(1)).times(o(100)),N=ae(t.renown.plus(f)).minus(o(1)).times(o(100)),R=Object.values(t.nationalProjects||{}).some(I=>I.active);return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{border:"4px solid #673ab7"},children:[e.jsx("h2",{style:{color:"#673ab7"},children:"üëë Abdication"}),e.jsx("p",{children:"Are you ready to pass the crown to your heir?"}),!((E=t.playerProfile)!=null&&E.hasChosenName)&&e.jsxs("div",{style:{background:"rgba(255, 235, 59, 0.1)",border:"1px solid #ffc107",padding:"10px",borderRadius:"4px",marginBottom:"15px",fontSize:"0.9rem"},children:["üí° ",e.jsx("strong",{children:"Tip:"})," You can abdicate without choosing a ruler name. Choose a name only if you want to appear in the leaderboard."]}),e.jsxs("div",{style:{textAlign:"left",margin:"20px 0",background:"rgba(243, 229, 245, 0.5)",padding:"15px",borderRadius:"4px"},children:[e.jsx("div",{children:e.jsx("strong",{children:"You will lose:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"All Gold & Treasury"}),e.jsx("li",{children:"All Estates (Buildings)"}),e.jsx("li",{children:"Workforce (Laborers & Specialists)"}),e.jsx("li",{children:"Royal Scepter Levels"}),e.jsxs("li",{children:[e.jsx("strong",{children:"Unfinished National Projects"})," (Progress & Resources)"]})]}),e.jsx("div",{children:e.jsx("strong",{children:"You will keep:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"Achievements"}),e.jsxs("li",{children:["Current Renown (",j(t.renown,t.numberFormat),")"]}),e.jsx("li",{children:"Completed National Project Levels"}),e.jsx("li",{children:"Lifetime Stats & Leaderboard Rank"})]})]}),R&&e.jsx("div",{style:{marginBottom:"20px",padding:"10px",background:"rgba(255, 0, 0, 0.1)",border:"1px solid red",borderRadius:"4px",color:"#d32f2f",fontSize:"0.9rem",fontWeight:"bold",textAlign:"center"},children:"‚ö†Ô∏è WARNING: You have a National Project under construction! Abdication will cancel the construction. All progress and resources invested in the pending level will be lost."}),e.jsxs("div",{style:{fontSize:"1.2rem",marginBottom:"20px"},children:[e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:["Current Renown: ",j(t.renown,t.numberFormat)]}),e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:["Total Gold Earned: ",j(d,t.numberFormat)]}),e.jsx("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:"Threshold for first prestige: 1,000,000,000,000 Gold"}),!y&&d.lt(m)&&e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"#cc0000"},children:["Need: ",j(T,t.numberFormat)," more Gold to unlock prestige"]}),y&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:[e.jsx("strong",{children:"Current:"})," ",j(t.renown,t.numberFormat)," Renown (+",O.toNumber().toFixed(1),"% bonus)"]}),e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:[e.jsx("strong",{children:"Gain:"})," ",j(f,t.numberFormat)," Renown (+",N.toNumber().toFixed(1),"% bonus)"]}),e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:[e.jsx("strong",{children:"Total:"})," ",j(t.renown.plus(f),t.numberFormat)," Renown (+",N.toNumber().toFixed(1),"% bonus)"]}),f.gt(0)&&e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginTop:"5px"},children:["Next Renown at: ",j(F,t.numberFormat)," gold"]})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("button",{className:"btn",style:{background:"#666"},onClick:g,children:"Cancel"}),e.jsx("button",{className:"btn",style:{background:"#673ab7"},onClick:l,disabled:!y,children:y?"Abdicate":d.lt(m)?`Need ${j(T,t.numberFormat)} more Gold to unlock prestige`:"Prestige Unavailable"})]})]})})},wt=({gameState:t,onClose:l,onHardReset:g,onSave:S,onOpenChangelog:m,onSetTheme:d,onSetNumberFormat:f,onToggleIdleMode:y,onUpdateInterface:T})=>{var q,K,Z,D;const[w,F]=bt.useState(!1),u=t.interface||{density:"normal",fontSize:"medium",showFloatingText:!0,showWeatherWidget:!0,reduceMotion:!1,crownAnimations:!0,layout:{left:o(1),center:o(1),right:o(1)},borderWidth:o(4),customColors:{enabled:!1,bg:"",panel:"",text:"",accent:"",border:"",secondaryText:"",accentHover:"",gold:"",success:"",danger:""}},O=(q=u.layout.left)!=null&&q.toNumber?u.layout.left.toNumber():Number(u.layout.left),L=(K=u.layout.center)!=null&&K.toNumber?u.layout.center.toNumber():Number(u.layout.center),N=(Z=u.layout.right)!=null&&Z.toNumber?u.layout.right.toNumber():Number(u.layout.right),R=(D=u.borderWidth)!=null&&D.toNumber?u.borderWidth.toNumber():Number(u.borderWidth),E=u.customColors||{},I=String(E.bg||""),k=String(E.panel||""),M=String(E.text||""),G=String(E.secondaryText||""),W=String(E.accent||""),_=String(E.accentHover||""),J=String(E.gold||""),V=String(E.border||""),H=String(E.success||""),U=String(E.danger||""),$=()=>{w?g():F(!0)},b=(c,te)=>{T({layout:{...u.layout,[c]:o(te)}})},h=(c,te)=>{T({customColors:{...u.customColors,[c]:te}})},A={display:"flex",gap:"5px",flexWrap:"wrap",justifyContent:"center"},B={marginBottom:"8px",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px",background:"rgba(0,0,0,0.03)",borderRadius:"4px"},Y={width:"100%",marginBottom:"5px"};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("h2",{children:"‚öôÔ∏è Royal Settings"}),t.playerProfile&&e.jsxs("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"12px",marginBottom:"20px",textAlign:"center"},children:[e.jsxs("div",{style:{color:"var(--gold-color)",fontSize:"16px",fontWeight:"bold"},children:["üëë Your Ruler: ",t.playerProfile.rulerName," ",t.playerProfile.rulerId]}),e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"12px",marginTop:"5px"},children:"Registered in Leaderboard System"})]}),e.jsxs("div",{style:{textAlign:"left",marginBottom:"20px",maxHeight:"60vh",overflowY:"auto",paddingRight:"5px"},children:[e.jsx("h3",{style:{marginBottom:"10px"},children:"Layout Configuration"}),e.jsxs("div",{style:{marginBottom:"15px",background:"rgba(0,0,0,0.03)",padding:"10px",borderRadius:"4px"},children:[e.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Column Widths (Ratio)"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"10px",alignItems:"center",marginBottom:"5px"},children:[e.jsx("span",{style:{fontSize:"0.8rem"},children:"Left"}),e.jsx("input",{type:"range",min:"1",max:"5",step:"0.5",value:O,onChange:c=>b("left",parseFloat(c.target.value)),style:Y}),e.jsx("span",{style:{fontSize:"0.8rem"},children:O})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"10px",alignItems:"center",marginBottom:"5px"},children:[e.jsx("span",{style:{fontSize:"0.8rem"},children:"Center"}),e.jsx("input",{type:"range",min:"1",max:"5",step:"0.5",value:L,onChange:c=>b("center",parseFloat(c.target.value)),style:Y}),e.jsx("span",{style:{fontSize:"0.8rem"},children:L})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"10px",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:"0.8rem"},children:"Right"}),e.jsx("input",{type:"range",min:"1",max:"5",step:"0.5",value:N,onChange:c=>b("right",parseFloat(c.target.value)),style:Y}),e.jsx("span",{style:{fontSize:"0.8rem"},children:N})]})]}),e.jsx("h3",{style:{marginBottom:"10px"},children:"Design Studio"}),e.jsxs("div",{style:B,children:[e.jsx("div",{children:e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Border Thickness"})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("input",{type:"range",min:"1",max:"10",value:R,onChange:c=>T({borderWidth:o(parseInt(c.target.value))})}),e.jsxs("span",{children:[R,"px"]})]})]}),e.jsxs("div",{style:B,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Enable Custom Colors"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Override theme colors."})]}),e.jsx("input",{type:"checkbox",checked:u.customColors.enabled,onChange:c=>h("enabled",c.target.checked),style:{transform:"scale(1.5)"}})]}),u.customColors.enabled&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",marginBottom:"15px"},children:[e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Background",e.jsx("input",{type:"color",value:I,onChange:c=>h("bg",c.target.value),style:{width:"100%"}})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Panels",e.jsx("input",{type:"color",value:k,onChange:c=>h("panel",c.target.value),style:{width:"100%"}})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Borders",e.jsx("input",{type:"color",value:V,onChange:c=>h("border",c.target.value),style:{width:"100%"}})]}),e.jsx("div",{style:{gridColumn:"1 / -1",height:"1px",background:"#ccc",margin:"5px 0"}}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Primary Text",e.jsx("input",{type:"color",value:M,onChange:c=>h("text",c.target.value),style:{width:"100%"}})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Secondary Text",e.jsx("input",{type:"color",value:G,onChange:c=>h("secondaryText",c.target.value),style:{width:"100%"}})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Gold/Value",e.jsx("input",{type:"color",value:J,onChange:c=>h("gold",c.target.value),style:{width:"100%"}})]}),e.jsx("div",{style:{gridColumn:"1 / -1",height:"1px",background:"#ccc",margin:"5px 0"}}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Accent/Buttons",e.jsx("input",{type:"color",value:W,onChange:c=>h("accent",c.target.value),style:{width:"100%"}})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Button Hover",e.jsx("input",{type:"color",value:_,onChange:c=>h("accentHover",c.target.value),style:{width:"100%"}})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Success/Green",e.jsx("input",{type:"color",value:H,onChange:c=>h("success",c.target.value),style:{width:"100%"}})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Danger/Red",e.jsx("input",{type:"color",value:U,onChange:c=>h("danger",c.target.value),style:{width:"100%"}})]})]}),e.jsx("div",{style:{borderTop:"1px dashed #ccc",margin:"15px 0"}}),e.jsxs("div",{style:{marginBottom:"15px",opacity:u.customColors.enabled?.5:1,pointerEvents:u.customColors.enabled?"none":"auto"},children:[e.jsxs("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:["Preset Themes ",u.customColors.enabled&&"(Disabled)"]}),e.jsx("div",{style:A,children:Object.values(pe).map(c=>e.jsx("button",{className:"btn",style:{background:t.theme===c.id?"var(--accent-color)":"var(--panel-bg)",color:t.theme===c.id?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",flex:"1 1 auto",padding:"5px 10px"},onClick:()=>d(c.id),children:c.name},c.id))})]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Font Size"}),e.jsx("div",{style:A,children:["small","medium","large"].map(c=>e.jsx("button",{className:"btn",style:{background:u.fontSize===c?"var(--accent-color)":"var(--panel-bg)",color:u.fontSize===c?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",flex:"1 1 auto",textTransform:"capitalize"},onClick:()=>T({fontSize:c}),children:c},c))})]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Layout Density"}),e.jsx("div",{style:A,children:["compact","normal","spacious"].map(c=>e.jsx("button",{className:"btn",style:{background:u.density===c?"var(--accent-color)":"var(--panel-bg)",color:u.density===c?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",flex:"1 1 auto",textTransform:"capitalize"},onClick:()=>T({density:c}),children:c},c))})]}),e.jsx("div",{style:{borderTop:"1px dashed #ccc",margin:"15px 0"}}),e.jsxs("div",{style:B,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Cinematic Idle Mode"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show landscape when inactive."})]}),e.jsx("button",{className:"btn",style:{background:t.idleModeEnabled?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:y,children:t.idleModeEnabled?"ON":"OFF"})]}),e.jsxs("div",{style:B,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Click Text"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show floating numbers on click."})]}),e.jsx("button",{className:"btn",style:{background:u.showFloatingText?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>T({showFloatingText:!u.showFloatingText}),children:u.showFloatingText?"ON":"OFF"})]}),e.jsxs("div",{style:B,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Weather Widget"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show weather info in top left."})]}),e.jsx("button",{className:"btn",style:{background:u.showWeatherWidget?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>T({showWeatherWidget:!u.showWeatherWidget}),children:u.showWeatherWidget?"ON":"OFF"})]}),e.jsxs("div",{style:B,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Crown Animations"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show crown effects and animations."})]}),e.jsx("button",{className:"btn",style:{background:u.crownAnimations?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>T({crownAnimations:!u.crownAnimations}),children:u.crownAnimations?"ON":"OFF"})]}),e.jsxs("div",{style:B,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Reduce Motion"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Disable animations."})]}),e.jsx("button",{className:"btn",style:{background:u.reduceMotion?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>T({reduceMotion:!u.reduceMotion}),children:u.reduceMotion?"ON":"OFF"})]}),e.jsxs("div",{style:{marginTop:"15px"},children:[e.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Number Format"}),e.jsx("div",{style:A,children:["standard","scientific","plain"].map(c=>e.jsx("button",{className:"btn",style:{background:t.numberFormat===c?"var(--accent-color)":"var(--panel-bg)",color:t.numberFormat===c?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",flex:"1 1 auto",padding:"5px 10px",textTransform:"capitalize"},onClick:()=>f(c),children:c},c))})]})]}),e.jsxs("div",{style:{borderTop:"2px solid #ccc",paddingTop:"15px",marginTop:"15px"},children:[e.jsx("h3",{children:"System"}),e.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"center",flexWrap:"wrap"},children:[e.jsx("button",{className:"btn",onClick:S,children:"Force Save"}),e.jsx("button",{className:"btn",style:{background:"#0288d1"},onClick:m,children:"Update Logs"}),e.jsx("button",{className:"btn",style:{backgroundColor:w?"red":"#d32f2f"},onClick:$,children:w?"CONFIRM WIPE?":"Hard Reset"})]}),w&&e.jsx("div",{style:{color:"red",fontSize:"0.8rem",marginTop:"5px"},children:"Warning: This will delete all progress permanently!"})]}),e.jsx("button",{className:"btn",style:{marginTop:"20px",background:"#5d4037",width:"100%"},onClick:l,children:"Return to Game"}),e.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)",marginTop:"10px"},children:"v2.3.0 - Kingdom Clicker"})]})})},Ct=({gameState:t,currentGps:l,onClose:g})=>{var I,k;const S=Object.values(t.buildings).reduce((M,G)=>M.plus(G),o(0)),m=t.achievements.length,d=Ge.length;let f="None",y="None",T=-1,w=o(0);ie.forEach((M,G)=>{const W=t.buildings[M.id]||o(0);W.gt(o(0))&&G>T&&(T=G,f=M.name),W.gt(w)&&(w=W,y=M.name)});const u=(()=>{let M=o(1);return M=M.times(ae(t.renown)),M})(),[O,L]=x.useState("");x.useEffect(()=>{const M=()=>{const W=o(Date.now()).minus(t.startTime),_=W.dividedBy(o(1e3)),J=_.minus(_.dividedBy(o(60)).floor().times(o(60))).floor(),V=W.dividedBy(o(6e4)),H=V.minus(V.dividedBy(o(60)).floor().times(o(60))).floor(),U=W.dividedBy(o(36e5)),$=U.minus(U.dividedBy(o(24)).floor().times(o(24))).floor(),b=W.dividedBy(o(864e5)).floor();let h="";b.gt(o(0))&&(h+=`${b.toString()}d `),$.gt(o(0))&&(h+=`${$.toString()}h `),h+=`${H.toString()}m ${J.toString()}s`,L(h)};M();const G=setInterval(M,1e3);return()=>clearInterval(G)},[t.startTime]);const N={display:"flex",justifyContent:"space-between",padding:"8px 0",borderBottom:"1px dashed rgba(0,0,0,0.1)",fontSize:"0.9rem"},R={fontSize:"1rem",color:"var(--accent-color)",marginTop:"15px",borderBottom:"2px solid var(--border-color)",paddingBottom:"2px",marginBottom:"5px"},E=(I=t.weather)!=null&&I.current&&((k=ut[t.weather.current])==null?void 0:k.name)||"Unknown";return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"500px",maxHeight:"90vh",display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx("h2",{style:{flexShrink:0},children:"üìä Royal Records"}),e.jsxs("div",{style:{textAlign:"left",marginBottom:"20px",overflowY:"auto",paddingRight:"10px",flex:1,minHeight:0},children:[e.jsx("h3",{style:R,children:"‚ö° Current Status"}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Gold Per Second:"}),e.jsxs("strong",{style:{color:"var(--success-color)"},children:[j(l,t.numberFormat)," / sec"]})]}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Click Power:"}),e.jsxs("strong",{style:{color:"var(--success-color)"},children:[j(u,t.numberFormat)," / click"]})]}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Current Weather:"}),e.jsx("strong",{children:E})]}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Renown Bonus:"}),e.jsxs("strong",{style:{color:"#673ab7"},children:["+",ae(t.renown).minus(o(1)).times(o(100)).toNumber().toString(),"%"]})]}),e.jsx("h3",{style:R,children:"‚è≥ Time & Legacy"}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Time Played:"}),e.jsx("strong",{children:O})]}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Kingdom Founded:"}),e.jsx("span",{children:new Date(t.startTime.toNumber()).toLocaleDateString()})]}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Total Renown:"}),e.jsx("strong",{children:j(t.renown,t.numberFormat)})]}),e.jsx("h3",{style:R,children:"üí∞ Economy Summary"}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Current Gold:"}),e.jsx("strong",{children:j(t.gold,t.numberFormat)})]}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Lifetime Gold:"}),e.jsx("strong",{children:j(t.totalGold,t.numberFormat)})]}),e.jsx("h3",{style:R,children:"üè∞ Dominion"}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Total Buildings:"}),e.jsx("strong",{children:j(S,t.numberFormat)})]}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Highest Tech Building:"}),e.jsx("strong",{children:f})]}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Most Numerous:"}),e.jsxs("strong",{children:[y," (",j(w,t.numberFormat),")"]})]}),e.jsx("h3",{style:R,children:"‚öîÔ∏è Workforce & Court"}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Total Workforce:"}),e.jsxs("strong",{children:[j(t.soldiers,t.numberFormat)," Laborers"]})]}),e.jsx("h3",{style:R,children:"üìà Player Stats"}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Manual Clicks:"}),e.jsx("span",{children:j(t.stats.totalClicks,t.numberFormat)})]}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Dragons Slain:"}),e.jsx("span",{children:j(t.stats.dragonsKilled,t.numberFormat)})]}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Tavern Games:"}),e.jsx("span",{children:j(t.stats.tavernGamesPlayed,t.numberFormat)})]}),e.jsx("h3",{style:R,children:"üéñÔ∏è Completion"}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Achievements:"}),e.jsxs("span",{children:[m," / ",d," (",Math.floor(m/d*100),"%)"]})]}),e.jsx("h3",{style:R,children:"üèÜ Achievements"}),e.jsx(dt,{gameState:t})]}),e.jsx("button",{className:"btn",style:{background:"#5d4037",width:"100%",flexShrink:0},onClick:g,children:"Close Records"})]})})},St=[0,10,25,50,100,150,200,250,300,350,400,450,500,550,550,600],kt=({gameState:t,onStartProject:l,onUpgradeClickPower:g,onUpgradeOffline:S,onClose:m})=>{const[d,f]=x.useState("infrastructure");if(!(t.buildings.field||o(0)).gt(0))return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("h2",{children:"üèóÔ∏è National Projects"}),e.jsxs("div",{style:{padding:"20px",color:"var(--text-secondary)"},children:[e.jsx("div",{style:{fontSize:"3rem",marginBottom:"10px"},children:"üîí"}),e.jsx("p",{children:"You must establish a functioning economy before launching national projects."}),e.jsx("p",{style:{fontWeight:"bold",color:"var(--accent-color)"},children:"Requirement: Build a Wheat Field."})]}),e.jsx("button",{className:"btn",onClick:m,children:"Close"})]})});const w=()=>e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"15px"},children:mt.map(u=>{var B,Y,q,K;const O=t.buildings[u.id]||o(0);if(O.lt(10))return null;const L=t.nationalProjects[u.id]||{level:0,active:!1,startTime:0,endTime:0},N=L.level,R=N>=fe,E=L.active,I=N+1,k=Ue(u.id,I),M=Ye(I),G=St[I]||0,W=O.gte(G),_=t.gold.gte(k.gold),J=t.soldiers.gte(k.laborers),V=!k.carpenter.gt(0)||((B=t.eliteUnits.carpenter)==null?void 0:B.gte(k.carpenter)),H=!k.mason.gt(0)||((Y=t.eliteUnits.mason)==null?void 0:Y.gte(k.mason)),U=!k.architect.gt(0)||((q=t.eliteUnits.architect)==null?void 0:q.gte(k.architect)),$=_&&J&&V&&H&&U&&W;let b=0,h=0;if(E){const Z=Date.now(),D=L.endTime-L.startTime,c=Z-L.startTime;b=Math.min(100,c/D*100),h=Math.max(0,Math.ceil((L.endTime-Z)/1e3))}const A=((K=ie.find(Z=>Z.id===u.id))==null?void 0:K.name)||"Building";return e.jsxs("div",{style:{border:"2px solid var(--border-color)",borderRadius:"8px",background:E?"#fff8e1":"var(--bg-color)",overflow:"hidden",position:"relative"},children:[e.jsxs("div",{style:{padding:"10px",background:E?"var(--gold-color)":"rgba(0,0,0,0.05)",color:E?"#fff":"var(--text-color)",fontWeight:"bold",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:u.name}),e.jsxs("span",{children:["Lvl ",N," / ",fe]})]}),e.jsxs("div",{style:{padding:"15px"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginBottom:"10px",fontStyle:"italic"},children:u.description}),e.jsxs("div",{style:{marginBottom:"10px",fontSize:"0.9rem",color:"var(--success-color)",fontWeight:"bold"},children:["Current Bonus: +",(N*$e*100).toFixed(0),"% Global"]}),E?e.jsxs("div",{children:[e.jsx("div",{style:{width:"100%",height:"10px",background:"#ccc",borderRadius:"5px",overflow:"hidden",marginBottom:"5px"},children:e.jsx("div",{style:{width:`${b}%`,height:"100%",background:"var(--success-color)",transition:"width 1s linear"}})}),e.jsxs("div",{style:{textAlign:"center",fontSize:"0.8rem"},children:["Under Construction... ",Math.floor(h/3600),"h ",Math.floor(h%3600/60),"m"]})]}):R?e.jsx("div",{style:{textAlign:"center",padding:"10px",color:"var(--gold-color)",fontWeight:"bold",border:"1px solid var(--gold-color)",borderRadius:"4px",background:"rgba(255, 215, 0, 0.1)"},children:"MAXIMUM LEVEL REACHED"}):e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"0.85rem",marginBottom:"10px",background:"rgba(255,255,255,0.5)",padding:"5px",borderRadius:"4px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"Next Level Requirements:"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"5px"},children:[e.jsxs("span",{style:{color:_?"green":"red"},children:["üí∞ ",j(k.gold)," Gold"]}),e.jsxs("span",{style:{color:J?"green":"red"},children:["üë∑ ",j(k.laborers)," Laborers"]}),k.carpenter.gt(0)&&e.jsxs("span",{style:{color:V?"green":"red"},children:["ü™ö ",j(k.carpenter)," Carpenters"]}),k.mason.gt(0)&&e.jsxs("span",{style:{color:H?"green":"red"},children:["üß± ",j(k.mason)," Masons"]}),k.architect.gt(0)&&e.jsxs("span",{style:{color:U?"green":"red"},children:["üìê ",j(k.architect)," Architects"]}),e.jsxs("span",{style:{color:W?"green":"red"},children:["üè† ",j(o(G))," ",A,"s"]})]}),e.jsxs("div",{style:{marginTop:"5px",fontSize:"0.8rem"},children:["‚è≥ Duration: ",Math.floor(M/3600),"h ",Math.floor(M%3600/60),"m"]})]}),e.jsx("button",{className:"btn",style:{width:"100%",background:$?"var(--accent-color)":"var(--border-color)",cursor:$?"pointer":"not-allowed"},disabled:!$,onClick:()=>l(u.id),children:"Start Project (Units Consumed)"})]})]})]},u.id)})}),F=()=>{const u=t.clickUpgradeLevel||0,O=u>=ye,L=u+1,N=_e(L),R=t.gold.gte(N),E=o(2).pow(Math.min(u,15)),I=ve(u),k=I>0?`${j(E)} + ${(I*100).toFixed(1)}% of GPS`:j(E),M=o(2).pow(Math.min(L,15)),G=ve(L),W=G>0?`${j(M)} + ${(G*100).toFixed(1)}% of GPS`:j(M),_=t.offlineUpgradeLevel||0,J=_>=be,V=_+1,H=He(V),U=t.renown.gte(H),{efficiency:$,duration:b}=je(_),{efficiency:h,duration:A}=je(V),B=Y=>{const q=Math.floor(Y/3600),K=Math.floor(Y%3600/60);return q>0?`${q}h ${K}m`:`${K}m`};return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"15px"},children:[e.jsxs("div",{style:{border:"2px solid var(--border-color)",borderRadius:"8px",background:"var(--bg-color)",overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"10px",background:"rgba(0,0,0,0.05)",color:"var(--text-color)",fontWeight:"bold",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"üëë Royal Scepter"}),e.jsxs("span",{children:["Lvl ",u," / ",ye]})]}),e.jsxs("div",{style:{padding:"15px"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginBottom:"10px",fontStyle:"italic"},children:"Enhance your royal authority to increase click power."}),e.jsxs("div",{style:{marginBottom:"10px",fontSize:"0.9rem",color:"var(--success-color)",fontWeight:"bold"},children:["Current Power: ",k]}),O?e.jsx("div",{style:{textAlign:"center",padding:"10px",color:"var(--gold-color)",fontWeight:"bold",border:"1px solid var(--gold-color)",borderRadius:"4px",background:"rgba(255, 215, 0, 0.1)"},children:"MAXIMUM LEVEL REACHED"}):e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"0.85rem",marginBottom:"10px",background:"rgba(255,255,255,0.5)",padding:"5px",borderRadius:"4px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"Next Level:"}),e.jsxs("div",{style:{marginBottom:"5px"},children:["Power: ",W]}),e.jsxs("div",{style:{color:R?"green":"red",fontWeight:"bold"},children:["üí∞ ",j(N)," Gold"]})]}),e.jsx("button",{className:"btn",style:{width:"100%",background:R?"var(--accent-color)":"var(--border-color)",cursor:R?"pointer":"not-allowed"},disabled:!R,onClick:g,children:"Upgrade Scepter"})]})]})]}),e.jsxs("div",{style:{border:"2px solid var(--border-color)",borderRadius:"8px",background:"var(--bg-color)",overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"10px",background:"rgba(0,0,0,0.05)",color:"var(--text-color)",fontWeight:"bold",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"üí§ Offline Production"}),e.jsxs("span",{children:["Lvl ",_," / ",be]})]}),e.jsxs("div",{style:{padding:"15px"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginBottom:"10px",fontStyle:"italic"},children:"Improve the efficiency of your kingdom while you are away."}),e.jsxs("div",{style:{marginBottom:"10px",fontSize:"0.9rem",color:"var(--success-color)",fontWeight:"bold"},children:["Current: ",($*100).toFixed(0),"% for ",B(b)]}),J?e.jsx("div",{style:{textAlign:"center",padding:"10px",color:"var(--gold-color)",fontWeight:"bold",border:"1px solid var(--gold-color)",borderRadius:"4px",background:"rgba(255, 215, 0, 0.1)"},children:"MAXIMUM LEVEL REACHED"}):e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"0.85rem",marginBottom:"10px",background:"rgba(255,255,255,0.5)",padding:"5px",borderRadius:"4px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"Next Level:"}),e.jsxs("div",{style:{marginBottom:"5px"},children:["Effect: ",(h*100).toFixed(0),"% for ",B(A)]}),e.jsxs("div",{style:{color:U?"#673ab7":"red",fontWeight:"bold"},children:["üëë ",j(H)," Renown"]})]}),e.jsx("button",{className:"btn",style:{width:"100%",background:U?"#673ab7":"var(--border-color)",cursor:U?"pointer":"not-allowed"},disabled:!U,onClick:S,children:"Upgrade Passive Income"})]})]})]})]})};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"1000px",width:"95%",height:"85vh",display:"flex",flexDirection:"column",padding:"0"},children:[e.jsxs("div",{style:{padding:"20px",background:"var(--accent-color)",color:"var(--text-on-accent)"},children:[e.jsx("h2",{style:{margin:0,border:"none",color:"var(--gold-color)"},children:"üèõÔ∏è National Projects"}),e.jsx("p",{style:{margin:"5px 0 0 0",fontSize:"0.9rem",opacity:.9},children:"Invest resources to permanently improve your kingdom's power. All improvements persist through prestige."})]}),e.jsxs("div",{style:{display:"flex",background:"var(--bg-color)",borderBottom:"2px solid var(--border-color)",padding:"0 20px"},children:[e.jsx("button",{className:"btn",style:{background:d==="infrastructure"?"var(--accent-color)":"transparent",border:"none",borderBottom:d==="infrastructure"?"3px solid var(--gold-color)":"3px solid transparent",borderRadius:"0",padding:"15px 20px",margin:"0",fontWeight:"bold",color:d==="infrastructure"?"var(--text-on-accent)":"var(--text-color)"},onClick:()=>f("infrastructure"),children:"üèóÔ∏è Infrastructure"}),e.jsx("button",{className:"btn",style:{background:d==="royalScepter"?"var(--accent-color)":"transparent",border:"none",borderBottom:d==="royalScepter"?"3px solid var(--gold-color)":"3px solid transparent",borderRadius:"0",padding:"15px 20px",margin:"0",fontWeight:"bold",color:d==="royalScepter"?"var(--text-on-accent)":"var(--text-color)"},onClick:()=>f("royalScepter"),children:"üëë Royal Scepter"})]}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"20px",background:"var(--panel-bg)"},children:[d==="infrastructure"&&w(),d==="royalScepter"&&F()]}),e.jsx("div",{style:{padding:"15px",borderTop:"1px solid var(--border-color)",textAlign:"right",background:"var(--bg-color)"},children:e.jsx("button",{className:"btn",onClick:m,children:"Return to Kingdom"})})]})})},Tt=({toasts:t})=>e.jsx("div",{className:"toast-container",children:t.map(l=>e.jsxs("div",{className:`toast ${l.type}`,children:[l.type==="success"&&"‚úÖ",l.type==="warning"&&"‚ö†Ô∏è",l.type==="info"&&"‚ÑπÔ∏è",l.type==="error"&&"‚ùå",e.jsx("span",{children:l.message})]},l.id))}),Nt=()=>{const[t,l]=x.useState(null);if(x.useEffect(()=>{const S=f=>{const T=f.target.closest("[data-tooltip]");if(T){const w=T.getAttribute("data-tooltip");w&&l({text:w,x:f.clientX,y:f.clientY})}else l(null)},m=f=>{t&&l(y=>y?{...y,x:f.clientX,y:f.clientY}:null)},d=()=>{l(null)};return document.addEventListener("mouseover",S),document.addEventListener("mousemove",m),document.addEventListener("mouseout",d),()=>{document.removeEventListener("mouseover",S),document.removeEventListener("mousemove",m),document.removeEventListener("mouseout",d)}},[t]),!t)return null;const g={left:t.x+15,top:t.y+15};return t.x+250>window.innerWidth&&(g.left=t.x-260),t.y+100>window.innerHeight&&(g.top=t.y-50),e.jsx("div",{className:"game-tooltip",style:g,children:t.text.split(`
`).map((S,m)=>e.jsx("div",{style:{marginBottom:m===t.text.split(`
`).length-1?0:"4px"},children:S},m))})},Et={apiKey:"AIzaSyA1Dw5M2Zk8bpTCjlU2Tuifvx0ZI3IeRv0",authDomain:"kingdomclicker-156dc.firebaseapp.com",projectId:"kingdomclicker-156dc",storageBucket:"kingdomclicker-156dc.firebasestorage.app",messagingSenderId:"496461589742",appId:"1:496461589742:web:e6413dfa2d1bbabd3ad7ff"},Pt=ht(Et),xe=gt(Pt);function Rt(){return`#${Math.floor(Math.random()*99999).toString().padStart(5,"0")}`}function Lt(){const t=new Date,l=t.getDay(),g=t.getDate()-l+(l===0?-6:1);return new Date(t.setDate(g))}async function Bt(t){try{console.log("üöÄ –ù–∞—á–∏–Ω–∞—é –æ—Ç–ø—Ä–∞–≤–∫—É –¥–∞–Ω–Ω—ã—Ö –≤ –ª–∏–¥–µ—Ä–±–æ—Ä–¥:",{rulerName:t.rulerName,rulerId:t.rulerId,gold:t.gold.toString(),renown:t.renown.toString(),buildings:t.buildings,achievements:t.achievements});const l={...t,period:"alltime"},g={...t,period:"weekly"};console.log("üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ leaderboard_alltime...");const S=Me(xe,"leaderboard_alltime",t.rulerId);await Ae(S,{...l,gold:Number(l.gold.toString()),renown:Number(l.renown.toString()),timestamp:De()}),console.log("‚úÖ –£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ leaderboard_alltime, ID:",t.rulerId),console.log("üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ leaderboard_weekly...");const m=Me(xe,"leaderboard_weekly",t.rulerId);return await Ae(m,{...g,gold:Number(g.gold.toString()),renown:Number(g.renown.toString()),timestamp:De()}),console.log("‚úÖ –£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ leaderboard_weekly, ID:",t.rulerId),console.log("üéâ –î–∞–Ω–Ω—ã–µ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!"),{allTimeId:t.rulerId,weeklyId:t.rulerId}}catch(l){throw console.error("‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –ª–∏–¥–µ—Ä–±–æ—Ä–¥:"),console.error("–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:",l),l instanceof Error&&(console.error("–°–æ–æ–±—â–µ–Ω–∏–µ –æ—à–∏–±–∫–∏:",l.message),console.error("–°—Ç–µ–∫ –æ—à–∏–±–∫–∏:",l.stack)),"code"in l&&(console.error("–ö–æ–¥ –æ—à–∏–±–∫–∏ Firebase:",l.code),console.error("–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:",l.customData)),l}}async function Mt(t=100){try{console.log("üîç –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö all-time –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞...");const l=Je(Ve(xe,"leaderboard_alltime"),Xe("gold","desc"),qe(t));console.log("üì° –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –∫ Firestore...");const g=await Ke(l);console.log("üìä –ü–æ–ª—É—á–µ–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:",g.docs.length);const S=g.docs.map(m=>{const d=m.data();return{id:m.id,...d,gold:d.gold instanceof oe?d.gold:new oe(d.gold),renown:d.renown instanceof oe?d.renown:new oe(d.renown),timestamp:d.timestamp}});return console.log("‚úÖ All-time –ª–∏–¥–µ—Ä–±–æ—Ä–¥ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω, –∑–∞–ø–∏—Å–µ–π:",S.length),S}catch(l){throw console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ all-time –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞:"),console.error("–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:",l),l instanceof Error&&(console.error("–°–æ–æ–±—â–µ–Ω–∏–µ –æ—à–∏–±–∫–∏:",l.message),console.error("–°—Ç–µ–∫ –æ—à–∏–±–∫–∏:",l.stack)),"code"in l&&console.error("–ö–æ–¥ –æ—à–∏–±–∫–∏ Firebase:",l.code),l}}async function At(t=100){try{console.log("üîç –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö weekly –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞...");const l=Lt();console.log("üìÖ –ù–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏:",l.toISOString());const g=Je(Ve(xe,"leaderboard_weekly"),Xe("gold","desc"),qe(t));console.log("üì° –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –∫ Firestore...");const S=await Ke(g);console.log("üìä –ü–æ–ª—É—á–µ–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–æ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:",S.docs.length);const d=S.docs.map(f=>{const y=f.data();return{id:f.id,...y,gold:y.gold instanceof oe?y.gold:new oe(y.gold),renown:y.renown instanceof oe?y.renown:new oe(y.renown),timestamp:y.timestamp}}).filter(f=>{var w,F;const y=((F=(w=f.timestamp)==null?void 0:w.toDate)==null?void 0:F.call(w))||new Date(f.timestamp),T=y>=l;return T||console.log("üóëÔ∏è –ó–∞–ø–∏—Å—å –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–∞ (—Å—Ç–∞—Ä–∞—è –¥–∞—Ç–∞):",y.toISOString()),T});return console.log("‚úÖ Weekly –ª–∏–¥–µ—Ä–±–æ—Ä–¥ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω, –∑–∞–ø–∏—Å–µ–π –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:",d.length),d}catch(l){throw console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ weekly –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞:"),console.error("–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:",l),l instanceof Error&&(console.error("–°–æ–æ–±—â–µ–Ω–∏–µ –æ—à–∏–±–∫–∏:",l.message),console.error("–°—Ç–µ–∫ –æ—à–∏–±–∫–∏:",l.stack)),"code"in l&&console.error("–ö–æ–¥ –æ—à–∏–±–∫–∏ Firebase:",l.code),l}}const Dt=({isOpen:t,onClose:l,onConfirm:g,gameState:S})=>{const[m,d]=x.useState(""),[f,y]=x.useState(!1);if(!t)return null;const T=async()=>{if(m.trim().length<3){alert("Ruler name must contain at least 3 characters!");return}if(m.trim().length>20){alert("Ruler name must not exceed 20 characters!");return}y(!0);try{const F={id:`player_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,rulerName:m.trim(),rulerId:Rt(),lastLeaderboardView:0,lastLeaderboardSubmit:0,hasChosenName:!0};g(F),l()}catch{alert("An error occurred while creating profile. Please try again.")}finally{y(!1)}};return e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{backgroundColor:"#fdf6e3",border:"4px solid #8d6e63",borderRadius:"8px",padding:"32px",maxWidth:"500px",width:"90%",textAlign:"center",fontFamily:"Georgia, serif"},children:[e.jsx("h2",{style:{color:"#3e2723",marginBottom:"16px"},children:"üëë Royal Coronation! üëë"}),e.jsxs("p",{style:{color:"#5d4037",marginBottom:"24px",lineHeight:"1.5"},children:["Congratulations! Your kingdom has reached ",e.jsx("strong",{children:It(S.gold)})," gold!",e.jsx("br",{}),"It's time to choose a name for your ruler and enter the history books!"]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("label",{style:{display:"block",color:"#3e2723",marginBottom:"8px",fontWeight:"bold"},children:"Ruler Name:"}),e.jsx("input",{type:"text",value:m,onChange:w=>d(w.target.value),placeholder:"Enter your name...",maxLength:20,style:{width:"100%",padding:"12px",border:"2px solid #a1887f",borderRadius:"4px",fontSize:"16px",fontFamily:"Arial, sans-serif",backgroundColor:"#fff",color:"#3e2723"},onKeyPress:w=>w.key==="Enter"&&T()}),e.jsxs("div",{style:{fontSize:"12px",color:"#8d6e63",marginTop:"4px",textAlign:"left"},children:[m.length,"/20 characters"]})]}),e.jsx("div",{style:{backgroundColor:"#fff3e0",border:"2px solid #bf9000",borderRadius:"4px",padding:"12px",marginBottom:"24px"},children:e.jsx("p",{style:{color:"#bf9000",margin:0,fontSize:"14px",fontWeight:"bold"},children:"‚ö†Ô∏è Important: You'll be able to join the leaderboard and compete with players from around the world!"})}),e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[e.jsx("button",{type:"button",onClick:T,disabled:f||m.trim().length<3,style:{padding:"12px 24px",backgroundColor:f||m.trim().length<3?"#cccccc":"#2e7d32",color:"white",border:"none",borderRadius:"4px",fontSize:"16px",fontWeight:"bold",cursor:f||m.trim().length<3?"not-allowed":"pointer",fontFamily:"Georgia, serif"},children:f?"Creating profile...":"Ascend the Throne"}),e.jsx("button",{type:"button",onClick:l,style:{padding:"12px 24px",backgroundColor:"#c62828",color:"white",border:"none",borderRadius:"4px",fontSize:"16px",cursor:"pointer",fontFamily:"Georgia, serif",transition:"background-color 0.2s"},onMouseOver:w=>{w.currentTarget.style.backgroundColor="#d32f2f"},onMouseOut:w=>{w.currentTarget.style.backgroundColor="#c62828"},children:"Later"})]})]})})};function It(t){return t.lt(1e3)?t.toFixed(0):t.lt(1e6)?t.toNumber().toLocaleString():t.toExponential(2)}const zt=({isOpen:t,onClose:l,playerProfile:g,onOpenRulerNameModal:S,gameState:m})=>{const[d,f]=x.useState([]),[y,T]=x.useState([]),[w,F]=x.useState("alltime"),[u,O]=x.useState(!1),[L,N]=x.useState(null),[R,E]=x.useState(0),[I,k]=x.useState(0),M=()=>{const b=localStorage.getItem("leaderboardCache");if(b)try{const{data:h,timestamp:A}=JSON.parse(b),B=Date.now(),Y=3600*1e3;if(B-A<Y&&h&&h.allTime&&h.weekly)return h}catch(h){console.error("Cache parse error:",h)}return null},G=b=>{const h={data:b,timestamp:Date.now()};localStorage.setItem("leaderboardCache",JSON.stringify(h)),k(Date.now())},W=()=>{const b=localStorage.getItem("leaderboardCache");if(b){const{timestamp:h}=JSON.parse(b),A=Date.now(),B=3600*1e3;return A-h<B}return!1};x.useEffect(()=>{if(t){if(W())try{const b=M();if(b){f(b.allTime),T(b.weekly);const h=JSON.parse(localStorage.getItem("leaderboardCache"));k(h.timestamp);return}}catch(b){console.error("Cache read error:",b)}_()}},[t]);const _=async()=>{O(!0),N(null);try{const b=new Promise((B,Y)=>setTimeout(()=>Y(new Error("Loading timeout")),1e4)),[h,A]=await Promise.all([Promise.race([Mt(50),b]),Promise.race([At(50),b])]);f(h),T(A),G({allTime:h,weekly:A}),console.log("Leaderboard data loaded successfully!")}catch(b){console.error("Error loading leaderboard:",b),N("Failed to load leaderboard. Please check your internet connection and try again.")}finally{O(!1)}},J=b=>{switch(b){case 1:return"ü•á";case 2:return"ü•à";case 3:return"ü•â";default:return`#${b}`}},V=()=>g?(w==="alltime"?d:y).findIndex(h=>h.rulerId===g.rulerId)+1:-1,H=()=>{const b=w==="alltime"?d:y;if(b.length>0){let h=0;if(b.forEach(A=>{if(A.timestamp){let B=0;typeof A.timestamp=="object"&&A.timestamp.toDate?B=A.timestamp.toDate().getTime():typeof A.timestamp=="number"?B=A.timestamp:typeof A.timestamp=="string"&&(B=new Date(A.timestamp).getTime()),B>h&&(h=B)}}),h>0)return h}return I},U=w==="alltime"?d:y,$=U.length>0;return t?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"800px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h2",{children:"üèÜ Leaderboard üèÜ"}),e.jsx("button",{className:"btn",onClick:l,children:"Close"})]}),!g&&e.jsxs("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"15px",marginBottom:"16px",textAlign:"center"},children:[e.jsx("h4",{style:{color:"var(--gold-color)",margin:"0 0 8px 0",fontSize:"14px"},children:"üëÅ View Only Mode"}),e.jsxs("p",{style:{color:"var(--text-secondary)",margin:"0",fontSize:"12px",lineHeight:"1.4"},children:[e.jsx("strong",{children:"Anyone can view leaderboard!"})," Choose a name at 10M gold to participate."]}),S&&m&&m.gold&&m.gold.gte(1e7)&&e.jsx("button",{className:"btn",onClick:()=>{l(),S()},style:{backgroundColor:"var(--accent-color)",padding:"6px 12px",fontSize:"12px",marginTop:"8px"},children:"üëë Choose Ruler Name"})]}),$&&e.jsx("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"12px",marginBottom:"16px",textAlign:"center",fontSize:"12px"},children:e.jsxs("span",{style:{color:"var(--gold-color)"},children:["üìä Data updated ",Math.floor((Date.now()-H())/6e4)," minutes ago"]})}),u&&e.jsx("div",{style:{textAlign:"center",padding:"20px",color:"var(--text-secondary)"},children:"Loading leaderboard data..."}),L&&e.jsx("div",{style:{textAlign:"center",padding:"20px",color:"var(--danger-color)"},children:L}),g&&$&&e.jsxs("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"12px",marginBottom:"16px",textAlign:"center"},children:[e.jsxs("div",{style:{color:"var(--gold-color)",fontSize:"14px",fontWeight:"bold"},children:["üëë You are playing as: ",g.rulerName," ",g.rulerId]}),U.length>0&&e.jsxs("div",{style:{color:"var(--text-secondary)",fontSize:"12px",marginTop:"5px"},children:["Your Rank: ",V()>0?`#${V()}`:"Not ranked yet"," in ",w==="alltime"?"All Time":"Weekly"]})]}),$&&e.jsxs("div",{style:{display:"flex",marginBottom:"16px",borderBottom:"2px solid var(--border-color)"},children:[e.jsx("button",{onClick:()=>F("alltime"),className:w==="alltime"?"tab-btn active":"tab-btn",children:"All Time"}),e.jsx("button",{onClick:()=>F("weekly"),className:w==="weekly"?"tab-btn active":"tab-btn",children:"This Week"})]}),$&&!u&&!L&&e.jsx("div",{style:{maxHeight:"400px",overflowY:"auto",border:"2px solid var(--border-color)",borderRadius:"4px",backgroundColor:"var(--panel-bg)"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{style:{backgroundColor:"var(--accent-color)",color:"white",position:"sticky",top:0},children:e.jsxs("tr",{children:[e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Rank"}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Ruler"}),e.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Gold"}),e.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Renown"}),e.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Buildings"})]})}),e.jsx("tbody",{children:U.map((b,h)=>e.jsxs("tr",{style:{backgroundColor:(g==null?void 0:g.rulerId)===b.rulerId?"rgba(191, 144, 0, 0.1)":h%2===0?"rgba(0, 0, 0, 0.02)":"transparent",borderBottom:"1px solid var(--border-color)"},children:[e.jsx("td",{style:{padding:"10px",fontWeight:"bold",color:"var(--text-color)"},children:J(h+1)}),e.jsx("td",{style:{padding:"10px",color:"var(--text-color)"},children:e.jsxs("div",{children:[e.jsx("strong",{children:b.rulerName}),e.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:b.rulerId})]})}),e.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--gold-color)",fontWeight:"bold"},children:j(b.gold,"standard")}),e.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--text-secondary)"},children:j(b.renown,"standard")}),e.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--text-secondary)"},children:b.buildings})]},b.id))})]})}),e.jsx("div",{style:{marginTop:"16px",fontSize:"12px",color:"var(--text-secondary)",textAlign:"center"},children:"üí° Leaderboard updates automatically every hour. Data is cached for performance."})]})}):null},ne={density:"normal",fontSize:"medium",showFloatingText:!0,showWeatherWidget:!0,reduceMotion:!1,crownAnimations:!0,lastBuyAmount:o(1),layout:{left:o(1),center:o(1),right:o(1)},borderWidth:o(4),customColors:{enabled:!1,bg:"#e8dcc5",panel:"#fdf6e3",text:"#3e2723",secondaryText:"#5d4037",accent:"#8d6e63",accentHover:"#6d4c41",gold:"#bf9000",border:"#a1887f",success:"#2e7d32",danger:"#c62828"}},le={gold:o(0),totalGold:o(0),startTime:o(Date.now()),lastSaveTime:o(Date.now()),buildings:{},achievements:[],renown:o(0),prestigeCount:0,soldiers:o(0),eliteUnits:{},nationalProjects:{},clickUpgradeLevel:0,offlineUpgradeLevel:0,weather:{current:"clear",timeLeft:o(120)},event:null,theme:"default",numberFormat:"standard",idleModeEnabled:!0,interface:ne,stats:{totalClicks:o(0),dragonsKilled:o(0),tavernGamesPlayed:o(0)},playerProfile:null},ue=t=>{if(t==null||typeof t=="string"||typeof t=="number"||typeof t=="boolean")return t;if(Array.isArray(t))return t.map(ue);if(typeof t=="object"&&t.toString&&typeof t.toString=="function"&&(t.hasOwnProperty("mantissa")||t.hasOwnProperty("exponent")))return t.toString();if(typeof t=="object"){const l={};for(const g in t)t.hasOwnProperty(g)&&(l[g]=ue(t[g]));return l}return t},_t=()=>{var Re;const[t,l]=x.useState(()=>{var n,s,a,v,C,p;const r=localStorage.getItem("kingdom_save");if(r)try{const i=JSON.parse(r),P=i.interface||{},z={...ne,...P,lastBuyAmount:o(P.lastBuyAmount??1),crownAnimations:P.crownAnimations??!0,layout:{left:o(((n=P.layout)==null?void 0:n.left)??ne.layout.left),center:o(((s=P.layout)==null?void 0:s.center)??ne.layout.center),right:o(((a=P.layout)==null?void 0:a.right)??ne.layout.right)},borderWidth:o(P.borderWidth??ne.borderWidth),customColors:{...ne.customColors,...P.customColors||{}}};return{...le,...i,renown:o(i.renown||0),prestigeCount:i.prestigeCount||0,gold:o(i.gold||0),totalGold:o(i.totalGold||0),startTime:o(i.startTime||Date.now()),lastSaveTime:o(i.lastSaveTime||Date.now()),soldiers:o(i.soldiers||0),buildings:Object.keys(i.buildings||{}).reduce((X,Q)=>(X[Q]=o(i.buildings[Q]),X),{}),stats:{...le.stats,...i.stats||{},totalClicks:o(((v=i.stats)==null?void 0:v.totalClicks)||0),dragonsKilled:o(((C=i.stats)==null?void 0:C.dragonsKilled)||0),tavernGamesPlayed:o(((p=i.stats)==null?void 0:p.tavernGamesPlayed)||0)},eliteUnits:Object.keys(i.eliteUnits||{}).reduce((X,Q)=>(X[Q]=o(i.eliteUnits[Q]),X),{}),nationalProjects:i.nationalProjects||{},clickUpgradeLevel:i.clickUpgradeLevel||0,offlineUpgradeLevel:i.offlineUpgradeLevel||0,weather:i.weather?{...i.weather,timeLeft:o(Number(i.weather.timeLeft)||120)}:le.weather,theme:i.theme||"default",numberFormat:i.numberFormat||"standard",idleModeEnabled:i.idleModeEnabled!==void 0?i.idleModeEnabled:!0,interface:z,playerProfile:i.playerProfile?{...i.playerProfile,lastLeaderboardSubmit:i.playerProfile.lastLeaderboardSubmit||0}:null}}catch(i){console.error("Save load failed",i)}return le}),g=x.useRef(t);x.useEffect(()=>{g.current=t},[t]);const S=x.useRef("");x.useEffect(()=>{const r=n=>{S.current=(S.current+n.key).slice(-20);const s=S.current.toLowerCase();s.endsWith("godon")?(l(a=>({...a,godMode:!0})),D("God Mode Enabled: +99999s per click","success"),S.current=""):s.endsWith("godoff")&&(l(a=>({...a,godMode:!1})),D("God Mode Disabled","info"),S.current="")};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[]);const[m,d]=x.useState(!1);x.useEffect(()=>{let r;const n=()=>{d(!1),clearTimeout(r),t.idleModeEnabled&&(r=setTimeout(()=>{d(!0)},2e4))};n();const s=["mousemove","mousedown","keydown","touchstart","scroll"];return s.forEach(a=>window.addEventListener(a,n)),()=>{clearTimeout(r),s.forEach(a=>window.removeEventListener(a,n))}},[t.idleModeEnabled]),x.useEffect(()=>{const r=j(t.gold);document.title=`Gold: ${r} - Kingdom Clicker`},[t.gold]),x.useEffect(()=>{var C;const r=document.documentElement,n=t.interface||ne;if((C=n.customColors)!=null&&C.enabled){const p=n.customColors;r.style.setProperty("--bg-color",p.bg),r.style.setProperty("--panel-bg",p.panel),r.style.setProperty("--text-color",p.text),r.style.setProperty("--text-secondary",p.secondaryText||"#5d4037"),r.style.setProperty("--text-on-accent","#ffffff"),r.style.setProperty("--accent-color",p.accent),r.style.setProperty("--accent-hover",p.accentHover||p.accent),r.style.setProperty("--gold-color",p.gold||"#bf9000"),r.style.setProperty("--border-color",p.border),r.style.setProperty("--success-color",p.success||"#2e7d32"),r.style.setProperty("--danger-color",p.danger||"#c62828"),r.style.setProperty("--bg-image","none")}else{const p=t.theme||"default",i=pe[p]||pe.default;i&&Object.entries(i.colors).forEach(([P,z])=>{r.style.setProperty(P,z)})}const s={small:"14px",medium:"16px",large:"18px"};r.style.setProperty("--base-font-size",s[n.fontSize]);const a={compact:"8px",normal:"12px",spacious:"20px"},v={compact:"6px",normal:"12px",spacious:"16px"};r.style.setProperty("--panel-padding",a[n.density]),r.style.setProperty("--gap-size",v[n.density]),r.style.setProperty("--custom-border-width",`${n.borderWidth}px`),r.style.setProperty("--col-left",String(n.layout.left)),r.style.setProperty("--col-center",String(n.layout.center)),r.style.setProperty("--col-right",String(n.layout.right)),n.reduceMotion?document.body.classList.add("no-motion"):document.body.classList.remove("no-motion")},[t.theme,t.interface]);const[f,y]=x.useState(!1);x.useEffect(()=>{var r;t.gold.gte(o(1e7))&&!((r=t.playerProfile)!=null&&r.hasChosenName)&&!f&&q(!0)},[t.gold,t.playerProfile,f]);const[T,w]=x.useState(null),[F,u]=x.useState([]),[O,L]=x.useState("buildings"),[N,R]=x.useState("army"),[E,I]=x.useState(!1),[k,M]=x.useState("throne");x.useEffect(()=>{const r=()=>{I(window.innerWidth<768)};return r(),window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]);const[G,W]=x.useState(!1),[_,J]=x.useState(!1),[V,H]=x.useState(!1),[U,$]=x.useState(!1),[b,h]=x.useState(!1),[A,B]=x.useState(!1),[Y,q]=x.useState(!1),[K,Z]=x.useState(!1),D=(r,n="info")=>{const s=Date.now().toString()+Math.random();u(a=>[...a,{id:s,message:r,type:n}]),setTimeout(()=>{u(a=>a.filter(v=>v.id!==s))},3e3)};x.useEffect(()=>{const r=Date.now();if(t.lastSaveTime&&o(r).minus(t.lastSaveTime).gt(o(6e4))){const n=o(r).minus(t.lastSaveTime).dividedBy(o(1e3)),{efficiency:s,duration:a}=je(t.offlineUpgradeLevel||0),v=o(a),C=oe.min(n,v),i=c(t).times(o(s)).times(C).floor();i.gt(o(0))&&(D(`While you were away (${j(C,"plain")}s), you earned ${j(i,t.numberFormat)} gold! (Efficiency: ${(s*100).toFixed(0)}%)`,"success"),l(P=>({...P,gold:P.gold.plus(i),totalGold:P.totalGold.plus(i)})))}},[]),x.useEffect(()=>{const r=setInterval(()=>{Date.now()%3e4<1e3&&l(n=>{const s={...n,lastSaveTime:o(Date.now())},a=ue(s);return localStorage.setItem("kingdom_save",JSON.stringify(a)),s})},1e3);return()=>clearInterval(r)},[]),x.useEffect(()=>{const r=()=>{const s=g.current,a=ue(s);localStorage.setItem("kingdom_save",JSON.stringify(a))};window.addEventListener("beforeunload",r);const n=()=>{document.visibilityState==="hidden"&&r()};return document.addEventListener("visibilitychange",n),()=>{window.removeEventListener("beforeunload",r),document.removeEventListener("visibilitychange",n)}},[]),x.useEffect(()=>{var n;if(!((n=t.playerProfile)!=null&&n.hasChosenName))return;const r=setInterval(()=>{var p;const s=g.current,a=Date.now(),v=((p=s.playerProfile)==null?void 0:p.lastLeaderboardSubmit)||0,C=3600*1e3;a-v>=C&&Bt({rulerName:s.playerProfile.rulerName,rulerId:s.playerProfile.rulerId,gold:s.gold,renown:s.renown,buildings:Object.keys(s.buildings).length,achievements:s.achievements.length,period:"alltime"}).then(()=>{l(i=>({...i,playerProfile:{...i.playerProfile,lastLeaderboardSubmit:Date.now()}})),D("Leaderboard data submitted successfully!","success")}).catch(i=>{console.error("Auto leaderboard submission failed:",i)})},6e4);return()=>clearInterval(r)},[(Re=t.playerProfile)==null?void 0:Re.hasChosenName]),x.useEffect(()=>{const r=setInterval(()=>{if(!t.event&&Math.random()<.05){const a=["dragon","merchant","jester"],v=a[Math.floor(Math.random()*a.length)],C={id:Date.now().toString(),type:v,expiresAt:o(Date.now()).plus(o(v==="dragon"?1e4:3e4)),hp:v==="dragon"?o(10):void 0,maxHp:v==="dragon"?o(10):void 0,reward:o(0)};l(p=>({...p,event:C}))}},1e4);return()=>clearInterval(r)},[t.event]);const c=r=>{var p;let n=o(0);const s=((p=r.weather)==null?void 0:p.current)||"clear";ie.forEach(i=>{const P=r.buildings[i.id]||o(0);let z=i.baseProduction;s==="sunny"?(i.id==="peasant"||i.id==="field"||i.id==="stable"||i.id==="cathedral")&&(z=z.times(o(1.2))):s==="rainy"?(i.id==="silver_mine"||i.id==="alchemist"||i.id==="market"||i.id==="tavern")&&(z=z.times(o(1.2))):s==="stormy"?((i.id==="blacksmith"||i.id==="void_portal")&&(z=z.times(o(1.3))),(i.id==="field"||i.id==="stable")&&(z=z.times(o(.8)))):s==="windy"&&(i.id==="market"||i.id==="castle"||i.id==="time_chamber")&&(z=z.times(o(1.15))),n=n.plus(P.times(z))});let a=0;r.nationalProjects&&Object.values(r.nationalProjects).forEach(i=>{a+=i.level||0});let v=o(1);const C=o(1).plus(o(a*$e));return v=v.times(C),v=v.times(ae(r.renown).plus(o(r.achievements.length*.02))),n=n.times(v),n},te=c(t),de=x.useRef(te);de.current=te,x.useEffect(()=>{const r=setInterval(()=>{l(n=>{const s=Date.now(),a=de.current.times(o(he)).dividedBy(o(1e3));let v=n.totalGold.plus(a),C=n.gold.plus(a),p={...n.weather};const i=o(he/1e3);if(p.timeLeft=p.timeLeft.minus(i),p.timeLeft.lte(o(0))){const ee=["clear","sunny","rainy","stormy","windy"],re=ee[Math.floor(Math.random()*ee.length)],me=o(Math.floor(Math.random()*120)+60);p={current:re,timeLeft:me}}let P=n.event;P&&P.expiresAt&&o(P.expiresAt).lt(o(s))&&(P=null);let z={...n.nationalProjects||{}};Object.keys(z).forEach(ee=>{var me;const re=z[ee];re.active&&re.endTime&&s>=re.endTime&&(z[ee]={...re,active:!1,level:re.level+1,startTime:0,endTime:0},D(`Project Completed: ${(me=ie.find(lt=>lt.id===ee))==null?void 0:me.name} Infrastructure Level ${re.level+1}!`,"success"))});const X=[...n.achievements];let Q=null;return Ge.forEach(ee=>{X.includes(ee.id)||ee.condition({...n,totalGold:v,gold:C},de.current)&&(X.push(ee.id),Q=ee)}),Q&&(w(Q),setTimeout(()=>w(null),3e3)),{...n,gold:C,totalGold:v,achievements:X,event:P,soldiers:n.soldiers,weather:p,nationalProjects:z}})},he);return()=>clearInterval(r)},[]);const se=(r="light")=>{if("vibrate"in navigator&&E)switch(r){case"light":navigator.vibrate(10);break;case"medium":navigator.vibrate(20);break;case"heavy":navigator.vibrate([30,10,30]);break}},we=(r=!1)=>{r||se("light");const n=Ze(g.current);l(s=>({...s,gold:s.gold.plus(n),totalGold:s.totalGold.plus(n),stats:{...s.stats,totalClicks:r?s.stats.totalClicks:s.stats.totalClicks.plus(o(1))}}))},Ze=r=>{const n=ae(r.renown),s=o(1),a=r.clickUpgradeLevel||0,v=Math.min(a,15),C=o(2).pow(v),p=s.times(C),i=c(r),P=ve(a),z=i.times(P);let X=p.plus(z);if(X=X.times(n),r.godMode){const Q=i.times(o(99999));X=X.plus(Q)}return X},Qe=()=>{const r=t.clickUpgradeLevel||0;if(r>=ye){D("Maximum Royal Scepter level reached!","warning");return}const n=_e(r+1);if(t.gold.lt(n)){D("Not enough gold!","error");return}l(s=>({...s,gold:s.gold.minus(n),clickUpgradeLevel:s.clickUpgradeLevel+1})),D(`Royal Scepter upgraded to level ${r+1}!`,"success")},et=()=>{const r=t.offlineUpgradeLevel||0;if(r>=be){D("Maximum Passive Income level reached!","warning");return}const n=He(r+1);if(t.renown.lt(n)){D("Not enough Renown!","error");return}l(s=>({...s,renown:s.renown.minus(n),offlineUpgradeLevel:s.offlineUpgradeLevel+1})),D(`Passive Income upgraded to level ${r+1}!`,"success")},Ce=(r,n)=>{const s=ie.find(C=>C.id===r);if(!s||n<=0)return;const a=t.buildings[r]||o(0),v=Le(s.baseCost,a,o(n)).floor();t.gold.gte(v)&&(se("medium"),l(C=>({...C,gold:C.gold.minus(v),buildings:{...C.buildings,[r]:(C.buildings[r]||o(0)).plus(o(n))}})))},Se=(r,n)=>{const s=ie.find(p=>p.id===r);if(!s||n<=0)return;const a=t.buildings[r]||o(0),v=o(Math.min(n,a.toNumber()));if(v.lte(o(0)))return;const C=Le(s.baseCost,a.minus(v),v).times(o(.25)).floor();l(p=>({...p,gold:p.gold.plus(C),buildings:{...p.buildings,[r]:a.minus(v)}}))},ke=r=>{const n=Be.times(o(r));t.gold.gte(n)&&l(s=>({...s,gold:s.gold.minus(n),soldiers:s.soldiers.plus(n.dividedBy(Be))}))},Te=(r,n)=>{const s=xt.find(C=>C.id===r);if(!s)return;const a=s.goldCost.times(o(n)),v=s.soldierCost.times(o(n));t.gold.gte(a)&&t.soldiers.gte(v)&&l(C=>({...C,gold:C.gold.minus(a),soldiers:C.soldiers.minus(v),eliteUnits:{...C.eliteUnits,[r]:(C.eliteUnits[r]||o(0)).plus(o(n))}}))},Ne=r=>{if(r.type==="merchant"){const n=de.current.times(o(10));l(s=>({...s,gold:s.gold.plus(n),totalGold:s.totalGold.plus(n),event:null})),D(`The merchant gifted you ${j(n.floor(),t.numberFormat)} gold!`,"success")}else if(r.type==="jester"){const n=t.gold.times(o(.1)),s=Math.random()>.5;l(a=>({...a,gold:s?a.gold.plus(n):a.gold.minus(n),totalGold:s?a.totalGold.plus(n):a.totalGold,event:null})),s?D(`Jester pays out! +${j(n.floor(),t.numberFormat)}`,"success"):D(`Jester tricked you! -${j(n.floor(),t.numberFormat)}`,"warning")}else if(r.type==="dragon"){let n=!1;l(s=>{if(!s.event||s.event.type!=="dragon")return s;const a=(s.event.hp||o(1)).minus(o(1));if(a.lte(0)){const v=de.current.times(o(30));return n=!0,{...s,gold:s.gold.plus(v),totalGold:s.totalGold.plus(v),event:null,stats:{...s.stats,dragonsKilled:s.stats.dragonsKilled.plus(o(1))}}}return{...s,event:{...s.event,hp:a}}}),n&&D("Dragon Slain! +Treasury Boost","success")}},tt=()=>{const r=o(1),n=o(1e12),s=t.totalGold;if(s.lt(n))return;const a=s.dividedBy(n),C=o(Math.floor(Math.pow(a.toNumber(),.33))).times(r).minus(t.renown);if(C.lte(0))return;const p={...t.nationalProjects};Object.keys(p).forEach(i=>{p[i].active&&(p[i]={...p[i],active:!1,startTime:0,endTime:0})}),l({...le,renown:t.renown.plus(C),prestigeCount:t.prestigeCount+1,totalGold:t.totalGold,achievements:t.achievements,nationalProjects:p,offlineUpgradeLevel:t.offlineUpgradeLevel,playerProfile:t.playerProfile,startTime:o(Date.now()),lastSaveTime:o(Date.now()),theme:t.theme,idleModeEnabled:t.idleModeEnabled,interface:t.interface}),J(!1),D("Abdication Successful. Long live the new King!","success")},ot=()=>{localStorage.removeItem("kingdom_save"),l({...le,startTime:o(Date.now())}),H(!1),D("Game Reset","warning")},rt=()=>{const n=ue(t);localStorage.setItem("kingdom_save",JSON.stringify(n)),D("Game Saved","info")},nt=r=>{l(n=>({...n,playerProfile:r})),localStorage.setItem(`playerProfile_${r.id}`,JSON.stringify(r)),D(`Welcome, ${r.rulerName} ${r.rulerId}!`,"success"),y(!1)},st=async()=>{tt()},Ee=r=>{l(n=>({...n,interface:{...n.interface,lastBuyAmount:r}}))},Pe=r=>({flex:r==="left"?"var(--col-left)":"var(--col-right)",display:"flex",flexDirection:"column",borderRight:r==="left"?"var(--custom-border-width) double var(--border-color)":"none",borderLeft:r==="right"?"var(--custom-border-width) double var(--border-color)":"none",background:"var(--panel-bg)",minWidth:0,transition:"transform 0.8s ease-in-out",transform:m&&t.idleModeEnabled?r==="left"?"translateX(-120%)":"translateX(120%)":"translateX(0)",zIndex:10});return e.jsxs("div",{style:{display:"flex",height:"100dvh",width:"100vw",backgroundColor:"var(--bg-color)",overflow:"hidden",position:"relative",flexDirection:E?"column":"row"},children:[e.jsx(Tt,{toasts:F}),e.jsx(Nt,{}),m&&t.idleModeEnabled&&e.jsx(pt,{gameState:t}),!E&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:Pe("left"),children:[e.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)"},children:e.jsx("button",{className:`tab-btn ${O==="buildings"?"active":""}`,onClick:()=>L("buildings"),children:"Estates"})}),e.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden"},children:O==="buildings"&&e.jsx(Ie,{gameState:t,onBuyBuilding:Ce,onSellBuilding:Se,onSetBuyAmount:Ee})})]}),e.jsx("div",{style:{flex:"var(--col-center)",display:"flex",flexDirection:"column",position:"relative",borderRight:m&&t.idleModeEnabled?"none":"var(--custom-border-width) double var(--border-color)",minWidth:0,zIndex:5,transition:"border 0.8s"},children:e.jsx(ze,{gameState:t,gps:te,onClick:()=>we(!1),onEventInteract:Ne,onOpenTavern:()=>W(!0),onOpenPrestige:()=>J(!0),onOpenSettings:()=>H(!0),onOpenStatistics:()=>h(!0),onOpenLeaderboard:()=>{Z(!0)},onOpenEmpire:()=>B(!0),isIdle:m&&t.idleModeEnabled})}),e.jsxs("div",{style:Pe("right"),children:[e.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)"},children:e.jsx("button",{className:`tab-btn ${N==="army"?"active":""}`,onClick:()=>R("army"),children:"Workforce"})}),e.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden"},children:N==="army"&&e.jsx(We,{gameState:t,onTrainSoldier:ke,onTrainElite:Te})})]})]}),E&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",position:"relative",minHeight:0,height:"100%"},children:[k==="buildings"&&e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0},children:[e.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:e.jsx("button",{className:"tab-btn active",onClick:()=>{},children:"Estates"})}),e.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:e.jsx(Ie,{gameState:t,onBuyBuilding:Ce,onSellBuilding:Se,onSetBuyAmount:Ee})})]}),k==="throne"&&e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,height:"100%"},children:e.jsx(ze,{gameState:t,gps:te,onClick:()=>we(!1),onEventInteract:Ne,onOpenTavern:()=>W(!0),onOpenPrestige:()=>J(!0),onOpenSettings:()=>H(!0),onOpenStatistics:()=>h(!0),onOpenLeaderboard:()=>Z(!0),onOpenEmpire:()=>B(!0),isIdle:m&&t.idleModeEnabled})}),k==="army"&&e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0},children:[e.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:e.jsx("button",{className:"tab-btn active",children:"Workforce"})}),e.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:e.jsx(We,{gameState:t,onTrainSoldier:ke,onTrainElite:Te})})]}),k==="empire"&&e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,height:"100%"},children:e.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:e.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"var(--text-secondary)"},children:[e.jsx("h3",{children:"üèóÔ∏è National Projects"}),e.jsx("p",{children:"Construct massive infrastructure to boost global production."}),e.jsx("button",{className:"btn",onClick:()=>B(!0),style:{margin:"10px",padding:"15px 20px",fontSize:"16px"},children:"üèóÔ∏è Manage Projects"})]})})})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-around",alignItems:"center",height:"60px",backgroundColor:"var(--panel-bg)",borderTop:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:[e.jsxs("button",{className:`mobile-nav-btn ${k==="buildings"?"active":""}`,onClick:()=>{se("light"),M("buildings")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:k==="buildings"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[e.jsx("div",{style:{fontSize:"20px"},children:"üèòÔ∏è"}),e.jsx("div",{children:"Estates"})]}),e.jsxs("button",{className:`mobile-nav-btn ${k==="throne"?"active":""}`,onClick:()=>{se("light"),M("throne")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:k==="throne"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[e.jsx("div",{style:{fontSize:"20px"},children:"üëë"}),e.jsx("div",{children:"Throne"})]}),e.jsxs("button",{className:`mobile-nav-btn ${k==="army"?"active":""}`,onClick:()=>{se("light"),M("army")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:k==="army"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[e.jsx("div",{style:{fontSize:"20px"},children:"üë∑"}),e.jsx("div",{children:"Workforce"})]}),e.jsxs("button",{className:`mobile-nav-btn ${k==="empire"?"active":""}`,onClick:()=>{se("light"),M("empire")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:k==="empire"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[e.jsx("div",{style:{fontSize:"20px"},children:"üèóÔ∏è"}),e.jsx("div",{children:"Projects"})]})]})]}),!(m&&t.idleModeEnabled)&&T&&e.jsxs("div",{className:"achievement-popup",children:[e.jsx("div",{style:{fontSize:"2rem"},children:T.icon}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",color:"var(--text-color)"},children:"Achievement Unlocked!"}),e.jsx("div",{style:{color:"var(--accent-color)"},children:T.name})]})]}),A&&e.jsx(kt,{gameState:t,onClose:()=>B(!1),onStartProject:r=>{var v,C,p,i;const n=((v=t.nationalProjects[r])==null?void 0:v.level)||0;if(n>=fe)return;const s=Ue(r,n+1);if(t.gold.lt(s.gold)||t.soldiers.lt(s.laborers)||(C=t.eliteUnits.carpenter)!=null&&C.lt(s.carpenter||0)||(p=t.eliteUnits.mason)!=null&&p.lt(s.mason||0)||(i=t.eliteUnits.architect)!=null&&i.lt(s.architect||0))return;const a=Ye(n+1);l(P=>({...P,gold:P.gold.minus(s.gold),soldiers:P.soldiers.minus(s.laborers),eliteUnits:{...P.eliteUnits,carpenter:(P.eliteUnits.carpenter||o(0)).minus(s.carpenter||0),mason:(P.eliteUnits.mason||o(0)).minus(s.mason||0),architect:(P.eliteUnits.architect||o(0)).minus(s.architect||0)},nationalProjects:{...P.nationalProjects,[r]:{level:n,active:!0,startTime:Date.now(),endTime:Date.now()+a*1e3}}})),D("Construction started!","info")},onUpgradeClickPower:Qe,onUpgradeOffline:et}),G&&e.jsx(vt,{gameState:t,onGamble:(r,n)=>{const s=o(r);l(a=>({...a,gold:n?a.gold.plus(s):a.gold.minus(s),stats:{...a.stats,tavernGamesPlayed:a.stats.tavernGamesPlayed.plus(o(1))}}))},onClose:()=>W(!1)}),_&&e.jsx(jt,{gameState:t,onPrestige:st,onClose:()=>J(!1)}),V&&e.jsx(wt,{gameState:t,onClose:()=>H(!1),onHardReset:ot,onSave:rt,onOpenChangelog:()=>$(!0),onSetTheme:r=>l(n=>({...n,theme:r})),onSetNumberFormat:r=>l(n=>({...n,numberFormat:r})),onToggleIdleMode:()=>l(r=>({...r,idleModeEnabled:!r.idleModeEnabled})),onUpdateInterface:r=>l(n=>({...n,interface:{...n.interface,...r}}))}),b&&e.jsx(Ct,{gameState:t,currentGps:te,onClose:()=>h(!1)}),U&&e.jsx(ct,{onClose:()=>$(!1)}),Y&&e.jsx(Dt,{isOpen:Y,onClose:()=>{q(!1),y(!0)},onConfirm:nt,gameState:t}),K&&e.jsx(zt,{isOpen:K,onClose:()=>Z(!1),playerProfile:t.playerProfile})]})};export{_t as A,bt as R,e as j,x as r};
