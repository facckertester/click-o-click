import{r as at,g as dt}from"./vendor-B--z-fyW.js";import{T as ye}from"./types-BcRHhxXE.js";import{g as le,A as ct,C as ut}from"./ui-B7hxfxpW.js";import{t as o,f as j,T as be,A as Ge,g as Oe,a as K,B as he,W as mt,b as $e,N as ht,c as _e,M as je,P as He,d as Ue,e as xt,h as Re,U as gt,S as Ae}from"./constants-CBbNB8eo.js";import{i as pt,g as ft,d as Be,s as Pe,a as De,q as Ye,c as Je,o as qe,l as Ve,b as Xe,e as Z}from"./game-BSflrnjg.js";import{I as yt,B as Me,M as Ie,A as ze}from"./components-C7FJjLNS.js";var ve={exports:{}},me={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fe;function vt(){if(Fe)return me;Fe=1;var t=Symbol.for("react.transitional.element"),s=Symbol.for("react.fragment");function y(c,g,m){var b=null;if(m!==void 0&&(b=""+m),g.key!==void 0&&(b=""+g.key),"key"in g){m={};for(var h in g)h!=="key"&&(m[h]=g[h])}else m=g;return g=m.ref,{$$typeof:t,type:c,key:b,ref:g!==void 0?g:null,props:m}}return me.Fragment=s,me.jsx=y,me.jsxs=y,me}var We;function bt(){return We||(We=1,ve.exports=vt()),ve.exports}var e=bt(),f=at();const jt=dt(f),wt=({gameState:t,onGamble:s,onClose:y})=>{const[c,g]=f.useState("coin"),[m,b]=f.useState(10),[h,w]=f.useState(""),[x,P]=f.useState(null),d=()=>{if(t.gold.lt(o(m))){w("Not enough gold!");return}const B=Math.random()>.5;s(m,B),w(B?`Heads! You DOUBLED your money! (+${j(m,t.numberFormat)} Profit)`:`Tails... You lost ${j(m,t.numberFormat)} gold.`),P(null)},O=()=>{if(t.gold.lt(o(m))){w("Not enough gold!");return}const B=Math.floor(Math.random()*6)+1,N=Math.floor(Math.random()*6)+1,L=B+N;P(L);let R=0;if(L===7)w(`Rolled ${L}. A draw! Gold returned.`),s(0,!0);else if(L>7){L>=10?R=2:R=1.5;const E=Math.floor(m*R);s(E,!0),w(`Rolled ${L}! You won ${j(E,t.numberFormat)} gold!`)}else s(m,!1),w(`Rolled ${L}. You lost ${j(m,t.numberFormat)} gold.`)};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{minHeight:"450px"},children:[e.jsx("h2",{style:{borderBottom:"none"},children:"üç∫ The Rusty Tankard"}),e.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"20px",justifyContent:"center"},children:[e.jsx("button",{className:"btn ",style:{opacity:c==="coin"?1:.6},onClick:()=>g("coin"),children:"Coin Flip"}),e.jsx("button",{className:"btn ",style:{opacity:c==="dice"?1:.6},onClick:()=>g("dice"),children:"High Dice"})]}),e.jsxs("div",{style:{background:"var(--panel-bg)",padding:"20px",borderRadius:"8px",border:"var(--custom-border-width) solid var(--border-color)"},children:[c==="coin"?e.jsxs("div",{style:{textAlign:"left",background:"var(--bg-color)",padding:"10px",borderRadius:"4px",color:"var(--text-color)"},children:[e.jsx("strong",{children:"Rules:"}),e.jsxs("ul",{style:{margin:"5px 0",paddingLeft:"20px",color:"var(--text-color)"},children:[e.jsx("li",{children:"50% Chance to Win."}),e.jsxs("li",{children:["Win: ",e.jsx("strong",{children:"+100% Profit"})," (Doubles your money)."]}),e.jsx("li",{children:"Lose: Lost the bet."})]})]}):e.jsxs("div",{style:{textAlign:"left",background:"var(--bg-color)",padding:"10px",borderRadius:"4px",color:"var(--text-color)"},children:[e.jsx("strong",{children:"Dice Rules (Roll 2-12):"}),e.jsxs("ul",{style:{margin:"5px 0",paddingLeft:"20px",color:"var(--text-color)"},children:[e.jsxs("li",{children:[e.jsx("strong",{children:"7:"})," Draw (Bet returned)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"8-9:"})," Win +50% Profit (1.5x)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"10-12:"})," Win +100% Profit (2x)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"2-6:"})," Loss"]})]})]}),e.jsxs("div",{style:{margin:"20px 0",color:"var(--text-color)"},children:[e.jsx("label",{style:{color:"var(--text-color)"},children:"Bet Amount: "}),e.jsx("input",{type:"number",value:m,onChange:B=>b(Math.max(1,parseInt(B.target.value)||0)),style:{padding:"8px",width:"120px",fontSize:"1rem",border:"var(--custom-border-width) solid var(--border-color)",backgroundColor:"var(--panel-bg)",color:"var(--text-color)"}})]}),c==="dice"&&x!==null&&e.jsxs("div",{style:{fontSize:"3rem",margin:"10px",color:"var(--text-color)"},children:["üé≤ ",x]}),e.jsx("button",{className:"btn",style:{fontSize:"1.2rem",padding:"10px 30px"},onClick:c==="coin"?d:O,children:c==="coin"?"Flip Coin":"Roll Dice"}),h&&e.jsx("div",{style:{marginTop:"15px",fontWeight:"bold",fontSize:"1.1rem",color:h.includes("won")||h.includes("DOUBLED")||h.includes("draw")?"var(--success-color)":"var(--danger-color)"},children:h})]}),e.jsx("div",{style:{marginTop:"30px"},children:e.jsx("button",{className:"btn",onClick:y,children:"Leave Tavern"})})]})})},Ct=({gameState:t,onPrestige:s,onClose:y})=>{var R;const c=t.advisorLevels.void_scholar||o(0),m=1+(t.advisors.includes("void_scholar")?c.toNumber()*.1:0),b=o(1e12),h=t.totalGold;let w=o(0),x=!1,P=b.minus(h);if(h.gte(b)){const E=h.dividedBy(b);w=o(Math.floor(Math.pow(E.toNumber(),.33))).times(m),x=w.gt(0)}const d=b.times(Math.pow(Math.floor(w.dividedBy(m).toNumber()+1),3));d.minus(h);const B=le(t.renown).minus(o(1)).times(o(100)),L=le(t.renown.plus(w)).minus(o(1)).times(o(100));return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{border:"4px solid #673ab7"},children:[e.jsx("h2",{style:{color:"#673ab7"},children:"üëë Abdication"}),e.jsx("p",{children:"Are you ready to pass the crown to your heir?"}),!((R=t.playerProfile)!=null&&R.hasChosenName)&&e.jsxs("div",{style:{background:"rgba(255, 235, 59, 0.1)",border:"1px solid #ffc107",padding:"10px",borderRadius:"4px",marginBottom:"15px",fontSize:"0.9rem"},children:["üí° ",e.jsx("strong",{children:"Tip:"})," You can abdicate without choosing a ruler name. Choose a name only if you want to appear in the leaderboard."]}),e.jsxs("div",{style:{textAlign:"left",margin:"20px 0",background:"rgba(243, 229, 245, 0.5)",padding:"15px",borderRadius:"4px"},children:[e.jsx("div",{children:e.jsx("strong",{children:"You will lose:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"All Gold"}),e.jsx("li",{children:"All Buildings"}),e.jsx("li",{children:"All Gold Upgrades"}),e.jsx("li",{children:"Current Soldiers"})]}),e.jsx("div",{children:e.jsx("strong",{children:"You will keep:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"Achievements"}),e.jsx("li",{children:"Artifacts"}),e.jsxs("li",{children:["Current Renown (",j(t.renown,t.numberFormat),")"]}),e.jsx("li",{children:"All Renown Upgrades (Permanent)"})]})]}),e.jsxs("div",{style:{fontSize:"1.2rem",marginBottom:"20px"},children:[e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:["Current Renown: ",j(t.renown,t.numberFormat)]}),e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:["Total Gold Earned: ",j(h,t.numberFormat)]}),e.jsx("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:"Threshold for first prestige: 1,000,000,000,000 Gold"}),!x&&h.lt(b)&&e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"#cc0000"},children:["Need: ",j(P,t.numberFormat)," more Gold to unlock prestige"]}),x&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:[e.jsx("strong",{children:"Current:"})," ",j(t.renown,t.numberFormat)," Renown (+",B.toNumber().toFixed(1),"% bonus)"]}),e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:[e.jsx("strong",{children:"Gain:"})," ",j(w,t.numberFormat)," Renown (+",L.toNumber().toFixed(1),"% bonus)"]}),e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:[e.jsx("strong",{children:"Total:"})," ",j(t.renown.plus(w),t.numberFormat)," Renown (+",L.toNumber().toFixed(1),"% bonus)"]}),w.gt(0)&&e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginTop:"5px"},children:["Next Renown at: ",j(d,t.numberFormat)," gold"]})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("button",{className:"btn",style:{background:"#666"},onClick:y,children:"Cancel"}),e.jsx("button",{className:"btn",style:{background:"#673ab7"},onClick:s,disabled:!x,children:x?"Abdicate":h.lt(b)?`Need ${j(P,t.numberFormat)} more Gold to unlock prestige`:"Prestige Unavailable"})]})]})})},St=({gameState:t,onClose:s,onHardReset:y,onSave:c,onOpenChangelog:g,onSetTheme:m,onSetNumberFormat:b,onToggleIdleMode:h,onUpdateInterface:w})=>{var ie,ae,de,oe;const[x,P]=jt.useState(!1),d=t.interface||{density:"normal",fontSize:"medium",showFloatingText:!0,showWeatherWidget:!0,reduceMotion:!1,crownAnimations:!0,layout:{left:o(1),center:o(1),right:o(1)},borderWidth:o(4),customColors:{enabled:!1,bg:"",panel:"",text:"",accent:"",border:"",secondaryText:"",accentHover:"",gold:"",success:"",danger:""}},O=(ie=d.layout.left)!=null&&ie.toNumber?d.layout.left.toNumber():Number(d.layout.left),B=(ae=d.layout.center)!=null&&ae.toNumber?d.layout.center.toNumber():Number(d.layout.center),N=(de=d.layout.right)!=null&&de.toNumber?d.layout.right.toNumber():Number(d.layout.right),L=(oe=d.borderWidth)!=null&&oe.toNumber?d.borderWidth.toNumber():Number(d.borderWidth),R=d.customColors||{},E=String(R.bg||""),W=String(R.panel||""),D=String(R.text||""),z=String(R.secondaryText||""),F=String(R.accent||""),H=String(R.accentHover||""),V=String(R.gold||""),$=String(R.border||""),X=String(R.success||""),U=String(R.danger||""),J=()=>{x?y():P(!0)},S=(a,te)=>{w({layout:{...d.layout,[a]:o(te)}})},k=(a,te)=>{w({customColors:{...d.customColors,[a]:te}})},A={display:"flex",gap:"5px",flexWrap:"wrap",justifyContent:"center"},I={marginBottom:"8px",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px",background:"rgba(0,0,0,0.03)",borderRadius:"4px"},Y={width:"100%",marginBottom:"5px"};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("h2",{children:"‚öôÔ∏è Royal Settings"}),t.playerProfile&&e.jsxs("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"12px",marginBottom:"20px",textAlign:"center"},children:[e.jsxs("div",{style:{color:"var(--gold-color)",fontSize:"16px",fontWeight:"bold"},children:["üëë Your Ruler: ",t.playerProfile.rulerName," ",t.playerProfile.rulerId]}),e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"12px",marginTop:"5px"},children:"Registered in Leaderboard System"})]}),e.jsxs("div",{style:{textAlign:"left",marginBottom:"20px",maxHeight:"60vh",overflowY:"auto",paddingRight:"5px"},children:[e.jsx("h3",{style:{marginBottom:"10px"},children:"Layout Configuration"}),e.jsxs("div",{style:{marginBottom:"15px",background:"rgba(0,0,0,0.03)",padding:"10px",borderRadius:"4px"},children:[e.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Column Widths (Ratio)"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"10px",alignItems:"center",marginBottom:"5px"},children:[e.jsx("span",{style:{fontSize:"0.8rem"},children:"Left"}),e.jsx("input",{type:"range",min:"1",max:"5",step:"0.5",value:O,onChange:a=>S("left",parseFloat(a.target.value)),style:Y}),e.jsx("span",{style:{fontSize:"0.8rem"},children:O})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"10px",alignItems:"center",marginBottom:"5px"},children:[e.jsx("span",{style:{fontSize:"0.8rem"},children:"Center"}),e.jsx("input",{type:"range",min:"1",max:"5",step:"0.5",value:B,onChange:a=>S("center",parseFloat(a.target.value)),style:Y}),e.jsx("span",{style:{fontSize:"0.8rem"},children:B})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"10px",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:"0.8rem"},children:"Right"}),e.jsx("input",{type:"range",min:"1",max:"5",step:"0.5",value:N,onChange:a=>S("right",parseFloat(a.target.value)),style:Y}),e.jsx("span",{style:{fontSize:"0.8rem"},children:N})]})]}),e.jsx("h3",{style:{marginBottom:"10px"},children:"Design Studio"}),e.jsxs("div",{style:I,children:[e.jsx("div",{children:e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Border Thickness"})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("input",{type:"range",min:"1",max:"10",value:L,onChange:a=>w({borderWidth:o(parseInt(a.target.value))})}),e.jsxs("span",{children:[L,"px"]})]})]}),e.jsxs("div",{style:I,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Enable Custom Colors"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Override theme colors."})]}),e.jsx("input",{type:"checkbox",checked:d.customColors.enabled,onChange:a=>k("enabled",a.target.checked),style:{transform:"scale(1.5)"}})]}),d.customColors.enabled&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",marginBottom:"15px"},children:[e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Background",e.jsx("input",{type:"color",value:E,onChange:a=>k("bg",a.target.value),style:{width:"100%"}})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Panels",e.jsx("input",{type:"color",value:W,onChange:a=>k("panel",a.target.value),style:{width:"100%"}})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Borders",e.jsx("input",{type:"color",value:$,onChange:a=>k("border",a.target.value),style:{width:"100%"}})]}),e.jsx("div",{style:{gridColumn:"1 / -1",height:"1px",background:"#ccc",margin:"5px 0"}}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Primary Text",e.jsx("input",{type:"color",value:D,onChange:a=>k("text",a.target.value),style:{width:"100%"}})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Secondary Text",e.jsx("input",{type:"color",value:z,onChange:a=>k("secondaryText",a.target.value),style:{width:"100%"}})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Gold/Value",e.jsx("input",{type:"color",value:V,onChange:a=>k("gold",a.target.value),style:{width:"100%"}})]}),e.jsx("div",{style:{gridColumn:"1 / -1",height:"1px",background:"#ccc",margin:"5px 0"}}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Accent/Buttons",e.jsx("input",{type:"color",value:F,onChange:a=>k("accent",a.target.value),style:{width:"100%"}})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Button Hover",e.jsx("input",{type:"color",value:H,onChange:a=>k("accentHover",a.target.value),style:{width:"100%"}})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Success/Green",e.jsx("input",{type:"color",value:X,onChange:a=>k("success",a.target.value),style:{width:"100%"}})]}),e.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:"0.8rem"},children:["Danger/Red",e.jsx("input",{type:"color",value:U,onChange:a=>k("danger",a.target.value),style:{width:"100%"}})]})]}),e.jsx("div",{style:{borderTop:"1px dashed #ccc",margin:"15px 0"}}),e.jsxs("div",{style:{marginBottom:"15px",opacity:d.customColors.enabled?.5:1,pointerEvents:d.customColors.enabled?"none":"auto"},children:[e.jsxs("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:["Preset Themes ",d.customColors.enabled&&"(Disabled)"]}),e.jsx("div",{style:A,children:Object.values(be).map(a=>e.jsx("button",{className:"btn",style:{background:t.theme===a.id?"var(--accent-color)":"var(--panel-bg)",color:t.theme===a.id?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",flex:"1 1 auto",padding:"5px 10px"},onClick:()=>m(a.id),children:a.name},a.id))})]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Font Size"}),e.jsx("div",{style:A,children:["small","medium","large"].map(a=>e.jsx("button",{className:"btn",style:{background:d.fontSize===a?"var(--accent-color)":"var(--panel-bg)",color:d.fontSize===a?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",flex:"1 1 auto",textTransform:"capitalize"},onClick:()=>w({fontSize:a}),children:a},a))})]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Layout Density"}),e.jsx("div",{style:A,children:["compact","normal","spacious"].map(a=>e.jsx("button",{className:"btn",style:{background:d.density===a?"var(--accent-color)":"var(--panel-bg)",color:d.density===a?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",flex:"1 1 auto",textTransform:"capitalize"},onClick:()=>w({density:a}),children:a},a))})]}),e.jsx("div",{style:{borderTop:"1px dashed #ccc",margin:"15px 0"}}),e.jsxs("div",{style:I,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Cinematic Idle Mode"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show landscape when inactive."})]}),e.jsx("button",{className:"btn",style:{background:t.idleModeEnabled?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:h,children:t.idleModeEnabled?"ON":"OFF"})]}),e.jsxs("div",{style:I,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Click Text"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show floating numbers on click."})]}),e.jsx("button",{className:"btn",style:{background:d.showFloatingText?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>w({showFloatingText:!d.showFloatingText}),children:d.showFloatingText?"ON":"OFF"})]}),e.jsxs("div",{style:I,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Weather Widget"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show weather info in top left."})]}),e.jsx("button",{className:"btn",style:{background:d.showWeatherWidget?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>w({showWeatherWidget:!d.showWeatherWidget}),children:d.showWeatherWidget?"ON":"OFF"})]}),e.jsxs("div",{style:I,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Crown Animations"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show crown effects and animations."})]}),e.jsx("button",{className:"btn",style:{background:d.crownAnimations?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>w({crownAnimations:!d.crownAnimations}),children:d.crownAnimations?"ON":"OFF"})]}),e.jsxs("div",{style:I,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Reduce Motion"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Disable animations."})]}),e.jsx("button",{className:"btn",style:{background:d.reduceMotion?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>w({reduceMotion:!d.reduceMotion}),children:d.reduceMotion?"ON":"OFF"})]}),e.jsxs("div",{style:{marginTop:"15px"},children:[e.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Number Format"}),e.jsx("div",{style:A,children:["standard","scientific","plain"].map(a=>e.jsx("button",{className:"btn",style:{background:t.numberFormat===a?"var(--accent-color)":"var(--panel-bg)",color:t.numberFormat===a?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",flex:"1 1 auto",padding:"5px 10px",textTransform:"capitalize"},onClick:()=>b(a),children:a},a))})]})]}),e.jsxs("div",{style:{borderTop:"2px solid #ccc",paddingTop:"15px",marginTop:"15px"},children:[e.jsx("h3",{children:"System"}),e.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"center",flexWrap:"wrap"},children:[e.jsx("button",{className:"btn",onClick:c,children:"Force Save"}),e.jsx("button",{className:"btn",style:{background:"#0288d1"},onClick:g,children:"Update Logs"}),e.jsx("button",{className:"btn",style:{backgroundColor:x?"red":"#d32f2f"},onClick:J,children:x?"CONFIRM WIPE?":"Hard Reset"})]}),x&&e.jsx("div",{style:{color:"red",fontSize:"0.8rem",marginTop:"5px"},children:"Warning: This will delete all progress permanently!"})]}),e.jsx("button",{className:"btn",style:{marginTop:"20px",background:"#5d4037",width:"100%"},onClick:s,children:"Return to Game"}),e.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)",marginTop:"10px"},children:"v2.3.0 - Kingdom Clicker"})]})})},kt=({gameState:t,onHireAdvisor:s,onClose:y})=>e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{border:"4px double #4a148c",maxWidth:"900px"},children:[e.jsx("h2",{style:{color:"#4a148c",borderBottomColor:"#4a148c"},children:"‚öñÔ∏è Royal Council"}),e.jsxs("div",{style:{marginBottom:"15px",color:"var(--text-secondary)",fontStyle:"italic"},children:["Hire permanent advisors with Renown. ",e.jsx("br",{}),"These buffs persist across abdications. Advisors can be upgraded for better effects."]}),e.jsxs("div",{style:{background:"rgba(103, 58, 183, 0.1)",padding:"10px",borderRadius:"4px",marginBottom:"20px",fontWeight:"bold",color:"#4a148c"},children:["Available Renown: ",j(t.renown,t.numberFormat)," üëë"]}),e.jsxs("div",{style:{marginBottom:"30px"},children:[e.jsx("h3",{style:{color:"#4a148c",marginBottom:"10px"},children:"üë• Royal Advisors"}),e.jsx("div",{style:{display:"grid",gap:"10px",maxHeight:"350px",overflowY:"auto"},children:Ge.map(c=>{const g=t.advisors.includes(c.id),m=t.advisorLevels[c.id]||o(0),b=Oe(c,m),h=!g&&t.renown.gte(c.cost),w=g&&t.renown.gte(b),x=K(c.id,m);return e.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"15px",border:`2px solid ${g?"#4a148c":"var(--border-color)"}`,background:g?"rgba(237, 231, 246, 0.5)":"var(--panel-bg)",borderRadius:"8px",opacity:g||h?1:.6},children:[e.jsx("div",{style:{fontSize:"2.5rem",marginRight:"15px"},children:c.icon}),e.jsxs("div",{style:{flex:1,textAlign:"left"},children:[e.jsxs("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:g?"#4a148c":"var(--text-color)"},children:[c.name," ",g&&`(Level ${j(m,t.numberFormat)})`]}),e.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:c.description}),g&&e.jsxs("div",{style:{fontSize:"0.8rem",color:"#4a148c",marginTop:"5px"},children:[c.id==="treasurer"&&`Auto-clicks every ${Math.max(.5,5-(m.toNumber()-1)*.5).toFixed(1)} seconds`,c.id==="warmaster"&&`Speed: +${j(x.times(o(100)),t.numberFormat)}%, Safety: +${j(x.times(o(100)),t.numberFormat)}%`,c.id==="guildmaster"&&`Discount: ${j(x.times(o(100)),t.numberFormat)}%`,c.id==="alchemist"&&`Event chance: x${j(x.plus(o(1)),t.numberFormat)}`,(c.id==="chronomancer"||c.id==="time_keeper")&&`Cooldown reduction: ${j(x.times(o(100)),t.numberFormat)}%`,c.id==="void_scholar"&&`Renown bonus: +${j(x.times(o(100)),t.numberFormat)}%`,c.id==="cosmic_mage"&&`Production bonus: +${j(x.times(o(100)),t.numberFormat)}%`]})]}),e.jsx("div",{style:{minWidth:"120px",textAlign:"right"},children:g?e.jsxs("button",{className:"btn",style:{background:w?"#4a148c":"var(--text-secondary)",fontSize:"0.8rem"},disabled:!w,onClick:()=>s(c.id),children:["Upgrade: ",j(b,t.numberFormat)," üëë"]}):e.jsxs("button",{className:"btn",style:{background:h?"#4a148c":"var(--text-secondary)"},disabled:!h,onClick:()=>s(c.id),children:["Hire: ",j(c.cost,t.numberFormat)," üëë"]})})]},c.id)})})]}),e.jsx("button",{className:"btn",style:{marginTop:"20px",background:"#5d4037"},onClick:y,children:"Close Council"})]})}),Tt=({gameState:t,currentGps:s,onClose:y})=>{var E,W;const c=Object.values(t.buildings).reduce((D,z)=>D.plus(z),o(0)),g=t.achievements.length,m=$e.length;let b="None",h="None",w=-1,x=o(0);he.forEach((D,z)=>{const F=t.buildings[D.id]||o(0);F.gt(o(0))&&z>w&&(w=z,b=D.name),F.gt(x)&&(x=F,h=D.name)});const d=(()=>{let D=o(1);return D=D.times(le(t.renown)),D})(),[O,B]=f.useState("");f.useEffect(()=>{const D=()=>{const F=o(Date.now()).minus(t.startTime),H=F.dividedBy(o(1e3)),V=H.minus(H.dividedBy(o(60)).floor().times(o(60))).floor(),$=F.dividedBy(o(6e4)),X=$.minus($.dividedBy(o(60)).floor().times(o(60))).floor(),U=F.dividedBy(o(36e5)),J=U.minus(U.dividedBy(o(24)).floor().times(o(24))).floor(),S=F.dividedBy(o(864e5)).floor();let k="";S.gt(o(0))&&(k+=`${S.toString()}d `),J.gt(o(0))&&(k+=`${J.toString()}h `),k+=`${X.toString()}m ${V.toString()}s`,B(k)};D();const z=setInterval(D,1e3);return()=>clearInterval(z)},[t.startTime]);const N={display:"flex",justifyContent:"space-between",padding:"8px 0",borderBottom:"1px dashed rgba(0,0,0,0.1)",fontSize:"0.9rem"},L={fontSize:"1rem",color:"var(--accent-color)",marginTop:"15px",borderBottom:"2px solid var(--border-color)",paddingBottom:"2px",marginBottom:"5px"},R=(E=t.weather)!=null&&E.current&&((W=mt[t.weather.current])==null?void 0:W.name)||"Unknown";return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"500px",maxHeight:"90vh",display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx("h2",{style:{flexShrink:0},children:"üìä Royal Records"}),e.jsxs("div",{style:{textAlign:"left",marginBottom:"20px",overflowY:"auto",paddingRight:"10px",flex:1,minHeight:0},children:[e.jsx("h3",{style:L,children:"‚ö° Current Status"}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Gold Per Second:"}),e.jsxs("strong",{style:{color:"var(--success-color)"},children:[j(s,t.numberFormat)," / sec"]})]}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Click Power:"}),e.jsxs("strong",{style:{color:"var(--success-color)"},children:[j(d,t.numberFormat)," / click"]})]}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Current Weather:"}),e.jsx("strong",{children:R})]}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Renown Bonus:"}),e.jsxs("strong",{style:{color:"#673ab7"},children:["+",le(t.renown).minus(o(1)).times(o(100)).toNumber().toString(),"%"]})]}),e.jsx("h3",{style:L,children:"‚è≥ Time & Legacy"}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Time Played:"}),e.jsx("strong",{children:O})]}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Kingdom Founded:"}),e.jsx("span",{children:new Date(t.startTime.toNumber()).toLocaleDateString()})]}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Total Renown:"}),e.jsx("strong",{children:j(t.renown,t.numberFormat)})]}),e.jsx("h3",{style:L,children:"üí∞ Economy Summary"}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Current Gold:"}),e.jsx("strong",{children:j(t.gold,t.numberFormat)})]}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Lifetime Gold:"}),e.jsx("strong",{children:j(t.totalGold,t.numberFormat)})]}),e.jsx("h3",{style:L,children:"üè∞ Dominion"}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Total Buildings:"}),e.jsx("strong",{children:j(c,t.numberFormat)})]}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Highest Tech Building:"}),e.jsx("strong",{children:b})]}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Most Numerous:"}),e.jsxs("strong",{children:[h," (",j(x,t.numberFormat),")"]})]}),e.jsx("h3",{style:L,children:"‚öîÔ∏è Workforce & Court"}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Total Workforce:"}),e.jsxs("strong",{children:[j(t.soldiers,t.numberFormat)," Laborers"]})]}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Royal Advisors:"}),e.jsxs("span",{children:[t.advisors.length," Hired"]})]}),e.jsx("h3",{style:L,children:"üìà Player Stats"}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Manual Clicks:"}),e.jsx("span",{children:j(t.stats.totalClicks,t.numberFormat)})]}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Dragons Slain:"}),e.jsx("span",{children:j(t.stats.dragonsKilled,t.numberFormat)})]}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Tavern Games:"}),e.jsx("span",{children:j(t.stats.tavernGamesPlayed,t.numberFormat)})]}),e.jsx("h3",{style:L,children:"üéñÔ∏è Completion"}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Achievements:"}),e.jsxs("span",{children:[g," / ",m," (",Math.floor(g/m*100),"%)"]})]}),e.jsxs("div",{style:N,children:[e.jsx("span",{children:"Artifacts:"}),e.jsxs("span",{children:[t.artifacts.length," Found"]})]}),e.jsx("h3",{style:L,children:"üèÜ Achievements"}),e.jsx(ct,{gameState:t})]}),e.jsx("button",{className:"btn",style:{background:"#5d4037",width:"100%",flexShrink:0},onClick:y,children:"Close Records"})]})})},Nt=({gameState:t,onStartProject:s,onClose:y})=>(t.buildings.field||o(0)).gt(0)?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"900px",width:"95%",height:"85vh",display:"flex",flexDirection:"column",padding:"0"},children:[e.jsxs("div",{style:{padding:"20px",background:"var(--accent-color)",color:"var(--text-on-accent)"},children:[e.jsx("h2",{style:{margin:0,border:"none",color:"var(--gold-color)"},children:"üèóÔ∏è National Projects"}),e.jsx("p",{style:{margin:"5px 0 0 0",fontSize:"0.9rem",opacity:.9},children:"Invest Workforce and Gold to permanently improve global production efficiency. Projects persist through prestige."})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",padding:"20px",background:"var(--panel-bg)"},children:e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"15px"},children:ht.map(m=>{var F,H,V;const b=t.nationalProjects[m.id]||{level:0,active:!1,startTime:0,endTime:0},h=b.level,w=h>=je,x=b.active,P=h+1,d=_e(m.id,P),O=Ue(P),B=t.gold.gte(d.gold),N=t.soldiers.gte(d.laborers),L=!d.carpenter.gt(0)||((F=t.eliteUnits.carpenter)==null?void 0:F.gte(d.carpenter)),R=!d.mason.gt(0)||((H=t.eliteUnits.mason)==null?void 0:H.gte(d.mason)),E=!d.architect.gt(0)||((V=t.eliteUnits.architect)==null?void 0:V.gte(d.architect)),W=B&&N&&L&&R&&E;let D=0,z=0;if(x){const $=Date.now(),X=b.endTime-b.startTime,U=$-b.startTime;D=Math.min(100,U/X*100),z=Math.max(0,Math.ceil((b.endTime-$)/1e3))}return e.jsxs("div",{style:{border:"2px solid var(--border-color)",borderRadius:"8px",background:x?"#fff8e1":"var(--bg-color)",overflow:"hidden",position:"relative"},children:[e.jsxs("div",{style:{padding:"10px",background:x?"var(--gold-color)":"rgba(0,0,0,0.05)",color:x?"#fff":"var(--text-color)",fontWeight:"bold",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:m.name}),e.jsxs("span",{children:["Lvl ",h," / ",je]})]}),e.jsxs("div",{style:{padding:"15px"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginBottom:"10px",fontStyle:"italic"},children:m.description}),e.jsxs("div",{style:{marginBottom:"10px",fontSize:"0.9rem",color:"var(--success-color)",fontWeight:"bold"},children:["Current Bonus: +",(h*He*100).toFixed(0),"% Global"]}),x?e.jsxs("div",{children:[e.jsx("div",{style:{width:"100%",height:"10px",background:"#ccc",borderRadius:"5px",overflow:"hidden",marginBottom:"5px"},children:e.jsx("div",{style:{width:`${D}%`,height:"100%",background:"var(--success-color)",transition:"width 1s linear"}})}),e.jsxs("div",{style:{textAlign:"center",fontSize:"0.8rem"},children:["Under Construction... ",Math.floor(z/3600),"h ",Math.floor(z%3600/60),"m"]})]}):w?e.jsx("div",{style:{textAlign:"center",padding:"10px",color:"var(--gold-color)",fontWeight:"bold",border:"1px solid var(--gold-color)",borderRadius:"4px",background:"rgba(255, 215, 0, 0.1)"},children:"MAXIMUM LEVEL REACHED"}):e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"0.85rem",marginBottom:"10px",background:"rgba(255,255,255,0.5)",padding:"5px",borderRadius:"4px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"Next Level Requirements:"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"5px"},children:[e.jsxs("span",{style:{color:B?"green":"red"},children:["üí∞ ",j(d.gold)," Gold"]}),e.jsxs("span",{style:{color:N?"green":"red"},children:["üë∑ ",j(d.laborers)," Laborers"]}),d.carpenter.gt(0)&&e.jsxs("span",{style:{color:L?"green":"red"},children:["ü™ö ",j(d.carpenter)," Carpenters"]}),d.mason.gt(0)&&e.jsxs("span",{style:{color:R?"green":"red"},children:["üß± ",j(d.mason)," Masons"]}),d.architect.gt(0)&&e.jsxs("span",{style:{color:E?"green":"red"},children:["üìê ",j(d.architect)," Architects"]})]}),e.jsxs("div",{style:{marginTop:"5px",fontSize:"0.8rem"},children:["‚è≥ Duration: ",Math.floor(O/3600),"h ",Math.floor(O%3600/60),"m"]})]}),e.jsx("button",{className:"btn",style:{width:"100%",background:W?"var(--accent-color)":"var(--border-color)",cursor:W?"pointer":"not-allowed"},disabled:!W,onClick:()=>s(m.id),children:"Start Project (Units Consumed)"})]})]})]},m.id)})})}),e.jsx("div",{style:{padding:"15px",borderTop:"1px solid var(--border-color)",textAlign:"right",background:"var(--bg-color)"},children:e.jsx("button",{className:"btn",onClick:y,children:"Return to Kingdom"})})]})}):e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("h2",{children:"üèóÔ∏è National Projects"}),e.jsxs("div",{style:{padding:"20px",color:"var(--text-secondary)"},children:[e.jsx("div",{style:{fontSize:"3rem",marginBottom:"10px"},children:"üîí"}),e.jsx("p",{children:"You must establish a functioning economy before launching national projects."}),e.jsx("p",{style:{fontWeight:"bold",color:"var(--accent-color)"},children:"Requirement: Build a Wheat Field."})]}),e.jsx("button",{className:"btn",onClick:y,children:"Close"})]})}),Lt=({toasts:t})=>e.jsx("div",{className:"toast-container",children:t.map(s=>e.jsxs("div",{className:`toast ${s.type}`,children:[s.type==="success"&&"‚úÖ",s.type==="warning"&&"‚ö†Ô∏è",s.type==="info"&&"‚ÑπÔ∏è",s.type==="error"&&"‚ùå",e.jsx("span",{children:s.message})]},s.id))}),Et=()=>{const[t,s]=f.useState(null);if(f.useEffect(()=>{const c=b=>{const w=b.target.closest("[data-tooltip]");if(w){const x=w.getAttribute("data-tooltip");x&&s({text:x,x:b.clientX,y:b.clientY})}else s(null)},g=b=>{t&&s(h=>h?{...h,x:b.clientX,y:b.clientY}:null)},m=()=>{s(null)};return document.addEventListener("mouseover",c),document.addEventListener("mousemove",g),document.addEventListener("mouseout",m),()=>{document.removeEventListener("mouseover",c),document.removeEventListener("mousemove",g),document.removeEventListener("mouseout",m)}},[t]),!t)return null;const y={left:t.x+15,top:t.y+15};return t.x+250>window.innerWidth&&(y.left=t.x-260),t.y+100>window.innerHeight&&(y.top=t.y-50),e.jsx("div",{className:"game-tooltip",style:y,children:t.text.split(`
`).map((c,g)=>e.jsx("div",{style:{marginBottom:g===t.text.split(`
`).length-1?0:"4px"},children:c},g))})},Rt={apiKey:"AIzaSyA1Dw5M2Zk8bpTCjlU2Tuifvx0ZI3IeRv0",authDomain:"kingdomclicker-156dc.firebaseapp.com",projectId:"kingdomclicker-156dc",storageBucket:"kingdomclicker-156dc.firebasestorage.app",messagingSenderId:"496461589742",appId:"1:496461589742:web:e6413dfa2d1bbabd3ad7ff"},At=pt(Rt),pe=ft(At);function Bt(){return`#${Math.floor(Math.random()*99999).toString().padStart(5,"0")}`}function Pt(){const t=new Date,s=t.getDay(),y=t.getDate()-s+(s===0?-6:1);return new Date(t.setDate(y))}async function Dt(t){try{console.log("üöÄ –ù–∞—á–∏–Ω–∞—é –æ—Ç–ø—Ä–∞–≤–∫—É –¥–∞–Ω–Ω—ã—Ö –≤ –ª–∏–¥–µ—Ä–±–æ—Ä–¥:",{rulerName:t.rulerName,rulerId:t.rulerId,gold:t.gold.toString(),renown:t.renown.toString(),buildings:t.buildings,achievements:t.achievements});const s={...t,period:"alltime"},y={...t,period:"weekly"};console.log("üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ leaderboard_alltime...");const c=Be(pe,"leaderboard_alltime",t.rulerId);await Pe(c,{...s,gold:Number(s.gold.toString()),renown:Number(s.renown.toString()),timestamp:De()}),console.log("‚úÖ –£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ leaderboard_alltime, ID:",t.rulerId),console.log("üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ leaderboard_weekly...");const g=Be(pe,"leaderboard_weekly",t.rulerId);return await Pe(g,{...y,gold:Number(y.gold.toString()),renown:Number(y.renown.toString()),timestamp:De()}),console.log("‚úÖ –£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ leaderboard_weekly, ID:",t.rulerId),console.log("üéâ –î–∞–Ω–Ω—ã–µ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!"),{allTimeId:t.rulerId,weeklyId:t.rulerId}}catch(s){throw console.error("‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –ª–∏–¥–µ—Ä–±–æ—Ä–¥:"),console.error("–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:",s),s instanceof Error&&(console.error("–°–æ–æ–±—â–µ–Ω–∏–µ –æ—à–∏–±–∫–∏:",s.message),console.error("–°—Ç–µ–∫ –æ—à–∏–±–∫–∏:",s.stack)),"code"in s&&(console.error("–ö–æ–¥ –æ—à–∏–±–∫–∏ Firebase:",s.code),console.error("–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:",s.customData)),s}}async function Mt(t=100){try{console.log("üîç –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö all-time –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞...");const s=Ye(Je(pe,"leaderboard_alltime"),qe("gold","desc"),Ve(t));console.log("üì° –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –∫ Firestore...");const y=await Xe(s);console.log("üìä –ü–æ–ª—É—á–µ–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:",y.docs.length);const c=y.docs.map(g=>{const m=g.data();return{id:g.id,...m,gold:m.gold instanceof Z?m.gold:new Z(m.gold),renown:m.renown instanceof Z?m.renown:new Z(m.renown),timestamp:m.timestamp}});return console.log("‚úÖ All-time –ª–∏–¥–µ—Ä–±–æ—Ä–¥ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω, –∑–∞–ø–∏—Å–µ–π:",c.length),c}catch(s){throw console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ all-time –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞:"),console.error("–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:",s),s instanceof Error&&(console.error("–°–æ–æ–±—â–µ–Ω–∏–µ –æ—à–∏–±–∫–∏:",s.message),console.error("–°—Ç–µ–∫ –æ—à–∏–±–∫–∏:",s.stack)),"code"in s&&console.error("–ö–æ–¥ –æ—à–∏–±–∫–∏ Firebase:",s.code),s}}async function It(t=100){try{console.log("üîç –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö weekly –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞...");const s=Pt();console.log("üìÖ –ù–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏:",s.toISOString());const y=Ye(Je(pe,"leaderboard_weekly"),qe("gold","desc"),Ve(t));console.log("üì° –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –∫ Firestore...");const c=await Xe(y);console.log("üìä –ü–æ–ª—É—á–µ–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–æ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:",c.docs.length);const m=c.docs.map(b=>{const h=b.data();return{id:b.id,...h,gold:h.gold instanceof Z?h.gold:new Z(h.gold),renown:h.renown instanceof Z?h.renown:new Z(h.renown),timestamp:h.timestamp}}).filter(b=>{var x,P;const h=((P=(x=b.timestamp)==null?void 0:x.toDate)==null?void 0:P.call(x))||new Date(b.timestamp),w=h>=s;return w||console.log("üóëÔ∏è –ó–∞–ø–∏—Å—å –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–∞ (—Å—Ç–∞—Ä–∞—è –¥–∞—Ç–∞):",h.toISOString()),w});return console.log("‚úÖ Weekly –ª–∏–¥–µ—Ä–±–æ—Ä–¥ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω, –∑–∞–ø–∏—Å–µ–π –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:",m.length),m}catch(s){throw console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ weekly –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞:"),console.error("–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:",s),s instanceof Error&&(console.error("–°–æ–æ–±—â–µ–Ω–∏–µ –æ—à–∏–±–∫–∏:",s.message),console.error("–°—Ç–µ–∫ –æ—à–∏–±–∫–∏:",s.stack)),"code"in s&&console.error("–ö–æ–¥ –æ—à–∏–±–∫–∏ Firebase:",s.code),s}}const zt=({isOpen:t,onClose:s,onConfirm:y,gameState:c})=>{const[g,m]=f.useState(""),[b,h]=f.useState(!1);if(!t)return null;const w=async()=>{if(g.trim().length<3){alert("Ruler name must contain at least 3 characters!");return}if(g.trim().length>20){alert("Ruler name must not exceed 20 characters!");return}h(!0);try{const P={id:`player_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,rulerName:g.trim(),rulerId:Bt(),lastLeaderboardView:0,lastLeaderboardSubmit:0,hasChosenName:!0};y(P),s()}catch{alert("An error occurred while creating profile. Please try again.")}finally{h(!1)}};return e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{backgroundColor:"#fdf6e3",border:"4px solid #8d6e63",borderRadius:"8px",padding:"32px",maxWidth:"500px",width:"90%",textAlign:"center",fontFamily:"Georgia, serif"},children:[e.jsx("h2",{style:{color:"#3e2723",marginBottom:"16px"},children:"üëë Royal Coronation! üëë"}),e.jsxs("p",{style:{color:"#5d4037",marginBottom:"24px",lineHeight:"1.5"},children:["Congratulations! Your kingdom has reached ",e.jsx("strong",{children:Ft(c.gold)})," gold!",e.jsx("br",{}),"It's time to choose a name for your ruler and enter the history books!"]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("label",{style:{display:"block",color:"#3e2723",marginBottom:"8px",fontWeight:"bold"},children:"Ruler Name:"}),e.jsx("input",{type:"text",value:g,onChange:x=>m(x.target.value),placeholder:"Enter your name...",maxLength:20,style:{width:"100%",padding:"12px",border:"2px solid #a1887f",borderRadius:"4px",fontSize:"16px",fontFamily:"Arial, sans-serif",backgroundColor:"#fff",color:"#3e2723"},onKeyPress:x=>x.key==="Enter"&&w()}),e.jsxs("div",{style:{fontSize:"12px",color:"#8d6e63",marginTop:"4px",textAlign:"left"},children:[g.length,"/20 characters"]})]}),e.jsx("div",{style:{backgroundColor:"#fff3e0",border:"2px solid #bf9000",borderRadius:"4px",padding:"12px",marginBottom:"24px"},children:e.jsx("p",{style:{color:"#bf9000",margin:0,fontSize:"14px",fontWeight:"bold"},children:"‚ö†Ô∏è Important: You'll be able to join the leaderboard and compete with players from around the world!"})}),e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[e.jsx("button",{type:"button",onClick:w,disabled:b||g.trim().length<3,style:{padding:"12px 24px",backgroundColor:b||g.trim().length<3?"#cccccc":"#2e7d32",color:"white",border:"none",borderRadius:"4px",fontSize:"16px",fontWeight:"bold",cursor:b||g.trim().length<3?"not-allowed":"pointer",fontFamily:"Georgia, serif"},children:b?"Creating profile...":"Ascend the Throne"}),e.jsx("button",{type:"button",onClick:s,style:{padding:"12px 24px",backgroundColor:"#c62828",color:"white",border:"none",borderRadius:"4px",fontSize:"16px",cursor:"pointer",fontFamily:"Georgia, serif",transition:"background-color 0.2s"},onMouseOver:x=>{x.currentTarget.style.backgroundColor="#d32f2f"},onMouseOut:x=>{x.currentTarget.style.backgroundColor="#c62828"},children:"Later"})]})]})})};function Ft(t){return t.lt(1e3)?t.toFixed(0):t.lt(1e6)?t.toNumber().toLocaleString():t.toExponential(2)}const Wt=({isOpen:t,onClose:s,playerProfile:y,onOpenRulerNameModal:c,gameState:g})=>{const[m,b]=f.useState([]),[h,w]=f.useState([]),[x,P]=f.useState("alltime"),[d,O]=f.useState(!1),[B,N]=f.useState(null),[L,R]=f.useState(0),[E,W]=f.useState(0),D=()=>{const S=localStorage.getItem("leaderboardCache");if(S)try{const{data:k,timestamp:A}=JSON.parse(S),I=Date.now(),Y=3600*1e3;if(I-A<Y&&k&&k.allTime&&k.weekly)return k}catch(k){console.error("Cache parse error:",k)}return null},z=S=>{const k={data:S,timestamp:Date.now()};localStorage.setItem("leaderboardCache",JSON.stringify(k)),W(Date.now())},F=()=>{const S=localStorage.getItem("leaderboardCache");if(S){const{timestamp:k}=JSON.parse(S),A=Date.now(),I=3600*1e3;return A-k<I}return!1};f.useEffect(()=>{if(t){if(F())try{const S=D();if(S){b(S.allTime),w(S.weekly);const k=JSON.parse(localStorage.getItem("leaderboardCache"));W(k.timestamp);return}}catch(S){console.error("Cache read error:",S)}H()}},[t]);const H=async()=>{O(!0),N(null);try{const S=new Promise((I,Y)=>setTimeout(()=>Y(new Error("Loading timeout")),1e4)),[k,A]=await Promise.all([Promise.race([Mt(50),S]),Promise.race([It(50),S])]);b(k),w(A),z({allTime:k,weekly:A}),console.log("Leaderboard data loaded successfully!")}catch(S){console.error("Error loading leaderboard:",S),N("Failed to load leaderboard. Please check your internet connection and try again.")}finally{O(!1)}},V=S=>{switch(S){case 1:return"ü•á";case 2:return"ü•à";case 3:return"ü•â";default:return`#${S}`}},$=()=>y?(x==="alltime"?m:h).findIndex(k=>k.rulerId===y.rulerId)+1:-1,X=()=>{const S=x==="alltime"?m:h;if(S.length>0){let k=0;if(S.forEach(A=>{if(A.timestamp){let I=0;typeof A.timestamp=="object"&&A.timestamp.toDate?I=A.timestamp.toDate().getTime():typeof A.timestamp=="number"?I=A.timestamp:typeof A.timestamp=="string"&&(I=new Date(A.timestamp).getTime()),I>k&&(k=I)}}),k>0)return k}return E},U=x==="alltime"?m:h,J=U.length>0;return t?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"800px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h2",{children:"üèÜ Leaderboard üèÜ"}),e.jsx("button",{className:"btn",onClick:s,children:"Close"})]}),!y&&e.jsxs("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"15px",marginBottom:"16px",textAlign:"center"},children:[e.jsx("h4",{style:{color:"var(--gold-color)",margin:"0 0 8px 0",fontSize:"14px"},children:"üëÅ View Only Mode"}),e.jsxs("p",{style:{color:"var(--text-secondary)",margin:"0",fontSize:"12px",lineHeight:"1.4"},children:[e.jsx("strong",{children:"Anyone can view leaderboard!"})," Choose a name at 10M gold to participate."]}),c&&g&&g.gold&&g.gold.gte(1e7)&&e.jsx("button",{className:"btn",onClick:()=>{s(),c()},style:{backgroundColor:"var(--accent-color)",padding:"6px 12px",fontSize:"12px",marginTop:"8px"},children:"üëë Choose Ruler Name"})]}),J&&e.jsx("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"12px",marginBottom:"16px",textAlign:"center",fontSize:"12px"},children:e.jsxs("span",{style:{color:"var(--gold-color)"},children:["üìä Data updated ",Math.floor((Date.now()-X())/6e4)," minutes ago"]})}),d&&e.jsx("div",{style:{textAlign:"center",padding:"20px",color:"var(--text-secondary)"},children:"Loading leaderboard data..."}),B&&e.jsx("div",{style:{textAlign:"center",padding:"20px",color:"var(--danger-color)"},children:B}),y&&J&&e.jsxs("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"12px",marginBottom:"16px",textAlign:"center"},children:[e.jsxs("div",{style:{color:"var(--gold-color)",fontSize:"14px",fontWeight:"bold"},children:["üëë You are playing as: ",y.rulerName," ",y.rulerId]}),U.length>0&&e.jsxs("div",{style:{color:"var(--text-secondary)",fontSize:"12px",marginTop:"5px"},children:["Your Rank: ",$()>0?`#${$()}`:"Not ranked yet"," in ",x==="alltime"?"All Time":"Weekly"]})]}),J&&e.jsxs("div",{style:{display:"flex",marginBottom:"16px",borderBottom:"2px solid var(--border-color)"},children:[e.jsx("button",{onClick:()=>P("alltime"),className:x==="alltime"?"tab-btn active":"tab-btn",children:"All Time"}),e.jsx("button",{onClick:()=>P("weekly"),className:x==="weekly"?"tab-btn active":"tab-btn",children:"This Week"})]}),J&&!d&&!B&&e.jsx("div",{style:{maxHeight:"400px",overflowY:"auto",border:"2px solid var(--border-color)",borderRadius:"4px",backgroundColor:"var(--panel-bg)"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{style:{backgroundColor:"var(--accent-color)",color:"white",position:"sticky",top:0},children:e.jsxs("tr",{children:[e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Rank"}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Ruler"}),e.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Gold"}),e.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Renown"}),e.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Buildings"})]})}),e.jsx("tbody",{children:U.map((S,k)=>e.jsxs("tr",{style:{backgroundColor:(y==null?void 0:y.rulerId)===S.rulerId?"rgba(191, 144, 0, 0.1)":k%2===0?"rgba(0, 0, 0, 0.02)":"transparent",borderBottom:"1px solid var(--border-color)"},children:[e.jsx("td",{style:{padding:"10px",fontWeight:"bold",color:"var(--text-color)"},children:V(k+1)}),e.jsx("td",{style:{padding:"10px",color:"var(--text-color)"},children:e.jsxs("div",{children:[e.jsx("strong",{children:S.rulerName}),e.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:S.rulerId})]})}),e.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--gold-color)",fontWeight:"bold"},children:j(S.gold,"standard")}),e.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--text-secondary)"},children:j(S.renown,"standard")}),e.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--text-secondary)"},children:S.buildings})]},S.id))})]})}),e.jsx("div",{style:{marginTop:"16px",fontSize:"12px",color:"var(--text-secondary)",textAlign:"center"},children:"üí° Leaderboard updates automatically every hour. Data is cached for performance."})]})}):null},ee={density:"normal",fontSize:"medium",showFloatingText:!0,showWeatherWidget:!0,reduceMotion:!1,crownAnimations:!0,lastBuyAmount:o(1),layout:{left:o(1),center:o(1),right:o(1)},borderWidth:o(4),customColors:{enabled:!1,bg:"#e8dcc5",panel:"#fdf6e3",text:"#3e2723",secondaryText:"#5d4037",accent:"#8d6e63",accentHover:"#6d4c41",gold:"#bf9000",border:"#a1887f",success:"#2e7d32",danger:"#c62828"}},se={gold:o(0),totalGold:o(0),startTime:o(Date.now()),lastSaveTime:o(Date.now()),buildings:{},achievements:[],renown:o(0),prestigeCount:0,soldiers:o(0),eliteUnits:{},artifacts:[],advisors:[],advisorLevels:{},intermediateGoods:{},nationalProjects:{},weather:{current:"clear",timeLeft:o(120)},event:null,theme:"default",numberFormat:"standard",idleModeEnabled:!0,interface:ee,stats:{totalClicks:o(0),dragonsKilled:o(0),tavernGamesPlayed:o(0)},playerProfile:null},xe=t=>{if(t==null||typeof t=="string"||typeof t=="number"||typeof t=="boolean")return t;if(Array.isArray(t))return t.map(xe);if(typeof t=="object"&&t.toString&&typeof t.toString=="function"&&(t.hasOwnProperty("mantissa")||t.hasOwnProperty("exponent")))return t.toString();if(typeof t=="object"){const s={};for(const y in t)t.hasOwnProperty(y)&&(s[y]=xe(t[y]));return s}return t},Yt=()=>{var Ee;const[t,s]=f.useState(()=>{var n,l,u,p,T,v;const r=localStorage.getItem("kingdom_save");if(r)try{const i=JSON.parse(r),C=i.interface||{},M={...ee,...C,lastBuyAmount:o(C.lastBuyAmount??1),crownAnimations:C.crownAnimations??!0,layout:{left:o(((n=C.layout)==null?void 0:n.left)??ee.layout.left),center:o(((l=C.layout)==null?void 0:l.center)??ee.layout.center),right:o(((u=C.layout)==null?void 0:u.right)??ee.layout.right)},borderWidth:o(C.borderWidth??ee.borderWidth),customColors:{...ee.customColors,...C.customColors||{}}};return{...se,...i,renown:o(i.renown||0),prestigeCount:i.prestigeCount||0,gold:o(i.gold||0),totalGold:o(i.totalGold||0),startTime:o(i.startTime||Date.now()),lastSaveTime:o(i.lastSaveTime||Date.now()),soldiers:o(i.soldiers||0),buildings:Object.keys(i.buildings||{}).reduce((G,_)=>(G[_]=o(i.buildings[_]),G),{}),stats:{...se.stats,...i.stats||{},totalClicks:o(((p=i.stats)==null?void 0:p.totalClicks)||0),dragonsKilled:o(((T=i.stats)==null?void 0:T.dragonsKilled)||0),tavernGamesPlayed:o(((v=i.stats)==null?void 0:v.tavernGamesPlayed)||0)},eliteUnits:Object.keys(i.eliteUnits||{}).reduce((G,_)=>(G[_]=o(i.eliteUnits[_]),G),{}),advisors:i.advisors||[],advisorLevels:Object.keys(i.advisorLevels||{}).reduce((G,_)=>(G[_]=o(i.advisorLevels[_]),G),{}),intermediateGoods:Object.keys(i.intermediateGoods||{}).reduce((G,_)=>{const ne=i.intermediateGoods[_];return G[_]={level:o(ne.level||0),lastClickTime:o(ne.lastClickTime||Date.now())},G},{}),nationalProjects:i.nationalProjects||{},weather:i.weather?{...i.weather,timeLeft:o(Number(i.weather.timeLeft)||120)}:se.weather,theme:i.theme||"default",numberFormat:i.numberFormat||"standard",idleModeEnabled:i.idleModeEnabled!==void 0?i.idleModeEnabled:!0,interface:M,playerProfile:i.playerProfile?{...i.playerProfile,lastLeaderboardSubmit:i.playerProfile.lastLeaderboardSubmit||0}:null}}catch(i){console.error("Save load failed",i)}return se}),y=f.useRef(t);f.useEffect(()=>{y.current=t},[t]);const[c,g]=f.useState(!1);f.useEffect(()=>{let r;const n=()=>{g(!1),clearTimeout(r),t.idleModeEnabled&&(r=setTimeout(()=>{g(!0)},2e4))};n();const l=["mousemove","mousedown","keydown","touchstart","scroll"];return l.forEach(u=>window.addEventListener(u,n)),()=>{clearTimeout(r),l.forEach(u=>window.removeEventListener(u,n))}},[t.idleModeEnabled]),f.useEffect(()=>{const r=j(t.gold);document.title=`Gold: ${r} - Kingdom Clicker`},[t.gold]),f.useEffect(()=>{var T;const r=document.documentElement,n=t.interface||ee;if((T=n.customColors)!=null&&T.enabled){const v=n.customColors;r.style.setProperty("--bg-color",v.bg),r.style.setProperty("--panel-bg",v.panel),r.style.setProperty("--text-color",v.text),r.style.setProperty("--text-secondary",v.secondaryText||"#5d4037"),r.style.setProperty("--text-on-accent","#ffffff"),r.style.setProperty("--accent-color",v.accent),r.style.setProperty("--accent-hover",v.accentHover||v.accent),r.style.setProperty("--gold-color",v.gold||"#bf9000"),r.style.setProperty("--border-color",v.border),r.style.setProperty("--success-color",v.success||"#2e7d32"),r.style.setProperty("--danger-color",v.danger||"#c62828"),r.style.setProperty("--bg-image","none")}else{const v=t.theme||"default",i=be[v]||be.default;i&&Object.entries(i.colors).forEach(([C,M])=>{r.style.setProperty(C,M)})}const l={small:"14px",medium:"16px",large:"18px"};r.style.setProperty("--base-font-size",l[n.fontSize]);const u={compact:"8px",normal:"12px",spacious:"20px"},p={compact:"6px",normal:"12px",spacious:"16px"};r.style.setProperty("--panel-padding",u[n.density]),r.style.setProperty("--gap-size",p[n.density]),r.style.setProperty("--custom-border-width",`${n.borderWidth}px`),r.style.setProperty("--col-left",String(n.layout.left)),r.style.setProperty("--col-center",String(n.layout.center)),r.style.setProperty("--col-right",String(n.layout.right)),n.reduceMotion?document.body.classList.add("no-motion"):document.body.classList.remove("no-motion")},[t.theme,t.interface]);const[m,b]=f.useState(!1);f.useEffect(()=>{var r;t.gold.gte(o(1e7))&&!((r=t.playerProfile)!=null&&r.hasChosenName)&&!m&&ae(!0)},[t.gold,t.playerProfile,m]);const[h,w]=f.useState(null),[x,P]=f.useState([]),[d,O]=f.useState("buildings"),[B,N]=f.useState("army"),[L,R]=f.useState(!1),[E,W]=f.useState("throne");f.useEffect(()=>{const r=()=>{R(window.innerWidth<768)};return r(),window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]);const[D,z]=f.useState(!1),[F,H]=f.useState(!1),[V,$]=f.useState(!1),[X,U]=f.useState(!1),[J,S]=f.useState(!1),[k,A]=f.useState(!1),[I,Y]=f.useState(!1),[ie,ae]=f.useState(!1),[de,oe]=f.useState(!1),a=(r,n="info")=>{const l=Date.now().toString()+Math.random();P(u=>[...u,{id:l,message:r,type:n}]),setTimeout(()=>{P(u=>u.filter(p=>p.id!==l))},3e3)};f.useEffect(()=>{const r=Date.now();if(t.lastSaveTime&&o(r).minus(t.lastSaveTime).gt(o(6e4))){const n=o(r).minus(t.lastSaveTime).dividedBy(o(1e3)),l=te(t),u=t.advisorLevels.dream_warden||o(0),p=t.advisors.includes("dream_warden")?K("dream_warden",u):o(0),T=Z.min(p,o(1)),v=l.times(n).times(T).floor();if(v.gt(o(0))){const i=T.gt(0)?` (+${j(T.times(100),t.numberFormat)}% Dream Warden)`:"";a(`While you were away, you earned ${j(v,t.numberFormat)} gold!${i}`,"success"),s(C=>({...C,gold:C.gold.plus(v),totalGold:C.totalGold.plus(v)}))}}},[]),f.useEffect(()=>{const r=setInterval(()=>{Date.now()%3e4<1e3&&s(n=>{const l={...n,lastSaveTime:o(Date.now())},u=xe(l);return localStorage.setItem("kingdom_save",JSON.stringify(u)),l})},1e3);return()=>clearInterval(r)},[]),f.useEffect(()=>{const r=()=>{const l=y.current,u=xe(l);localStorage.setItem("kingdom_save",JSON.stringify(u))};window.addEventListener("beforeunload",r);const n=()=>{document.visibilityState==="hidden"&&r()};return document.addEventListener("visibilitychange",n),()=>{window.removeEventListener("beforeunload",r),document.removeEventListener("visibilitychange",n)}},[]),f.useEffect(()=>{var n;if(!((n=t.playerProfile)!=null&&n.hasChosenName))return;const r=setInterval(()=>{var v;const l=y.current,u=Date.now(),p=((v=l.playerProfile)==null?void 0:v.lastLeaderboardSubmit)||0,T=3600*1e3;u-p>=T&&Dt({rulerName:l.playerProfile.rulerName,rulerId:l.playerProfile.rulerId,gold:l.gold,renown:l.renown,buildings:Object.keys(l.buildings).length,achievements:l.achievements.length,period:"alltime"}).then(()=>{s(i=>({...i,playerProfile:{...i.playerProfile,lastLeaderboardSubmit:Date.now()}})),a("Leaderboard data submitted successfully!","success")}).catch(i=>{console.error("Auto leaderboard submission failed:",i)})},6e4);return()=>clearInterval(r)},[(Ee=t.playerProfile)==null?void 0:Ee.hasChosenName]),f.useRef(0),f.useEffect(()=>{if(t.advisors.includes("treasurer")){const r=t.advisorLevels.treasurer||o(1),n=Math.max(.5,5-(r.toNumber()-1)*.5),l=setInterval(()=>{fe(!0)},n*1e3);return()=>clearInterval(l)}},[t.advisors,t.advisorLevels]),f.useEffect(()=>{const r=setInterval(()=>{if(!t.event){t.advisors.includes("alchemist");const n=t.advisorLevels.alchemist||o(1),l=.05,u=K("alchemist",n),p=l*u.toNumber();if(Math.random()<p){const T=["dragon","merchant","jester"],v=T[Math.floor(Math.random()*T.length)],i={id:Date.now().toString(),type:v,expiresAt:o(Date.now()).plus(o(v==="dragon"?1e4:3e4)),hp:v==="dragon"?o(10):void 0,maxHp:v==="dragon"?o(10):void 0,reward:o(0)};s(C=>({...C,event:i}))}}},1e4);return()=>clearInterval(r)},[t.event,t.advisors,t.advisorLevels]);const te=r=>{var v;let n=o(0);const l=((v=r.weather)==null?void 0:v.current)||"clear";he.forEach(i=>{const C=r.buildings[i.id]||o(0);let M=i.baseProduction;l==="sunny"?(i.id==="peasant"||i.id==="field"||i.id==="stable"||i.id==="cathedral")&&(M=M.times(o(1.2))):l==="rainy"?(i.id==="silver_mine"||i.id==="alchemist"||i.id==="market"||i.id==="tavern")&&(M=M.times(o(1.2))):l==="stormy"?((i.id==="blacksmith"||i.id==="void_portal")&&(M=M.times(o(1.3))),(i.id==="field"||i.id==="stable")&&(M=M.times(o(.8)))):l==="windy"&&(i.id==="market"||i.id==="castle"||i.id==="time_chamber")&&(M=M.times(o(1.15))),n=n.plus(C.times(M))});let u=0;r.nationalProjects&&Object.values(r.nationalProjects).forEach(i=>{u+=i.level||0});let p=o(1);const T=o(1).plus(o(u*He));if(p=p.times(T),r.advisors.includes("cosmic_mage")){const i=r.advisorLevels.cosmic_mage||o(0),C=r.advisors.includes("cosmic_mage")?K("cosmic_mage",i):o(0),M=o(1).plus(C);p=p.times(M)}return r.artifacts.forEach(i=>{const C=xt.find(M=>M.id===i);C&&(p=p.times(C.globalMultiplier))}),p=p.times(le(r.renown).plus(o(r.achievements.length*.02))),n=n.times(p),n},ce=te(t),ue=f.useRef(ce);ue.current=ce,f.useEffect(()=>{const r=setInterval(()=>{s(n=>{const l=Date.now(),u=ue.current.times(o(ye)).dividedBy(o(1e3));let p=n.totalGold.plus(u),T=n.gold.plus(u),v={...n.weather};const i=o(ye/1e3);if(v.timeLeft=v.timeLeft.minus(i),v.timeLeft.lte(o(0))){const q=["clear","sunny","rainy","stormy","windy"],Q=q[Math.floor(Math.random()*q.length)],ge=o(Math.floor(Math.random()*120)+60);v={current:Q,timeLeft:ge}}let C=n.event;C&&C.expiresAt&&o(C.expiresAt).lt(o(l))&&(C=null);let M={...n.intermediateGoods};o(0);let G={...n.nationalProjects||{}};Object.keys(G).forEach(q=>{var ge;const Q=G[q];if(Q.active&&Q.endTime){const nt=n.advisorLevels.warmaster||o(0);n.advisors.includes("warmaster")&&K("warmaster",nt).toNumber();const st=n.advisorLevels.chronomancer||o(0);n.advisors.includes("chronomancer")&&K("chronomancer",st).toNumber();const lt=n.advisorLevels.time_keeper||o(0);n.advisors.includes("time_keeper")&&K("time_keeper",lt).toNumber(),l>=Q.endTime&&(G[q]={...Q,active:!1,level:Q.level+1,startTime:0,endTime:0},a(`Project Completed: ${(ge=he.find(it=>it.id===q))==null?void 0:ge.name} Infrastructure Level ${Q.level+1}!`,"success"))}});const _=[...n.achievements];let ne=null;return $e.forEach(q=>{_.includes(q.id)||q.condition({...n,totalGold:p,gold:T},ue.current)&&(_.push(q.id),ne=q)}),ne&&(w(ne),setTimeout(()=>w(null),3e3)),{...n,gold:T,totalGold:p,achievements:_,event:C,artifacts:n.artifacts,soldiers:n.soldiers,weather:v,intermediateGoods:M,nationalProjects:G,advisorLevels:n.advisorLevels}})},ye);return()=>clearInterval(r)},[t.advisors,t.advisorLevels]);const Ke=f.useRef(t.artifacts);f.useEffect(()=>{Ke.current=t.artifacts},[t.artifacts]);const re=(r="light")=>{if("vibrate"in navigator&&L)switch(r){case"light":navigator.vibrate(10);break;case"medium":navigator.vibrate(20);break;case"heavy":navigator.vibrate([30,10,30]);break}},fe=(r=!1)=>{r||re("light");let n=o(1);if(n=n.times(le(y.current.renown)),y.current.godMode){const u=te(y.current).times(o(6e3));n=n.plus(u)}s(l=>({...l,gold:l.gold.plus(n),totalGold:l.totalGold.plus(n),stats:{...l.stats,totalClicks:r?l.stats.totalClicks:l.stats.totalClicks.plus(o(1))}}))},we=(r,n)=>{const l=he.find(C=>C.id===r);if(!l||n<=0)return;const u=t.buildings[r]||o(0),p=t.advisorLevels.guildmaster||o(0),T=t.advisors.includes("guildmaster")?K("guildmaster",p):o(0),v=o(1).minus(T),i=Re(l.baseCost,u,o(n)).times(v).floor();t.gold.gte(i)&&(re("medium"),s(C=>({...C,gold:C.gold.minus(i),buildings:{...C.buildings,[r]:(C.buildings[r]||o(0)).plus(o(n))}})))},Ce=(r,n)=>{const l=he.find(v=>v.id===r);if(!l||n<=0)return;const u=t.buildings[r]||o(0),p=o(Math.min(n,u.toNumber()));if(p.lte(o(0)))return;const T=Re(l.baseCost,u.minus(p),p).times(o(.25)).floor();s(v=>({...v,gold:v.gold.plus(T),buildings:{...v.buildings,[r]:u.minus(p)}}))},Se=r=>{const n=Ae.times(o(r));t.gold.gte(n)&&s(l=>({...l,gold:l.gold.minus(n),soldiers:l.soldiers.plus(n.dividedBy(Ae))}))},ke=(r,n)=>{const l=gt.find(T=>T.id===r);if(!l)return;const u=l.goldCost.times(o(n)),p=l.soldierCost.times(o(n));t.gold.gte(u)&&t.soldiers.gte(p)&&s(T=>({...T,gold:T.gold.minus(u),soldiers:T.soldiers.minus(p),eliteUnits:{...T.eliteUnits,[r]:(T.eliteUnits[r]||o(0)).plus(o(n))}}))},Ze=r=>{const n=Ge.find(p=>p.id===r);if(!n)return;const l=t.advisors.includes(r),u=t.advisorLevels[r]||o(0);if(!l)t.renown.gte(n.cost)?(s(p=>({...p,renown:p.renown.minus(n.cost),advisors:[...p.advisors,r],advisorLevels:{...p.advisorLevels,[r]:o(1)}})),a(`Hired ${n.name}!`,"success")):a(`Not enough Renown! Need ${j(n.cost,t.numberFormat)}`,"error");else{const p=Oe(n,u);t.renown.gte(p)?(s(T=>({...T,renown:T.renown.minus(p),advisorLevels:{...T.advisorLevels,[r]:u.plus(o(1))}})),a(`Upgraded ${n.name} to Level ${u.plus(o(1))}!`,"success")):a(`Not enough Renown! Need ${j(p,t.numberFormat)}`,"error")}},Te=r=>{if(r.type==="merchant"){const n=ue.current.times(o(10));s(l=>({...l,gold:l.gold.plus(n),totalGold:l.totalGold.plus(n),event:null})),a(`The merchant gifted you ${j(n.floor(),t.numberFormat)} gold!`,"success")}else if(r.type==="jester"){const n=t.gold.times(o(.1)),l=Math.random()>.5;s(u=>({...u,gold:l?u.gold.plus(n):u.gold.minus(n),totalGold:l?u.totalGold.plus(n):u.totalGold,event:null})),l?a(`Jester pays out! +${j(n.floor(),t.numberFormat)}`,"success"):a(`Jester tricked you! -${j(n.floor(),t.numberFormat)}`,"warning")}else if(r.type==="dragon"){let n=!1;s(l=>{if(!l.event||l.event.type!=="dragon")return l;const u=(l.event.hp||o(1)).minus(o(1));if(u.lte(0)){const p=ue.current.times(o(30));return n=!0,{...l,gold:l.gold.plus(p),totalGold:l.totalGold.plus(p),event:null,stats:{...l.stats,dragonsKilled:l.stats.dragonsKilled.plus(o(1))}}}return{...l,event:{...l.event,hp:u}}}),n&&a("Dragon Slain! +Treasury Boost","success")}},Qe=()=>{const r=t.advisorLevels.void_scholar||o(0),n=t.advisors.includes("void_scholar")?K("void_scholar",r):o(0),l=o(1).plus(n),u=o(1e12),p=t.totalGold;if(p.lt(u))return;const T=p.dividedBy(u),v=o(Math.floor(Math.pow(T.toNumber(),.33))).times(l);v.lte(0)||(s({...se,renown:t.renown.plus(v),prestigeCount:t.prestigeCount+1,totalGold:t.totalGold,achievements:t.achievements,artifacts:t.artifacts,advisors:t.advisors,advisorLevels:t.advisorLevels,nationalProjects:t.nationalProjects,playerProfile:t.playerProfile,startTime:o(Date.now()),lastSaveTime:o(Date.now()),theme:t.theme,idleModeEnabled:t.idleModeEnabled,interface:t.interface}),H(!1),a("Abdication Successful. Long live the new King!","success"))},et=()=>{localStorage.removeItem("kingdom_save"),s({...se,startTime:o(Date.now())}),$(!1),a("Game Reset","warning")},tt=()=>{const n=xe(t);localStorage.setItem("kingdom_save",JSON.stringify(n)),a("Game Saved","info")},ot=r=>{s(n=>({...n,playerProfile:r})),localStorage.setItem(`playerProfile_${r.id}`,JSON.stringify(r)),a(`Welcome, ${r.rulerName} ${r.rulerId}!`,"success"),b(!1)},rt=async()=>{Qe()},Ne=r=>{s(n=>({...n,interface:{...n.interface,lastBuyAmount:r}}))},Le=r=>({flex:r==="left"?"var(--col-left)":"var(--col-right)",display:"flex",flexDirection:"column",borderRight:r==="left"?"var(--custom-border-width) double var(--border-color)":"none",borderLeft:r==="right"?"var(--custom-border-width) double var(--border-color)":"none",background:"var(--panel-bg)",minWidth:0,transition:"transform 0.8s ease-in-out",transform:c&&t.idleModeEnabled?r==="left"?"translateX(-120%)":"translateX(120%)":"translateX(0)",zIndex:10});return e.jsxs("div",{style:{display:"flex",height:"100dvh",width:"100vw",backgroundColor:"var(--bg-color)",overflow:"hidden",position:"relative",flexDirection:L?"column":"row"},children:[e.jsx(Lt,{toasts:x}),e.jsx(Et,{}),c&&t.idleModeEnabled&&e.jsx(yt,{gameState:t}),!L&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:Le("left"),children:[e.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)"},children:e.jsx("button",{className:`tab-btn ${d==="buildings"?"active":""}`,onClick:()=>O("buildings"),children:"Estates"})}),e.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden"},children:d==="buildings"&&e.jsx(Me,{gameState:t,onBuyBuilding:we,onSellBuilding:Ce,onSetBuyAmount:Ne})})]}),e.jsx("div",{style:{flex:"var(--col-center)",display:"flex",flexDirection:"column",position:"relative",borderRight:c&&t.idleModeEnabled?"none":"var(--custom-border-width) double var(--border-color)",minWidth:0,zIndex:5,transition:"border 0.8s"},children:e.jsx(Ie,{gameState:t,gps:ce,onClick:()=>fe(!1),onEventInteract:Te,onOpenConquest:()=>{},onOpenTavern:()=>z(!0),onOpenPrestige:()=>H(!0),onOpenSettings:()=>$(!0),onOpenCouncil:()=>S(!0),onOpenStatistics:()=>A(!0),onOpenLeaderboard:()=>{oe(!0)},onOpenEmpire:()=>Y(!0),isIdle:c&&t.idleModeEnabled})}),e.jsxs("div",{style:Le("right"),children:[e.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)"},children:e.jsx("button",{className:`tab-btn ${B==="army"?"active":""}`,onClick:()=>N("army"),children:"Workforce"})}),e.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden"},children:B==="army"&&e.jsx(ze,{gameState:t,onTrainSoldier:Se,onTrainElite:ke})})]})]}),L&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",position:"relative",minHeight:0,height:"100%"},children:[E==="buildings"&&e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0},children:[e.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:e.jsx("button",{className:"tab-btn active",onClick:()=>{},children:"Estates"})}),e.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:e.jsx(Me,{gameState:t,onBuyBuilding:we,onSellBuilding:Ce,onSetBuyAmount:Ne})})]}),E==="throne"&&e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,height:"100%"},children:e.jsx(Ie,{gameState:t,gps:ce,onClick:()=>fe(!1),onEventInteract:Te,onOpenConquest:()=>{},onOpenTavern:()=>z(!0),onOpenPrestige:()=>H(!0),onOpenSettings:()=>$(!0),onOpenCouncil:()=>S(!0),onOpenStatistics:()=>A(!0),onOpenLeaderboard:()=>oe(!0),onOpenEmpire:()=>Y(!0),isIdle:c&&t.idleModeEnabled})}),E==="army"&&e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0},children:[e.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:e.jsx("button",{className:"tab-btn active",children:"Workforce"})}),e.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:e.jsx(ze,{gameState:t,onTrainSoldier:Se,onTrainElite:ke})})]}),E==="empire"&&e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,height:"100%"},children:e.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:e.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"var(--text-secondary)"},children:[e.jsx("h3",{children:"üèóÔ∏è National Projects"}),e.jsx("p",{children:"Construct massive infrastructure to boost global production."}),e.jsx("button",{className:"btn",onClick:()=>Y(!0),style:{margin:"10px",padding:"15px 20px",fontSize:"16px"},children:"üèóÔ∏è Manage Projects"})]})})})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-around",alignItems:"center",height:"60px",backgroundColor:"var(--panel-bg)",borderTop:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:[e.jsxs("button",{className:`mobile-nav-btn ${E==="buildings"?"active":""}`,onClick:()=>{re("light"),W("buildings")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:E==="buildings"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[e.jsx("div",{style:{fontSize:"20px"},children:"üèòÔ∏è"}),e.jsx("div",{children:"Estates"})]}),e.jsxs("button",{className:`mobile-nav-btn ${E==="throne"?"active":""}`,onClick:()=>{re("light"),W("throne")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:E==="throne"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[e.jsx("div",{style:{fontSize:"20px"},children:"üëë"}),e.jsx("div",{children:"Throne"})]}),e.jsxs("button",{className:`mobile-nav-btn ${E==="army"?"active":""}`,onClick:()=>{re("light"),W("army")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:E==="army"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[e.jsx("div",{style:{fontSize:"20px"},children:"üë∑"}),e.jsx("div",{children:"Workforce"})]}),e.jsxs("button",{className:`mobile-nav-btn ${E==="empire"?"active":""}`,onClick:()=>{re("light"),W("empire")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:E==="empire"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[e.jsx("div",{style:{fontSize:"20px"},children:"üèóÔ∏è"}),e.jsx("div",{children:"Projects"})]})]})]}),!(c&&t.idleModeEnabled)&&h&&e.jsxs("div",{className:"achievement-popup",children:[e.jsx("div",{style:{fontSize:"2rem"},children:h.icon}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",color:"var(--text-color)"},children:"Achievement Unlocked!"}),e.jsx("div",{style:{color:"var(--accent-color)"},children:h.name})]})]}),I&&e.jsx(Nt,{gameState:t,onClose:()=>Y(!1),onStartProject:r=>{var p,T,v,i;const n=((p=t.nationalProjects[r])==null?void 0:p.level)||0;if(n>=je)return;const l=_e(r,n+1);if(t.gold.lt(l.gold)||t.soldiers.lt(l.laborers)||(T=t.eliteUnits.carpenter)!=null&&T.lt(l.carpenter||0)||(v=t.eliteUnits.mason)!=null&&v.lt(l.mason||0)||(i=t.eliteUnits.architect)!=null&&i.lt(l.architect||0))return;const u=Ue(n+1);s(C=>({...C,gold:C.gold.minus(l.gold),soldiers:C.soldiers.minus(l.laborers),eliteUnits:{...C.eliteUnits,carpenter:(C.eliteUnits.carpenter||o(0)).minus(l.carpenter||0),mason:(C.eliteUnits.mason||o(0)).minus(l.mason||0),architect:(C.eliteUnits.architect||o(0)).minus(l.architect||0)},nationalProjects:{...C.nationalProjects,[r]:{level:n,active:!0,startTime:Date.now(),endTime:Date.now()+u*1e3}}})),a("Construction started!","info")}}),D&&e.jsx(wt,{gameState:t,onGamble:(r,n)=>{const l=o(r);s(u=>({...u,gold:n?u.gold.plus(l):u.gold.minus(l),stats:{...u.stats,tavernGamesPlayed:u.stats.tavernGamesPlayed.plus(o(1))}}))},onClose:()=>z(!1)}),F&&e.jsx(Ct,{gameState:t,onPrestige:rt,onClose:()=>H(!1)}),V&&e.jsx(St,{gameState:t,onClose:()=>$(!1),onHardReset:et,onSave:tt,onOpenChangelog:()=>U(!0),onSetTheme:r=>s(n=>({...n,theme:r})),onSetNumberFormat:r=>s(n=>({...n,numberFormat:r})),onToggleIdleMode:()=>s(r=>({...r,idleModeEnabled:!r.idleModeEnabled})),onUpdateInterface:r=>s(n=>({...n,interface:{...n.interface,...r}}))}),k&&e.jsx(Tt,{gameState:t,currentGps:ce,onClose:()=>A(!1)}),X&&e.jsx(ut,{onClose:()=>U(!1)}),J&&e.jsx(kt,{gameState:t,onHireAdvisor:Ze,onClose:()=>S(!1)}),ie&&e.jsx(zt,{isOpen:ie,onClose:()=>{ae(!1),b(!0)},onConfirm:ot,gameState:t}),de&&e.jsx(Wt,{isOpen:de,onClose:()=>oe(!1),playerProfile:t.playerProfile})]})};export{Yt as A,jt as R,e as j,f as r};
