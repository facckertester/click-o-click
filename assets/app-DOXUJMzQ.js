import{r as jt,g as wt}from"./vendor-B--z-fyW.js";import{t as o,f as w,B as re,P as we,g as ge,a as Oe,b as kt,U as et,c as Ue,S as Te,W as tt,d as be,T as Re,C as _e,A as ye,N as Ct,e as ot,M as Ne,h as nt,i as rt,j as Be,k as he,l as it,m as ve,n as Ce}from"./core-DEU_YNIC.js";import{a as ie,i as St,g as Tt,d as He,s as $e,b as Ye,q as st,c as lt,o as at,l as dt,e as ct}from"./game-DOhdzVw7.js";var Se={exports:{}},me={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qe;function Rt(){if(qe)return me;qe=1;var t=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function a(i,u,r){var x=null;if(r!==void 0&&(x=""+r),u.key!==void 0&&(x=""+u.key),"key"in u){r={};for(var l in u)l!=="key"&&(r[l]=u[l])}else r=u;return u=r.ref,{$$typeof:t,type:i,key:x,ref:u!==void 0?u:null,props:r}}return me.Fragment=n,me.jsx=a,me.jsxs=a,me}var Ke;function Nt(){return Ke||(Ke=1,Se.exports=Rt()),Se.exports}var e=Nt(),y=jt();const Ee=wt(y),Bt=({gameState:t,building:n,x:a,y:i,visible:u,onHide:r})=>{const x=y.useRef(null),[l,f]=y.useState({x:0,y:0});if(y.useEffect(()=>{if(!u||!x.current)return;const j=x.current.getBoundingClientRect();let z=a+15,p=i-j.height/2;z+j.width>window.innerWidth&&(z=a-j.width-15),p<10&&(p=10),p+j.height>window.innerHeight-10&&(p=window.innerHeight-j.height-10),f({x:z,y:p})},[u,a,i]),!u||!n)return null;const d=t.buildings[n.id]||o(0);if(!(t.totalGold.gte(n.baseCost)||d.gt(o(0))))return e.jsxs("div",{ref:x,className:"advanced-tooltip",style:{position:"fixed",left:`${l.x}px`,top:`${l.y}px`,background:"var(--panel-bg)",color:"var(--text-color)",padding:"12px",borderRadius:"2px",border:"4px double var(--accent-color)",fontSize:"15px",lineHeight:"1.4",width:"240px",minWidth:"240px",zIndex:1e4,boxShadow:"var(--shadow)",pointerEvents:"none",transition:"all 0.15s ease"},onMouseLeave:r,children:[e.jsxs("div",{style:{fontWeight:"bold",fontSize:"16px",marginBottom:"8px",color:"var(--accent-color)",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid var(--accent-color)",paddingBottom:"6px"},children:[e.jsx("span",{style:{fontSize:"20px"},children:"‚ùì"}),e.jsx("span",{children:"???"})]}),e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 10px",background:"linear-gradient(135deg, rgba(33, 150, 243, 0.1), rgba(33, 150, 243, 0.05))",borderRadius:"6px",border:"1px solid rgba(33, 150, 243, 0.3)",marginBottom:"6px"},children:[e.jsx("span",{style:{color:"rgba(33, 150, 243, 0.9)",fontWeight:"bold",fontSize:"13px"},children:"Count"}),e.jsx("span",{style:{color:"var(--text-color)",fontWeight:"bold",fontSize:"14px"},children:"???"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 10px",background:"linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(76, 175, 80, 0.05))",borderRadius:"6px",border:"1px solid rgba(76, 175, 80, 0.3)",marginBottom:"6px"},children:[e.jsx("span",{style:{color:"var(--success-color)",fontWeight:"bold",fontSize:"13px"},children:"Production"}),e.jsx("span",{style:{color:"var(--text-color)",fontWeight:"bold",fontSize:"14px"},children:"???/s"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 10px",background:"linear-gradient(135deg, rgba(255, 152, 0, 0.1), rgba(255, 152, 0, 0.05))",borderRadius:"6px",border:"1px solid rgba(255, 152, 0, 0.3)"},children:[e.jsx("span",{style:{color:"#ff9800",fontWeight:"bold",fontSize:"13px"},children:"Income Share"}),e.jsx("span",{style:{color:"var(--text-color)",fontWeight:"bold",fontSize:"14px"},children:"???%"})]})]}),e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 10px",background:"linear-gradient(135deg, rgba(141, 110, 99, 0.1), rgba(141, 110, 99, 0.05))",borderRadius:"6px",border:"1px solid var(--accent-color)",marginBottom:"6px"},children:[e.jsx("span",{style:{color:"var(--accent-color)",fontWeight:"bold",fontSize:"13px"},children:"Next Building"}),e.jsx("span",{style:{color:"var(--accent-color)",fontWeight:"bold",fontSize:"14px"},children:"??? gold"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 10px",background:"linear-gradient(135deg, rgba(156, 39, 176, 0.1), rgba(156, 39, 176, 0.05))",borderRadius:"6px",border:"1px solid rgba(156, 39, 176, 0.3)"},children:[e.jsx("span",{style:{color:"#9c27b0",fontWeight:"bold",fontSize:"13px"},children:"Each Produces"}),e.jsx("span",{style:{color:"var(--text-color)",fontWeight:"bold",fontSize:"14px"},children:"???/s"})]})]}),e.jsx("div",{style:{padding:"6px",background:"rgba(0, 0, 0, 0.05)",borderRadius:"6px",borderTop:"1px solid var(--border-color)",fontSize:"11px",color:"var(--text-secondary)",fontStyle:"italic",textAlign:"center"},children:"???"})]});const h=t.buildings[n.id]||o(0),B=xt(t,n),C=B.times(h),k=Et(t),M=k.gt(0)?C.div(k).times(100):o(0),S=zt(n.baseCost,h);return(S.gt(0)?B.div(S):o(0)).gt(0)?S.div(B):o(0),e.jsxs("div",{ref:x,className:"advanced-tooltip",style:{position:"fixed",left:`${l.x}px`,top:`${l.y}px`,background:"var(--panel-bg)",color:"var(--text-color)",padding:"12px",borderRadius:"2px",border:"4px double var(--accent-color)",fontSize:"15px",lineHeight:"1.4",width:"240px",minWidth:"240px",zIndex:1e4,boxShadow:"var(--shadow)",pointerEvents:"none",transition:"all 0.15s ease"},onMouseLeave:r,children:[e.jsxs("div",{style:{fontWeight:"bold",fontSize:"16px",marginBottom:"8px",color:"var(--accent-color)",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid var(--accent-color)",paddingBottom:"6px"},children:[e.jsx("span",{style:{fontSize:"20px"},children:n.icon}),e.jsx("span",{children:n.name})]}),e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 10px",background:"linear-gradient(135deg, rgba(33, 150, 243, 0.1), rgba(33, 150, 243, 0.05))",borderRadius:"6px",border:"1px solid rgba(33, 150, 243, 0.3)",marginBottom:"6px"},children:[e.jsx("span",{style:{color:"rgba(33, 150, 243, 0.9)",fontWeight:"bold",fontSize:"13px"},children:"Count"}),e.jsx("span",{style:{color:"var(--text-color)",fontWeight:"bold",fontSize:"14px"},children:w(h,t.numberFormat)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 10px",background:"linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(76, 175, 80, 0.05))",borderRadius:"6px",border:"1px solid rgba(76, 175, 80, 0.3)",marginBottom:"6px"},children:[e.jsx("span",{style:{color:"var(--success-color)",fontWeight:"bold",fontSize:"13px"},children:"Production"}),e.jsxs("span",{style:{color:"var(--text-color)",fontWeight:"bold",fontSize:"14px"},children:[w(C,t.numberFormat),"/s"]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 10px",background:"linear-gradient(135deg, rgba(255, 152, 0, 0.1), rgba(255, 152, 0, 0.05))",borderRadius:"6px",border:"1px solid rgba(255, 152, 0, 0.3)"},children:[e.jsx("span",{style:{color:"#ff9800",fontWeight:"bold",fontSize:"13px"},children:"Income Share"}),e.jsxs("span",{style:{color:"var(--text-color)",fontWeight:"bold",fontSize:"14px"},children:[w(M,t.numberFormat),"%"]})]})]}),e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 10px",background:"linear-gradient(135deg, rgba(141, 110, 99, 0.1), rgba(141, 110, 99, 0.05))",borderRadius:"6px",border:"1px solid var(--accent-color)",marginBottom:"6px"},children:[e.jsx("span",{style:{color:"var(--accent-color)",fontWeight:"bold",fontSize:"13px"},children:"Next Building"}),e.jsxs("span",{style:{color:"var(--accent-color)",fontWeight:"bold",fontSize:"14px"},children:[w(S,t.numberFormat)," gold"]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 10px",background:"linear-gradient(135deg, rgba(156, 39, 176, 0.1), rgba(156, 39, 176, 0.05))",borderRadius:"6px",border:"1px solid rgba(156, 39, 176, 0.3)"},children:[e.jsx("span",{style:{color:"#9c27b0",fontWeight:"bold",fontSize:"13px"},children:"Each Produces"}),e.jsxs("span",{style:{color:"var(--text-color)",fontWeight:"bold",fontSize:"14px"},children:[w(B,t.numberFormat),"/s"]})]})]}),e.jsx("div",{style:{padding:"6px",background:"rgba(0, 0, 0, 0.05)",borderRadius:"6px",borderTop:"1px solid var(--border-color)",fontSize:"11px",color:"var(--text-secondary)",fontStyle:"italic",textAlign:"center"},children:n.description})]})};function xt(t,n){var l;let a=n.baseProduction;const i=((l=t.weather)==null?void 0:l.current)||"clear";i==="sunny"&&(n.id==="peasant"||n.id==="field")?a=a.times(o(1.2)):i==="rainy"&&(n.id==="silver_mine"||n.id==="alchemist")?a=a.times(o(1.2)):i==="stormy"?(n.id==="blacksmith"&&(a=a.times(o(1.3))),n.id==="field"&&(a=a.times(o(.8)))):i==="windy"&&n.id==="market"&&(a=a.times(o(1.15)));let u=0;t.nationalProjects&&Object.values(t.nationalProjects).forEach(f=>{u+=f.level||0});const r=1+u*we;a=a.times(o(r));const x=ee(t.renown);return a=a.times(x),a}function ee(t){const n=t.toNumber();if(n<=0)return o(1);let a=o(1);n<=100?a=o(1+n*.01):n<=1e3?a=o(2).plus(o(n-100).times(o(.005))):n<=1e4?a=o(2.5).plus(o(n-1e3).times(o(.001))):a=o(10).plus(o(10).times(Math.log10(n)));const i=o(1e3);return ie.min(a,i)}function Et(t){let n=o(0);return re.forEach(a=>{const i=t.buildings[a.id]||o(0);if(i.gt(0)){const u=xt(t,a);n=n.plus(u.times(i))}}),n}function zt(t,n){return t.times(o(1.15).pow(n)).floor()}const Xe=(t,n=!1,a=!1,i=!1)=>({display:"flex",alignItems:"center",padding:"var(--panel-padding)",background:a?"rgba(0,0,0,0.05)":n?"rgba(46, 125, 50, 0.1)":i?"#f3e5f5":"var(--panel-bg)",border:"1px solid",borderColor:a?"rgba(0,0,0,0.2)":i?"#7b1fa2":t?"var(--accent-color)":"rgba(0,0,0,0.1)",borderRadius:"2px",cursor:t&&!a?"pointer":"default",opacity:t&&!a||n?1:.7,transition:"all 0.2s",boxShadow:t&&!a?"2px 2px 0 rgba(0,0,0,0.1)":"none",position:"relative",userSelect:"none",marginBottom:"var(--gap-size)",filter:a?"grayscale(1)":"none"}),pt={display:"flex",flexDirection:"column",gap:"var(--gap-size)",height:"100%",overflowY:"auto",padding:"var(--panel-padding)"},Ve=({gameState:t,onBuyBuilding:n,onSellBuilding:a,onSetBuyAmount:i})=>{var S;const[u,r]=y.useState({visible:!1,x:0,y:0,building:null}),x=o(1),l=((S=t.interface)==null?void 0:S.lastBuyAmount)||o(1),[f,d]=y.useState(!1),[m,h]=y.useState(1);y.useEffect(()=>{const b=z=>{z.ctrlKey?h(10):z.shiftKey?h(100):h(1)},E=z=>b(z),j=z=>b(z);return window.addEventListener("keydown",E),window.addEventListener("keyup",j),()=>{window.removeEventListener("keydown",E),window.removeEventListener("keyup",j)}},[]);const B=(b,E)=>{const j=b.currentTarget.getBoundingClientRect();r({visible:!0,x:j.right,y:j.top+j.height/2,building:E})},C=()=>{r({visible:!1,x:0,y:0,building:null})},k=(b,E)=>{var R;let j=E;const z=((R=t.weather)==null?void 0:R.current)||"clear";z==="sunny"&&(b==="peasant"||b==="field")?j=j.times(o(1.2)):z==="rainy"&&(b==="silver_mine"||b==="alchemist")?j=j.times(o(1.2)):z==="stormy"?(b==="blacksmith"&&(j=j.times(o(1.3))),b==="field"&&(j=j.times(o(.8)))):z==="windy"&&b==="market"&&(j=j.times(o(1.15)));let p=o(1),A=0;t.nationalProjects&&Object.values(t.nationalProjects).forEach(F=>A+=F.level||0);const G=1+A*.05;p=p.times(o(G));const U=ee(t.renown);return p=p.times(U),j.times(p)};let M=0;return e.jsxs("div",{style:pt,children:[e.jsx("div",{style:{display:"flex",gap:"5px",marginBottom:"10px",justifyContent:"center"},children:[o(1),o(10),o(100),o(500),o(1e3),o(-1)].map(b=>e.jsx("button",{onClick:()=>i(b),style:{padding:"5px 10px",border:"1px solid var(--accent-color)",background:l.equals(b)?"var(--accent-color)":"var(--panel-bg)",color:l.equals(b)?"var(--text-on-accent)":"var(--text-color)",cursor:"pointer",fontWeight:"bold",fontSize:"0.8rem"},children:b.equals(o(-1))?"Max":`${b.toString()}`},`amount-${b.toString()}`))}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center"},children:"Hold Ctrl: x10 ‚Ä¢ Hold Shift: x100"}),e.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"10px",justifyContent:"center"},children:[e.jsx("button",{className:"btn",style:{background:f?"var(--panel-bg)":"var(--accent-color)",color:f?"var(--text-color)":"var(--text-on-accent)",border:"1px solid var(--accent-color)",padding:"5px 15px",fontSize:"0.8rem"},onClick:()=>d(!1),children:"üõí Buy Mode"}),e.jsx("button",{className:"btn",style:{background:f?"#e65100":"var(--panel-bg)",color:f?"var(--text-on-accent)":"var(--text-color)",border:"1px solid #e65100",padding:"5px 15px",fontSize:"0.8rem"},onClick:()=>d(!0),children:"üí∞ Sell Mode (25%)"})]}),e.jsx("h3",{style:{fontSize:"1rem",color:"var(--text-secondary)",fontWeight:"bold",borderBottom:"1px solid var(--border-color)",paddingBottom:"5px"},children:"Estates"}),re.map((b,E)=>{const j=t.buildings[b.id]||o(0),z=t.totalGold.gte(b.baseCost)||j.gt(o(0));if(z||M++,!z&&M>2)return null;if(f){if(j.eq(o(0)))return null;let N;l.equals(o(-1))?N=j:(N=l.times(m),N.gt(j)&&(N=j));const P=ge(b.baseCost,j.minus(N),N).times(o(.25)).floor();return k(b.id,b.baseProduction),e.jsxs("div",{style:Xe(!0,!1,!1,!1),onClick:()=>a(b.id,N.toNumber()),onMouseEnter:H=>B(H,b),onMouseLeave:C,children:[e.jsx("div",{style:{fontSize:"2rem",marginRight:"15px",width:"40px",textAlign:"center"},children:b.icon}),e.jsx("div",{style:{flex:1},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"var(--text-color)"},children:b.name}),e.jsx("span",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"var(--accent-color)"},children:w(j,t.numberFormat)})]})}),e.jsxs("div",{style:{marginLeft:"12px",minWidth:"70px",textAlign:"right"},children:[e.jsxs("div",{style:{color:"var(--accent-color)",fontWeight:"bold"},children:["+",w(P,t.numberFormat)]}),e.jsxs("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)"},children:["for ",w(N,t.numberFormat)]})]})]},b.id)}let p=o(0),A=o(0);l.equals(o(-1))?(p=Oe(b.baseCost,j,t.gold.div(x)),p.eq(o(0))?(p=o(1),A=kt(b.baseCost,j).times(x).floor()):A=ge(b.baseCost,j,p).times(x).floor()):(p=l,A=ge(b.baseCost,j,p).times(x).floor());const G=t.gold.gte(A),U=l.equals(o(-1))&&Oe(b.baseCost,j,t.gold.div(x)).eq(o(0));let R=p,F=A,D=G;return l.equals(o(-1))||(R=p.times(m),F=ge(b.baseCost,j,R).times(x).floor(),D=t.gold.gte(F)),e.jsxs("div",{style:Xe(D&&!U,!1,!z),onClick:()=>{if(!(D&&!U))return;const N=l.equals(o(-1))?p:R;n(b.id,N.toNumber())},onMouseEnter:N=>B(N,b),onMouseLeave:C,children:[e.jsx("div",{style:{fontSize:"2rem",marginRight:"15px",width:"40px",textAlign:"center"},children:z?b.icon:"‚ùì"}),e.jsx("div",{style:{flex:1},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"var(--text-color)"},children:z?b.name:"???"}),e.jsx("span",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"var(--accent-color)"},children:w(j,t.numberFormat)})]})}),e.jsxs("div",{style:{marginLeft:"12px",minWidth:"70px",textAlign:"right"},children:[e.jsx("div",{style:{color:D&&!U?"var(--gold-color)":"var(--text-secondary)",fontWeight:"bold"},children:w(l.equals(o(-1))?A:F,t.numberFormat)}),!l.equals(o(-1))&&e.jsxs("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)"},children:["for ",w(R,t.numberFormat)]})]})]},b.id)}),e.jsx(Bt,{gameState:t,building:u.building,x:u.x,y:u.y,visible:u.visible,onHide:C})]})},Je=({gameState:t,onTrainSoldier:n,onTrainElite:a})=>{const[i,u]=y.useState(1);y.useEffect(()=>{const x=f=>{f.ctrlKey&&!f.shiftKey?u(10):f.shiftKey&&!f.ctrlKey?u(100):f.ctrlKey&&f.shiftKey&&u(1e3)},l=()=>u(1);return window.addEventListener("keydown",x),window.addEventListener("keyup",l),()=>{window.removeEventListener("keydown",x),window.removeEventListener("keyup",l)}},[]);const r=x=>Ue(Te.times(o(x)),t.renown);return e.jsxs("div",{style:pt,children:[e.jsxs("div",{style:{padding:"15px",background:"var(--panel-bg)",borderRadius:"4px",marginBottom:"10px",border:"1px solid var(--border-color)"},children:[e.jsx("div",{style:{fontSize:"1.2rem",fontWeight:"bold",marginBottom:"5px",color:"var(--text-color)"},children:"Construction Workforce"}),e.jsx("div",{style:{fontSize:"2rem",color:"var(--text-color)"},children:w(t.soldiers,t.numberFormat)}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:"General Laborers Available"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",marginBottom:"20px"},children:[e.jsxs("button",{className:"btn",disabled:t.gold.lt(r(1*i)),onClick:()=>{n(1*i)},"data-tooltip":`Hire 1 laborer - Cost: ${w(r(1*i),t.numberFormat)} Gold`,children:["Hire ",i>1?`${1*i}`:"1"," (",w(r(1*i),t.numberFormat)," G)"]}),e.jsxs("button",{className:"btn",disabled:t.gold.lt(r(10*i)),onClick:()=>{n(10*i)},"data-tooltip":`Hire 10 laborers - Cost: ${w(r(10*i),t.numberFormat)} Gold`,children:["Hire ",i>1?`${10*i}`:"10"," (",w(r(10*i),t.numberFormat)," G)"]}),e.jsxs("button",{className:"btn",disabled:t.gold.lt(r(100*i)),onClick:()=>{n(100*i)},"data-tooltip":`Hire 100 laborers - Cost: ${w(r(100*i),t.numberFormat)} Gold`,children:["Hire ",i>1?`${100*i}`:"100"," (",w(r(100*i),t.numberFormat)," G)"]}),e.jsxs("button",{className:"btn",disabled:t.gold.lt(r(1e3*i)),onClick:()=>{n(1e3*i)},"data-tooltip":`Hire 1K laborers - Cost: ${w(r(1e3*i),t.numberFormat)} Gold`,children:["Hire ",i>1?`${1e3*i/1e3}K`:"1K"," (",w(r(1e3*i),t.numberFormat)," G)"]}),e.jsxs("button",{className:"btn",disabled:t.gold.lt(r(1e6*i)),onClick:()=>{n(1e6*i)},"data-tooltip":`Hire 1M laborers - Cost: ${w(r(1e6*i),t.numberFormat)} Gold`,children:["Hire ",i>1?`${1e6*i/1e6}M`:"1M"," (",w(r(1e6*i),t.numberFormat)," G)"]})]}),e.jsxs("div",{style:{borderTop:"2px solid var(--border-color)",paddingTop:"15px"},children:[e.jsxs("h3",{style:{fontSize:"1rem",color:"var(--accent-color)",fontWeight:"bold",marginBottom:"10px"},children:["Specialist Guild ",e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:"normal",color:"var(--text-secondary)"},children:"(Train from Laborers)"})]}),et.map(x=>{const l=t.eliteUnits[x.id]||o(0),d={carpenter:"blacksmith",mason:"castle",architect:"palace"}[x.id],m=d?t.buildings[d]||o(0):o(0),h=Ue(x.goldCost,t.renown),B=t.soldiers.gte(x.soldierCost),C=t.gold.gte(h)&&B;return!d||m.lt(o(1))?null:e.jsxs("div",{style:{marginBottom:"10px",padding:"10px",background:"var(--panel-bg)",border:"1px solid var(--border-color)",borderRadius:"4px",display:"flex",alignItems:"center",gap:"10px"},"data-tooltip":"",children:[e.jsx("div",{style:{fontSize:"2rem"},children:x.icon}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{fontWeight:"bold",color:"var(--text-color)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("span",{children:[x.name," ",e.jsxs("span",{style:{color:"var(--text-secondary)"},children:["x",w(l,t.numberFormat)]})]}),e.jsxs("button",{className:"btn",style:{padding:"5px 10px",fontSize:"0.8rem"},disabled:!C,onClick:()=>a(x.id,i),onMouseEnter:k=>{C||(k.currentTarget.style.cursor="not-allowed")},onMouseLeave:k=>{k.currentTarget.style.cursor="pointer"},"data-tooltip":"",children:["Train ",i>1?`x${i}`:""]})]}),e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"4px"},children:x.description}),e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"2px"},children:["Requires ",w(h,t.numberFormat)," Gold and ",w(x.soldierCost,t.numberFormat)," Laborers"]})]})]},x.id)})]})]})},Wt=Ee.memo(({renown:t,totalRenownEarned:n,numberFormat:a})=>{const i=ee(n).minus(o(1)).times(o(100)).floor().toString();return e.jsxs("div",{style:{padding:"5px 15px",background:"rgba(103, 58, 183, 0.1)",border:"1px solid rgba(103, 58, 183, 0.3)",borderRadius:"20px",display:"inline-block"},children:[e.jsxs("div",{style:{color:"#673ab7",fontWeight:"bold",fontSize:"1rem"},children:["üëë Current: ",w(t,a)," Renown"]}),e.jsxs("div",{style:{color:"#673ab7",fontWeight:"bold",fontSize:"1rem"},children:["üëë Total: ",w(n,a)," (+",i,"% Bonus)"]})]})}),Ze=Ee.memo(({gameState:t,gps:n,onClick:a,onEventInteract:i,onOpenTavern:u,onOpenPrestige:r,onOpenSettings:x,onOpenStatistics:l,onOpenLeaderboard:f,onOpenEmpire:d,isIdle:m})=>{var A,G,U;const[h,B]=y.useState([]),C=y.useRef(null),k=t.interface||{showFloatingText:!0,showWeatherWidget:!0,crownAnimations:!0},M=()=>{let R=0;return t.nationalProjects&&Object.values(t.nationalProjects).forEach(F=>{R+=F.level*we}),o(R)},S=R=>{var F;if(k.showFloatingText){const D=(F=C.current)==null?void 0:F.getBoundingClientRect();if(D){const N=R.clientX-D.left+(Math.random()*40-20),P=R.clientY-D.top+(Math.random()*40-20),H=ee(t.renown),q=o(1),X=t.clickUpgradeLevel||0,te=Math.min(X,15),J=o(2).pow(te),oe=q.times(J),ce=be(X),xe=n.times(ce);let ne=oe.plus(xe);if(ne=ne.times(H),t.godMode){const Z=n.times(o(99999));ne=ne.plus(Z)}const K="+"+w(ne,t.numberFormat),le={id:Date.now(),x:N,y:P,val:K};B(Z=>[...Z,le]),setTimeout(()=>{B(Z=>Z.filter(ae=>ae.id!==le.id))},1e3)}}a(R)},b=tt[((A=t.weather)==null?void 0:A.current)||"clear"],E={transition:"transform 0.8s ease-in-out, width 0.8s ease-in-out, height 0.8s ease-in-out, margin 0.8s ease-in-out, position 0.8s ease-in-out"},j=m?{position:"fixed",bottom:"120px",right:"30px",transform:"scale(0.8)",transformOrigin:"bottom right",textAlign:"right",zIndex:100,...E}:{transform:"scale(1)",marginBottom:"3rem",zIndex:10,textAlign:"center",...E},z=m?{width:"80px",height:"80px",fontSize:"2rem",position:"fixed",bottom:"30px",right:"30px",borderRadius:"50%",zIndex:100,...E}:{width:"260px",height:"260px",fontSize:"6rem",borderRadius:"50%",position:"relative",zIndex:5,margin:"0 auto",...E},p={opacity:m?0:1,transition:"opacity 0.5s ease-in-out",pointerEvents:m?"none":"auto"};return e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",padding:"var(--panel-padding)",height:"100%",overflow:"hidden"},children:[k.showWeatherWidget&&e.jsxs("div",{style:{position:"absolute",top:"10px",left:"10px",zIndex:20,background:b.color,padding:"8px 12px",borderRadius:"20px",border:"2px solid rgba(0,0,0,0.1)",boxShadow:"2px 2px 5px rgba(0,0,0,0.1)",display:"flex",alignItems:"center",gap:"8px",cursor:"help",...p},"data-tooltip":`${b.name}: ${b.description}`,children:[e.jsx("span",{style:{fontSize:"1.5rem"},children:b.icon}),e.jsxs("div",{style:{textAlign:"left",lineHeight:"1.1"},children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem",color:"#222"},children:b.name}),e.jsxs("div",{style:{fontSize:"0.7rem",color:"#444"},children:[o(Number(((G=t.weather)==null?void 0:G.timeLeft)||0)).ceil().toString(),"s remaining"]})]})]}),e.jsxs("div",{style:{position:"absolute",top:"10px",right:"10px",zIndex:20,display:"flex",gap:"5px",...p},children:[e.jsx("button",{onClick:f,style:{background:"transparent",border:"none",fontSize:"1.5rem",cursor:"pointer",opacity:.8,color:"var(--text-color)",transition:"all 0.2s ease"},title:"Leaderboard (Available for all players)",children:"üèÜ"}),e.jsx("button",{onClick:l,style:{background:"transparent",border:"none",fontSize:"1.5rem",cursor:"pointer",opacity:.7,color:"var(--text-color)"},title:"Statistics",children:"üìä"}),e.jsx("button",{onClick:x,style:{background:"transparent",border:"none",fontSize:"1.5rem",cursor:"pointer",opacity:.7,color:"var(--text-color)"},title:"Kingdom Settings",children:"‚öôÔ∏è"})]}),e.jsxs("div",{style:j,children:[e.jsx("div",{style:{fontSize:"1rem",color:m?"var(--text-color)":"var(--text-secondary)",marginBottom:"5px",textTransform:"uppercase",letterSpacing:"2px",textShadow:m?"1px 1px 2px #000":"none"},children:"Royal Treasury"}),e.jsx("div",{style:{fontSize:"3rem",fontFamily:"var(--font-main)",color:"var(--text-color)",textShadow:m?"2px 2px 4px #000":"2px 2px 0px rgba(255, 215, 0, 0.4)"},children:w(t.gold,t.numberFormat)}),e.jsxs("div",{style:{marginTop:"5px",fontSize:"1.1rem",color:m?"#90ee90":"var(--success-color)",fontStyle:"italic",textShadow:m?"1px 1px 2px #000":"none"},children:["+",w(n,t.numberFormat)," gold / sec"]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"10px",marginTop:"15px"},children:[e.jsx(Wt,{renown:t.renown,totalRenownEarned:t.totalRenownEarned,numberFormat:t.numberFormat}),e.jsx("div",{style:{padding:"5px 15px",background:"rgba(76, 175, 80, 0.1)",border:"1px solid rgba(76, 175, 80, 0.3)",borderRadius:"20px",display:"inline-block"},children:e.jsxs("span",{style:{color:"#4caf50",fontWeight:"bold"},children:["üèóÔ∏è Projects: +",M().times(o(100)).floor().toString(),"%"]})})]})]}),e.jsxs("div",{style:{position:"relative",marginBottom:m?0:"3rem",display:"flex",justifyContent:"center",alignItems:"center"},children:[e.jsx("div",{className:"magnetic-container",children:e.jsx("button",{ref:C,className:`main-button ${m?"idle":""} ${k.crownAnimations?"":"no-animations"}`,style:{...z,display:"flex",alignItems:"center",justifyContent:"center",outline:"none",color:"#5d4037",cursor:"pointer",overflow:"hidden"},onClick:S,children:e.jsx("span",{className:k.crownAnimations?"crown-icon":"",style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",lineHeight:1,marginTop:"-10px"},children:"üëë"})})}),!m&&h.map(R=>e.jsx("div",{className:"floating-text",style:{left:R.x,top:R.y},children:R.val},R.id))]}),e.jsxs("div",{style:{display:"flex",gap:"10px",zIndex:10,flexWrap:"wrap",justifyContent:"center",...p},children:[t.buildings.field&&t.buildings.field.gt(o(0))&&e.jsx("button",{className:"btn",style:{background:"var(--accent-color)",borderColor:"var(--gold-color)"},onClick:d,children:"üèóÔ∏è Projects"}),((U=t.buildings.tavern)==null?void 0:U.gt(o(0)))&&e.jsx("button",{className:"btn",onClick:u,children:"üç∫ Tavern"}),(t.totalGold.gt(o(5e5))||t.renown.gt(o(0)))&&e.jsx("button",{className:"btn",style:{background:"var(--accent-color)"},onClick:r,children:"üëë Legacy"})]}),!m&&t.event&&t.event.type==="dragon"&&e.jsx("div",{className:"dragon-event",onMouseDown:()=>{try{i(t.event)}catch(R){console.error("Error clicking dragon:",R)}},children:"üêâ"}),!m&&t.event&&t.event.type==="merchant"&&e.jsxs("div",{style:{position:"absolute",right:"20px",top:"100px",background:"#fff3e0",padding:"10px",border:"2px solid orange",zIndex:100,cursor:"pointer",animation:"pop 0.5s",borderRadius:"8px",boxShadow:"2px 2px 5px rgba(0,0,0,0.2)"},onClick:()=>i(t.event),children:[e.jsx("div",{style:{fontSize:"1.5rem",textAlign:"center"},children:"üë≥"}),e.jsx("div",{style:{fontWeight:"bold",color:"#000"},children:"Merchant"}),e.jsx("small",{style:{color:"#444"},children:"Click for gift"})]}),!m&&t.event&&t.event.type==="jester"&&e.jsxs("div",{style:{position:"absolute",left:"20px",top:"100px",background:"#fce4ec",padding:"10px",border:"2px solid pink",zIndex:100,cursor:"pointer",animation:"pop 0.5s",borderRadius:"8px",boxShadow:"2px 2px 5px rgba(0,0,0,0.2)"},onClick:()=>i(t.event),children:[e.jsx("div",{style:{fontSize:"1.5rem",textAlign:"center"},children:"ü§°"}),e.jsx("div",{style:{fontWeight:"bold",color:"#000"},children:"Jester"}),e.jsx("small",{style:{color:"#444"},children:"Risk it all?"})]})]})}),ze=({currentBet:t,maxGold:n,onBetChange:a,numberFormat:i})=>{const[u,r]=y.useState(t===0?"":t.toString());y.useEffect(()=>{var m,h;t===0&&((m=document.activeElement)==null?void 0:m.tagName)!=="INPUT"?r(""):Math.abs(parseFloat(u)-t)>1e-4&&((h=document.activeElement)==null?void 0:h.tagName)!=="INPUT"&&r(t>1e9?t.toExponential(2).replace("+",""):t.toString())},[t]);const x=m=>{try{if(m.trim()===""){a(0),r("");return}let h=parseFloat(m);const B=m.toLowerCase().trim(),C={k:1e3,m:1e6,b:1e9,t:1e12,qa:1e15,qi:1e18,sx:1e21,sp:1e24,oc:1e27,no:1e30,dc:1e33,ud:1e36,dd:1e39,td:1e42,qd:1e45,qn:1e48};for(const M of Object.keys(C))if(B.endsWith(M)){const S=parseFloat(B.slice(0,-M.length));isNaN(S)||(h=S*C[M]);break}(isNaN(h)||h<0)&&(h=0);const k=n.toNumber();isFinite(k)&&h>k?h=k:!isFinite(k)&&o(h).gt(n)&&(h=Number.MAX_VALUE),a(h),h===0?r(""):h>=1e6?r(h.toExponential(2).replace("+","")):r(Math.floor(h).toString())}catch{r(t===0?"":t.toString())}},l=()=>{x(u)},f=m=>{m.key==="Enter"&&(x(u),m.target.blur())},d=m=>{let B=n.times(m).floor().toNumber();isFinite(B)||(B=Number.MAX_VALUE),B<1&&n.gt(0)&&(B=1),a(B),B>=1e6?r(B.toExponential(2).replace("+","")):r(B.toString())};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px",width:"100%"},children:[e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center"},children:[e.jsx("span",{style:{position:"absolute",left:"10px",pointerEvents:"none",fontSize:"1.2rem"},children:"üí∞"}),e.jsx("input",{type:"text",value:u,onChange:m=>r(m.target.value),onBlur:l,onKeyDown:f,style:{width:"100%",padding:"10px 30px 10px 35px",fontSize:"1.1rem",border:"2px solid var(--border-color)",borderRadius:"4px",fontFamily:"monospace",background:"#fff",color:"#000",outline:"none",fontWeight:"bold"},placeholder:"Wager (100, 1k, 2.5m, 1b, 2e13)..."}),t>0&&e.jsx("button",{onClick:()=>{a(0),r("")},style:{position:"absolute",right:"5px",top:"50%",transform:"translateY(-50%)",background:"transparent",border:"none",color:"#999",fontSize:"1.2rem",cursor:"pointer",padding:"0 5px"},title:"Clear",children:"‚úï"})]}),e.jsxs("div",{style:{display:"flex",gap:"4px",justifyContent:"space-between"},children:[e.jsx("button",{className:"btn",style:{padding:"4px 8px",fontSize:"0.7rem",flex:1,background:"rgba(0,0,0,0.1)",color:"var(--text-color)",border:"1px solid var(--border-color)"},onClick:()=>d(.1),children:"10%"}),e.jsx("button",{className:"btn",style:{padding:"4px 8px",fontSize:"0.7rem",flex:1,background:"rgba(0,0,0,0.1)",color:"var(--text-color)",border:"1px solid var(--border-color)"},onClick:()=>d(.5),children:"50%"}),e.jsx("button",{className:"btn",style:{padding:"4px 8px",fontSize:"0.7rem",flex:1,background:"var(--gold-color)",color:"#000",border:"1px solid #b8860b"},onClick:()=>d(1),children:"MAX"}),e.jsx("div",{style:{width:"4px"}}),e.jsx("button",{className:"btn",style:{padding:"4px 8px",fontSize:"0.7rem",flex:1,background:"rgba(0,0,0,0.1)",color:"var(--text-color)",border:"1px solid var(--border-color)"},onClick:()=>x(Math.floor(t/2).toString()),children:"¬Ω"}),e.jsx("button",{className:"btn",style:{padding:"4px 8px",fontSize:"0.7rem",flex:1,background:"rgba(0,0,0,0.1)",color:"var(--text-color)",border:"1px solid var(--border-color)"},onClick:()=>x((t*2).toString()),children:"x2"})]})]})},Mt=["Shadowfax","Roach","Bucephalus","Pegasus","Sleipnir","Epona","Agro","Artax","Rapidash","Spirit","Bullseye","Maximus","Khan","Buckbeak","Chestnut","Midnight","Storm","Blaze","Comet","Dakota"],Lt=["#d32f2f","#1976d2","#388e3c","#fbc02d","#8e24aa","#ef6c00"],At=50,Pt=({gameState:t,onGamble:n,onLeave:a})=>{const[i,u]=y.useState([]),[r,x]=y.useState(null),[l,f]=y.useState(0),[d,m]=y.useState("betting"),[h,B]=y.useState(""),[C,k]=y.useState(null),M=y.useRef(null),S=y.useRef([]);y.useEffect(()=>{b()},[]);const b=()=>{const p=[],A=[...Mt].sort(()=>.5-Math.random());for(let G=0;G<6;G++){const U=Math.random()*5+5,R=Math.random()*5+5;let D=25-(U+R);D=D+(Math.random()*4-2),D<1.5&&(D=1.5),D>20&&(D=20),p.push({id:G,name:A[G],color:Lt[G],icon:"üêé",odds:parseFloat(D.toFixed(1)),progress:0,finished:!1,rank:0,speedRating:U,staminaRating:R})}u(p),x(null),k(null),S.current=[],B("Select a horse and place your bet!")},E=()=>{if(r===null){B("Select a horse first!");return}if(l<=0){B("Place a valid bet!");return}if(t.gold.lt(o(l))){B("Not enough gold!");return}m("racing"),B("And they're off!");let p=0;const A=400;M.current=setInterval(()=>{p++,u(G=>G.map(R=>{if(R.finished)return R;const F=Math.random()<.05?1:0,D=Math.random()<.05?-.5:0,N=.15,P=R.speedRating/10*.15,H=Math.random()*.2;let q=N+P+H+F+D,X=R.progress+q;return X>=100&&(X=100,!S.current.includes(R.id))?(S.current.push(R.id),{...R,progress:100,finished:!0,rank:S.current.length}):{...R,progress:X}}).slice(0,6)),(S.current.length===6||p>=A)&&(S.current.length<6&&u(G=>(G.filter(R=>!R.finished).sort((R,F)=>F.progress-R.progress).forEach(R=>{S.current.includes(R.id)||S.current.push(R.id)}),G.map(R=>{const F=S.current.indexOf(R.id);return F!==-1?{...R,rank:F+1,finished:!0,progress:100}:R}))),j())},At)},j=()=>{M.current&&clearInterval(M.current);const p=i.map(R=>{const F=S.current.indexOf(R.id);return F!==-1?{...R,rank:F+1,finished:!0}:R});u(p);const A=S.current[0],G=p.find(R=>R.id===A);if(!G)return;if(m("finished"),A===r){const R=p.find(N=>N.id===r),F=(R==null?void 0:R.odds)||1,D=Math.max(1,Math.floor(l*(F-1)));n(D,!0),k({won:!0,amount:D,winnerName:G.name})}else n(l,!1),k({won:!1,amount:l,winnerName:G.name})};y.useEffect(()=>()=>{M.current&&clearInterval(M.current)},[]);const z=()=>{m("betting"),f(0),b()};return C&&(C.won,C.won,C.won,C.won,C.won,C.winnerName,C.won?(e.Fragment,w(o(C.amount),t.numberFormat)):(e.Fragment,w(o(C.amount),t.numberFormat))),e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[e.jsx("div",{style:{padding:"5px",textAlign:"center",background:"#e0cda9",borderBottom:"1px solid #5d4037",color:"#5d4037",fontWeight:"bold"},children:h}),e.jsxs("div",{style:{flex:1,background:"#e0cda9",padding:"10px 0",overflow:"hidden",display:"flex",flexDirection:"column",justifyContent:"space-between",position:"relative"},children:[e.jsx("div",{style:{position:"absolute",right:"40px",top:0,bottom:0,width:"10px",background:"repeating-linear-gradient(45deg, #000, #000 10px, #fff 10px, #fff 20px)",zIndex:0,borderLeft:"2px solid rgba(0,0,0,0.2)",borderRight:"2px solid rgba(0,0,0,0.2)",height:"100%"}}),i.map(p=>e.jsxs("div",{onClick:()=>d==="betting"&&x(p.id),style:{position:"relative",flex:1,minHeight:"30px",borderBottom:"1px dashed rgba(93, 64, 55, 0.3)",display:"flex",alignItems:"center",cursor:d==="betting"?"pointer":"default",background:r===p.id?"rgba(255, 215, 0, 0.3)":"rgba(255,255,255,0.1)",transition:"background 0.2s"},children:[e.jsxs("div",{style:{width:"100px",padding:"0 10px",borderRight:"1px solid var(--border-color)",display:"flex",flexDirection:"column",justifyContent:"center",zIndex:2,background:"var(--panel-bg)",height:"100%"},children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.8rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",color:"var(--text-color)"},children:p.name}),e.jsxs("div",{style:{fontSize:"0.9rem",color:r===p.id?"var(--accent-color)":"var(--text-secondary)",fontWeight:"bold"},children:[p.odds.toFixed(1),"x"]})]}),e.jsx("div",{style:{position:"absolute",left:`calc(100px + ${p.progress}% - ${p.progress*.8}px)`,transition:d==="racing"?"left 0.05s linear":"left 0.3s ease",fontSize:"2rem",zIndex:1,transform:"scaleX(-1) translateY(-5px)",filter:r===p.id?"drop-shadow(0 0 5px gold)":"drop-shadow(0 2px 2px rgba(0,0,0,0.3))",color:p.color},children:e.jsx("div",{style:{fontSize:"2rem"},children:p.icon})}),p.finished&&e.jsx("div",{style:{position:"absolute",right:"10px",fontWeight:"bold",fontSize:"1.2rem",zIndex:5,color:"#000",textShadow:"0 0 2px rgba(0,0,0,0.3)"},children:p.rank===1?"ü•á":p.rank===2?"ü•à":p.rank===3?"ü•â":p.rank?`#${p.rank}`:"?"})]},p.id))]}),e.jsxs("div",{style:{padding:"15px 20px",background:"var(--panel-bg)",borderTop:"2px solid var(--border-color)",flexShrink:0,display:"flex",flexDirection:"row",gap:"15px",alignItems:"flex-end"},children:[e.jsx("div",{style:{flex:1},children:e.jsx(ze,{currentBet:l,maxGold:t.gold,onBetChange:f,numberFormat:t.numberFormat})}),e.jsxs("div",{style:{flexShrink:0},children:[d==="betting"&&e.jsx("button",{className:"btn",onClick:E,disabled:r===null||l<=0,style:{opacity:r===null||l<=0?.5:1,fontSize:"1.2rem",padding:"0 30px",height:"60px",background:"var(--accent-color)",boxShadow:"0 4px 0 rgba(0,0,0,0.2)",fontWeight:"bold"},children:"START"}),d==="finished"&&e.jsx("button",{className:"btn",onClick:z,style:{fontSize:"1.2rem",padding:"0 30px",height:"60px",background:"var(--accent-color)",boxShadow:"0 4px 0 rgba(0,0,0,0.2)",fontWeight:"bold"},children:"RACE AGAIN"}),d==="racing"&&e.jsx("div",{style:{width:"100%",height:"60px"}})]})]}),e.jsxs("div",{style:{padding:"10px 20px",background:"var(--panel-bg)",borderTop:"1px solid var(--border-color)",textAlign:"center",fontSize:"1rem",fontWeight:"bold"},children:[e.jsx("span",{style:{marginRight:"10px",color:"var(--text-secondary)"},children:"Result:"}),C?e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{marginRight:"10px"},children:C.won?"üèá":"üê¢"}),e.jsx("span",{style:{color:C.won?"#4caf50":"#f44336",marginRight:"10px"},children:C.won?"Winner!":"Better luck next time"}),e.jsxs("span",{style:{color:"var(--accent-color)",marginRight:"10px"},children:["Winner: ",C.winnerName]}),e.jsxs("span",{style:{color:C.won?"gold":"#ef5350"},children:[C.won?"+":"-",w(o(C.amount),t.numberFormat)," Gold"]})]}):e.jsx("span",{style:{color:"var(--text-secondary)",fontStyle:"italic"},children:"No results yet"})]})]})},Ft=({gameState:t,onGamble:n,onLeave:a})=>{const[i,u]=y.useState(0),[r,x]=y.useState(null),[l,f]=y.useState(!1),[d,m]=y.useState(0),[h,B]=y.useState(null),[C,k]=y.useState("Select a side and place your wager.");h&&(h.won,h.won,h.won,h.won,h.won,h.side,h.won?(e.Fragment,w(o(h.amount),t.numberFormat)):(e.Fragment,w(o(h.amount),t.numberFormat)));const M=()=>{if(!r){k("Please select Heads or Tails!");return}if(i<=0){k("Please enter a valid bet amount.");return}if(t.gold.lt(o(i))){k("Not enough gold!");return}f(!0),k("");const b=Math.random()>.5?"heads":"tails",E=r===b,j=d,p=360*5;let A=j+p;const G=A%360;b==="heads"?A+=360-G:A+=180-G+360,m(A),setTimeout(()=>{f(!1),E?(n(i,!0),k("Victory!")):(n(i,!1),k("Defeat!")),setTimeout(()=>{B({won:E,amount:i,side:b})},500)},3e3)};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[e.jsx("style",{children:`
            .coin-container {
                perspective: 1000px;
                width: 180px;
                height: 180px;
                margin: 0 auto;
            }
            .coin {
                width: 100%;
                height: 100%;
                position: relative;
                transform-style: preserve-3d;
                transition: transform 3s cubic-bezier(0.1, 0.7, 0.1, 1);
            }
            .coin-face {
                position: absolute;
                width: 100%;
                height: 100%;
                backface-visibility: hidden;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 5rem;
                box-shadow: inset 0 0 30px rgba(0,0,0,0.5), 0 10px 20px rgba(0,0,0,0.3);
                border: 10px solid #b8860b;
            }
            .coin-front {
                background: radial-gradient(#ffd700, #daa520);
                color: #5d4037;
                transform: rotateY(0deg);
            }
            .coin-back {
                background: radial-gradient(#e6c200, #b8860b);
                color: #5d4037;
                transform: rotateY(180deg);
            }
            .coin-text {
                font-family: 'Cinzel', serif;
                font-weight: bold;
                text-shadow: 2px 2px 0 rgba(255,255,255,0.4);
            }
        `}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",position:"relative",background:"var(--bg-color)",overflow:"hidden"},children:[e.jsx("div",{className:"coin-container",children:e.jsxs("div",{className:"coin",style:{transform:`rotateY(${d}deg)`},children:[e.jsx("div",{className:"coin-face coin-front",children:e.jsx("span",{className:"coin-text",children:"üëë"})}),e.jsx("div",{className:"coin-face coin-back",children:e.jsx("span",{className:"coin-text",children:"1"})})]})}),e.jsx("div",{style:{fontSize:"1.4rem",fontWeight:"bold",marginTop:"20px",minHeight:"30px",color:"var(--accent-color)",textAlign:"center",padding:"0 20px"},children:C}),e.jsxs("div",{style:{display:"flex",gap:"20px",marginTop:"20px"},children:[e.jsxs("button",{onClick:()=>x("heads"),disabled:l,style:{padding:"10px 20px",border:`3px solid ${r==="heads"?"var(--gold-color)":"transparent"}`,background:r==="heads"?"rgba(255, 215, 0, 0.2)":"var(--bg-color)",color:"var(--text-color)",borderRadius:"8px",cursor:l?"not-allowed":"pointer",transition:"all 0.2s",display:"flex",flexDirection:"column",alignItems:"center",minWidth:"100px",transform:l?"none":"scale(1)",boxShadow:l?"none":"0 4px 8px rgba(0,0,0,0.15)",opacity:l?.6:1},onMouseEnter:S=>{!l&&r!=="heads"&&(S.currentTarget.style.transform="scale(1.1)",S.currentTarget.style.boxShadow="0 6px 12px rgba(0,0,0,0.3)",S.currentTarget.style.border="3px solid var(--accent-color)",S.currentTarget.style.background="rgba(33, 150, 243, 0.2)")},onMouseLeave:S=>{!l&&r!=="heads"&&(S.currentTarget.style.transform="scale(1)",S.currentTarget.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",S.currentTarget.style.border="3px solid transparent",S.currentTarget.style.background="var(--bg-color)")},children:[e.jsx("div",{style:{fontSize:"1.5rem"},children:"üëë"}),e.jsx("div",{style:{fontWeight:"bold"},children:"Heads"})]}),e.jsxs("button",{onClick:()=>x("tails"),disabled:l,style:{padding:"10px 20px",border:`3px solid ${r==="tails"?"var(--gold-color)":"transparent"}`,background:r==="tails"?"rgba(255, 215, 0, 0.2)":"var(--bg-color)",color:"var(--text-color)",borderRadius:"8px",cursor:l?"not-allowed":"pointer",transition:"all 0.2s",display:"flex",flexDirection:"column",alignItems:"center",minWidth:"100px",transform:l?"none":"scale(1)",boxShadow:l?"none":"0 4px 8px rgba(0,0,0,0.15)",opacity:l?.6:1},onMouseEnter:S=>{!l&&r!=="tails"&&(S.currentTarget.style.transform="scale(1.1)",S.currentTarget.style.boxShadow="0 6px 12px rgba(0,0,0,0.3)",S.currentTarget.style.border="3px solid var(--accent-color)",S.currentTarget.style.background="rgba(33, 150, 243, 0.2)")},onMouseLeave:S=>{!l&&r!=="tails"&&(S.currentTarget.style.transform="scale(1)",S.currentTarget.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",S.currentTarget.style.border="3px solid transparent",S.currentTarget.style.background="var(--bg-color)")},children:[e.jsx("div",{style:{fontSize:"1.5rem"},children:"1"}),e.jsx("div",{style:{fontWeight:"bold"},children:"Tails"})]})]})]}),e.jsxs("div",{style:{padding:"15px 20px",background:"var(--panel-bg)",borderTop:"2px solid var(--border-color)",flexShrink:0,display:"flex",flexDirection:"row",gap:"15px",alignItems:"flex-end"},children:[e.jsx("div",{style:{flex:1},children:e.jsx(ze,{currentBet:i,maxGold:t.gold,onBetChange:u,numberFormat:t.numberFormat})}),e.jsx("button",{className:"btn",onClick:M,disabled:!r||i<=0||l,style:{opacity:!r||i<=0||l?.5:1,fontSize:"1.2rem",padding:"0 30px",height:"60px",background:"var(--accent-color)",boxShadow:"0 4px 0 rgba(0,0,0,0.2)",flexShrink:0,fontWeight:"bold"},children:"FLIP"})]}),e.jsxs("div",{style:{padding:"10px 20px",background:"var(--panel-bg)",borderTop:"1px solid var(--border-color)",textAlign:"center",fontSize:"1rem",fontWeight:"bold"},children:[e.jsx("span",{style:{marginRight:"10px",color:"var(--text-secondary)"},children:"Result:"}),h?e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{marginRight:"10px"},children:h.won?"‚ú®":"üí∏"}),e.jsx("span",{style:{color:h.won?"#4caf50":"#f44336",marginRight:"10px"},children:h.won?"Victory!":"Defeat!"}),e.jsxs("span",{style:{color:"var(--accent-color)",marginRight:"10px"},children:["Result: ",h.side]}),e.jsxs("span",{style:{color:h.won?"gold":"#ef5350"},children:[h.won?"+":"-",w(o(h.amount),t.numberFormat)," Gold"]})]}):e.jsx("span",{style:{color:"var(--text-secondary)",fontStyle:"italic"},children:"No results yet"})]})]})},Qe=({value:t,size:n=80,color:a="#3e2723"})=>{const i=n*.18,u=n*.25,r=n*.5,x=n*.75,l=[];return(t===1||t===3||t===5)&&l.push({cx:r,cy:r}),t>1&&(l.push({cx:u,cy:u}),l.push({cx:x,cy:x})),t>3&&(l.push({cx:x,cy:u}),l.push({cx:u,cy:x})),t===6&&(l.push({cx:u,cy:r}),l.push({cx:x,cy:r})),e.jsx("div",{style:{width:n,height:n,backgroundColor:"#fff",borderRadius:n*.15,boxShadow:"0 4px 8px rgba(0,0,0,0.2), inset 0 -4px 4px rgba(0,0,0,0.1)",display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid #ccc"},children:e.jsx("svg",{width:n,height:n,viewBox:`0 0 ${n} ${n}`,children:l.map((f,d)=>e.jsx("circle",{cx:f.cx,cy:f.cy,r:i/2,fill:a},d))})})},It=({gameState:t,onGamble:n,onLeave:a})=>{const[i,u]=y.useState(0),[r,x]=y.useState(!1),[l,f]=y.useState([1,1]),[d,m]=y.useState(null),[h,B]=y.useState("Place your wager and roll!"),C=()=>{if(i<=0){B("Please enter a valid bet amount.");return}if(t.gold.lt(o(i))){B("Not enough gold!");return}x(!0),B("Rolling..."),m(null);let M=0;const S=10,b=setInterval(()=>{f([Math.floor(Math.random()*6)+1,Math.floor(Math.random()*6)+1]),M++,M>=S&&(clearInterval(b),k())},100)},k=()=>{const M=Math.floor(Math.random()*6)+1,S=Math.floor(Math.random()*6)+1,b=M+S;f([M,S]),x(!1);let E=0,j=!1,z="";if(b===2?(E=10,j=!0,z="Snake Eyes! JACKPOT (x10)!"):b>=3&&b<=6?(E=0,j=!1,z="Low roll... House wins."):b===7?(E=2,j=!0,z="Lucky Seven! (x2)"):b>=8&&b<=11?(E=1.5,j=!0,z="Good roll! (x1.5)"):b===12&&(E=5,j=!0,z="Boxcars! Huge Win (x5)!"),j){const p=Math.max(1,Math.floor(i*(E-1)));n(p,!0),B(z),m({won:!0,amount:p,sum:b})}else n(i,!1),B(z),m({won:!1,amount:i,sum:b})};return d&&(d.won,d.won,d.won,d.won,d.won,d.sum,d.won?(e.Fragment,w(o(d.amount),t.numberFormat)):(e.Fragment,w(o(d.amount),t.numberFormat))),e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"space-evenly",alignItems:"center",background:"var(--bg-color)",overflow:"hidden",padding:"10px"},children:[e.jsxs("div",{style:{background:"var(--panel-bg)",padding:"10px",borderRadius:"8px",fontSize:"0.8rem",border:"1px solid var(--border-color)",width:"100%",maxWidth:"400px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"2px"},children:[e.jsx("span",{style:{color:"var(--text-color)"},children:"Sum 2 (Snake Eyes)"}),e.jsx("span",{style:{color:"var(--gold-color)",fontWeight:"bold"},children:"x10"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"2px"},children:[e.jsx("span",{style:{color:"var(--text-color)"},children:"Sum 12 (Boxcars)"}),e.jsx("span",{style:{color:"var(--gold-color)",fontWeight:"bold"},children:"x5"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"2px"},children:[e.jsx("span",{style:{color:"var(--text-color)"},children:"Sum 7"}),e.jsx("span",{style:{color:"var(--success-color)",fontWeight:"bold"},children:"x2"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:"var(--text-color)"},children:"Sum 8-11"}),e.jsx("span",{style:{color:"var(--success-color)",fontWeight:"bold"},children:"x1.5"})]}),e.jsx("div",{style:{textAlign:"center",color:"var(--danger-color)",borderTop:"1px solid var(--border-color)",marginTop:"5px"},children:"Sum 3-6: House Wins"})]}),e.jsxs("div",{style:{display:"flex",gap:"30px",transform:"scale(1.2)"},children:[e.jsx(Qe,{value:l[0],size:100}),e.jsx(Qe,{value:l[1],size:100})]}),e.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",minHeight:"40px",color:"var(--accent-color)"},children:r?"":`Sum: ${l[0]+l[1]}`}),e.jsx("div",{style:{fontSize:"1rem",minHeight:"20px",color:"var(--text-color)"},children:h})]}),e.jsxs("div",{style:{padding:"15px 20px",background:"var(--panel-bg)",borderTop:"2px solid var(--border-color)",flexShrink:0,display:"flex",flexDirection:"row",gap:"15px",alignItems:"flex-end"},children:[e.jsx("div",{style:{flex:1},children:e.jsx(ze,{currentBet:i,maxGold:t.gold,onBetChange:u,numberFormat:t.numberFormat})}),e.jsx("button",{className:"btn",onClick:C,disabled:i<=0||r,style:{fontSize:"1.2rem",padding:"0 30px",height:"60px",background:"var(--accent-color)",opacity:i<=0||r?.5:1,boxShadow:"0 4px 0 rgba(0,0,0,0.2)",flexShrink:0,fontWeight:"bold"},children:"ROLL"})]}),e.jsxs("div",{style:{padding:"10px 20px",background:"var(--panel-bg)",borderTop:"1px solid var(--border-color)",textAlign:"center",fontSize:"1rem",fontWeight:"bold"},children:[e.jsx("span",{style:{marginRight:"10px",color:"var(--text-secondary)"},children:"Result:"}),d?e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{marginRight:"10px"},children:d.won?"üé≤":"üìâ"}),e.jsx("span",{style:{color:d.won?"#4caf50":"#f44336",marginRight:"10px"},children:d.won?"You Won!":"You Lost"}),e.jsxs("span",{style:{color:"var(--accent-color)",marginRight:"10px"},children:["Rolled: ",d.sum]}),e.jsxs("span",{style:{color:d.won?"gold":"#ef5350"},children:[d.won?"+":"-",w(o(d.amount),t.numberFormat)," Gold"]})]}):e.jsx("span",{style:{color:"var(--text-secondary)",fontStyle:"italic"},children:"No results yet"})]})]})},Dt=({gameState:t,onGamble:n,onClose:a})=>{const[i,u]=y.useState("racing");return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{height:"95vh",maxWidth:"1000px",width:"98%",padding:"0",display:"flex",flexDirection:"column",overflow:"hidden",borderRadius:"12px",border:"4px double var(--border-color)"},children:[e.jsxs("div",{style:{padding:"10px 20px",borderBottom:"2px solid var(--border-color)",background:"var(--accent-color)",color:"#fff",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h2",{style:{borderBottom:"none",margin:0,fontSize:"1.4rem",textShadow:"1px 1px 0 rgba(0,0,0,0.3)"},children:"üç∫ The Rusty Tankard"}),e.jsxs("div",{style:{fontSize:"0.9rem",background:"rgba(0,0,0,0.2)",padding:"4px 10px",borderRadius:"4px"},children:["Gold: ",e.jsx("span",{style:{color:"var(--gold-color)",fontWeight:"bold"},children:w(t.gold,t.numberFormat)})]})]}),e.jsxs("div",{style:{display:"flex",background:"var(--bg-color)",borderBottom:"2px solid var(--border-color)",overflowX:"auto"},children:[e.jsx("button",{onClick:()=>u("racing"),style:{flex:1,minWidth:"90px",padding:"12px 10px",border:"none",background:i==="racing"?"var(--panel-bg)":"transparent",fontWeight:"bold",color:i==="racing"?"var(--accent-color)":"var(--text-secondary)",cursor:"pointer",borderBottom:i==="racing"?"3px solid var(--accent-color)":"3px solid transparent",transition:"all 0.2s"},children:"üèá Racing"}),e.jsx("button",{onClick:()=>u("coin"),style:{flex:1,minWidth:"90px",padding:"12px 10px",border:"none",background:i==="coin"?"var(--panel-bg)":"transparent",fontWeight:"bold",color:i==="coin"?"var(--accent-color)":"var(--text-secondary)",cursor:"pointer",borderBottom:i==="coin"?"3px solid var(--accent-color)":"3px solid transparent",transition:"all 0.2s"},children:"üü° Coin"}),e.jsx("button",{onClick:()=>u("dice"),style:{flex:1,minWidth:"90px",padding:"12px 10px",border:"none",background:i==="dice"?"var(--panel-bg)":"transparent",fontWeight:"bold",color:i==="dice"?"var(--accent-color)":"var(--text-secondary)",cursor:"pointer",borderBottom:i==="dice"?"3px solid var(--accent-color)":"3px solid transparent",transition:"all 0.2s"},children:"üé≤ Dice"})]}),e.jsxs("div",{style:{background:"var(--bg-color)",flex:1,overflow:"hidden",position:"relative",display:"flex",flexDirection:"column"},children:[i==="racing"&&e.jsx(Pt,{gameState:t,onGamble:(r,x)=>n(r,x),onLeave:a}),i==="coin"&&e.jsx(Ft,{gameState:t,onGamble:(r,x)=>n(r,x),onLeave:a}),i==="dice"&&e.jsx(It,{gameState:t,onGamble:(r,x)=>n(r,x),onLeave:a})]}),e.jsx("div",{style:{padding:"8px",borderTop:"2px solid var(--border-color)",background:"var(--panel-bg)",textAlign:"center",flexShrink:0},children:e.jsx("button",{className:"btn",onClick:a,style:{background:"#5d4037",padding:"8px 20px",fontSize:"0.9rem",width:"auto"},children:"Exit Tavern"})})]})})},Gt=({gameState:t,onPrestige:n,onClose:a})=>{var b;const u=o(1e12),r=t.totalGold;let x=o(0),l=!1,f=u.minus(r);if(r.gte(u)){const E=r.dividedBy(u);x=o(Math.floor(Math.pow(E.toNumber(),.33))).times(1).minus(t.renown),x.lt(0)&&(x=o(0)),l=x.gt(0)}const d=t.renown.plus(x),m=u.times(Math.pow(Math.floor(d.dividedBy(1).toNumber()+1),1/.33)),h=m.minus(r),C=ee(t.renown).minus(o(1)).times(o(100)),M=ee(t.renown.plus(x)).minus(o(1)).times(o(100)),S=Object.values(t.nationalProjects||{}).some(E=>E==null?void 0:E.active);return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{border:"4px solid #673ab7",maxHeight:"90vh",display:"flex",flexDirection:"column"},children:[e.jsx("h2",{style:{color:"#673ab7"},children:"üëë Abdication"}),e.jsx("p",{children:"Are you ready to pass the crown to your heir?"}),e.jsxs("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:[!((b=t.playerProfile)!=null&&b.hasChosenName)&&e.jsxs("div",{style:{background:"rgba(255, 235, 59, 0.1)",border:"1px solid #ffc107",padding:"10px",borderRadius:"4px",marginBottom:"15px",fontSize:"0.9rem"},children:["üí° ",e.jsx("strong",{children:"Tip:"})," You can abdicate without choosing a ruler name. Choose a name only if you want to appear in the leaderboard."]}),e.jsxs("div",{style:{textAlign:"left",margin:"20px 0",background:"rgba(243, 229, 245, 0.5)",padding:"15px",borderRadius:"4px"},children:[e.jsx("div",{children:e.jsx("strong",{children:"You will lose:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"All Gold & Treasury"}),e.jsx("li",{children:"All Estates (Buildings)"}),e.jsx("li",{children:"Workforce (Laborers & Specialists)"}),e.jsx("li",{children:"Royal Scepter Levels"}),e.jsxs("li",{children:[e.jsx("strong",{children:"Unfinished National Projects"})," (Progress & Resources)"]})]}),e.jsx("div",{children:e.jsx("strong",{children:"You will keep:"})}),e.jsxs("ul",{children:[e.jsx("li",{children:"Achievements"}),e.jsxs("li",{children:["Current Renown (",w(t.renown,t.numberFormat),")"]}),e.jsx("li",{children:"Completed National Project Levels"}),e.jsx("li",{children:"Lifetime Stats & Leaderboard Rank"})]})]}),S&&e.jsx("div",{style:{marginBottom:"20px",padding:"10px",background:"rgba(255, 0, 0, 0.1)",border:"1px solid red",borderRadius:"4px",color:"#d32f2f",fontSize:"0.9rem",fontWeight:"bold",textAlign:"center"},children:"‚ö†Ô∏è WARNING: You have a National Project under construction! Abdication will cancel the construction. All progress and resources invested in the pending level will be lost."}),e.jsxs("div",{style:{fontSize:"1.2rem",marginBottom:"20px"},children:[e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:["Current Renown: ",w(t.renown,t.numberFormat)]}),e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:["Total Gold Earned: ",w(r,t.numberFormat)]}),e.jsx("hr",{style:{margin:"15px 0",borderTop:"1px dashed #ccc",borderBottom:"none"}}),e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:[e.jsx("strong",{children:"Current Bonus:"})," +",C.toNumber().toFixed(1),"%"]}),e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:[e.jsx("strong",{children:"Renown Gain:"})," ",w(x,t.numberFormat)]}),e.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.9rem",color:"var(--text-secondary)"},children:[e.jsx("strong",{children:"Total After:"})," ",w(t.renown.plus(x),t.numberFormat)," (+",M.toNumber().toFixed(1),"% bonus)"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginTop:"10px",background:"rgba(0,0,0,0.05)",padding:"5px",borderRadius:"4px"},children:[e.jsxs("div",{children:["Next Renown at: ",e.jsx("strong",{children:w(m,t.numberFormat)})," Lifetime Gold"]}),e.jsxs("div",{style:{color:h.gt(0)?"#cc0000":"var(--success-color)",fontWeight:"bold"},children:["(Need ",w(h.gt(0)?h:o(0),t.numberFormat)," more)"]})]})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"20px"},children:[e.jsx("button",{className:"btn",style:{background:"#666"},onClick:a,children:"Cancel"}),e.jsx("button",{className:"btn",style:{background:"#673ab7"},onClick:n,disabled:!l,children:l?"Abdicate":r.lt(u)?`Need ${w(f,t.numberFormat)} more Gold`:"Prestige Unavailable"})]})]})})},Ot=({gameState:t,onClose:n,onHardReset:a,onSave:i,onSetTheme:u,onSetNumberFormat:r,onToggleIdleMode:x,onUpdateInterface:l})=>{var E,j,z;const[f,d]=Ee.useState(!1),m=t.interface||{density:"normal",showFloatingText:!0,showWeatherWidget:!0,reduceMotion:!1,crownAnimations:!0,layout:{left:o(1),center:o(1),right:o(1)}},h=(E=m.layout.left)!=null&&E.toNumber?m.layout.left.toNumber():Number(m.layout.left),B=(j=m.layout.center)!=null&&j.toNumber?m.layout.center.toNumber():Number(m.layout.center),C=(z=m.layout.right)!=null&&z.toNumber?m.layout.right.toNumber():Number(m.layout.right),k=()=>{f?a():d(!0)},M=(p,A)=>{l({layout:{...m.layout,[p]:o(A)}})},S={marginBottom:"8px",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px",background:"rgba(0,0,0,0.03)",borderRadius:"4px"},b={width:"100%",marginBottom:"5px"};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxHeight:"90vh",display:"flex",flexDirection:"column"},children:[e.jsx("h2",{children:"‚öôÔ∏è Royal Settings"}),t.playerProfile&&e.jsxs("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"12px",marginBottom:"20px",textAlign:"center"},children:[e.jsxs("div",{style:{color:"var(--gold-color)",fontSize:"16px",fontWeight:"bold"},children:["üëë Your Ruler: ",t.playerProfile.rulerName," ",t.playerProfile.rulerId]}),e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"12px",marginTop:"5px"},children:"Registered in Leaderboard System"})]}),e.jsxs("div",{style:{textAlign:"left",marginBottom:"20px",maxHeight:"60vh",overflowY:"auto",paddingRight:"5px",flex:1,overflowX:"hidden",WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:[e.jsx("h3",{style:{marginBottom:"10px"},children:"Layout Configuration"}),e.jsxs("div",{style:{marginBottom:"15px",background:"rgba(0,0,0,0.03)",padding:"10px",borderRadius:"4px"},children:[e.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Column Widths (Ratio)"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"10px",alignItems:"center",marginBottom:"5px"},children:[e.jsx("span",{style:{fontSize:"0.8rem"},children:"Left"}),e.jsx("input",{type:"range",min:"1",max:"5",step:"0.5",value:h,onChange:p=>M("left",parseFloat(p.target.value)),style:b}),e.jsx("span",{style:{fontSize:"0.8rem"},children:h})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"10px",alignItems:"center",marginBottom:"5px"},children:[e.jsx("span",{style:{fontSize:"0.8rem"},children:"Center"}),e.jsx("input",{type:"range",min:"1",max:"5",step:"0.5",value:B,onChange:p=>M("center",parseFloat(p.target.value)),style:b}),e.jsx("span",{style:{fontSize:"0.8rem"},children:B})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"10px",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:"0.8rem"},children:"Right"}),e.jsx("input",{type:"range",min:"1",max:"5",step:"0.5",value:C,onChange:p=>M("right",parseFloat(p.target.value)),style:b}),e.jsx("span",{style:{fontSize:"0.8rem"},children:C})]})]}),e.jsx("div",{style:{borderTop:"1px dashed #ccc",margin:"15px 0"}}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Preset Themes"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(120px, 1fr))",gap:"5px",justifyContent:"center"},children:Object.values(Re).map(p=>e.jsx("button",{className:"btn",style:{background:t.theme===p.id?"var(--accent-color)":"var(--panel-bg)",color:t.theme===p.id?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",padding:"5px 10px",minWidth:"120px",textAlign:"center"},onClick:()=>u(p.id),children:p.name},p.id))})]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Layout Density"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"5px",justifyContent:"center"},children:["compact","normal","spacious"].map(p=>e.jsx("button",{className:"btn",style:{background:m.density===p?"var(--accent-color)":"var(--panel-bg)",color:m.density===p?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",textTransform:"capitalize",minWidth:"120px",textAlign:"center",padding:"5px 10px"},onClick:()=>l({density:p}),children:p},p))})]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"5px",fontWeight:"bold"},children:"Number Format"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"5px",justifyContent:"center"},children:["standard","scientific","plain"].map(p=>e.jsx("button",{className:"btn",style:{background:t.numberFormat===p?"var(--accent-color)":"var(--panel-bg)",color:t.numberFormat===p?"var(--text-on-accent)":"var(--text-color)",border:"1px solid var(--border-color)",fontSize:"0.8rem",padding:"5px 10px",textTransform:"capitalize",minWidth:"120px",textAlign:"center"},onClick:()=>r(p),children:p},p))})]}),e.jsx("div",{style:{borderTop:"1px dashed #ccc",margin:"15px 0"}}),e.jsxs("div",{style:S,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Cinematic Idle Mode"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show landscape when inactive. Wait 30 seconds after enabling."})]}),e.jsx("button",{className:"btn",style:{background:t.idleModeEnabled?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:x,children:t.idleModeEnabled?"ON":"OFF"})]}),e.jsxs("div",{style:S,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Click Text"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show floating numbers on click."})]}),e.jsx("button",{className:"btn",style:{background:m.showFloatingText?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>l({showFloatingText:!m.showFloatingText}),children:m.showFloatingText?"ON":"OFF"})]}),e.jsxs("div",{style:S,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Weather Widget"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show weather info in top left."})]}),e.jsx("button",{className:"btn",style:{background:m.showWeatherWidget?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>l({showWeatherWidget:!m.showWeatherWidget}),children:m.showWeatherWidget?"ON":"OFF"})]}),e.jsxs("div",{style:S,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Crown Animations"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Show crown effects and animations."})]}),e.jsx("button",{className:"btn",style:{background:m.crownAnimations?"var(--success-color)":"#9e9e9e",minWidth:"60px"},onClick:()=>l({crownAnimations:!m.crownAnimations}),children:m.crownAnimations?"ON":"OFF"})]}),e.jsxs("div",{style:S,children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9rem"},children:"Animations"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Enable visual effects and animations."})]}),e.jsx("button",{className:"btn",style:{background:m.reduceMotion?"#9e9e9e":"var(--success-color)",minWidth:"60px"},onClick:()=>l({reduceMotion:!m.reduceMotion}),children:m.reduceMotion?"OFF":"ON"})]})]}),e.jsxs("div",{style:{borderTop:"2px solid #ccc",paddingTop:"15px",marginTop:"15px",flexShrink:0},children:[e.jsx("h3",{children:"System"}),e.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"center",flexWrap:"wrap"},children:[e.jsx("button",{className:"btn",onClick:i,children:"Force Save"}),e.jsx("button",{className:"btn",style:{backgroundColor:f?"red":"#d32f2f"},onClick:k,children:f?"CONFIRM WIPE?":"Hard Reset"})]}),f&&e.jsx("div",{style:{color:"red",fontSize:"0.8rem",marginTop:"5px"},children:"Warning: This will delete all progress permanently!"})]}),e.jsx("button",{className:"btn",style:{marginTop:"20px",background:"#5d4037",width:"100%",flexShrink:0},onClick:n,children:"Return to Game"}),e.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)",marginTop:"10px",flexShrink:0},children:"v2.3.0 - Kingdom Clicker"})]})})},Ut=({onClose:t})=>e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"600px",maxHeight:"80vh",display:"flex",flexDirection:"column"},children:[e.jsx("h2",{children:"üìú Royal Chronicles"}),e.jsx("div",{style:{overflowY:"auto",textAlign:"left",padding:"0 20px",flex:1},children:_e.map((n,a)=>e.jsxs("div",{style:{marginBottom:"20px",borderBottom:a<_e.length-1?"1px dashed #ccc":"none",paddingBottom:"10px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"5px"},children:[e.jsxs("span",{style:{fontSize:"1.2rem",fontWeight:"bold",color:"var(--accent-color)"},children:["v",n.version]}),e.jsx("span",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:n.date})]}),e.jsx("ul",{style:{margin:"5px 0",paddingLeft:"20px"},children:n.changes.map((i,u)=>e.jsx("li",{style:{marginBottom:"3px"},children:i},u))})]},n.version))}),e.jsx("button",{className:"btn",style:{marginTop:"20px",alignSelf:"center"},onClick:t,children:"Close Chronicles"})]})}),_t=({gameState:t})=>{var l;const[n,a]=y.useState("all"),i=()=>{const f=ye.sort((d,m)=>{const h=t.achievements.includes(d.id),B=t.achievements.includes(m.id);return h&&!B?-1:!h&&B?1:0});return n==="all"?f:f.filter(d=>n==="buildings"?d.id.startsWith("build_"):n==="clicks"?d.id.startsWith("clicks_"):n==="gold"?d.id.startsWith("gold_"):n==="soldiers"?d.id.startsWith("soldiers_"):n==="renown"?d.id.startsWith("renown_"):n==="dragons"?d.id.startsWith("dragons_"):n==="gambler"?d.id.startsWith("gambler_"):n==="total_builds"?d.id.startsWith("total_builds"):n==="efficiency"?["speed_1m","speed_1b","prestige_master"].includes(d.id):n==="wonders"?["first_wonder","complete_wonder","all_wonders"].includes(d.id):n==="trade"?["first_trade","trade_master"].includes(d.id):n==="secret"?["click_master","idle_time_master"].includes(d.id):n==="bonus"?["gold_veteran","production_master","speed_baker","prestige_novice","golden_touch","combo_master"].includes(d.id):n==="combo"?["building_soldier_combo"].includes(d.id):!0)},u=[{id:"all",name:"All",icon:"üèÜ"},{id:"buildings",name:"Buildings",icon:"üèóÔ∏è"},{id:"clicks",name:"Clicks",icon:"üëÜ"},{id:"gold",name:"Gold",icon:"üí∞"},{id:"soldiers",name:"Army",icon:"‚öîÔ∏è"},{id:"renown",name:"Prestige",icon:"üëë"},{id:"dragons",name:"Dragons",icon:"üêâ"},{id:"gambler",name:"Tavern",icon:"üé≤"},{id:"total_builds",name:"Total Buildings",icon:"üèõÔ∏è"},{id:"efficiency",name:"Efficiency",icon:"‚ö°"},{id:"wonders",name:"Wonders",icon:"üåü"},{id:"trade",name:"Trade",icon:"üö¢"},{id:"secret",name:"Secret",icon:"üîç"},{id:"bonus",name:"Bonus",icon:"‚ú®"},{id:"combo",name:"Combo",icon:"‚ö°"}],r={display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"5px",padding:"5px",background:"var(--panel-bg)",border:"1px solid var(--border-color)",borderRadius:"4px",marginTop:"10px"},x=f=>({width:"100%",aspectRatio:"1",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",border:`2px solid ${f?"var(--gold-color)":"#ccc"}`,background:f?"#fff8e1":"#eee",borderRadius:"4px",opacity:f?1:.3,cursor:f?"help":"default",position:"relative",fontSize:"0.8rem"});return e.jsxs("div",{style:{marginTop:"auto",padding:"10px"},children:[e.jsx("h3",{style:{fontSize:"1rem",margin:"0 0 5px 0"},children:"Royal Decree (Achievements)"}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginBottom:"10px",textAlign:"center"},children:[t.achievements.length," / ",ye.length," Unlocked",n!=="all"&&e.jsxs("span",{children:[" | ",i().filter(f=>t.achievements.includes(f.id)).length," / ",i().length," in ",(l=u.find(f=>f.id===n))==null?void 0:l.name]})]}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"5px",marginBottom:"10px",padding:"5px",background:"var(--panel-bg)",border:"1px solid var(--border-color)",borderRadius:"4px"},children:u.map(f=>e.jsxs("button",{onClick:()=>a(f.id),style:{padding:"4px 8px",fontSize:"0.75rem",border:`1px solid ${n===f.id?"var(--gold-color)":"var(--border-color)"}`,borderRadius:"3px",background:n===f.id?"#fff8e1":"var(--panel-bg)",cursor:"pointer",transition:"all 0.2s"},title:f.name,children:[e.jsx("span",{style:{marginRight:"2px"},children:f.icon}),e.jsx("span",{style:{display:n===f.id?"inline":"none"},children:f.name})]},f.id))}),e.jsx("div",{style:r,children:i().map(f=>{const d=t.achievements.includes(f.id);return e.jsx("div",{style:x(d),"data-tooltip":d?`${f.name}: ${f.description}`:"Locked",children:e.jsx("div",{style:{fontSize:"1rem",filter:d?"none":"grayscale(100%)",opacity:d?1:.2},children:d?f.icon:"‚ùì"})},f.id)})})]})},Ht=({gameState:t,currentGps:n,onClose:a})=>{var b,E;const i=Object.values(t.buildings).reduce((j,z)=>j.plus(z),o(0)),u=t.achievements.length,r=ye.length;let x="None",l="None",f=-1,d=o(0);re.forEach((j,z)=>{const p=t.buildings[j.id]||o(0);p.gt(o(0))&&z>f&&(f=z,x=j.name),p.gt(d)&&(d=p,l=j.name)});const h=(()=>{let j=o(1);return j=j.times(ee(t.totalRenownEarned)),j})(),[B,C]=y.useState("");y.useEffect(()=>{const j=()=>{const p=o(Date.now()).minus(t.startTime),A=p.dividedBy(o(1e3)),G=A.minus(A.dividedBy(o(60)).floor().times(o(60))).floor(),U=p.dividedBy(o(6e4)),R=U.minus(U.dividedBy(o(60)).floor().times(o(60))).floor(),F=p.dividedBy(o(36e5)),D=F.minus(F.dividedBy(o(24)).floor().times(o(24))).floor(),N=p.dividedBy(o(864e5)).floor();let P="";N.gt(o(0))&&(P+=`${N.toString()}d `),D.gt(o(0))&&(P+=`${D.toString()}h `),P+=`${R.toString()}m ${G.toString()}s`,C(P)};j();const z=setInterval(j,1e3);return()=>clearInterval(z)},[t.startTime]);const k={display:"flex",justifyContent:"space-between",padding:"8px 0",borderBottom:"1px dashed rgba(0,0,0,0.1)",fontSize:"0.9rem"},M={fontSize:"1rem",color:"var(--accent-color)",marginTop:"15px",borderBottom:"2px solid var(--border-color)",paddingBottom:"2px",marginBottom:"5px"},S=(b=t.weather)!=null&&b.current&&((E=tt[t.weather.current])==null?void 0:E.name)||"Unknown";return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"500px",maxHeight:"90vh",display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx("h2",{style:{flexShrink:0},children:"üìä Royal Records"}),e.jsxs("div",{style:{textAlign:"left",marginBottom:"20px",overflowY:"auto",paddingRight:"10px",flex:1,minHeight:0},children:[e.jsx("h3",{style:M,children:"‚ö° Current Status"}),e.jsxs("div",{style:k,children:[e.jsx("span",{children:"Gold Per Second:"}),e.jsxs("strong",{style:{color:"var(--success-color)"},children:[w(n,t.numberFormat)," / sec"]})]}),e.jsxs("div",{style:k,children:[e.jsx("span",{children:"Click Power:"}),e.jsxs("strong",{style:{color:"var(--success-color)"},children:[w(h,t.numberFormat)," / click"]})]}),e.jsxs("div",{style:k,children:[e.jsx("span",{children:"Current Weather:"}),e.jsx("strong",{children:S})]}),e.jsxs("div",{style:k,children:[e.jsx("span",{children:"Current Renown:"}),e.jsx("strong",{style:{color:"#673ab7"},children:w(t.renown,t.numberFormat)})]}),e.jsxs("div",{style:k,children:[e.jsx("span",{children:"Total Renown Earned:"}),e.jsx("strong",{style:{color:"#9575cd"},children:w(t.totalRenownEarned,t.numberFormat)})]}),e.jsxs("div",{style:k,children:[e.jsx("span",{children:"Renown Bonus:"}),e.jsxs("strong",{style:{color:"#9575cd"},children:["+",ee(t.totalRenownEarned).minus(o(1)).times(o(100)).toNumber().toString(),"%"]})]}),e.jsx("h3",{style:M,children:"‚è≥ Time & Legacy"}),e.jsxs("div",{style:k,children:[e.jsx("span",{children:"Time Played:"}),e.jsx("strong",{children:B})]}),e.jsxs("div",{style:k,children:[e.jsx("span",{children:"Kingdom Founded:"}),e.jsx("span",{children:new Date(t.startTime.toNumber()).toLocaleDateString()})]}),e.jsxs("div",{style:k,children:[e.jsx("span",{children:"Total Renown:"}),e.jsx("strong",{children:w(t.renown,t.numberFormat)})]}),e.jsx("h3",{style:M,children:"üí∞ Economy Summary"}),e.jsxs("div",{style:k,children:[e.jsx("span",{children:"Current Gold:"}),e.jsx("strong",{children:w(t.gold,t.numberFormat)})]}),e.jsxs("div",{style:k,children:[e.jsx("span",{children:"Lifetime Gold:"}),e.jsx("strong",{children:w(t.totalGold,t.numberFormat)})]}),e.jsx("h3",{style:M,children:"üè∞ Dominion"}),e.jsxs("div",{style:k,children:[e.jsx("span",{children:"Total Buildings:"}),e.jsx("strong",{children:w(i,t.numberFormat)})]}),e.jsxs("div",{style:k,children:[e.jsx("span",{children:"Highest Tech Building:"}),e.jsx("strong",{children:x})]}),e.jsxs("div",{style:k,children:[e.jsx("span",{children:"Most Numerous:"}),e.jsxs("strong",{children:[l," (",w(d,t.numberFormat),")"]})]}),e.jsx("h3",{style:M,children:"‚öîÔ∏è Workforce & Court"}),e.jsxs("div",{style:k,children:[e.jsx("span",{children:"Total Workforce:"}),e.jsxs("strong",{children:[w(t.soldiers,t.numberFormat)," Laborers"]})]}),e.jsx("h3",{style:M,children:"üìà Player Stats"}),e.jsxs("div",{style:k,children:[e.jsx("span",{children:"Manual Clicks:"}),e.jsx("span",{children:w(t.stats.totalClicks,t.numberFormat)})]}),e.jsxs("div",{style:k,children:[e.jsx("span",{children:"Dragons Slain:"}),e.jsx("span",{children:w(t.stats.dragonsKilled,t.numberFormat)})]}),e.jsxs("div",{style:k,children:[e.jsx("span",{children:"Tavern Games:"}),e.jsx("span",{children:w(t.stats.tavernGamesPlayed,t.numberFormat)})]}),e.jsx("h3",{style:M,children:"üéñÔ∏è Completion"}),e.jsxs("div",{style:k,children:[e.jsx("span",{children:"Achievements:"}),e.jsxs("span",{children:[u," / ",r," (",Math.floor(u/r*100),"%)"]})]}),e.jsx("h3",{style:M,children:"üèÜ Achievements"}),e.jsx(_t,{gameState:t})]}),e.jsx("button",{className:"btn",style:{background:"#5d4037",width:"100%",flexShrink:0},onClick:a,children:"Close Records"})]})})},$t=[0,10,25,50,100,150,200,250,300,350,400,450,500,550,550,600],Yt=({gameState:t,onStartProject:n,onUpgradeClickPower:a,onUpgradeOffline:i,onClose:u})=>{const[r,x]=y.useState("infrastructure");if(!(t.buildings.field||o(0)).gt(0))return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("h2",{children:"üèóÔ∏è National Projects"}),e.jsxs("div",{style:{padding:"20px",color:"var(--text-secondary)"},children:[e.jsx("div",{style:{fontSize:"3rem",marginBottom:"10px"},children:"üîí"}),e.jsx("p",{children:"You must establish a functioning economy before launching national projects."}),e.jsx("p",{style:{fontWeight:"bold",color:"var(--accent-color)"},children:"Requirement: Build a Wheat Field."})]}),e.jsx("button",{className:"btn",onClick:u,children:"Close"})]})});const d=()=>e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"15px"},children:Ct.map(h=>{var q,X,te,J;const B=t.buildings[h.id]||o(0);if(B.lt(10))return null;const C=t.nationalProjects[h.id]||{level:0,active:!1,startTime:0,endTime:0},k=C.level,M=k>=Ne,S=C.active,b=k+1,E=ot(h.id,b),j=it(b),z=$t[b]||0,p=B.gte(z),A=t.gold.gte(E.gold),G=t.soldiers.gte(E.laborers),U=!E.carpenter.gt(0)||((q=t.eliteUnits.carpenter)==null?void 0:q.gte(E.carpenter)),R=!E.mason.gt(0)||((X=t.eliteUnits.mason)==null?void 0:X.gte(E.mason)),F=!E.architect.gt(0)||((te=t.eliteUnits.architect)==null?void 0:te.gte(E.architect)),D=A&&G&&U&&R&&F&&p;let N=0,P=0;if(S){const oe=Date.now(),ce=C.endTime-C.startTime,xe=oe-C.startTime;N=Math.min(100,xe/ce*100),P=Math.max(0,Math.ceil((C.endTime-oe)/1e3))}const H=((J=re.find(oe=>oe.id===h.id))==null?void 0:J.name)||"Building";return e.jsxs("div",{style:{border:"2px solid var(--border-color)",borderRadius:"8px",background:S?"#fff8e1":"var(--bg-color)",overflow:"hidden",position:"relative"},children:[e.jsxs("div",{style:{padding:"10px",background:S?"var(--accent-color)":"rgba(0,0,0,0.05)",color:S?"#fff":"var(--text-color)",fontWeight:"bold",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:h.name.replace(" Infrastructure","")}),e.jsxs("span",{children:["Lvl ",k," / ",Ne]})]}),e.jsxs("div",{style:{padding:"15px"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:S?"#000":"#fff",marginBottom:"10px",fontStyle:"italic"},children:h.description}),e.jsxs("div",{style:{marginBottom:"10px",fontSize:"0.9rem",color:"var(--success-color)",fontWeight:"bold"},children:["Current Bonus: +",(k*we*100).toFixed(0),"% Global"]}),S?e.jsxs("div",{children:[e.jsx("div",{style:{width:"100%",height:"10px",background:"#ccc",borderRadius:"5px",overflow:"hidden",marginBottom:"5px"},children:e.jsx("div",{style:{width:`${N}%`,height:"100%",background:"var(--success-color)",transition:"width 1s linear"}})}),e.jsxs("div",{style:{textAlign:"center",fontSize:"0.8rem",color:"#3e2723"},children:["Under Construction... ",Math.floor(P/3600),"h ",Math.floor(P%3600/60),"m"]})]}):M?e.jsx("div",{style:{textAlign:"center",padding:"10px",color:"var(--gold-color)",fontWeight:"bold",border:"1px solid var(--gold-color)",borderRadius:"4px",background:"rgba(255, 215, 0, 0.1)"},children:"MAXIMUM LEVEL REACHED"}):e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"0.85rem",marginBottom:"10px",background:"rgba(255,255,255,0.5)",padding:"5px",borderRadius:"4px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"Next Level Requirements:"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(140px, 1fr))",gap:"5px"},children:[e.jsxs("span",{style:{color:A?"green":"red"},children:["üí∞ ",w(E.gold)," Gold"]}),e.jsxs("span",{style:{color:G?"green":"red"},children:["üë∑ ",w(E.laborers)," Laborers"]}),E.carpenter.gt(0)&&e.jsxs("span",{style:{color:U?"green":"red"},children:["ü™ö ",w(E.carpenter)," Carpenters"]}),E.mason.gt(0)&&e.jsxs("span",{style:{color:R?"green":"red"},children:["üß± ",w(E.mason)," Masons"]}),E.architect.gt(0)&&e.jsxs("span",{style:{color:F?"green":"red"},children:["üìê ",w(E.architect)," Architects"]}),e.jsxs("span",{style:{color:p?"green":"red"},children:["üè† ",w(o(z))," ",H,"s"]})]}),e.jsxs("div",{style:{marginTop:"5px",fontSize:"0.8rem"},children:["‚è≥ Duration: ",Math.floor(j/3600),"h ",Math.floor(j%3600/60),"m"]})]}),e.jsx("button",{className:"btn",style:{width:"100%",background:D?"var(--accent-color)":"var(--border-color)",cursor:D?"pointer":"not-allowed"},disabled:!D,onClick:()=>n(h.id),children:"Start Project (Units Consumed)"})]})]})]},h.id)})}),m=()=>{const h=t.clickUpgradeLevel||0,B=h>=Be,C=h+1,k=nt(C),M=t.gold.gte(k),S=o(2).pow(Math.min(h,15)),b=be(h),E=b>0?`${w(S)} + ${(b*100).toFixed(1)}% of GPS`:w(S),j=o(2).pow(Math.min(C,15)),z=be(C),p=z>0?`${w(j)} + ${(z*100).toFixed(1)}% of GPS`:w(j),A=t.offlineUpgradeLevel||0,G=A>=he,U=A+1,R=rt(U),F=t.renown.gte(R),{efficiency:D,duration:N}=ve(A),{efficiency:P,duration:H}=ve(U),q=X=>{const te=Math.floor(X/3600),J=Math.floor(X%3600/60);return te>0?`${te}h ${J}m`:`${J}m`};return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"15px"},children:[e.jsxs("div",{style:{border:"2px solid var(--border-color)",borderRadius:"8px",background:"var(--bg-color)",overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"10px",background:"rgba(0,0,0,0.05)",color:"var(--text-color)",fontWeight:"bold",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"üëë Royal Scepter"}),e.jsxs("span",{children:["Lvl ",h," / ",Be]})]}),e.jsxs("div",{style:{padding:"15px"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginBottom:"10px",fontStyle:"italic"},children:"Enhance your royal authority to increase click power."}),e.jsxs("div",{style:{marginBottom:"10px",fontSize:"0.9rem",color:"var(--success-color)",fontWeight:"bold"},children:["Current Power: ",E]}),B?e.jsx("div",{style:{textAlign:"center",padding:"10px",color:"var(--gold-color)",fontWeight:"bold",border:"1px solid var(--gold-color)",borderRadius:"4px",background:"rgba(255, 215, 0, 0.1)"},children:"MAXIMUM LEVEL REACHED"}):e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"0.85rem",marginBottom:"10px",background:"rgba(255,255,255,0.5)",padding:"5px",borderRadius:"4px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"Next Level:"}),e.jsxs("div",{style:{marginBottom:"5px"},children:["Power: ",p]}),e.jsxs("div",{style:{color:M?"green":"red",fontWeight:"bold"},children:["üí∞ ",w(k)," Gold"]})]}),e.jsx("button",{className:"btn",style:{width:"100%",background:M?"var(--accent-color)":"var(--border-color)",cursor:M?"pointer":"not-allowed"},disabled:!M,onClick:a,children:"Upgrade Scepter"})]})]})]}),e.jsxs("div",{style:{border:"2px solid var(--border-color)",borderRadius:"8px",background:"var(--bg-color)",overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"10px",background:"rgba(0,0,0,0.05)",color:"var(--text-color)",fontWeight:"bold",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"üí§ Offline Production"}),e.jsxs("span",{children:["Lvl ",A," / ",he]})]}),e.jsxs("div",{style:{padding:"15px"},children:[e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginBottom:"10px",fontStyle:"italic"},children:["Improve the efficiency of your kingdom while you are away.",e.jsx("br",{}),"‚è±Ô∏è Higher levels increase both efficiency % and maximum production time."]}),e.jsxs("div",{style:{marginBottom:"10px",fontSize:"0.9rem",color:"var(--success-color)",fontWeight:"bold"},children:["Current: ",(D*100).toFixed(0),"% for ",q(N)]}),!G&&e.jsxs("div",{style:{marginBottom:"10px"},children:[e.jsx("div",{style:{width:"100%",height:"8px",background:"#ccc",borderRadius:"4px",overflow:"hidden"},children:e.jsx("div",{style:{width:`${A/he*100}%`,height:"100%",background:"var(--success-color)",transition:"width 0.3s ease"}})}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"2px"},children:[he-A," levels to max"]})]}),G?e.jsx("div",{style:{textAlign:"center",padding:"10px",color:"var(--gold-color)",fontWeight:"bold",border:"1px solid var(--gold-color)",borderRadius:"4px",background:"rgba(255, 215, 0, 0.1)"},children:"MAXIMUM LEVEL REACHED"}):e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"0.85rem",marginBottom:"10px",background:"rgba(255,255,255,0.5)",padding:"5px",borderRadius:"4px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"Next Level:"}),e.jsxs("div",{style:{marginBottom:"5px"},children:["Effect: ",(P*100).toFixed(0),"% for ",q(H)]}),e.jsxs("div",{style:{color:F?"#673ab7":"red",fontWeight:"bold"},children:["üëë ",w(R)," Renown"]})]}),e.jsx("button",{className:"btn",style:{width:"100%",background:F?"#673ab7":"var(--border-color)",cursor:F?"pointer":"not-allowed"},disabled:!F,onClick:i,children:"Upgrade Passive Income"})]})]})]})]})};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"1000px",width:"95%",height:"85vh",display:"flex",flexDirection:"column",padding:"0"},children:[e.jsxs("div",{style:{padding:"20px",background:"var(--accent-color)",color:"var(--text-on-accent)"},children:[e.jsx("h2",{style:{margin:0,border:"none",color:"var(--gold-color)"},children:"üèõÔ∏è National Projects"}),e.jsx("p",{style:{margin:"5px 0 0 0",fontSize:"0.9rem",opacity:.9},children:"Invest resources to permanently improve your kingdom's power. All improvements persist through prestige."})]}),e.jsxs("div",{style:{display:"flex",background:"var(--bg-color)",borderBottom:"2px solid var(--border-color)",padding:"0 20px"},children:[e.jsx("button",{className:"btn",style:{background:r==="infrastructure"?"var(--accent-color)":"transparent",border:"none",borderBottom:r==="infrastructure"?"3px solid var(--gold-color)":"3px solid transparent",borderRadius:"0",padding:"15px 20px",margin:"0",fontWeight:"bold",color:r==="infrastructure"?"var(--text-on-accent)":"var(--text-color)"},onClick:()=>x("infrastructure"),children:"üèóÔ∏è Infrastructure"}),e.jsx("button",{className:"btn",style:{background:r==="royalScepter"?"var(--accent-color)":"transparent",border:"none",borderBottom:r==="royalScepter"?"3px solid var(--gold-color)":"3px solid transparent",borderRadius:"0",padding:"15px 20px",margin:"0",fontWeight:"bold",color:r==="royalScepter"?"var(--text-on-accent)":"var(--text-color)"},onClick:()=>x("royalScepter"),children:"üëë Royal Scepter"})]}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"20px",background:"var(--panel-bg)"},children:[r==="infrastructure"&&d(),r==="royalScepter"&&m()]}),e.jsx("div",{style:{padding:"15px",borderTop:"1px solid var(--border-color)",textAlign:"right",background:"var(--bg-color)"},children:e.jsx("button",{className:"btn",onClick:u,children:"Return to Kingdom"})})]})})},qt=({toasts:t})=>e.jsx("div",{className:"toast-container",children:t.map(n=>e.jsxs("div",{className:`toast ${n.type}`,children:[n.type==="success"&&"‚úÖ",n.type==="warning"&&"‚ö†Ô∏è",n.type==="info"&&"‚ÑπÔ∏è",n.type==="error"&&"‚ùå",e.jsx("span",{children:n.message})]},n.id))}),Kt=()=>{const[t,n]=y.useState(null);if(y.useEffect(()=>{const i=x=>{const f=x.target.closest("[data-tooltip]");if(f){const d=f.getAttribute("data-tooltip");d&&n({text:d,x:x.clientX,y:x.clientY})}else n(null)},u=x=>{t&&n(l=>l?{...l,x:x.clientX,y:x.clientY}:null)},r=()=>{n(null)};return document.addEventListener("mouseover",i),document.addEventListener("mousemove",u),document.addEventListener("mouseout",r),()=>{document.removeEventListener("mouseover",i),document.removeEventListener("mousemove",u),document.removeEventListener("mouseout",r)}},[t]),!t)return null;const a={left:t.x+15,top:t.y+15};return t.x+250>window.innerWidth&&(a.left=t.x-260),t.y+100>window.innerHeight&&(a.top=t.y-50),e.jsx("div",{className:"game-tooltip",style:a,children:t.text.split(`
`).map((i,u)=>e.jsx("div",{style:{marginBottom:u===t.text.split(`
`).length-1?0:"4px"},children:i},u))})},Xt=({gameState:t})=>{const{weather:n,buildings:a,totalGold:i}=t,u=B=>{var C;return((C=a[B])==null?void 0:C.toNumber())||0};let r="wilderness";u("palace")>0?r="empire":u("castle")>0||u("market")>0?r="city":(u("peasant")>20||u("field")>10||i.gt(o(500)))&&(r="hamlet");let x="",l="";switch(r){case"wilderness":x="linear-gradient(to bottom, #87CEEB 0%, #87CEEB 60%, #556B2F 60%, #556B2F 100%)",l="üå≤ üå≥ üå≤ ü¶å üå≤ üåø";break;case"hamlet":x="linear-gradient(to bottom, #87CEEB 0%, #87CEEB 65%, #8B4513 65%, #228B22 80%)",l="üè° üåæ üêÑ üè° üåæ üöú";break;case"city":x="linear-gradient(to bottom, #B0C4DE 0%, #B0C4DE 60%, #696969 60%, #808080 100%)",l="üè∞ üè† ‚öíÔ∏è üè† ‚öñÔ∏è üè†";break;case"empire":x="linear-gradient(to bottom, #191970 0%, #4B0082 50%, #FFD700 100%)",l="üèØ üíÇ üèõÔ∏è üêâ üèõÔ∏è üíÇ";break}const f=n.current;let d="none",m="",h=0;return f==="rainy"?(d="linear-gradient(to bottom, rgba(0,0,50,0.3), rgba(0,0,100,0.3))",m="üåßÔ∏è üåßÔ∏è üåßÔ∏è üåßÔ∏è üåßÔ∏è",h=1):f==="stormy"?(d="linear-gradient(to bottom, rgba(0,0,0,0.6), rgba(50,50,50,0.6))",m="‚ö° ‚õàÔ∏è ‚ö° ‚õàÔ∏è ‚ö°",h=1):f==="sunny"?(d="radial-gradient(circle at top right, rgba(255,255,0,0.3), transparent)",m="‚òÄÔ∏è",h=.6):f==="windy"&&(m="üçÉ üçÉ üçÉ",h=.8),e.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:x,display:"flex",flexDirection:"column",justifyContent:"flex-end",alignItems:"center",paddingBottom:"20vh",zIndex:0,overflow:"hidden",transition:"background 2s ease"},children:[e.jsx("div",{style:{position:"absolute",top:"10%",width:"100%",textAlign:"center",fontSize:"5rem",opacity:h,animation:f==="windy"?"float 3s infinite ease-in-out":"none"},children:m}),d!=="none"&&e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:d,pointerEvents:"none"}}),e.jsx("div",{style:{fontSize:"4rem",textAlign:"center",zIndex:1,textShadow:"0 4px 4px rgba(0,0,0,0.3)",whiteSpace:"nowrap"},children:l}),e.jsx("div",{style:{marginTop:"20px",fontSize:"1.5rem",color:"#fff",textShadow:"2px 2px 4px #000",fontStyle:"italic",zIndex:2,background:"rgba(0,0,0,0.5)",padding:"5px 15px",borderRadius:"15px"},children:"The Kingdom sleeps..."}),e.jsx("style",{children:`
            @keyframes float {
                0% { transform: translateX(0px); }
                50% { transform: translateX(20px); }
                100% { transform: translateX(0px); }
            }
        `})]})},Vt={apiKey:"AIzaSyA1Dw5M2Zk8bpTCjlU2Tuifvx0ZI3IeRv0",authDomain:"kingdomclicker-156dc.firebaseapp.com",projectId:"kingdomclicker-156dc",storageBucket:"kingdomclicker-156dc.firebasestorage.app",messagingSenderId:"496461589742",appId:"1:496461589742:web:e6413dfa2d1bbabd3ad7ff"},Jt=St(Vt),je=Tt(Jt);function Zt(){return`#${Math.floor(Math.random()*99999).toString().padStart(5,"0")}`}function Qt(){const t=new Date,n=t.getDay(),a=t.getDate()-n+(n===0?-6:1);return new Date(t.setDate(a))}async function eo(t){try{const n={...t,period:"alltime"},a={...t,period:"weekly"},i=He(je,"leaderboard_alltime",t.rulerId);await $e(i,{...n,gold:Number(n.gold.toString()),buildings:Number(n.buildings),achievements:Number(n.achievements),renown:Number(n.renown.toString()),timestamp:Ye()});const u=He(je,"leaderboard_weekly",t.rulerId);return await $e(u,{...a,gold:Number(a.gold.toString()),buildings:Number(a.buildings),achievements:Number(a.achievements),renown:Number(a.renown.toString()),timestamp:Ye()}),{allTimeId:t.rulerId,weeklyId:t.rulerId}}catch(n){throw console.error("‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –ª–∏–¥–µ—Ä–±–æ—Ä–¥:"),console.error("–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:",n),n instanceof Error&&(console.error("–°–æ–æ–±—â–µ–Ω–∏–µ –æ—à–∏–±–∫–∏:",n.message),console.error("–°—Ç–µ–∫ –æ—à–∏–±–∫–∏:",n.stack)),"code"in n&&(console.error("–ö–æ–¥ –æ—à–∏–±–∫–∏ Firebase:",n.code),console.error("–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:",n.customData)),n}}async function to(t=100){try{console.log("üîç –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö all-time –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞...");const n=st(lt(je,"leaderboard_alltime"),at("gold","desc"),dt(t));console.log("üì° –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –∫ Firestore...");const a=await ct(n);console.log("üìä –ü–æ–ª—É—á–µ–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:",a.docs.length);const i=a.docs.map(u=>{const r=u.data();return{id:u.id,...r,gold:r.gold instanceof ie?r.gold:new ie(r.gold),renown:r.renown instanceof ie?r.renown:new ie(r.renown),timestamp:r.timestamp}});return console.log("‚úÖ All-time –ª–∏–¥–µ—Ä–±–æ—Ä–¥ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω, –∑–∞–ø–∏—Å–µ–π:",i.length),i}catch(n){throw console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ all-time –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞:"),console.error("–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:",n),n instanceof Error&&(console.error("–°–æ–æ–±—â–µ–Ω–∏–µ –æ—à–∏–±–∫–∏:",n.message),console.error("–°—Ç–µ–∫ –æ—à–∏–±–∫–∏:",n.stack)),"code"in n&&console.error("–ö–æ–¥ –æ—à–∏–±–∫–∏ Firebase:",n.code),n}}async function oo(t=100){try{console.log("üîç –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö weekly –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞...");const n=Qt();console.log("üìÖ –ù–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏:",n.toISOString());const a=st(lt(je,"leaderboard_weekly"),at("gold","desc"),dt(t));console.log("üì° –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –∫ Firestore...");const i=await ct(a);console.log("üìä –ü–æ–ª—É—á–µ–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–æ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:",i.docs.length);const r=i.docs.map(x=>{const l=x.data();return{id:x.id,...l,gold:l.gold instanceof ie?l.gold:new ie(l.gold),renown:l.renown instanceof ie?l.renown:new ie(l.renown),timestamp:l.timestamp}}).filter(x=>{var d,m;const l=((m=(d=x.timestamp)==null?void 0:d.toDate)==null?void 0:m.call(d))||new Date(x.timestamp),f=l>=n;return f||console.log("üóëÔ∏è –ó–∞–ø–∏—Å—å –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–∞ (—Å—Ç–∞—Ä–∞—è –¥–∞—Ç–∞):",l.toISOString()),f});return console.log("‚úÖ Weekly –ª–∏–¥–µ—Ä–±–æ—Ä–¥ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω, –∑–∞–ø–∏—Å–µ–π –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:",r.length),r}catch(n){throw console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ weekly –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞:"),console.error("–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:",n),n instanceof Error&&(console.error("–°–æ–æ–±—â–µ–Ω–∏–µ –æ—à–∏–±–∫–∏:",n.message),console.error("–°—Ç–µ–∫ –æ—à–∏–±–∫–∏:",n.stack)),"code"in n&&console.error("–ö–æ–¥ –æ—à–∏–±–∫–∏ Firebase:",n.code),n}}const no=({isOpen:t,onClose:n,onConfirm:a,gameState:i})=>{const[u,r]=y.useState(""),[x,l]=y.useState(!1);if(!t)return null;const f=async()=>{if(u.trim().length<3){alert("Ruler name must contain at least 3 characters!");return}if(u.trim().length>20){alert("Ruler name must not exceed 20 characters!");return}l(!0);try{const m={id:`player_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,rulerName:u.trim(),rulerId:Zt(),lastLeaderboardView:0,lastLeaderboardSubmit:0,hasChosenName:!0};a(m),n()}catch{alert("An error occurred while creating profile. Please try again.")}finally{l(!1)}};return e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{backgroundColor:"#fdf6e3",border:"4px solid #8d6e63",borderRadius:"8px",padding:"32px",maxWidth:"500px",width:"90%",textAlign:"center",fontFamily:"Georgia, serif"},children:[e.jsx("h2",{style:{color:"#3e2723",marginBottom:"16px"},children:"üëë Royal Coronation! üëë"}),e.jsxs("p",{style:{color:"#5d4037",marginBottom:"24px",lineHeight:"1.5"},children:["Congratulations! Your kingdom has reached ",e.jsx("strong",{children:ro(i.gold)})," gold!",e.jsx("br",{}),"It's time to choose a name for your ruler and enter the history books!"]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("label",{style:{display:"block",color:"#3e2723",marginBottom:"8px",fontWeight:"bold"},children:"Ruler Name:"}),e.jsx("input",{type:"text",value:u,onChange:d=>r(d.target.value),placeholder:"Enter your name...",maxLength:20,style:{width:"100%",padding:"12px",border:"2px solid #a1887f",borderRadius:"4px",fontSize:"16px",fontFamily:"Arial, sans-serif",backgroundColor:"#fff",color:"#3e2723"},onKeyPress:d=>d.key==="Enter"&&f()}),e.jsxs("div",{style:{fontSize:"12px",color:"#8d6e63",marginTop:"4px",textAlign:"left"},children:[u.length,"/20 characters"]})]}),e.jsx("div",{style:{backgroundColor:"#fff3e0",border:"2px solid #bf9000",borderRadius:"4px",padding:"12px",marginBottom:"24px"},children:e.jsx("p",{style:{color:"#bf9000",margin:0,fontSize:"14px",fontWeight:"bold"},children:"‚ö†Ô∏è Important: You'll be able to join the leaderboard and compete with players from around the world!"})}),e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[e.jsx("button",{type:"button",onClick:f,disabled:x||u.trim().length<3,style:{padding:"12px 24px",backgroundColor:x||u.trim().length<3?"#cccccc":"#2e7d32",color:"white",border:"none",borderRadius:"4px",fontSize:"16px",fontWeight:"bold",cursor:x||u.trim().length<3?"not-allowed":"pointer",fontFamily:"Georgia, serif"},children:x?"Creating profile...":"Ascend the Throne"}),e.jsx("button",{type:"button",onClick:n,style:{padding:"12px 24px",backgroundColor:"#c62828",color:"white",border:"none",borderRadius:"4px",fontSize:"16px",cursor:"pointer",fontFamily:"Georgia, serif",transition:"background-color 0.2s"},onMouseOver:d=>{d.currentTarget.style.backgroundColor="#d32f2f"},onMouseOut:d=>{d.currentTarget.style.backgroundColor="#c62828"},children:"Later"})]})]})})};function ro(t){return t.lt(1e3)?t.toFixed(0):t.lt(1e6)?t.toNumber().toLocaleString():t.toExponential(2)}const io=({isOpen:t,onClose:n,playerProfile:a,onOpenRulerNameModal:i,gameState:u})=>{const[r,x]=y.useState([]),[l,f]=y.useState([]),[d,m]=y.useState("alltime"),[h,B]=y.useState(!1),[C,k]=y.useState(null),[M,S]=y.useState(0),[b,E]=y.useState(0),j=()=>{const N=localStorage.getItem("leaderboardCache");if(N)try{const{data:P,timestamp:H}=JSON.parse(N),q=Date.now(),X=3600*1e3;if(q-H<X&&P&&P.allTime&&P.weekly)return P}catch(P){console.error("Cache parse error:",P)}return null},z=N=>{const P={data:N,timestamp:Date.now()};localStorage.setItem("leaderboardCache",JSON.stringify(P)),E(Date.now())},p=()=>{const N=localStorage.getItem("leaderboardCache");if(N){const{timestamp:P}=JSON.parse(N),H=Date.now(),q=3600*1e3;return H-P<q}return!1};y.useEffect(()=>{if(t){if(p())try{const N=j();if(N){x(N.allTime),f(N.weekly);const P=JSON.parse(localStorage.getItem("leaderboardCache"));E(P.timestamp);return}}catch(N){console.error("Cache read error:",N)}A()}},[t]);const A=async()=>{B(!0),k(null);try{const N=new Promise((q,X)=>setTimeout(()=>X(new Error("Loading timeout")),1e4)),[P,H]=await Promise.all([Promise.race([to(50),N]),Promise.race([oo(50),N])]);x(P),f(H),z({allTime:P,weekly:H})}catch(N){console.error("Error loading leaderboard:",N),k("Failed to load leaderboard. Please check your internet connection and try again.")}finally{B(!1)}},G=N=>{switch(N){case 1:return"ü•á";case 2:return"ü•à";case 3:return"ü•â";default:return`#${N}`}},U=()=>a?(d==="alltime"?r:l).findIndex(P=>P.rulerId===a.rulerId)+1:-1,R=()=>{const N=d==="alltime"?r:l;if(N.length>0){let P=0;if(N.forEach(H=>{if(H.timestamp){let q=0;typeof H.timestamp=="object"&&H.timestamp.toDate?q=H.timestamp.toDate().getTime():typeof H.timestamp=="number"?q=H.timestamp:typeof H.timestamp=="string"&&(q=new Date(H.timestamp).getTime()),q>P&&(P=q)}}),P>0)return P}return b},F=d==="alltime"?r:l,D=F.length>0;return t?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"800px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h2",{children:"üèÜ Leaderboard üèÜ"}),e.jsx("button",{className:"btn",onClick:n,children:"Close"})]}),!a&&e.jsxs("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"15px",marginBottom:"16px",textAlign:"center"},children:[e.jsx("h4",{style:{color:"var(--gold-color)",margin:"0 0 8px 0",fontSize:"14px"},children:"üëÅ View Only Mode"}),e.jsxs("p",{style:{color:"var(--text-secondary)",margin:"0",fontSize:"12px",lineHeight:"1.4"},children:[e.jsx("strong",{children:"Anyone can view leaderboard!"})," Choose a name at 10M gold to participate."]}),i&&u&&u.gold&&u.gold.gte(1e7)&&e.jsx("button",{className:"btn",onClick:()=>{n(),i()},style:{backgroundColor:"var(--accent-color)",padding:"6px 12px",fontSize:"12px",marginTop:"8px"},children:"üëë Choose Ruler Name"})]}),D&&e.jsx("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"12px",marginBottom:"16px",textAlign:"center",fontSize:"12px"},children:e.jsxs("span",{style:{color:"var(--gold-color)"},children:["üìä Data updated ",Math.floor((Date.now()-R())/6e4)," minutes ago"]})}),h&&e.jsx("div",{style:{textAlign:"center",padding:"20px",color:"var(--text-secondary)"},children:"Loading leaderboard data..."}),C&&e.jsx("div",{style:{textAlign:"center",padding:"20px",color:"var(--danger-color)"},children:C}),a&&D&&e.jsxs("div",{style:{backgroundColor:"rgba(191, 144, 0, 0.1)",border:"2px solid var(--gold-color)",borderRadius:"4px",padding:"12px",marginBottom:"16px",textAlign:"center"},children:[e.jsxs("div",{style:{color:"var(--gold-color)",fontSize:"14px",fontWeight:"bold"},children:["üëë You are playing as: ",a.rulerName," ",a.rulerId]}),F.length>0&&e.jsxs("div",{style:{color:"var(--text-secondary)",fontSize:"12px",marginTop:"5px"},children:["Your Rank: ",U()>0?`#${U()}`:"Not ranked yet"," in ",d==="alltime"?"All Time":"Weekly"]})]}),D&&e.jsxs("div",{style:{display:"flex",marginBottom:"16px",borderBottom:"2px solid var(--border-color)"},children:[e.jsx("button",{onClick:()=>m("alltime"),className:d==="alltime"?"tab-btn active":"tab-btn",children:"All Time"}),e.jsx("button",{onClick:()=>m("weekly"),className:d==="weekly"?"tab-btn active":"tab-btn",children:"This Week"})]}),D&&!h&&!C&&e.jsx("div",{style:{maxHeight:"400px",overflowY:"auto",border:"2px solid var(--border-color)",borderRadius:"4px",backgroundColor:"var(--panel-bg)"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{style:{backgroundColor:"var(--accent-color)",color:"white",position:"sticky",top:0},children:e.jsxs("tr",{children:[e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Rank"}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Ruler"}),e.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Gold"}),e.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Renown"}),e.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Buildings"}),e.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Achievements"})]})}),e.jsx("tbody",{children:F.map((N,P)=>e.jsxs("tr",{style:{backgroundColor:(a==null?void 0:a.rulerId)===N.rulerId?"rgba(191, 144, 0, 0.1)":P%2===0?"rgba(0, 0, 0, 0.02)":"transparent",borderBottom:"1px solid var(--border-color)"},children:[e.jsx("td",{style:{padding:"10px",fontWeight:"bold",color:"var(--text-color)"},children:G(P+1)}),e.jsx("td",{style:{padding:"10px",color:"var(--text-color)"},children:e.jsxs("div",{children:[e.jsx("strong",{children:N.rulerName}),e.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:N.rulerId})]})}),e.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--gold-color)",fontWeight:"bold"},children:w(N.gold,"standard")}),e.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--text-secondary)"},children:w(N.renown,"standard")}),e.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--text-secondary)"},children:N.buildings}),e.jsx("td",{style:{padding:"10px",textAlign:"right",color:"var(--text-secondary)"},children:N.achievements})]},N.id))})]})}),e.jsx("div",{style:{marginTop:"16px",fontSize:"12px",color:"var(--text-secondary)",textAlign:"center"},children:"üí° Leaderboard updates automatically every hour. Data is cached for performance."})]})}):null},so=({gained:t,effectiveTime:n,totalTime:a,efficiency:i,completedProjects:u,currentLevel:r,maxDuration:x,onClose:l,numberFormat:f})=>{const d=m=>{const h=Math.floor(m/3600),B=Math.floor(m%3600/60),C=Math.floor(m%60),k=[];return h>0&&k.push(`${h}h`),B>0&&k.push(`${B}m`),(C>0||k.length===0)&&k.push(`${C}s`),k.join(" ")};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{border:"4px solid var(--accent-color)"},children:[e.jsx("h2",{children:"üåô Welcome Back, Ruler!"}),e.jsxs("div",{style:{padding:"20px",textAlign:"left"},children:[e.jsx("p",{children:"Your kingdom continued to operate while you were away."}),e.jsxs("div",{style:{background:"var(--panel-bg)",border:"1px solid var(--border-color)",padding:"15px",borderRadius:"4px",marginBottom:"15px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[e.jsx("span",{children:"Time Away:"}),e.jsx("strong",{children:d(a.toNumber())})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[e.jsx("span",{children:"Effective Production Time:"}),e.jsx("strong",{children:d(n.toNumber())})]}),n.toNumber()<a.toNumber()&&e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",fontStyle:"italic",marginBottom:"5px",textAlign:"center"},children:["‚ö†Ô∏è Production time limited by upgrade level (max ",d(x),")"]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[e.jsx("span",{children:"Efficiency:"}),e.jsxs("strong",{children:[(i*100).toFixed(0),"% (Level ",r,"/20)"]})]}),e.jsx("div",{style:{borderTop:"1px dashed var(--border-color)",margin:"10px 0"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"1.2rem",color:"var(--gold-color)"},children:[e.jsx("span",{children:"Gold Earned:"}),e.jsxs("strong",{children:["+",w(t,f)]})]})]}),u.length>0&&e.jsxs("div",{children:[e.jsx("h3",{children:"‚úÖ Projects Completed"}),e.jsx("ul",{style:{paddingLeft:"20px",maxHeight:"150px",overflowY:"auto"},children:u.map((m,h)=>e.jsx("li",{style:{color:"var(--success-color)",marginBottom:"5px"},children:m},h))})]})]}),e.jsx("button",{className:"btn",onClick:l,style:{width:"100%",padding:"15px",fontSize:"1.1rem"},children:"Collect & Continue"})]})})},se={density:"normal",showFloatingText:!0,showWeatherWidget:!0,reduceMotion:!1,crownAnimations:!0,lastBuyAmount:o(1),layout:{left:o(1),center:o(1),right:o(1)},borderWidth:o(4),customColors:{enabled:!1,bg:"#e8dcc5",panel:"#fdf6e3",text:"#3e2723",secondaryText:"#5d4037",accent:"#8d6e63",accentHover:"#6d4c41",gold:"#bf9000",border:"#a1887f",success:"#2e7d32",danger:"#c62828"}},ue={gold:o(0),totalGold:o(0),totalRenownEarned:o(0),startTime:o(Date.now()),lastSaveTime:o(Date.now()),buildings:{},achievements:[],renown:o(0),prestigeCount:0,soldiers:o(0),eliteUnits:{},nationalProjects:{},clickUpgradeLevel:0,offlineUpgradeLevel:0,weather:{current:"clear",timeLeft:o(120)},event:null,theme:"default",numberFormat:"standard",idleModeEnabled:!1,interface:se,stats:{totalClicks:o(0),dragonsKilled:o(0),tavernGamesPlayed:o(0)},playerProfile:null},fe=t=>{if(t==null||typeof t=="string"||typeof t=="number"||typeof t=="boolean")return t;if(Array.isArray(t))return t.map(fe);if(typeof t=="object"&&t.toString&&typeof t.toString=="function"&&(t.hasOwnProperty("mantissa")||t.hasOwnProperty("exponent")))return t.toString();if(typeof t=="object"){const n={};for(const a in t)t.hasOwnProperty(a)&&(n[a]=fe(t[a]));return n}return t},xo=()=>{var Ge;const[t,n]=y.useState(()=>{var c,g,T,W,L,I;const s=localStorage.getItem("kingdom_save");if(s)try{const v=JSON.parse(s),O=v.interface||{},_={...se,...O,lastBuyAmount:o(O.lastBuyAmount??1),crownAnimations:O.crownAnimations??!0,layout:{left:o(((c=O.layout)==null?void 0:c.left)??se.layout.left),center:o(((g=O.layout)==null?void 0:g.center)??se.layout.center),right:o(((T=O.layout)==null?void 0:T.right)??se.layout.right)},borderWidth:o(O.borderWidth??se.borderWidth),customColors:{...se.customColors,...O.customColors||{}}};return{...ue,...v,renown:o(v.renown||0),totalRenownEarned:o(v.totalRenownEarned||0),prestigeCount:v.prestigeCount||0,gold:o(v.gold||0),totalGold:o(v.totalGold||0),startTime:o(v.startTime||Date.now()),lastSaveTime:o(v.lastSaveTime||Date.now()),soldiers:o(v.soldiers||0),buildings:Object.keys(v.buildings||{}).reduce((Y,$)=>(Y[$]=o(v.buildings[$]),Y),{}),stats:{...ue.stats,...v.stats||{},totalClicks:o(((W=v.stats)==null?void 0:W.totalClicks)||0),dragonsKilled:o(((L=v.stats)==null?void 0:L.dragonsKilled)||0),tavernGamesPlayed:o(((I=v.stats)==null?void 0:I.tavernGamesPlayed)||0)},eliteUnits:Object.keys(v.eliteUnits||{}).reduce((Y,$)=>(Y[$]=o(v.eliteUnits[$]),Y),{}),nationalProjects:v.nationalProjects||{},clickUpgradeLevel:v.clickUpgradeLevel||0,offlineUpgradeLevel:v.offlineUpgradeLevel||0,weather:v.weather?{...v.weather,timeLeft:o(Number(v.weather.timeLeft)||120)}:ue.weather,theme:v.theme||"default",numberFormat:v.numberFormat||"standard",idleModeEnabled:v.idleModeEnabled!==void 0?v.idleModeEnabled:!1,interface:_,playerProfile:v.playerProfile?{...v.playerProfile,lastLeaderboardSubmit:v.playerProfile.lastLeaderboardSubmit||0}:null}}catch(v){console.error("Save load failed",v)}return ue}),a=y.useRef(t);y.useEffect(()=>{a.current=t},[t]);const i=y.useRef("");y.useEffect(()=>{const s=c=>{i.current=(i.current+c.key).slice(-20);const g=i.current.toLowerCase();g.endsWith("godon")?(n(T=>({...T,godMode:!0})),K("God Mode Enabled: +99999s per click","success"),i.current=""):g.endsWith("godoff")&&(n(T=>({...T,godMode:!1})),K("God Mode Disabled","info"),i.current="")};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[]);const u=()=>{k(null);const s=localStorage.getItem("kingdom_last_save_time"),c=Date.now();if(s){const g=c-parseInt(s),T=o(g/1e3);if(T.gte(o(60))){const W=t.offlineUpgradeLevel||0,{efficiency:L,duration:I}=ve(W),v=o(I),O=T.lt(v)?T:v,Y=le(t).times(o(L)).times(O).floor();Y.gt(o(0))&&(k({gained:Y,effectiveTime:O,totalTime:T,efficiency:L,completedProjects:[],currentLevel:W,maxDuration:I}),n($=>({...$,gold:$.gold.plus(Y),totalGold:$.totalGold.plus(Y)})))}}localStorage.setItem("kingdom_last_save_time",c.toString())},[r,x]=y.useState(!1);y.useEffect(()=>{let s;const c=()=>{x(!1),clearTimeout(s),t.idleModeEnabled&&(s=setTimeout(()=>{x(!0)},2e4))};c();const g=["mousemove","mousedown","keydown","touchstart","scroll"];return g.forEach(T=>window.addEventListener(T,c)),()=>{clearTimeout(s),g.forEach(T=>window.removeEventListener(T,c))}},[t.idleModeEnabled]),y.useEffect(()=>{t.event&&x(!1)},[t.event]),y.useEffect(()=>{const s=w(t.gold);document.title=`Gold: ${s} - Kingdom Clicker`},[t.gold]),y.useEffect(()=>{const s=document.documentElement,c=t.interface||se,g=t.theme||"default",T=Re[g]||Re.default;T&&Object.entries(T.colors).forEach(([I,v])=>{s.style.setProperty(I,v)});const W={compact:"8px",normal:"12px",spacious:"20px"},L={compact:"6px",normal:"12px",spacious:"16px"};s.style.setProperty("--panel-padding",W[c.density]),s.style.setProperty("--gap-size",L[c.density]),s.style.setProperty("--col-left",String(c.layout.left)),s.style.setProperty("--col-center",String(c.layout.center)),s.style.setProperty("--col-right",String(c.layout.right)),c.reduceMotion?document.body.classList.add("no-motion"):document.body.classList.remove("no-motion")},[t.theme,t.interface]);const[l,f]=y.useState(!1);y.useEffect(()=>{var s;t.gold.gte(o(1e7))&&!((s=t.playerProfile)!=null&&s.hasChosenName)&&!l&&ce(!0)},[t.gold,t.playerProfile,l]);const[d,m]=y.useState(null),[h,B]=y.useState([]),[C,k]=y.useState(null),[M,S]=y.useState("buildings"),[b,E]=y.useState("army"),[j,z]=y.useState(!1),[p,A]=y.useState("throne");y.useEffect(()=>{const s=()=>{z(window.innerWidth<768)};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]);const[G,U]=y.useState(!1),[R,F]=y.useState(!1),[D,N]=y.useState(!1),[P,H]=y.useState(!1),[q,X]=y.useState(!1),[te,J]=y.useState(!1),[oe,ce]=y.useState(!1),[xe,ne]=y.useState(!1),K=(s,c="info")=>{const g=Date.now().toString()+Math.random();B(T=>[...T,{id:g,message:s,type:c}]),setTimeout(()=>{B(T=>T.filter(W=>W.id!==g))},3e3)};y.useEffect(()=>{const s=Date.now();if(t.lastSaveTime&&o(s).minus(t.lastSaveTime).gt(o(6e4))){const c=o(s).minus(t.lastSaveTime).dividedBy(o(1e3)),{efficiency:g,duration:T}=ve(t.offlineUpgradeLevel||0),W=o(T),L=c.lt(W)?c:W,v=le(t).times(o(g)).times(L).floor(),O=[];let _={...t.nationalProjects},Y=!1;Object.keys(_).forEach($=>{var Q;const V=_[$];if(V.active&&V.endTime&&s>=V.endTime){_[$]={...V,active:!1,level:V.level+1,startTime:0,endTime:0};const de=(Q=re.find(ke=>ke.id===$))==null?void 0:Q.name;de&&O.push(`${de} Infrastructure (Lvl ${V.level+1})`),Y=!0}}),(v.gt(o(0))||O.length>0)&&(k($=>$||{gained:v,effectiveTime:L,totalTime:c,efficiency:g,completedProjects:O,currentLevel:t.offlineUpgradeLevel||0,maxDuration:T}),n($=>({...$,gold:$.gold.plus(v),totalGold:$.totalGold.plus(v),nationalProjects:Y?_:$.nationalProjects})))}},[]),y.useEffect(()=>{const s=setInterval(()=>{Date.now()%3e4<1e3&&n(c=>{const g={...c,lastSaveTime:o(Date.now())},T=fe(g);return localStorage.setItem("kingdom_save",JSON.stringify(T)),g})},1e3);return()=>clearInterval(s)},[]),y.useEffect(()=>{const s=()=>{const g=a.current,T=fe(g);localStorage.setItem("kingdom_save",JSON.stringify(T)),localStorage.setItem("kingdom_last_save_time",Date.now().toString())};window.addEventListener("beforeunload",s);const c=()=>{document.visibilityState==="hidden"?s():document.visibilityState==="visible"&&u()};return document.addEventListener("visibilitychange",c),()=>{window.removeEventListener("beforeunload",s),document.removeEventListener("visibilitychange",c)}},[]),y.useEffect(()=>{var c;if(!((c=t.playerProfile)!=null&&c.hasChosenName))return;const s=setInterval(()=>{var I;const g=a.current,T=Date.now(),W=((I=g.playerProfile)==null?void 0:I.lastLeaderboardSubmit)||0,L=3600*1e3;T-W>=L&&eo({rulerName:g.playerProfile.rulerName,rulerId:g.playerProfile.rulerId,gold:g.totalGold,renown:g.renown,buildings:Object.keys(g.buildings).length,achievements:g.achievements.length,period:"alltime"}).then(()=>{n(v=>({...v,playerProfile:{...v.playerProfile,lastLeaderboardSubmit:Date.now()}})),K("Leaderboard data submitted successfully!","success")}).catch(v=>{console.error("Auto leaderboard submission failed:",v)})},6e4);return()=>clearInterval(s)},[(Ge=t.playerProfile)==null?void 0:Ge.hasChosenName]),y.useEffect(()=>{const s=setInterval(()=>{if(!t.event&&Math.random()<.05){const T=["dragon","merchant","jester"],W=T[Math.floor(Math.random()*T.length)],L=W==="dragon"?6e5:3e4,I={id:Date.now().toString(),type:W,expiresAt:o(Date.now()).plus(o(L)),hp:W==="dragon"?o(10):void 0,maxHp:W==="dragon"?o(10):void 0,reward:o(0),startTime:W==="dragon"?Date.now():void 0};n(v=>({...v,event:I}))}},1e4);return()=>clearInterval(s)},[t.event]);const le=s=>{var I;let c=o(0);const g=((I=s.weather)==null?void 0:I.current)||"clear";re.forEach(v=>{const O=s.buildings[v.id]||o(0);let _=v.baseProduction;g==="sunny"?(v.id==="peasant"||v.id==="field"||v.id==="stable"||v.id==="cathedral")&&(_=_.times(o(1.2))):g==="rainy"?(v.id==="silver_mine"||v.id==="alchemist"||v.id==="market"||v.id==="tavern")&&(_=_.times(o(1.2))):g==="stormy"?((v.id==="blacksmith"||v.id==="void_portal")&&(_=_.times(o(1.3))),(v.id==="field"||v.id==="stable")&&(_=_.times(o(.8)))):g==="windy"&&(v.id==="market"||v.id==="castle"||v.id==="time_chamber")&&(_=_.times(o(1.15))),c=c.plus(O.times(_))});let T=0;s.nationalProjects&&Object.values(s.nationalProjects).forEach(v=>{T+=v.level||0});let W=o(1);const L=o(1).plus(o(T*we));if(W=W.times(L),W=W.times(ee(s.totalRenownEarned).plus(o(s.achievements.length*.02))),s.event&&s.event.type==="dragon"&&s.event.startTime){const v=Math.floor((Date.now()-s.event.startTime)/1e3),_=1-Math.min(99,v)/100;W=W.times(o(_))}return c=c.times(W),c},Z=le(t),ae=y.useRef(Z);ae.current=Z,y.useEffect(()=>{const s=setInterval(()=>{n(c=>{const g=Date.now(),T=ae.current.times(o(Ce)).dividedBy(o(1e3));let W=c.totalGold.plus(T),L=c.gold.plus(T),I={...c.weather};const v=o(Ce/1e3);if(I.timeLeft=I.timeLeft.minus(v),I.timeLeft.lte(o(0))){const V=["clear","sunny","rainy","stormy","windy"],Q=V[Math.floor(Math.random()*V.length)],de=o(Math.floor(Math.random()*120)+60);I={current:Q,timeLeft:de}}let O=c.event;O&&O.expiresAt&&o(O.expiresAt).lt(o(g))&&(O=null);let _={...c.nationalProjects||{}};Object.keys(_).forEach(V=>{var de;const Q=_[V];Q.active&&Q.endTime&&g>=Q.endTime&&(_[V]={...Q,active:!1,level:Q.level+1,startTime:0,endTime:0},K(`Project Completed: ${(de=re.find(ke=>ke.id===V))==null?void 0:de.name} Infrastructure Level ${Q.level+1}!`,"success"))});const Y=[...c.achievements];let $=null;return ye.forEach(V=>{Y.includes(V.id)||V.condition({...c,totalGold:W,gold:L},ae.current)&&(Y.push(V.id),$=V)}),$&&(m($),setTimeout(()=>m(null),3e3)),{...c,gold:L,totalGold:W,achievements:Y,event:O,soldiers:c.soldiers,weather:I,nationalProjects:_}})},Ce);return()=>clearInterval(s)},[]);const pe=(s="light")=>{if("vibrate"in navigator&&j)switch(s){case"light":navigator.vibrate(10);break;case"medium":navigator.vibrate(20);break;case"heavy":navigator.vibrate([30,10,30]);break}},We=(s=!1)=>{s||pe("light");const c=ut(a.current);n(g=>({...g,gold:g.gold.plus(c),totalGold:g.totalGold.plus(c),stats:{...g.stats,totalClicks:s?g.stats.totalClicks:g.stats.totalClicks.plus(o(1))}}))},ut=s=>{const c=ee(s.totalRenownEarned),g=o(1),T=s.clickUpgradeLevel||0,W=Math.min(T,15),L=o(2).pow(W),I=g.times(L),v=le(s),O=be(T),_=v.times(O);let Y=I.plus(_);if(Y=Y.times(c),s.godMode){const $=v.times(o(99999));Y=Y.plus($)}return Y},gt=()=>{const s=t.clickUpgradeLevel||0;if(s>=Be){K("Maximum Royal Scepter level reached!","warning");return}const c=nt(s+1);if(t.gold.lt(c)){K("Not enough gold!","error");return}n(g=>({...g,gold:g.gold.minus(c),clickUpgradeLevel:g.clickUpgradeLevel+1})),K(`Royal Scepter upgraded to level ${s+1}!`,"success")},mt=()=>{const s=t.offlineUpgradeLevel||0;if(s>=he){K("Maximum Passive Income level reached!","warning");return}const c=rt(s+1);if(t.renown.lt(c)){K("Not enough Renown!","error");return}n(g=>({...g,renown:g.renown.minus(c),offlineUpgradeLevel:g.offlineUpgradeLevel+1})),K(`Passive Income upgraded to level ${s+1}!`,"success")},Me=(s,c)=>{const g=re.find(L=>L.id===s);if(!g||c<=0)return;const T=t.buildings[s]||o(0),W=ge(g.baseCost,T,o(c)).floor();t.gold.gte(W)&&(pe("medium"),n(L=>({...L,gold:L.gold.minus(W),buildings:{...L.buildings,[s]:(L.buildings[s]||o(0)).plus(o(c))}})))},Le=(s,c)=>{const g=re.find(I=>I.id===s);if(!g||c<=0)return;const T=t.buildings[s]||o(0),W=o(Math.min(c,T.toNumber()));if(W.lte(o(0)))return;const L=ge(g.baseCost,T.minus(W),W).times(o(.25)).floor();n(I=>({...I,gold:I.gold.plus(L),buildings:{...I.buildings,[s]:T.minus(W)}}))},Ae=s=>{const c=Te.times(o(s));t.gold.gte(c)&&n(g=>({...g,gold:g.gold.minus(c),soldiers:g.soldiers.plus(c.dividedBy(Te))}))},Pe=(s,c)=>{const g=et.find(L=>L.id===s);if(!g)return;const T=g.goldCost.times(o(c)),W=g.soldierCost.times(o(c));t.gold.gte(T)&&t.soldiers.gte(W)&&n(L=>({...L,gold:L.gold.minus(T),soldiers:L.soldiers.minus(W),eliteUnits:{...L.eliteUnits,[s]:(L.eliteUnits[s]||o(0)).plus(o(c))}}))},Fe=s=>{if(s.type==="merchant"){const c=ae.current.times(o(10));n(g=>({...g,gold:g.gold.plus(c),totalGold:g.totalGold.plus(c),event:null})),K(`The merchant gifted you ${w(c.floor(),t.numberFormat)} gold!`,"success")}else if(s.type==="jester"){const c=t.gold.times(o(.1)),g=Math.random()>.5;n(T=>({...T,gold:g?T.gold.plus(c):T.gold.minus(c),totalGold:g?T.totalGold.plus(c):T.totalGold,event:null})),g?K(`Jester pays out! +${w(c.floor(),t.numberFormat)}`,"success"):K(`Jester tricked you! -${w(c.floor(),t.numberFormat)}`,"warning")}else if(s.type==="dragon")try{let c=!1;n(g=>{if(!g.event||g.event.type!=="dragon")return g;const W=o(g.event.hp||10).minus(o(1));if(W.lte(0)){const L=ae.current.times(o(30));return c=!0,{...g,gold:g.gold.plus(L),totalGold:g.totalGold.plus(L),event:null,stats:{...g.stats,dragonsKilled:g.stats.dragonsKilled.plus(o(1))}}}return{...g,event:{...g.event,hp:W}}}),c&&K("Dragon Slain! +Treasury Boost","success")}catch(c){console.error("Error handling dragon interaction:",c),K("Error interacting with dragon","error")}},ht=()=>{const s=o(1),c=o(1e12),g=t.totalGold;if(g.lt(c))return;const T=g.dividedBy(c),L=o(Math.floor(Math.pow(T.toNumber(),.33))).times(s).minus(t.renown);if(L.lte(0))return;const I={...t.nationalProjects};Object.keys(I).forEach(v=>{I[v].active&&(I[v]={...I[v],active:!1,startTime:0,endTime:0})}),n({...ue,renown:t.renown.plus(L),totalRenownEarned:t.totalRenownEarned.plus(L),prestigeCount:t.prestigeCount+1,totalGold:t.totalGold,achievements:t.achievements,nationalProjects:I,offlineUpgradeLevel:t.offlineUpgradeLevel,playerProfile:t.playerProfile,startTime:o(Date.now()),lastSaveTime:o(Date.now()),theme:t.theme,idleModeEnabled:t.idleModeEnabled,interface:t.interface}),F(!1),K("Abdication Successful. Long live the new King!","success")},ft=()=>{localStorage.removeItem("kingdom_save"),n({...ue,startTime:o(Date.now())}),N(!1),K("Game Reset","warning")},bt=()=>{const c=fe(t);localStorage.setItem("kingdom_save",JSON.stringify(c)),K("Game Saved","info")},yt=s=>{n(c=>({...c,playerProfile:s})),localStorage.setItem(`playerProfile_${s.id}`,JSON.stringify(s)),K(`Welcome, ${s.rulerName} ${s.rulerId}!`,"success"),f(!1)},vt=async()=>{ht()},Ie=s=>{n(c=>({...c,interface:{...c.interface,lastBuyAmount:s}}))},De=s=>({flex:s==="left"?"var(--col-left)":"var(--col-right)",display:"flex",flexDirection:"column",borderRight:s==="left"?"var(--custom-border-width) double var(--border-color)":"none",borderLeft:s==="right"?"var(--custom-border-width) double var(--border-color)":"none",background:"var(--panel-bg)",minWidth:0,transition:"transform 0.8s ease-in-out",transform:r&&t.idleModeEnabled?s==="left"?"translateX(-120%)":"translateX(120%)":"translateX(0)",zIndex:10});return e.jsxs("div",{style:{display:"flex",height:"100dvh",width:"100vw",backgroundColor:"var(--bg-color)",overflow:"hidden",position:"relative",flexDirection:j?"column":"row"},children:[e.jsx(qt,{toasts:h}),e.jsx(Kt,{}),r&&t.idleModeEnabled&&e.jsx(Xt,{gameState:t}),!j&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:De("left"),children:[e.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)"},children:e.jsx("button",{className:`tab-btn ${M==="buildings"?"active":""}`,onClick:()=>S("buildings"),children:"Estates"})}),e.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden"},children:M==="buildings"&&e.jsx(Ve,{gameState:t,onBuyBuilding:Me,onSellBuilding:Le,onSetBuyAmount:Ie})})]}),e.jsx("div",{style:{flex:"var(--col-center)",display:"flex",flexDirection:"column",position:"relative",borderRight:r&&t.idleModeEnabled?"none":"var(--custom-border-width) double var(--border-color)",minWidth:0,zIndex:5,transition:"border 0.8s"},children:e.jsx(Ze,{gameState:t,gps:Z,onClick:()=>We(!1),onEventInteract:Fe,onOpenTavern:()=>U(!0),onOpenPrestige:()=>F(!0),onOpenSettings:()=>N(!0),onOpenStatistics:()=>X(!0),onOpenLeaderboard:()=>{ne(!0)},onOpenEmpire:()=>J(!0),isIdle:r&&t.idleModeEnabled})}),e.jsxs("div",{style:De("right"),children:[e.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)"},children:e.jsx("button",{className:`tab-btn ${b==="army"?"active":""}`,onClick:()=>E("army"),children:"Workforce"})}),e.jsx("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden"},children:b==="army"&&e.jsx(Je,{gameState:t,onTrainSoldier:Ae,onTrainElite:Pe})})]})]}),j&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",position:"relative",minHeight:0,height:"100%"},children:[p==="buildings"&&e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0},children:[e.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:e.jsx("button",{className:"tab-btn active",onClick:()=>{},children:"Estates"})}),e.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:e.jsx(Ve,{gameState:t,onBuyBuilding:Me,onSellBuilding:Le,onSetBuyAmount:Ie})})]}),p==="throne"&&e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,height:"100%"},children:e.jsx(Ze,{gameState:t,gps:Z,onClick:()=>We(!1),onEventInteract:Fe,onOpenTavern:()=>U(!0),onOpenPrestige:()=>F(!0),onOpenSettings:()=>N(!0),onOpenStatistics:()=>X(!0),onOpenLeaderboard:()=>ne(!0),onOpenEmpire:()=>J(!0),isIdle:r&&t.idleModeEnabled})}),p==="army"&&e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",height:"100%",minHeight:0},children:[e.jsx("div",{style:{display:"flex",borderBottom:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:e.jsx("button",{className:"tab-btn active",children:"Workforce"})}),e.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:e.jsx(Je,{gameState:t,onTrainSoldier:Ae,onTrainElite:Pe})})]}),p==="empire"&&e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,height:"100%"},children:e.jsx("div",{className:"scrollable-content",style:{flex:1,overflowY:"auto",overflowX:"hidden",minHeight:0,WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:e.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"var(--text-secondary)"},children:[e.jsx("h3",{children:"üèóÔ∏è National Projects"}),e.jsx("p",{children:"Construct massive infrastructure to boost global production."}),e.jsx("button",{className:"btn",onClick:()=>J(!0),style:{margin:"10px",padding:"15px 20px",fontSize:"16px"},children:"üèóÔ∏è Manage Projects"})]})})})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-around",alignItems:"center",height:"60px",backgroundColor:"var(--panel-bg)",borderTop:"var(--custom-border-width) solid var(--border-color)",flexShrink:0},children:[e.jsxs("button",{className:`mobile-nav-btn ${p==="buildings"?"active":""}`,onClick:()=>{pe("light"),A("buildings")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:p==="buildings"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[e.jsx("div",{style:{fontSize:"20px"},children:"üèòÔ∏è"}),e.jsx("div",{children:"Estates"})]}),e.jsxs("button",{className:`mobile-nav-btn ${p==="throne"?"active":""}`,onClick:()=>{pe("light"),A("throne")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:p==="throne"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[e.jsx("div",{style:{fontSize:"20px"},children:"üëë"}),e.jsx("div",{children:"Throne"})]}),e.jsxs("button",{className:`mobile-nav-btn ${p==="army"?"active":""}`,onClick:()=>{pe("light"),A("army")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:p==="army"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[e.jsx("div",{style:{fontSize:"20px"},children:"üë∑"}),e.jsx("div",{children:"Workforce"})]}),e.jsxs("button",{className:`mobile-nav-btn ${p==="empire"?"active":""}`,onClick:()=>{pe("light"),A("empire")},style:{flex:1,height:"100%",border:"none",backgroundColor:"transparent",fontSize:"12px",color:p==="empire"?"var(--accent-color)":"var(--text-color)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",cursor:"pointer"},children:[e.jsx("div",{style:{fontSize:"20px"},children:"üèóÔ∏è"}),e.jsx("div",{children:"Projects"})]})]})]}),!(r&&t.idleModeEnabled)&&d&&e.jsxs("div",{className:"achievement-popup",children:[e.jsx("div",{style:{fontSize:"2rem"},children:d.icon}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",color:"var(--text-color)"},children:"Achievement Unlocked!"}),e.jsx("div",{style:{color:"var(--accent-color)"},children:d.name})]})]}),C&&e.jsx(so,{gained:C.gained,effectiveTime:C.effectiveTime,totalTime:C.totalTime,efficiency:C.efficiency,completedProjects:C.completedProjects,currentLevel:C.currentLevel,maxDuration:C.maxDuration,numberFormat:t.numberFormat,onClose:()=>k(null)}),te&&e.jsx(Yt,{gameState:t,onClose:()=>J(!1),onStartProject:s=>{var W,L,I,v;const c=((W=t.nationalProjects[s])==null?void 0:W.level)||0;if(c>=Ne)return;const g=ot(s,c+1);if(t.gold.lt(g.gold)||t.soldiers.lt(g.laborers)||(L=t.eliteUnits.carpenter)!=null&&L.lt(g.carpenter||0)||(I=t.eliteUnits.mason)!=null&&I.lt(g.mason||0)||(v=t.eliteUnits.architect)!=null&&v.lt(g.architect||0))return;const T=it(c+1);n(O=>({...O,gold:O.gold.minus(g.gold),soldiers:O.soldiers.minus(g.laborers),eliteUnits:{...O.eliteUnits,carpenter:(O.eliteUnits.carpenter||o(0)).minus(g.carpenter||0),mason:(O.eliteUnits.mason||o(0)).minus(g.mason||0),architect:(O.eliteUnits.architect||o(0)).minus(g.architect||0)},nationalProjects:{...O.nationalProjects,[s]:{level:c,active:!0,startTime:Date.now(),endTime:Date.now()+T*1e3}}})),K("Construction started!","info")},onUpgradeClickPower:gt,onUpgradeOffline:mt}),G&&e.jsx(Dt,{gameState:t,onGamble:(s,c)=>{const g=o(s);n(T=>({...T,gold:c?T.gold.plus(g):T.gold.minus(g).max(0),stats:{...T.stats,tavernGamesPlayed:T.stats.tavernGamesPlayed.plus(o(1))}}))},onClose:()=>U(!1)}),R&&e.jsx(Gt,{gameState:t,onPrestige:vt,onClose:()=>F(!1)}),D&&e.jsx(Ot,{gameState:t,onClose:()=>N(!1),onHardReset:ft,onSave:bt,onSetTheme:s=>n(c=>({...c,theme:s})),onSetNumberFormat:s=>n(c=>({...c,numberFormat:s})),onToggleIdleMode:()=>n(s=>({...s,idleModeEnabled:!s.idleModeEnabled})),onUpdateInterface:s=>n(c=>({...c,interface:{...c.interface,...s}}))}),q&&e.jsx(Ht,{gameState:t,currentGps:Z,onClose:()=>X(!1)}),P&&e.jsx(Ut,{onClose:()=>H(!1)}),oe&&e.jsx(no,{isOpen:oe,onClose:()=>{ce(!1),f(!0)},onConfirm:yt,gameState:t}),xe&&e.jsx(io,{isOpen:xe,onClose:()=>ne(!1),playerProfile:t.playerProfile})]})};export{xo as A,Ee as R,e as j};
