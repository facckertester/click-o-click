var le=Object.defineProperty,se=Object.defineProperties;var de=Object.getOwnPropertyDescriptors;var Q=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var ee=(r,d,a)=>d in r?le(r,d,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[d]=a,A=(r,d)=>{for(var a in d||(d={}))ae.call(d,a)&&ee(r,a,d[a]);if(Q)for(var a of Q(d))ce.call(d,a)&&ee(r,a,d[a]);return r},z=(r,d)=>se(r,de(d));import{r as p,j as o}from"./vendor-react-CUeQczFW.js";import{t as n,B as ue,k as W,f as j,l as te,m as xe,N as oe,b as Y,c as Z,M as N,P as re}from"./core-Bsm8WMPA.js";import{A as pe}from"./components-ui-DPdqUY33.js";import{D as fe}from"./components-modals-DTocpHRQ.js";const D=(r,d,a=500)=>{const[b,B]=p.useState(!1),T=p.useRef(null),L=p.useCallback(()=>{T.current=setTimeout(()=>{r(),B(!0)},a)},[r,a]),M=p.useCallback(()=>{T.current&&(clearTimeout(T.current),T.current=null)},[]),C=p.useCallback(()=>{L()},[L]),u=p.useCallback(()=>{M(),b||d(),B(!1)},[M,d,b]),P=p.useCallback(()=>{L()},[L]),q=p.useCallback(()=>{M(),b||d(),B(!1)},[M,d,b]),E=p.useCallback(()=>{M(),B(!1)},[M]);return{onMouseDown:C,onMouseUp:u,onTouchStart:P,onTouchEnd:q,onTouchMove:E}},h=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),H=(r,d=!1,a=!1,b=!1)=>({display:"flex",alignItems:"center",padding:"var(--panel-padding)",background:a?"rgba(0,0,0,0.05)":d?"rgba(46, 125, 50, 0.1)":b?"#f3e5f5":"var(--panel-bg)",border:"1px solid",borderColor:a?"rgba(0,0,0,0.2)":b?"#7b1fa2":r?"var(--accent-color)":"rgba(0,0,0,0.1)",borderRadius:"2px",cursor:r&&!a?"pointer":"default",opacity:r&&!a||d?1:.7,transition:"all 0.2s",boxShadow:r&&!a?"2px 2px 0 rgba(0,0,0,0.1)":"none",position:"relative",userSelect:"none",marginBottom:"var(--gap-size)",filter:a?"grayscale(1)":"none"}),ve={display:"flex",flexDirection:"column",gap:"var(--gap-size)",height:"100%",overflowY:"auto",padding:"var(--panel-padding)",position:"relative"},be=({gameState:r,onBuyBuilding:d,onSellBuilding:a,onSetBuyAmount:b,onStartProject:B,setGameState:T})=>{var $;const[L,M]=p.useState({visible:!1,x:0,y:0,building:null}),C=n(1),u=(($=r.interface)==null?void 0:$.lastBuyAmount)||n(1),[P,q]=p.useState(!1),[E,F]=p.useState({visible:!1,x:0,y:0,buildingId:null}),[I,S]=p.useState({visible:!1,building:null}),[V,O]=p.useState(1);p.useEffect(()=>{const e=l=>{l.ctrlKey?O(10):l.shiftKey?O(100):O(1)},c=l=>e(l),t=l=>e(l);return window.addEventListener("keydown",c),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",c),window.removeEventListener("keyup",t)}},[]);const _=(e,c)=>{const t=e.currentTarget.getBoundingClientRect();M({visible:!0,x:t.right,y:t.top+t.height/2,building:c})},R=()=>{M({visible:!1,x:0,y:0,building:null}),F({visible:!1,x:0,y:0,buildingId:null})},U=(e,c)=>{const t=e.currentTarget.getBoundingClientRect();F({visible:!0,x:t.right+10,y:t.top+t.height/2,buildingId:c})},G=()=>{F({visible:!1,x:0,y:0,buildingId:null})},J=e=>{var x;if(!B)return;const c=((x=r.nationalProjects[e])==null?void 0:x.level)||0;if(c>=N)return;const t=Y(e,c+1),l=r.buildings[e]||n(0);if(l.lt(10))return;const i=Z[c+1]||0;l.lt(i)||r.gold.lt(t.gold)||T(v=>z(A({},v),{gold:v.gold.minus(t.gold),nationalProjects:z(A({},v.nationalProjects),{[e]:{level:c+1,active:!1,startTime:0,endTime:0}})}))},ne=(e,c)=>{var f;let t=c;const l=((f=r.weather)==null?void 0:f.current)||"clear";l==="sunny"&&(e==="peasant"||e==="field")?t=t.times(n(1.2)):l==="rainy"&&(e==="silver_mine"||e==="alchemist")?t=t.times(n(1.2)):l==="stormy"?(e==="blacksmith"&&(t=t.times(n(1.3))),e==="field"&&(t=t.times(n(.8)))):l==="windy"&&e==="market"&&(t=t.times(n(1.15)));let i=n(1),x=0;r.nationalProjects&&Object.values(r.nationalProjects).forEach(m=>x+=m.level||0);const v=1+x*re;i=i.times(n(v));const g=n(1).plus(r.renown.times(.01));return i=i.times(g),t.times(i)},w=(e,c)=>{if(!oe.find(k=>k.id===e)||c.lt(10))return"var(--border-color)";const i=(r.nationalProjects[e]||{level:0}).level;if(i>=N)return"var(--gold-color)";const v=i+1,g=Y(e,v),f=Z[v]||0,m=c.gte(f);return r.gold.gte(g.gold)&&m?"#00e676":"var(--text-secondary)"},ie=(e,c)=>{const t=oe.find(k=>k.id===e);if(!t||!B||c.lt(10))return null;const i=(r.nationalProjects[e]||{level:0}).level,x=i>=N,v=i+1,g=Y(e,v),f=Z[v]||0,m=c.gte(f),y=r.gold.gte(g.gold),s=y&&m;return o.jsxs("div",{style:{padding:"10px",background:"var(--panel-bg)",border:"2px solid var(--accent-color)",borderRadius:"8px",fontSize:"0.8rem",color:"var(--text-color)",minWidth:"200px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:[o.jsxs("div",{style:{fontWeight:"bold",marginBottom:"5px",color:"var(--accent-color)"},children:["ðŸ—ï¸ ",t.name.replace(" Infrastructure","")," - Lvl ",i,"/",N]}),o.jsxs("div",{style:{marginBottom:"5px",fontSize:"0.75rem",color:"var(--text-secondary)"},children:["Current Bonus: +",(i*re*100).toFixed(0),"% Global"]}),x?o.jsx("div",{style:{textAlign:"center",padding:"5px",color:"var(--gold-color)",fontWeight:"bold",fontSize:"0.7rem",border:"1px solid var(--gold-color)",borderRadius:"4px",background:"rgba(255, 215, 0, 0.1)"},children:"MAX LEVEL"}):o.jsxs("div",{children:[o.jsxs("div",{style:{fontSize:"0.7rem",marginBottom:"5px"},children:[o.jsxs("div",{style:{color:y?"var(--success-color)":"var(--error-color)"},children:["ðŸ’° ",j(g.gold)]}),o.jsxs("div",{style:{color:m?"var(--success-color)":"var(--error-color)"},children:["ðŸ  ",f," buildings"]})]}),o.jsx("div",{style:{fontSize:"0.7rem",color:s?"var(--success-color)":"var(--error-color)",textAlign:"center",fontWeight:"bold"},children:s?"Click to upgrade!":"Requirements not met"})]})]})};let X=0;return o.jsxs("div",{style:ve,children:[o.jsx("div",{style:{display:"flex",gap:"5px",marginBottom:"10px",justifyContent:"center"},children:[n(1),n(10),n(100),n(500),n(1e3),n(-1)].map(e=>o.jsx("button",{onClick:()=>b(e),style:{padding:"5px 10px",border:"1px solid var(--accent-color)",background:u.equals(e)?"var(--accent-color)":"var(--panel-bg)",color:u.equals(e)?"var(--text-on-accent)":"var(--text-color)",cursor:"pointer",fontWeight:"bold",fontSize:"0.8rem"},children:e.equals(n(-1))?"Max":`${e.toString()}`},`amount-${e.toString()}`))}),o.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center"},children:"Hold Ctrl: x10 â€¢ Hold Shift: x100"}),o.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"10px",justifyContent:"center"},children:[o.jsx("button",{className:"btn",style:{background:P?"var(--panel-bg)":"var(--accent-color)",color:P?"var(--text-color)":"var(--text-on-accent)",border:"1px solid var(--accent-color)",padding:"5px 15px",fontSize:"0.8rem"},onClick:()=>q(!1),children:"ðŸ›’ Buy Mode"}),o.jsx("button",{className:"btn",style:{background:P?"#e65100":"var(--panel-bg)",color:P?"var(--text-on-accent)":"var(--text-color)",border:"1px solid #e65100",padding:"5px 15px",fontSize:"0.8rem"},onClick:()=>q(!0),children:"ðŸ’° Sell Mode (25%)"})]}),o.jsx("h3",{style:{fontSize:"1rem",color:"var(--text-secondary)",fontWeight:"bold",borderBottom:"1px solid var(--border-color)",paddingBottom:"5px"},children:"Estates"}),ue.map((e,c)=>{const t=r.buildings[e.id]||n(0),l=r.totalGold.gte(e.baseCost)||t.gt(n(0));if(l||X++,!l&&X>2)return null;if(P){if(t.eq(n(0)))return null;let s;u.equals(n(-1))?s=t:(s=u.times(V),s.gt(t)&&(s=t));const k=W(e.baseCost,t.minus(s),s).times(n(.25)).floor();return ne(e.id,e.baseProduction),o.jsxs("div",{style:H(!0,!1,!1,!1),onClick:()=>a(e.id,s.toNumber()),onMouseEnter:K=>_(K,e),onMouseLeave:R,children:[t.gte(n(10))&&o.jsx("div",z(A({style:{position:"absolute",left:"8px",top:"50%",transform:"translateY(-50%)",width:"28px",height:"28px",cursor:"pointer",pointerEvents:"auto",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10}},D(()=>S({visible:!0,building:e}),()=>J(e.id),h()?500:2e3)),{onMouseEnter:h()?void 0:K=>U(K,e.id),onMouseLeave:h()?void 0:G,children:o.jsx("svg",{width:"26",height:"26",viewBox:"0 0 12 12",style:{fill:w(e.id,t),filter:w(e.id,t)==="#00e676"?"drop-shadow(0 0 8px rgba(0, 230, 118, 0.6))":w(e.id,t)==="var(--gold-color)"?"drop-shadow(0 0 8px rgba(255, 215, 0, 0.6))":"drop-shadow(0 0 4px rgba(0, 0, 0, 0.3))"},children:o.jsx("path",{d:"M6 1 L10 8 L7 8 L7 11 L5 11 L5 8 L2 8 Z"})})})),o.jsx("div",{style:{fontSize:"2rem",marginRight:"15px",width:"40px",textAlign:"center",position:"relative",marginLeft:t.gte(n(10))?"30px":"10px"},children:e.icon}),o.jsx("div",{style:{flex:1},children:o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o.jsx("span",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"var(--text-color)"},children:e.name}),o.jsx("span",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"var(--accent-color)"},children:j(t,r.numberFormat)})]})}),o.jsxs("div",{style:{marginLeft:"12px",minWidth:"70px",textAlign:"right"},children:[o.jsxs("div",{style:{color:"var(--accent-color)",fontWeight:"bold"},children:["+",j(k,r.numberFormat)]}),o.jsxs("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)"},children:["for ",j(s,r.numberFormat)]})]})]},e.id)}let i=n(0),x=n(0);u.equals(n(-1))?(i=te(e.baseCost,t,r.gold.div(C)),i.eq(n(0))?(i=n(1),x=xe(e.baseCost,t).times(C).floor()):x=W(e.baseCost,t,i).times(C).floor()):(i=u,x=W(e.baseCost,t,i).times(C).floor());const v=r.gold.gte(x),g=u.equals(n(-1))&&te(e.baseCost,t,r.gold.div(C)).eq(n(0));let f=i,m=x,y=v;return u.equals(n(-1))||(f=i.times(V),m=W(e.baseCost,t,f).times(C).floor(),y=r.gold.gte(m)),z(A({style:H(y&&!g,!1,!l)},D(()=>S({visible:!0,building:e}),()=>{if(!(y&&!g))return;const s=u.equals(n(-1))?i:f;d(e.id,s.toNumber())},h()?500:2e3)),{onMouseEnter:h()?void 0:s=>_(s,e),onMouseLeave:h()?void 0:R,children:[o.jsxs("div",{style:{fontSize:"2rem",marginRight:"15px",width:"40px",textAlign:"center",position:"relative",marginLeft:"10px"},children:[l?e.icon:"â“",t.gte(n(10))&&o.jsx("div",z(A({style:{position:"absolute",left:"-22px",top:"50%",transform:"translateY(-50%)",width:"28px",height:"28px",cursor:"pointer",pointerEvents:"auto",display:"flex",alignItems:"center",justifyContent:"center"}},D(()=>S({visible:!0,building:e}),()=>J(e.id),h()?500:2e3)),{onMouseEnter:h()?void 0:s=>U(s,e.id),onMouseLeave:h()?void 0:G,children:o.jsx("svg",{width:"26",height:"26",viewBox:"0 0 12 12",style:{fill:w(e.id,t),filter:w(e.id,t)==="#00e676"?"drop-shadow(0 0 8px rgba(0, 230, 118, 0.6))":w(e.id,t)==="var(--gold-color)"?"drop-shadow(0 0 8px rgba(255, 215, 0, 0.6))":"drop-shadow(0 0 4px rgba(0, 0, 0, 0.3))"},children:o.jsx("path",{d:"M6 1 L10 8 L7 8 L7 11 L5 11 L5 8 L2 8 Z"})})}))]}),o.jsx("div",{style:{flex:1},children:o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o.jsx("span",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"var(--text-color)"},children:l?e.name:"???"}),o.jsx("span",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"var(--accent-color)"},children:j(t,r.numberFormat)})]})}),o.jsxs("div",{style:{marginLeft:"12px",minWidth:"70px",textAlign:"right"},children:[o.jsx("div",{style:{color:y&&!g?"var(--gold-color)":"var(--text-secondary)",fontWeight:"bold"},children:j(u.equals(n(-1))?x:m,r.numberFormat)}),!u.equals(n(-1))&&o.jsxs("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)"},children:["for ",j(f,r.numberFormat)]})]})]}),e.id,o.jsxs("div",{style:H(y&&!g,!1,!l),onClick:()=>{if(!(y&&!g))return;const s=u.equals(n(-1))?i:f;d(e.id,s.toNumber())},onMouseEnter:s=>_(s,e),onMouseLeave:R,children:[t.gte(n(10))&&o.jsx("div",z(A({style:{position:"absolute",left:"8px",top:"50%",transform:"translateY(-50%)",width:"28px",height:"28px",cursor:"pointer",pointerEvents:"auto",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10}},D(()=>S({visible:!0,building:e}),()=>J(e.id),h()?500:2e3)),{onMouseEnter:h()?void 0:s=>U(s,e.id),onMouseLeave:h()?void 0:G,children:o.jsx("svg",{width:"26",height:"26",viewBox:"0 0 12 12",style:{fill:w(e.id,t),filter:w(e.id,t)==="#00e676"?"drop-shadow(0 0 8px rgba(0, 230, 118, 0.6))":w(e.id,t)==="var(--gold-color)"?"drop-shadow(0 0 8px rgba(255, 215, 0, 0.6))":"drop-shadow(0 0 4px rgba(0, 0, 0, 0.3))"},children:o.jsx("path",{d:"M6 1 L10 8 L7 8 L7 11 L5 11 L5 8 L2 8 Z"})})})),o.jsx("div",{style:{fontSize:"2rem",marginRight:"15px",width:"40px",textAlign:"center",position:"relative",marginLeft:t.gte(n(10))?"30px":"10px"},children:l?e.icon:"â“"}),o.jsx("div",{style:{flex:1},children:o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o.jsx("span",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"var(--text-color)"},children:l?e.name:"???"}),o.jsx("span",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"var(--accent-color)"},children:j(t,r.numberFormat)})]})}),o.jsxs("div",{style:{marginLeft:"12px",minWidth:"70px",textAlign:"right"},children:[o.jsx("div",{style:{color:y&&!g?"var(--gold-color)":"var(--text-secondary)",fontWeight:"bold"},children:j(u.equals(n(-1))?x:m,r.numberFormat)}),!u.equals(n(-1))&&o.jsxs("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)"},children:["for ",j(f,r.numberFormat)]})]})]},e.id)}),o.jsx(pe,{gameState:r,building:L.building,x:L.x,y:L.y,visible:L.visible,onHide:R}),E.visible&&E.buildingId&&o.jsx("div",{style:{position:"fixed",left:E.x,top:E.y-50,zIndex:1e3,pointerEvents:"none"},children:ie(E.buildingId,r.buildings[E.buildingId]||n(0))}),I.visible&&I.building&&o.jsx(fe,{building:I.building,gameState:r,onClose:()=>S({visible:!1,building:null})})]})};export{be as B};
